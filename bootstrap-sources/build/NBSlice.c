#include "omc_simulation_settings.h"
#include "NBSlice.h"
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT0,1,5) {&ErrorTypes_MessageType_TRANSLATION__desc,}};
#define _OMC_LIT0 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT0)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT1,1,4) {&ErrorTypes_Severity_ERROR__desc,}};
#define _OMC_LIT1 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT1)
#define _OMC_LIT2_data "Internal error %s"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT2,17,_OMC_LIT2_data);
#define _OMC_LIT2 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT2)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT3,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT2}};
#define _OMC_LIT3 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT3)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT4,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(63)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT3}};
#define _OMC_LIT4 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT4)
#define _OMC_LIT5_data "NBSlice.applyNewFrameRange failed because frame expression was not Expression.RANGE(): "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT5,87,_OMC_LIT5_data);
#define _OMC_LIT5 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT5)
#define _OMC_LIT6_data "NBSlice.resolveDimensionsSubscript"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT6,34,_OMC_LIT6_data);
#define _OMC_LIT6 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data ""
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,0,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
#define _OMC_LIT8_data "/home/adrpo33/OpenModelica/OMCompiler/Compiler/NBackEnd/Util/NBSlice.mo"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT8,71,_OMC_LIT8_data);
#define _OMC_LIT8 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT8)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT9_6,1.758197185e9);
#define _OMC_LIT9_6 MMC_REFREALLIT(_OMC_LIT_STRUCT9_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT9,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1709)),MMC_IMMEDIATE(MMC_TAGFIXNUM(7)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1710)),MMC_IMMEDIATE(MMC_TAGFIXNUM(5)),_OMC_LIT9_6}};
#define _OMC_LIT9 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "NBSlice.combineFrames2Indices"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,29,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
#define _OMC_LIT11_data "NBSlice.combineFrames2Indices failed because iterator binding could not be parsed: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT11,83,_OMC_LIT11_data);
#define _OMC_LIT11 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT11)
#define _OMC_LIT12_data " in "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT12,4,_OMC_LIT12_data);
#define _OMC_LIT12 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT12)
#define _OMC_LIT13_data "NBSlice.combineFrames2Indices failed because uniontype records are wrong: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT13,74,_OMC_LIT13_data);
#define _OMC_LIT13 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT13)
#define _OMC_LIT14_data "NBSlice.combineFrames2Indices failed for an unknown reason."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT14,59,_OMC_LIT14_data);
#define _OMC_LIT14 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT14)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT15,2,1) {_OMC_LIT14,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT15 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT15)
#define _OMC_LIT16_data "NBSlice.addMatrixEntry failed because index "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT16,44,_OMC_LIT16_data);
#define _OMC_LIT16 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT16)
#define _OMC_LIT17_data " could not be added. Matrix size: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT17,34,_OMC_LIT17_data);
#define _OMC_LIT17 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT17)
#define _OMC_LIT18_data "."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT18,1,_OMC_LIT18_data);
#define _OMC_LIT18 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT18)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT19_6,1.758197185e9);
#define _OMC_LIT19_6 MMC_REFREALLIT(_OMC_LIT_STRUCT19_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT19,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1530)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1530)),MMC_IMMEDIATE(MMC_TAGFIXNUM(76)),_OMC_LIT19_6}};
#define _OMC_LIT19 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT19)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT20_6,1.758197185e9);
#define _OMC_LIT20_6 MMC_REFREALLIT(_OMC_LIT_STRUCT20_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT20,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1498)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1502)),MMC_IMMEDIATE(MMC_TAGFIXNUM(16)),_OMC_LIT20_6}};
#define _OMC_LIT20 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT20)
#define _OMC_LIT21_data "NBSlice.resolveMixed failed because subscripts, dimensions and dependencies were not of equal length.\nvariable subscripts("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT21,122,_OMC_LIT21_data);
#define _OMC_LIT21 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT21)
#define _OMC_LIT22_data "): "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT22,3,_OMC_LIT22_data);
#define _OMC_LIT22 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT22)
#define _OMC_LIT23_data "{"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT23,1,_OMC_LIT23_data);
#define _OMC_LIT23 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT23)
#define _OMC_LIT24_data ", "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT24,2,_OMC_LIT24_data);
#define _OMC_LIT24 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT24)
#define _OMC_LIT25_data "}"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT25,1,_OMC_LIT25_data);
#define _OMC_LIT25 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT25)
#define _OMC_LIT26_data "\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT26,1,_OMC_LIT26_data);
#define _OMC_LIT26 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT26)
#define _OMC_LIT27_data "variable dimensions("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT27,20,_OMC_LIT27_data);
#define _OMC_LIT27 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT27)
#define _OMC_LIT28_data "equation dimensions("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT28,20,_OMC_LIT28_data);
#define _OMC_LIT28 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT28)
#define _OMC_LIT29_data "variable dependencies("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT29,22,_OMC_LIT29_data);
#define _OMC_LIT29 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT29)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT30_6,1.758197185e9);
#define _OMC_LIT30_6 MMC_REFREALLIT(_OMC_LIT_STRUCT30_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT30,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1442)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1442)),MMC_IMMEDIATE(MMC_TAGFIXNUM(66)),_OMC_LIT30_6}};
#define _OMC_LIT30 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT30)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT31_6,1.758197185e9);
#define _OMC_LIT31_6 MMC_REFREALLIT(_OMC_LIT_STRUCT31_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT31,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1392)),MMC_IMMEDIATE(MMC_TAGFIXNUM(11)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1395)),MMC_IMMEDIATE(MMC_TAGFIXNUM(18)),_OMC_LIT31_6}};
#define _OMC_LIT31 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT31)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT32_6,1.758197185e9);
#define _OMC_LIT32_6 MMC_REFREALLIT(_OMC_LIT_STRUCT32_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT32,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1326)),MMC_IMMEDIATE(MMC_TAGFIXNUM(7)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1326)),MMC_IMMEDIATE(MMC_TAGFIXNUM(76)),_OMC_LIT32_6}};
#define _OMC_LIT32 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT32)
#define _OMC_LIT33_data "NBSlice.resolveDependency failed for: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT33,38,_OMC_LIT33_data);
#define _OMC_LIT33 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT33)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT34_6,1.758197185e9);
#define _OMC_LIT34_6 MMC_REFREALLIT(_OMC_LIT_STRUCT34_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT34,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1207)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1230)),MMC_IMMEDIATE(MMC_TAGFIXNUM(18)),_OMC_LIT34_6}};
#define _OMC_LIT34 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT34)
#define _OMC_LIT35_data "NBSlice.resolveSkips failed because skip of "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT35,44,_OMC_LIT35_data);
#define _OMC_LIT35 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT35)
#define _OMC_LIT36_data " is too large for record elements "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT36,34,_OMC_LIT36_data);
#define _OMC_LIT36 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT36)
#define _OMC_LIT37_data " for type "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT37,10,_OMC_LIT37_data);
#define _OMC_LIT37 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT37)
#define _OMC_LIT38_data " is requested, but the cref is not part of a record: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT38,53,_OMC_LIT38_data);
#define _OMC_LIT38 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT38)
#define _OMC_LIT39_data " is too large."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT39,14,_OMC_LIT39_data);
#define _OMC_LIT39 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT39)
#define _OMC_LIT40_data "NBSlice.resolveSkips failed because there is no skip for type "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT40,62,_OMC_LIT40_data);
#define _OMC_LIT40 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT40)
#define _OMC_LIT41_data " is invalid."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT41,12,_OMC_LIT41_data);
#define _OMC_LIT41 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT41)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT42_6,1.758197185e9);
#define _OMC_LIT42_6 MMC_REFREALLIT(_OMC_LIT_STRUCT42_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT42,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1115)),MMC_IMMEDIATE(MMC_TAGFIXNUM(7)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1115)),MMC_IMMEDIATE(MMC_TAGFIXNUM(71)),_OMC_LIT42_6}};
#define _OMC_LIT42 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT42)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT43,2,0) {MMC_IMMEDIATE(MMC_TAGFIXNUM(1)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1))}};
#define _OMC_LIT43 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT43)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT44,1,3) {&NFType_INTEGER__desc,}};
#define _OMC_LIT44 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT44)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT45,2,0) {MMC_IMMEDIATE(MMC_TAGFIXNUM(3)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1))}};
#define _OMC_LIT45 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT45)
#define _OMC_LIT46_data "NBSlice.getDependentCrefsPseudoArrayCausalized.fixSingleDep failed because dependencies of size "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT46,96,_OMC_LIT46_data);
#define _OMC_LIT46 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT46)
#define _OMC_LIT47_data " could not be repeated to fit row size "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT47,39,_OMC_LIT47_data);
#define _OMC_LIT47 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT47)
#define _OMC_LIT48_data "NBSlice.fillDependencyArray failed because number of flattened indices "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT48,71,_OMC_LIT48_data);
#define _OMC_LIT48 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT48)
#define _OMC_LIT49_data " for dependency "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT49,16,_OMC_LIT49_data);
#define _OMC_LIT49 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT49)
#define _OMC_LIT50_data " could not be divided by or repeated to fit the body size "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT50,58,_OMC_LIT50_data);
#define _OMC_LIT50 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT50)
#define _OMC_LIT51_data " without rest."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT51,14,_OMC_LIT51_data);
#define _OMC_LIT51 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT51)
#define _OMC_LIT52_data "NBSlice.getDependentCrefsPseudoForCausalized failed because the equation size "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT52,78,_OMC_LIT52_data);
#define _OMC_LIT52 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT52)
#define _OMC_LIT53_data " could not be divided by the iterator size "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT53,43,_OMC_LIT53_data);
#define _OMC_LIT53 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT53)
#define _OMC_LIT54_data "NBSlice.getDependentCrefIndicesPseudoFor failed because the equation size "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT54,74,_OMC_LIT54_data);
#define _OMC_LIT54 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT54)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT55_6,1.758197185e9);
#define _OMC_LIT55_6 MMC_REFREALLIT(_OMC_LIT_STRUCT55_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT55,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(391)),MMC_IMMEDIATE(MMC_TAGFIXNUM(7)),MMC_IMMEDIATE(MMC_TAGFIXNUM(391)),MMC_IMMEDIATE(MMC_TAGFIXNUM(71)),_OMC_LIT55_6}};
#define _OMC_LIT55 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT55)
#define _OMC_LIT56_data "NBSlice.getDependentCrefIndicesPseudoFull failed because flattened indices "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT56,75,_OMC_LIT56_data);
#define _OMC_LIT56 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT56)
#define _OMC_LIT57_data " could not be repeated to fit equation size "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT57,44,_OMC_LIT57_data);
#define _OMC_LIT57 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT57)
#define _OMC_LIT58_data ". lst: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT58,7,_OMC_LIT58_data);
#define _OMC_LIT58 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT58)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT59_6,1.758197185e9);
#define _OMC_LIT59_6 MMC_REFREALLIT(_OMC_LIT_STRUCT59_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT59,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(354)),MMC_IMMEDIATE(MMC_TAGFIXNUM(7)),MMC_IMMEDIATE(MMC_TAGFIXNUM(354)),MMC_IMMEDIATE(MMC_TAGFIXNUM(71)),_OMC_LIT59_6}};
#define _OMC_LIT59 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT59)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT60_6,1.758197185e9);
#define _OMC_LIT60_6 MMC_REFREALLIT(_OMC_LIT_STRUCT60_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT60,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(306)),MMC_IMMEDIATE(MMC_TAGFIXNUM(5)),MMC_IMMEDIATE(MMC_TAGFIXNUM(306)),MMC_IMMEDIATE(MMC_TAGFIXNUM(101)),_OMC_LIT60_6}};
#define _OMC_LIT60 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT60)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT61_6,1.758197185e9);
#define _OMC_LIT61_6 MMC_REFREALLIT(_OMC_LIT_STRUCT61_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT61,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT8,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(278)),MMC_IMMEDIATE(MMC_TAGFIXNUM(5)),MMC_IMMEDIATE(MMC_TAGFIXNUM(278)),MMC_IMMEDIATE(MMC_TAGFIXNUM(101)),_OMC_LIT61_6}};
#define _OMC_LIT61 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT61)
#define _OMC_LIT62_data "	"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT62,1,_OMC_LIT62_data);
#define _OMC_LIT62 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT62)
#define _OMC_LIT63_data ";\n	"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT63,3,_OMC_LIT63_data);
#define _OMC_LIT63 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT63)
#define _OMC_LIT64_data ";"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT64,1,_OMC_LIT64_data);
#define _OMC_LIT64 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT64)
#define _OMC_LIT65_data "\n	slice: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT65,9,_OMC_LIT65_data);
#define _OMC_LIT65 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT65)
#include "util/modelica.h"

#include "NBSlice_includes.h"


/* default, do not make protected functions static */
#if !defined(PROTECTED_FUNCTION_STATIC)
#define PROTECTED_FUNCTION_STATIC
#endif
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_applyNewFrameRange(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fframe, modelica_metatype _range);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_applyNewFrameRange,2,0) {(void*) boxptr_NBSlice_applyNewFrameRange,0}};
#define boxvar_NBSlice_applyNewFrameRange MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_applyNewFrameRange)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveDimensionsSubscript(threadData_t *threadData, modelica_metatype _replaced, modelica_integer _size);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveDimensionsSubscript(threadData_t *threadData, modelica_metatype _replaced, modelica_metatype _size);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveDimensionsSubscript,2,0) {(void*) boxptr_NBSlice_resolveDimensionsSubscript,0}};
#define boxvar_NBSlice_resolveDimensionsSubscript MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveDimensionsSubscript)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveDimensionsSubscripts(threadData_t *threadData, modelica_metatype _sizes, modelica_metatype _subs, modelica_metatype _replacements);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveDimensionsSubscripts,2,0) {(void*) boxptr_NBSlice_resolveDimensionsSubscripts,0}};
#define boxvar_NBSlice_resolveDimensionsSubscripts MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveDimensionsSubscripts)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_getCrefInFrameIndices(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _frames, modelica_metatype _mapping, modelica_metatype _map);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_getCrefInFrameIndices,2,0) {(void*) boxptr_NBSlice_getCrefInFrameIndices,0}};
#define boxvar_NBSlice_getCrefInFrameIndices MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_getCrefInFrameIndices)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_combineFrames2Indices(threadData_t *threadData, modelica_integer _first, modelica_metatype _sizes, modelica_metatype _subs, modelica_metatype _frames, modelica_metatype _replacements, modelica_metatype __omcQ_24in_5Findices);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_combineFrames2Indices(threadData_t *threadData, modelica_metatype _first, modelica_metatype _sizes, modelica_metatype _subs, modelica_metatype _frames, modelica_metatype _replacements, modelica_metatype __omcQ_24in_5Findices);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_combineFrames2Indices,2,0) {(void*) boxptr_NBSlice_combineFrames2Indices,0}};
#define boxvar_NBSlice_combineFrames2Indices MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_combineFrames2Indices)
PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveReductions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _stripped, modelica_metatype _acc, modelica_integer _index);
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveReductions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _stripped, modelica_metatype _acc, modelica_metatype _index);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveReductions,2,0) {(void*) boxptr_NBSlice_resolveReductions,0}};
#define boxvar_NBSlice_resolveReductions MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveReductions)
PROTECTED_FUNCTION_STATIC void omc_NBSlice_addMatrixEntry(threadData_t *threadData, modelica_metatype _m, modelica_metatype _modes, modelica_integer _eqn_idx, modelica_integer _var_idx, modelica_metatype _mode);
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_addMatrixEntry(threadData_t *threadData, modelica_metatype _m, modelica_metatype _modes, modelica_metatype _eqn_idx, modelica_metatype _var_idx, modelica_metatype _mode);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_addMatrixEntry,2,0) {(void*) boxptr_NBSlice_addMatrixEntry,0}};
#define boxvar_NBSlice_addMatrixEntry MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_addMatrixEntry)
PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveEquationDimensions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _m, modelica_metatype _modes, modelica_metatype _mode, modelica_metatype _eqn_idx_ptr, modelica_integer _index);
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveEquationDimensions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _m, modelica_metatype _modes, modelica_metatype _mode, modelica_metatype _eqn_idx_ptr, modelica_metatype _index);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveEquationDimensions,2,0) {(void*) boxptr_NBSlice_resolveEquationDimensions,0}};
#define boxvar_NBSlice_resolveEquationDimensions MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveEquationDimensions)
PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveAllReduced(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _skip_idx, modelica_integer _size, modelica_integer _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveAllReduced(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _skip_idx, modelica_metatype _size, modelica_metatype _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveAllReduced,2,0) {(void*) boxptr_NBSlice_resolveAllReduced,0}};
#define boxvar_NBSlice_resolveAllReduced MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveAllReduced)
PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveMixed(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _skip_idx, modelica_metatype _ty, modelica_metatype _frames, modelica_metatype _regulars, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveMixed(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _skip_idx, modelica_metatype _ty, modelica_metatype _frames, modelica_metatype _regulars, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveMixed,2,0) {(void*) boxptr_NBSlice_resolveMixed,0}};
#define boxvar_NBSlice_resolveMixed MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveMixed)
PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveAllRegular(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _skip_idx, modelica_integer _size, modelica_integer _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveAllRegular(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _skip_idx, modelica_metatype _size, modelica_metatype _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveAllRegular,2,0) {(void*) boxptr_NBSlice_resolveAllRegular,0}};
#define boxvar_NBSlice_resolveAllRegular MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveAllRegular)
PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveDependency(threadData_t *threadData, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _eqn_arr_idx, modelica_metatype _iter, modelica_metatype _ty, modelica_metatype _dep, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _fullmap, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveDependency(threadData_t *threadData, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _eqn_arr_idx, modelica_metatype _iter, modelica_metatype _ty, modelica_metatype _dep, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _fullmap, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveDependency,2,0) {(void*) boxptr_NBSlice_resolveDependency,0}};
#define boxvar_NBSlice_resolveDependency MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveDependency)
PROTECTED_FUNCTION_STATIC modelica_string omc_NBSlice_val1String(threadData_t *threadData, modelica_metatype _val);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_val1String,2,0) {(void*) boxptr_NBSlice_val1String,0}};
#define boxvar_NBSlice_val1String MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_val1String)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NBSlice_keyEqual(threadData_t *threadData, modelica_metatype _key1, modelica_metatype _key2);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_keyEqual(threadData_t *threadData, modelica_metatype _key1, modelica_metatype _key2);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_keyEqual,2,0) {(void*) boxptr_NBSlice_keyEqual,0}};
#define boxvar_NBSlice_keyEqual MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_keyEqual)
PROTECTED_FUNCTION_STATIC modelica_integer omc_NBSlice_keyHash(threadData_t *threadData, modelica_metatype _key);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_keyHash(threadData_t *threadData, modelica_metatype _key);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_keyHash,2,0) {(void*) boxptr_NBSlice_keyHash,0}};
#define boxvar_NBSlice_keyHash MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_keyHash)
PROTECTED_FUNCTION_STATIC modelica_string omc_NBSlice_keyString(threadData_t *threadData, modelica_metatype _key);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_keyString,2,0) {(void*) boxptr_NBSlice_keyString,0}};
#define boxvar_NBSlice_keyString MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_keyString)
PROTECTED_FUNCTION_STATIC modelica_integer omc_NBSlice_resolveSkips(threadData_t *threadData, modelica_integer __omcQ_24in_5Findex, modelica_metatype __omcQ_24in_5Fty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap, modelica_metatype *out_ty);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveSkips(threadData_t *threadData, modelica_metatype __omcQ_24in_5Findex, modelica_metatype __omcQ_24in_5Fty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap, modelica_metatype *out_ty);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveSkips,2,0) {(void*) boxptr_NBSlice_resolveSkips,0}};
#define boxvar_NBSlice_resolveSkips MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveSkips)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveSkipsLst(threadData_t *threadData, modelica_integer _index, modelica_metatype _ty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveSkipsLst(threadData_t *threadData, modelica_metatype _index, modelica_metatype _ty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveSkipsLst,2,0) {(void*) boxptr_NBSlice_resolveSkipsLst,0}};
#define boxvar_NBSlice_resolveSkipsLst MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveSkipsLst)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveEqualInertia(threadData_t *threadData, modelica_metatype _frame_inertia_lst, modelica_metatype _replacements, modelica_integer *out_status);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveEqualInertia(threadData_t *threadData, modelica_metatype _frame_inertia_lst, modelica_metatype _replacements, modelica_metatype *out_status);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_resolveEqualInertia,2,0) {(void*) boxptr_NBSlice_resolveEqualInertia,0}};
#define boxvar_NBSlice_resolveEqualInertia MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_resolveEqualInertia)
PROTECTED_FUNCTION_STATIC modelica_integer omc_NBSlice_frameLocationInertia(threadData_t *threadData, modelica_metatype _frameLocation);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_frameLocationInertia(threadData_t *threadData, modelica_metatype _frameLocation);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_frameLocationInertia,2,0) {(void*) boxptr_NBSlice_frameLocationInertia,0}};
#define boxvar_NBSlice_frameLocationInertia MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_frameLocationInertia)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep(threadData_t *threadData, modelica_integer _row_size, modelica_metatype __omcQ_24in_5Fsingle_5Fdep, modelica_metatype _full_deps);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep(threadData_t *threadData, modelica_metatype _row_size, modelica_metatype __omcQ_24in_5Fsingle_5Fdep, modelica_metatype _full_deps);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep,2,0) {(void*) boxptr_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep,0}};
#define boxvar_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep MMC_REFSTRUCTLIT(boxvar_lit_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep)

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_applyNewFrameRange(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fframe, modelica_metatype _range)
{
  modelica_metatype _frame = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _frame = __omcQ_24in_5Fframe;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _frame;
    {
      modelica_metatype _name = NULL;
      modelica_metatype _exp = NULL;
      modelica_metatype _map = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _name has no default value.
      // _exp has no default value.
      // _map has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 1));
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,10,4) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _name = tmpMeta6;
          _exp = tmpMeta7;
          _map = tmpMeta8;
          /* Pattern matching succeeded */
          tmpMeta9 = mmc_mk_box3(0, _name, omc_NFExpression_sliceRange(threadData, _exp, _range), _map);
          tmpMeta1 = tmpMeta9;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          
          _exp = tmpMeta10;
          /* Pattern matching succeeded */
          tmpMeta12 = stringAppend(_OMC_LIT5,omc_NFExpression_toString(threadData, _exp));
          tmpMeta11 = mmc_mk_cons(tmpMeta12, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta11);
          goto goto_2;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _frame = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _frame;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveDimensionsSubscript(threadData_t *threadData, modelica_metatype _replaced, modelica_integer _size)
{
  modelica_metatype _res = NULL;
  modelica_metatype _rep = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _res has no default value.
  // _rep has no default value.
  _rep = omc_NFSimplifyExp_simplifyDump(threadData, _replaced, 1 /* true */, _OMC_LIT6, _OMC_LIT7);

  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _rep;
    {
      modelica_integer _start;
      modelica_integer _step;
      modelica_integer _stop;
      int tmp4;
      // _start has no default value.
      // _step has no default value.
      // _stop has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_rep), 2))), MMC_REFSTRUCTLIT(mmc_nil));
          tmpMeta1 = tmpMeta5;
          goto tmp3_done;
        }
        case 13: {
          
          /* Pattern matching succeeded */
          _start = omc_NFExpression_getIntegerRange(threadData, _rep ,&_step ,&_stop);
          tmpMeta1 = omc_List_intRange3(threadData, _start, _step, _stop);
          goto tmp3_done;
        }
        case 11: {
          modelica_metatype tmpMeta6;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype __omcQ_24tmpVar3;
            modelica_metatype* tmp7;
            modelica_metatype tmpMeta8;
            modelica_metatype __omcQ_24tmpVar2;
            modelica_integer tmp9;
            modelica_metatype _e_loopVar = 0;
            modelica_integer tmp10;
            modelica_metatype _e;
            _e_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_rep), 3)));
            tmp10 = 1;
            tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar3 = tmpMeta8; /* defaultValue */
            tmp7 = &__omcQ_24tmpVar3;
            while(1) {
              tmp9 = 1;
              if (tmp10 <= arrayLength(_e_loopVar)) {
                _e = arrayGet(_e_loopVar, tmp10++);
                tmp9--;
              }
              if (tmp9 == 0) {
                __omcQ_24tmpVar2 = omc_NBSlice_resolveDimensionsSubscript(threadData, _e, _size);
                *tmp7 = mmc_mk_cons(__omcQ_24tmpVar2,0);
                tmp7 = &MMC_CDR(*tmp7);
              } else if (tmp9 == 1) {
                break;
              } else {
                goto goto_2;
              }
            }
            *tmp7 = mmc_mk_nil();
            tmpMeta6 = __omcQ_24tmpVar3;
          }
          tmpMeta1 = omc_List_flatten(threadData, tmpMeta6);
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = omc_List_intRange(threadData, _size);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _res = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _res;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveDimensionsSubscript(threadData_t *threadData, modelica_metatype _replaced, modelica_metatype _size)
{
  modelica_integer tmp1;
  modelica_metatype _res = NULL;
  tmp1 = mmc_unbox_integer(_size);
  _res = omc_NBSlice_resolveDimensionsSubscript(threadData, _replaced, tmp1);
  /* skip box _res; list<#Integer> */
  return _res;
}

static modelica_metatype closure0_NBReplacements_applySimpleExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype replacements = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NBReplacements_applySimpleExp(thData, $in_exp, replacements);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveDimensionsSubscripts(threadData_t *threadData, modelica_metatype _sizes, modelica_metatype _subs, modelica_metatype _replacements)
{
  modelica_metatype _values = NULL;
  modelica_metatype _replaced = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _values has no default value.
  // _replaced has no default value.
  {
    modelica_metatype __omcQ_24tmpVar5;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar4;
    modelica_integer tmp5;
    modelica_metatype _sub_loopVar = 0;
    modelica_metatype _sub;
    _sub_loopVar = _subs;
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar5 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar5;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_sub_loopVar)) {
        _sub = MMC_CAR(_sub_loopVar);
        _sub_loopVar = MMC_CDR(_sub_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        tmpMeta4 = mmc_mk_box1(0, _replacements);
        __omcQ_24tmpVar4 = omc_NFExpression_map(threadData, _sub, (modelica_fnptr) mmc_mk_box2(0,closure0_NBReplacements_applySimpleExp,tmpMeta4));
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar4,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar5;
  }
  _replaced = tmpMeta1;

  {
    modelica_metatype __omcQ_24tmpVar7;
    modelica_metatype* tmp7;
    modelica_metatype tmpMeta8;
    modelica_metatype __omcQ_24tmpVar6;
    modelica_integer tmp9;
    modelica_metatype _exp_loopVar = 0;
    modelica_metatype _exp;
    modelica_metatype _size_loopVar = 0;
    modelica_metatype _size;
    _exp_loopVar = _replaced;
    _size_loopVar = _sizes;
    tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar7 = tmpMeta8; /* defaultValue */
    tmp7 = &__omcQ_24tmpVar7;
    while(1) {
      tmp9 = 2;
      if (!listEmpty(_exp_loopVar)) {
        _exp = MMC_CAR(_exp_loopVar);
        _exp_loopVar = MMC_CDR(_exp_loopVar);
        tmp9--;
      }if (!listEmpty(_size_loopVar)) {
        _size = MMC_CAR(_size_loopVar);
        _size_loopVar = MMC_CDR(_size_loopVar);
        tmp9--;
      }
      if (tmp9 == 0) {
        __omcQ_24tmpVar6 = omc_NBSlice_resolveDimensionsSubscript(threadData, _exp, mmc_unbox_integer(_size));
        *tmp7 = mmc_mk_cons(__omcQ_24tmpVar6,0);
        tmp7 = &MMC_CDR(*tmp7);
      } else if (tmp9 == 2) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp7 = mmc_mk_nil();
    tmpMeta6 = __omcQ_24tmpVar7;
  }
  _values = tmpMeta6;

  _values = omc_List_combination(threadData, _values);
  _return: OMC_LABEL_UNUSED
  return _values;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_getCrefInFrameIndices(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _frames, modelica_metatype _mapping, modelica_metatype _map)
{
  modelica_metatype _scal_lst = NULL;
  modelica_metatype _c = NULL;
  modelica_integer _var_arr_idx;
  modelica_integer _var_start;
  modelica_metatype _sizes = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype _ty = NULL;
  modelica_integer _complex_size;
  modelica_integer tmp1_c0 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_integer tmp10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _scal_lst has no default value.
  // _c has no default value.
  // _var_arr_idx has no default value.
  // _var_start has no default value.
  // _sizes has no default value.
  // _subs has no default value.
  // _ty has no default value.
  // _complex_size has no default value.
  
  
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = omc_UnorderedMap_get(threadData, _cref, _map);
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_integer tmp7;
          if (optionNone(tmp4_1)) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 1));
          tmp7 = mmc_unbox_integer(tmpMeta6);
          _var_arr_idx = tmp7  /* pattern as ty=Integer */;
          /* Pattern matching succeeded */
          tmp1_c0 = _var_arr_idx;
          tmpMeta[0+1] = _cref;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          _c = omc_NFComponentRef_stripSubscriptsAll(threadData, _cref);
          tmp1_c0 = mmc_unbox_integer(omc_UnorderedMap_getSafe(threadData, _c, _map, _OMC_LIT9));
          tmpMeta[0+1] = _c;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _var_arr_idx = tmp1_c0;
  _c = tmpMeta[0+1];

  /* Pattern-matching assignment */
  tmpMeta8 = arrayGet((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mapping), 5))),_var_arr_idx) /* DAE.ASUB */;
  tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta8), 1));
  tmp10 = mmc_unbox_integer(tmpMeta9);
  _var_start = tmp10  /* pattern as ty=Integer */;

  tmpMeta11 = MMC_REFSTRUCTLIT(mmc_nil);
  _sizes = omc_NFComponentRef_sizes(threadData, _c, 0 /* false */, 0 /* false */, tmpMeta11);

  _subs = omc_NFComponentRef_subscriptsToExpression(threadData, _cref, 1 /* true */);

  _ty = omc_NFType_arrayElementType(threadData, omc_NFComponentRef_getComponentType(threadData, _cref));

  { /* match expression */
    modelica_metatype tmp15_1;
    tmp15_1 = omc_NFType_complexSize(threadData, _ty, 0 /* false */);
    {
      volatile mmc_switch_type tmp15;
      int tmp16;
      tmp15 = 0;
      for (; tmp15 < 2; tmp15++) {
        switch (MMC_SWITCH_CAST(tmp15)) {
        case 0: {
          modelica_metatype tmpMeta17;
          modelica_integer tmp18;
          modelica_metatype tmpMeta19;
          modelica_metatype tmpMeta20;
          modelica_metatype tmpMeta21;
          modelica_metatype tmpMeta22;
          modelica_metatype tmpMeta23;
          modelica_integer tmp24;
          modelica_integer tmp25;
          modelica_integer tmp26;
          if (optionNone(tmp15_1)) goto tmp14_end;
          tmpMeta17 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp15_1), 1));
          tmp18 = mmc_unbox_integer(tmpMeta17);
          _complex_size = tmp18  /* pattern as ty=Integer */;
          /* Pattern matching succeeded */
          tmpMeta19 = MMC_REFSTRUCTLIT(mmc_nil);
          _scal_lst = tmpMeta19;

          tmp24 = _complex_size; tmp25 = ((modelica_integer) -1); tmp26 = ((modelica_integer) 1);
          if(!(((tmp25 > 0) && (tmp24 > tmp26)) || ((tmp25 < 0) && (tmp24 < tmp26))))
          {
            modelica_integer _i;
            for(_i = _complex_size; in_range_integer(_i, tmp24, tmp26); _i += tmp25)
            {
              tmpMeta20 = mmc_mk_cons(mmc_mk_integer(_complex_size), _sizes);
              tmpMeta22 = mmc_mk_box2(3, &NFExpression_INTEGER__desc, mmc_mk_integer(_i));
              tmpMeta21 = mmc_mk_cons(tmpMeta22, _subs);
              tmpMeta23 = MMC_REFSTRUCTLIT(mmc_nil);
              _scal_lst = listAppend(listReverse(omc_NBSlice_combineFrames2Indices(threadData, _var_start, tmpMeta20, tmpMeta21, _frames, omc_UnorderedMap_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 1)), tmpMeta23)), _scal_lst);
            }
          }
          tmpMeta12 = _scal_lst;
          goto tmp14_done;
        }
        case 1: {
          modelica_metatype tmpMeta27;
          
          /* Pattern matching succeeded */
          tmpMeta27 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta12 = listReverse(omc_NBSlice_combineFrames2Indices(threadData, _var_start, _sizes, _subs, _frames, omc_UnorderedMap_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 1)), tmpMeta27));
          goto tmp14_done;
        }
        }
        goto tmp14_end;
        tmp14_end: ;
      }
      goto goto_13;
      goto_13:;
      MMC_THROW_INTERNAL();
      goto tmp14_done;
      tmp14_done:;
    }
  }
  _scal_lst = tmpMeta12;
  _return: OMC_LABEL_UNUSED
  return _scal_lst;
}

static modelica_metatype closure1_NBReplacements_applySimpleExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype replacements = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NBReplacements_applySimpleExp(thData, $in_exp, replacements);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_combineFrames2Indices(threadData_t *threadData, modelica_integer _first, modelica_metatype _sizes, modelica_metatype _subs, modelica_metatype _frames, modelica_metatype _replacements, modelica_metatype __omcQ_24in_5Findices)
{
  modelica_metatype _indices = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _indices = __omcQ_24in_5Findices;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _frames;
    {
      modelica_metatype _rest = NULL;
      modelica_metatype _iterator = NULL;
      modelica_metatype _range = NULL;
      modelica_metatype _map = NULL;
      modelica_integer _start;
      modelica_integer _step;
      modelica_integer _stop;
      modelica_metatype _values = NULL;
      modelica_metatype _iterator_exps = NULL;
      modelica_metatype _iterator_lst = NULL;
      modelica_integer _sub_idx;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _rest has no default value.
      // _iterator has no default value.
      // _range has no default value.
      // _map has no default value.
      // _start has no default value.
      // _step has no default value.
      // _stop has no default value.
      // _values has no default value.
      // _iterator_exps has no default value.
      // _iterator_lst has no default value.
      // _sub_idx has no default value.
      tmp4 = 0;
      for (; tmp4 < 4; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (!listEmpty(tmp4_1)) goto tmp3_end;
          /* Pattern matching succeeded */
          _values = omc_NBSlice_resolveDimensionsSubscripts(threadData, _sizes, _subs, _replacements);
          {
            modelica_metatype __omcQ_24tmpVar9;
            modelica_metatype* tmp7;
            modelica_metatype tmpMeta8;
            modelica_metatype __omcQ_24tmpVar8;
            modelica_integer tmp9;
            modelica_metatype _v_loopVar = 0;
            modelica_metatype _v;
            _v_loopVar = _values;
            tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar9 = tmpMeta8; /* defaultValue */
            tmp7 = &__omcQ_24tmpVar9;
            while(1) {
              tmp9 = 1;
              if (!listEmpty(_v_loopVar)) {
                _v = MMC_CAR(_v_loopVar);
                _v_loopVar = MMC_CDR(_v_loopVar);
                tmp9--;
              }
              if (tmp9 == 0) {
                __omcQ_24tmpVar8 = mmc_mk_integer(omc_NBSlice_locationToIndex(threadData, _sizes, _v, _first));
                *tmp7 = mmc_mk_cons(__omcQ_24tmpVar8,0);
                tmp7 = &MMC_CDR(*tmp7);
              } else if (tmp9 == 1) {
                break;
              } else {
                goto goto_2;
              }
            }
            *tmp7 = mmc_mk_nil();
            tmpMeta6 = __omcQ_24tmpVar9;
          }
          tmpMeta1 = tmpMeta6;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta33;
          modelica_metatype tmpMeta34;
          modelica_metatype tmpMeta35;
          modelica_metatype tmpMeta36;
          modelica_metatype tmpMeta37;
          modelica_metatype tmpMeta38;
          if (listEmpty(tmp4_1)) goto tmp3_end;
          tmpMeta10 = MMC_CAR(tmp4_1);
          tmpMeta11 = MMC_CDR(tmp4_1);
          tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta10), 1));
          tmpMeta13 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta10), 2));
          tmpMeta14 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta10), 3));
          _iterator = tmpMeta12;
          _range = tmpMeta13;
          _map = tmpMeta14;
          _rest = tmpMeta11;
          /* Pattern matching succeeded */
          { /* match expression */
            modelica_metatype tmp18_1;
            tmp18_1 = _range;
            {
              int tmp18;
              {
                switch (MMC_SWITCH_CAST(valueConstructor(tmp18_1))) {
                case 13: {
                  
                  /* Pattern matching succeeded */
                  _start = omc_NFExpression_getIntegerRange(threadData, _range ,&_step ,&_stop);
                  tmpMeta15 = omc_List_intRange3(threadData, _start, _step, _stop);
                  goto tmp17_done;
                }
                case 11: {
                  modelica_metatype tmpMeta19;
                  modelica_metatype tmpMeta25;
                  
                  /* Pattern matching succeeded */
                  {
                    modelica_metatype __omcQ_24tmpVar11;
                    modelica_metatype* tmp20;
                    modelica_metatype tmpMeta21;
                    modelica_metatype tmpMeta22;
                    modelica_metatype __omcQ_24tmpVar10;
                    modelica_integer tmp23;
                    modelica_metatype _e_loopVar = 0;
                    modelica_integer tmp24;
                    modelica_metatype _e;
                    _e_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_range), 3)));
                    tmp24 = 1;
                    tmpMeta21 = MMC_REFSTRUCTLIT(mmc_nil);
                    __omcQ_24tmpVar11 = tmpMeta21; /* defaultValue */
                    tmp20 = &__omcQ_24tmpVar11;
                    while(1) {
                      tmp23 = 1;
                      if (tmp24 <= arrayLength(_e_loopVar)) {
                        _e = arrayGet(_e_loopVar, tmp24++);
                        tmp23--;
                      }
                      if (tmp23 == 0) {
                        tmpMeta22 = mmc_mk_box1(0, _replacements);
                        __omcQ_24tmpVar10 = omc_NFExpression_map(threadData, _e, (modelica_fnptr) mmc_mk_box2(0,closure1_NBReplacements_applySimpleExp,tmpMeta22));
                        *tmp20 = mmc_mk_cons(__omcQ_24tmpVar10,0);
                        tmp20 = &MMC_CDR(*tmp20);
                      } else if (tmp23 == 1) {
                        break;
                      } else {
                        goto goto_16;
                      }
                    }
                    *tmp20 = mmc_mk_nil();
                    tmpMeta19 = __omcQ_24tmpVar11;
                  }
                  _iterator_exps = tmpMeta19;
                  {
                    modelica_metatype __omcQ_24tmpVar13;
                    modelica_metatype* tmp26;
                    modelica_metatype tmpMeta27;
                    modelica_metatype __omcQ_24tmpVar12;
                    modelica_integer tmp28;
                    modelica_metatype _e_loopVar = 0;
                    modelica_metatype _e;
                    _e_loopVar = _iterator_exps;
                    tmpMeta27 = MMC_REFSTRUCTLIT(mmc_nil);
                    __omcQ_24tmpVar13 = tmpMeta27; /* defaultValue */
                    tmp26 = &__omcQ_24tmpVar13;
                    while(1) {
                      tmp28 = 1;
                      if (!listEmpty(_e_loopVar)) {
                        _e = MMC_CAR(_e_loopVar);
                        _e_loopVar = MMC_CDR(_e_loopVar);
                        tmp28--;
                      }
                      if (tmp28 == 0) {
                        __omcQ_24tmpVar12 = mmc_mk_integer(omc_NFExpression_integerValue(threadData, omc_NFSimplifyExp_simplifyDump(threadData, _e, 1 /* true */, _OMC_LIT10, _OMC_LIT7)));
                        *tmp26 = mmc_mk_cons(__omcQ_24tmpVar12,0);
                        tmp26 = &MMC_CDR(*tmp26);
                      } else if (tmp28 == 1) {
                        break;
                      } else {
                        goto goto_16;
                      }
                    }
                    *tmp26 = mmc_mk_nil();
                    tmpMeta25 = __omcQ_24tmpVar13;
                  }
                  tmpMeta15 = tmpMeta25;
                  goto tmp17_done;
                }
                default:
                tmp17_default: OMC_LABEL_UNUSED; {
                  modelica_metatype tmpMeta29;
                  modelica_metatype tmpMeta30;
                  modelica_metatype tmpMeta31;
                  modelica_metatype tmpMeta32;
                  
                  /* Pattern matching succeeded */
                  tmpMeta30 = stringAppend(_OMC_LIT11,omc_NFComponentRef_toString(threadData, _iterator));
                  tmpMeta31 = stringAppend(tmpMeta30,_OMC_LIT12);
                  tmpMeta32 = stringAppend(tmpMeta31,omc_NFExpression_toString(threadData, _range));
                  tmpMeta29 = mmc_mk_cons(tmpMeta32, MMC_REFSTRUCTLIT(mmc_nil));
                  omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta29);
                  goto goto_16;
                  goto tmp17_done;
                }
                }
                goto tmp17_end;
                tmp17_end: ;
              }
              goto goto_16;
              goto_16:;
              goto goto_2;
              goto tmp17_done;
              tmp17_done:;
            }
          }
          _iterator_lst = tmpMeta15;

          _sub_idx = ((modelica_integer) 1);

          {
            modelica_metatype _index;
            for (tmpMeta33 = _iterator_lst; !listEmpty(tmpMeta33); tmpMeta33=MMC_CDR(tmpMeta33))
            {
              _index = MMC_CAR(tmpMeta33);
              tmpMeta34 = mmc_mk_box2(3, &NFExpression_INTEGER__desc, _index);
              omc_UnorderedMap_add(threadData, _iterator, tmpMeta34, _replacements);

              omc_NBEquation_Iterator_createMappedLocationReplacement(threadData, _map, _sub_idx, _replacements);

              if(listEmpty(_rest))
              {
                _values = omc_NBSlice_resolveDimensionsSubscripts(threadData, _sizes, _subs, _replacements);

                {
                  modelica_metatype _v;
                  for (tmpMeta35 = listReverse(_values); !listEmpty(tmpMeta35); tmpMeta35=MMC_CDR(tmpMeta35))
                  {
                    _v = MMC_CAR(tmpMeta35);
                    tmpMeta36 = mmc_mk_cons(mmc_mk_integer(omc_NBSlice_locationToIndex(threadData, _sizes, _v, _first)), _indices);
                    _indices = tmpMeta36;
                  }
                }
              }
              else
              {
                _indices = omc_NBSlice_combineFrames2Indices(threadData, _first, _sizes, _subs, _rest, _replacements, _indices);
              }

              _sub_idx = ((modelica_integer) 1) + _sub_idx;
            }
          }
          tmpMeta1 = _indices;
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta39;
          modelica_metatype tmpMeta40;
          modelica_metatype tmpMeta41;
          modelica_metatype tmpMeta42;
          modelica_metatype tmpMeta43;
          modelica_metatype tmpMeta44;
          modelica_metatype tmpMeta45;
          modelica_metatype tmpMeta46;
          if (listEmpty(tmp4_1)) goto tmp3_end;
          tmpMeta39 = MMC_CAR(tmp4_1);
          tmpMeta40 = MMC_CDR(tmp4_1);
          tmpMeta41 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta39), 1));
          tmpMeta42 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta39), 2));
          
          _iterator = tmpMeta41;
          _range = tmpMeta42;
          /* Pattern matching succeeded */
          tmpMeta44 = stringAppend(_OMC_LIT13,omc_NFComponentRef_toString(threadData, _iterator));
          tmpMeta45 = stringAppend(tmpMeta44,_OMC_LIT12);
          tmpMeta46 = stringAppend(tmpMeta45,omc_NFExpression_toString(threadData, _range));
          tmpMeta43 = mmc_mk_cons(tmpMeta46, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta43);
          goto goto_2;
          goto tmp3_done;
        }
        case 3: {
          
          /* Pattern matching succeeded */
          omc_Error_addMessage(threadData, _OMC_LIT4, _OMC_LIT15);
          goto goto_2;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _indices = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _indices;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_combineFrames2Indices(threadData_t *threadData, modelica_metatype _first, modelica_metatype _sizes, modelica_metatype _subs, modelica_metatype _frames, modelica_metatype _replacements, modelica_metatype __omcQ_24in_5Findices)
{
  modelica_integer tmp1;
  modelica_metatype _indices = NULL;
  tmp1 = mmc_unbox_integer(_first);
  _indices = omc_NBSlice_combineFrames2Indices(threadData, tmp1, _sizes, _subs, _frames, _replacements, __omcQ_24in_5Findices);
  /* skip box _indices; list<#Integer> */
  return _indices;
}

PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveReductions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _stripped, modelica_metatype _acc, modelica_integer _index)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _lst;
    {
      modelica_metatype _rest = NULL;
      modelica_metatype _sub = NULL;
      modelica_metatype _dim = NULL;
      modelica_metatype _cref = NULL;
      modelica_metatype _val = NULL;
      modelica_integer _sub_idx;
      volatile mmc_switch_type tmp3;
      int tmp4;
      // _rest has no default value.
      // _sub has no default value.
      // _dim has no default value.
      // _cref has no default value.
      // _val has no default value.
      // _sub_idx has no default value.
      tmp3 = 0;
      for (; tmp3 < 3; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          if (!listEmpty(tmp3_1)) goto tmp2_end;
          /* Pattern matching succeeded */
          _cref = omc_NFComponentRef_mergeSubscripts(threadData, listReverse(_acc), _stripped, 1 /* true */, 0 /* false */);

          _val = omc_NFComponentRef_scalarizeAll(threadData, _cref, 1 /* true */);

          omc_UnorderedMap_add(threadData, arrayList(_key), _val, _map);
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_integer tmp9;
          modelica_metatype tmpMeta10;
          if (listEmpty(tmp3_1)) goto tmp2_end;
          tmpMeta5 = MMC_CAR(tmp3_1);
          tmpMeta6 = MMC_CDR(tmp3_1);
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 1));
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 3));
          tmp9 = mmc_unbox_integer(tmpMeta8);
          if (0 /* false */ != tmp9) goto tmp2_end;
          _sub = tmpMeta7;
          _rest = tmpMeta6;
          /* Pattern matching succeeded */
          tmpMeta10 = mmc_mk_cons(_sub, _acc);
          /* Tail recursive call */
          _lst = _rest;
          _acc = tmpMeta10;
          _index = ((modelica_integer) 1) + _index;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          ;
          goto tmp2_done;
        }
        case 2: {
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_integer tmp16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          modelica_metatype tmpMeta19;
          if (listEmpty(tmp3_1)) goto tmp2_end;
          tmpMeta11 = MMC_CAR(tmp3_1);
          tmpMeta12 = MMC_CDR(tmp3_1);
          tmpMeta13 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 1));
          tmpMeta14 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 2));
          tmpMeta15 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 3));
          tmp16 = mmc_unbox_integer(tmpMeta15);
          if (1 /* true */ != tmp16) goto tmp2_end;
          _sub = tmpMeta13;
          _dim = tmpMeta14;
          _rest = tmpMeta12;
          /* Pattern matching succeeded */
          _sub_idx = ((modelica_integer) 1);

          {
            modelica_metatype _s;
            for (tmpMeta17 = omc_NFSubscript_scalarize(threadData, _sub, _dim, 1 /* true */); !listEmpty(tmpMeta17); tmpMeta17=MMC_CDR(tmpMeta17))
            {
              _s = MMC_CAR(tmpMeta17);
              arrayUpdate(_key, _index, mmc_mk_integer(_sub_idx));

              tmpMeta18 = mmc_mk_cons(_s, _acc);
              omc_NBSlice_resolveReductions(threadData, _rest, _map, _key, _stripped, tmpMeta18, ((modelica_integer) 1) + _index);

              _sub_idx = ((modelica_integer) 1) + _sub_idx;
            }
          }
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveReductions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _stripped, modelica_metatype _acc, modelica_metatype _index)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_index);
  omc_NBSlice_resolveReductions(threadData, _lst, _map, _key, _stripped, _acc, tmp1);
  return;
}

static modelica_metatype closure2_NBAdjacency_Mode_mergeCreate(threadData_t *thData, modelica_metatype closure, modelica_metatype omode)
{
  modelica_metatype $in_mode = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NBAdjacency_Mode_mergeCreate(thData, omode, $in_mode);
}
PROTECTED_FUNCTION_STATIC void omc_NBSlice_addMatrixEntry(threadData_t *threadData, modelica_metatype _m, modelica_metatype _modes, modelica_integer _eqn_idx, modelica_integer _var_idx, modelica_metatype _mode)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  { /* matchcontinue expression */
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      MMC_TRY_INTERNAL(mmc_jumper)
      tmp2_top:
      threadData->mmc_jumper = &new_mmc_jumper;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_cons(mmc_mk_integer(_var_idx), arrayGet(_m,_eqn_idx) /* DAE.ASUB */);
          arrayUpdate(_m, _eqn_idx, tmpMeta5);

          tmpMeta6 = mmc_mk_box2(0, mmc_mk_integer(_eqn_idx), mmc_mk_integer(_var_idx));
          tmpMeta7 = mmc_mk_box1(0, _mode);
          omc_UnorderedMap_addUpdate(threadData, tmpMeta6, (modelica_fnptr) mmc_mk_box2(0,closure2_NBAdjacency_Mode_mergeCreate,tmpMeta7), _modes);
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          /* Pattern matching succeeded */
          tmpMeta9 = stringAppend(_OMC_LIT16,intString(_eqn_idx));
          tmpMeta10 = stringAppend(tmpMeta9,_OMC_LIT17);
          tmpMeta11 = stringAppend(tmpMeta10,intString(arrayLength(_m)));
          tmpMeta12 = stringAppend(tmpMeta11,_OMC_LIT18);
          tmpMeta8 = mmc_mk_cons(tmpMeta12, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta8);

          goto goto_1;
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      tmp2_done:
      (void)tmp3;
      MMC_RESTORE_INTERNAL(mmc_jumper);
      goto tmp2_done2;
      goto_1:;
      MMC_CATCH_INTERNAL(mmc_jumper);
      if (++tmp3 < 2) {
        goto tmp2_top;
      }
      MMC_THROW_INTERNAL();
      tmp2_done2:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_addMatrixEntry(threadData_t *threadData, modelica_metatype _m, modelica_metatype _modes, modelica_metatype _eqn_idx, modelica_metatype _var_idx, modelica_metatype _mode)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  tmp1 = mmc_unbox_integer(_eqn_idx);
  tmp2 = mmc_unbox_integer(_var_idx);
  omc_NBSlice_addMatrixEntry(threadData, _m, _modes, tmp1, tmp2, _mode);
  return;
}

PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveEquationDimensions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _m, modelica_metatype _modes, modelica_metatype _mode, modelica_metatype _eqn_idx_ptr, modelica_integer _index)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _lst;
    {
      modelica_metatype _dim = NULL;
      modelica_metatype _rest = NULL;
      modelica_integer _eqn_idx;
      modelica_metatype _scal_lst = NULL;
      volatile mmc_switch_type tmp3;
      int tmp4;
      // _dim has no default value.
      // _rest has no default value.
      // _eqn_idx has no default value.
      // _scal_lst has no default value.
      tmp3 = 0;
      for (; tmp3 < 3; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (!listEmpty(tmp3_1)) goto tmp2_end;
          /* Pattern matching succeeded */
          _eqn_idx = mmc_unbox_integer(omc_Pointer_access(threadData, _eqn_idx_ptr));

          _scal_lst = omc_UnorderedMap_getSafe(threadData, arrayList(_key), _map, _OMC_LIT19);

          {
            modelica_metatype _scal_idx;
            for (tmpMeta5 = _scal_lst; !listEmpty(tmpMeta5); tmpMeta5=MMC_CDR(tmpMeta5))
            {
              _scal_idx = MMC_CAR(tmpMeta5);
              omc_NBSlice_addMatrixEntry(threadData, _m, _modes, _eqn_idx, mmc_unbox_integer(_scal_idx), _mode);
            }
          }

          omc_Pointer_update(threadData, _eqn_idx_ptr, mmc_mk_integer(((modelica_integer) 1) + _eqn_idx));
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_integer tmp11;
          modelica_integer tmp12;
          modelica_integer tmp13;
          modelica_integer tmp14;
          if (listEmpty(tmp3_1)) goto tmp2_end;
          tmpMeta7 = MMC_CAR(tmp3_1);
          tmpMeta8 = MMC_CDR(tmp3_1);
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 1));
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 2));
          tmp11 = mmc_unbox_integer(tmpMeta10);
          if (0 /* false */ != tmp11) goto tmp2_end;
          _dim = tmpMeta9;
          _rest = tmpMeta8;
          /* Pattern matching succeeded */
          tmp12 = ((modelica_integer) 1); tmp13 = 1; tmp14 = omc_NFDimension_size(threadData, _dim, 1 /* true */);
          if(!(((tmp13 > 0) && (tmp12 > tmp14)) || ((tmp13 < 0) && (tmp12 < tmp14))))
          {
            modelica_integer _i;
            for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp12, tmp14); _i += tmp13)
            {
              omc_NBSlice_resolveEquationDimensions(threadData, _rest, _map, _key, _m, _modes, _mode, _eqn_idx_ptr, ((modelica_integer) 1) + _index);
            }
          }
          goto tmp2_done;
        }
        case 2: {
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          modelica_integer tmp19;
          modelica_integer tmp20;
          modelica_integer tmp21;
          modelica_integer tmp22;
          if (listEmpty(tmp3_1)) goto tmp2_end;
          tmpMeta15 = MMC_CAR(tmp3_1);
          tmpMeta16 = MMC_CDR(tmp3_1);
          tmpMeta17 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta15), 1));
          tmpMeta18 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta15), 2));
          tmp19 = mmc_unbox_integer(tmpMeta18);
          if (1 /* true */ != tmp19) goto tmp2_end;
          _dim = tmpMeta17;
          _rest = tmpMeta16;
          /* Pattern matching succeeded */
          tmp20 = ((modelica_integer) 1); tmp21 = 1; tmp22 = omc_NFDimension_size(threadData, _dim, 1 /* true */);
          if(!(((tmp21 > 0) && (tmp20 > tmp22)) || ((tmp21 < 0) && (tmp20 < tmp22))))
          {
            modelica_integer _i;
            for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp20, tmp22); _i += tmp21)
            {
              arrayUpdate(_key, _index, mmc_mk_integer(_i));

              omc_NBSlice_resolveEquationDimensions(threadData, _rest, _map, _key, _m, _modes, _mode, _eqn_idx_ptr, ((modelica_integer) 1) + _index);
            }
          }
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveEquationDimensions(threadData_t *threadData, modelica_metatype _lst, modelica_metatype _map, modelica_metatype _key, modelica_metatype _m, modelica_metatype _modes, modelica_metatype _mode, modelica_metatype _eqn_idx_ptr, modelica_metatype _index)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_index);
  omc_NBSlice_resolveEquationDimensions(threadData, _lst, _map, _key, _m, _modes, _mode, _eqn_idx_ptr, tmp1);
  return;
}

PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveAllReduced(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _skip_idx, modelica_integer _size, modelica_integer _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_boolean _repeated;
  modelica_metatype _scalarized = NULL;
  modelica_metatype _map3 = NULL;
  modelica_integer _shift;
  modelica_metatype _mode = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_integer tmp9;
  modelica_integer tmp10;
  modelica_integer tmp11;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _repeated has no default value.
  // _scalarized has no default value.
  // _map3 has no default value.
  // _shift has no default value.
  // _mode has no default value.
  _repeated = omc_UnorderedSet_contains(threadData, _cref, _rep);

  _scalarized = listReverse(omc_NFComponentRef_scalarizeAll(threadData, _cref, 1 /* true */));

  _map3 = omc_UnorderedMap_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 1));

  {
    modelica_metatype _scal;
    for (tmpMeta1 = _scalarized; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _scal = MMC_CAR(tmpMeta1);
      omc_UnorderedMap_add(threadData, _scal, omc_NBSlice_getCrefInFrameIndices(threadData, _scal, _frames, _mapping, _map), _map3);
    }
  }

  if(_repeated)
  {
    tmpMeta3 = mmc_mk_cons(_original_cref, MMC_REFSTRUCTLIT(mmc_nil));
    _mode = omc_NBAdjacency_Mode_create(threadData, _eqn_name, tmpMeta3, 0 /* false */);
  }

  tmp9 = _skip_idx; tmp10 = _iter_size; tmp11 = _skip_idx + _size - _iter_size;
  if(!tmp10) {
    omc_assert(threadData, omc_dummyFileInfo, "assertion range step != 0 failed");
  } else if(!(((tmp10 > 0) && (tmp9 > tmp11)) || ((tmp10 < 0) && (tmp9 < tmp11))))
  {
    modelica_integer _i;
    for(_i = _skip_idx; in_range_integer(_i, tmp9, tmp11); _i += tmp10)
    {
      _shift = ((modelica_integer) 0);

      {
        modelica_metatype _scal;
        for (tmpMeta4 = _scalarized; !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
        {
          _scal = MMC_CAR(tmpMeta4);
          if((!_repeated))
          {
            tmpMeta5 = mmc_mk_cons(_original_cref, MMC_REFSTRUCTLIT(mmc_nil));
            _mode = omc_NBAdjacency_Mode_create(threadData, _eqn_name, tmpMeta5, 1 /* true */);
          }

          {
            modelica_metatype _scal_idx;
            for (tmpMeta6 = omc_UnorderedMap_getSafe(threadData, _scal, _map3, _OMC_LIT20); !listEmpty(tmpMeta6); tmpMeta6=MMC_CDR(tmpMeta6))
            {
              _scal_idx = MMC_CAR(tmpMeta6);
              if((modelica_integer_mod(_shift, _iter_size) == ((modelica_integer) 0)))
              {
                _shift = ((modelica_integer) 0);
              }

              omc_NBSlice_addMatrixEntry(threadData, _m, _modes, _i + _shift, mmc_unbox_integer(_scal_idx), _mode);

              _shift = ((modelica_integer) 1) + _shift;
            }
          }
        }
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveAllReduced(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _skip_idx, modelica_metatype _size, modelica_metatype _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_integer tmp3;
  tmp1 = mmc_unbox_integer(_skip_idx);
  tmp2 = mmc_unbox_integer(_size);
  tmp3 = mmc_unbox_integer(_iter_size);
  omc_NBSlice_resolveAllReduced(threadData, _cref, _original_cref, _eqn_name, tmp1, tmp2, tmp3, _frames, _rep, _map, _m, _mapping, _modes);
  return;
}

PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveMixed(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _skip_idx, modelica_metatype _ty, modelica_metatype _frames, modelica_metatype _regulars, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_metatype _stripped = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype _dims = NULL;
  modelica_metatype _eq_dims = NULL;
  modelica_metatype _key = NULL;
  modelica_metatype _map1 = NULL;
  modelica_metatype _map2 = NULL;
  modelica_metatype _scalarized = NULL;
  modelica_metatype _scal_lst = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_metatype tmpMeta21;
  modelica_metatype tmpMeta22;
  modelica_metatype tmpMeta23;
  modelica_metatype tmpMeta24;
  modelica_metatype tmpMeta25;
  modelica_metatype tmpMeta26;
  modelica_metatype tmpMeta27;
  modelica_metatype tmpMeta28;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _stripped has no default value.
  // _subs has no default value.
  // _dims has no default value.
  // _eq_dims has no default value.
  // _key has no default value.
  // _map1 has no default value.
  // _map2 has no default value.
  // _scalarized has no default value.
  // _scal_lst has no default value.
  _subs = omc_NFComponentRef_subscriptsAllWithWholeFlat(threadData, _cref);

  _dims = omc_NFType_arrayDims(threadData, omc_NFComponentRef_getSubscriptedType(threadData, _cref, 0 /* false */));

  _eq_dims = omc_NFType_arrayDims(threadData, _ty);

  if((((omc_List_compareLength(threadData, _subs, _dims) == ((modelica_integer) 0)) && (omc_List_compareLength(threadData, _subs, _regulars) == ((modelica_integer) 0))) && (omc_List_compareLength(threadData, _subs, _eq_dims) == ((modelica_integer) 0))))
  {
    _stripped = omc_NFComponentRef_stripSubscriptsAll(threadData, _cref);

    _key = arrayCreate(listLength(_subs), mmc_mk_integer(((modelica_integer) 0)));

    _map1 = omc_UnorderedMap_new(threadData, boxvar_NBSlice_keyHash, boxvar_NBSlice_keyEqual, ((modelica_integer) 1));

    tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
    omc_NBSlice_resolveReductions(threadData, omc_List_zip3(threadData, _subs, _dims, _regulars), _map1, _key, _stripped, tmpMeta1, ((modelica_integer) 1));

    _map2 = omc_UnorderedMap_new(threadData, boxvar_NBSlice_keyHash, boxvar_NBSlice_keyEqual, ((modelica_integer) 1));

    {
      modelica_metatype _k;
      for (tmpMeta2 = omc_UnorderedMap_keyList(threadData, _map1); !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
      {
        _k = MMC_CAR(tmpMeta2);
        _scalarized = omc_UnorderedMap_getSafe(threadData, _k, _map1, _OMC_LIT30);

        {
          modelica_metatype __omcQ_24tmpVar15;
          modelica_metatype* tmp4;
          modelica_metatype tmpMeta5;
          modelica_metatype __omcQ_24tmpVar14;
          modelica_integer tmp6;
          modelica_metatype _scal_loopVar = 0;
          modelica_metatype _scal;
          _scal_loopVar = _scalarized;
          tmpMeta5 = MMC_REFSTRUCTLIT(mmc_nil);
          __omcQ_24tmpVar15 = tmpMeta5; /* defaultValue */
          tmp4 = &__omcQ_24tmpVar15;
          while(1) {
            tmp6 = 1;
            if (!listEmpty(_scal_loopVar)) {
              _scal = MMC_CAR(_scal_loopVar);
              _scal_loopVar = MMC_CDR(_scal_loopVar);
              tmp6--;
            }
            if (tmp6 == 0) {
              __omcQ_24tmpVar14 = omc_NBSlice_getCrefInFrameIndices(threadData, _scal, _frames, _mapping, _map);
              *tmp4 = mmc_mk_cons(__omcQ_24tmpVar14,0);
              tmp4 = &MMC_CDR(*tmp4);
            } else if (tmp6 == 1) {
              break;
            } else {
              MMC_THROW_INTERNAL();
            }
          }
          *tmp4 = mmc_mk_nil();
          tmpMeta3 = __omcQ_24tmpVar15;
        }
        _scal_lst = omc_List_flatten(threadData, tmpMeta3);

        omc_UnorderedMap_add(threadData, _k, _scal_lst, _map2);
      }
    }

    _key = arrayCreate(listLength(_subs), mmc_mk_integer(((modelica_integer) 0)));

    tmpMeta8 = mmc_mk_cons(_original_cref, MMC_REFSTRUCTLIT(mmc_nil));
    omc_NBSlice_resolveEquationDimensions(threadData, omc_List_zip(threadData, _eq_dims, _regulars), _map2, _key, _m, _modes, omc_NBAdjacency_Mode_create(threadData, _eqn_name, tmpMeta8, 0 /* false */), omc_Pointer_create(threadData, mmc_mk_integer(_skip_idx)), ((modelica_integer) 1));
  }
  else
  {
    tmpMeta10 = stringAppend(_OMC_LIT21,intString(listLength(_subs)));
    tmpMeta11 = stringAppend(tmpMeta10,_OMC_LIT22);
    tmpMeta12 = stringAppend(tmpMeta11,omc_List_toString(threadData, _subs, boxvar_NFSubscript_toString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0)));
    tmpMeta13 = stringAppend(tmpMeta12,_OMC_LIT26);
    tmpMeta14 = stringAppend(tmpMeta13,_OMC_LIT27);
    tmpMeta15 = stringAppend(tmpMeta14,intString(listLength(_dims)));
    tmpMeta16 = stringAppend(tmpMeta15,_OMC_LIT22);
    tmpMeta17 = stringAppend(tmpMeta16,omc_List_toString(threadData, _dims, boxvar_NFDimension_toString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0)));
    tmpMeta18 = stringAppend(tmpMeta17,_OMC_LIT26);
    tmpMeta19 = stringAppend(tmpMeta18,_OMC_LIT28);
    tmpMeta20 = stringAppend(tmpMeta19,intString(listLength(_eq_dims)));
    tmpMeta21 = stringAppend(tmpMeta20,_OMC_LIT22);
    tmpMeta22 = stringAppend(tmpMeta21,omc_List_toString(threadData, _eq_dims, boxvar_NFDimension_toString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0)));
    tmpMeta23 = stringAppend(tmpMeta22,_OMC_LIT26);
    tmpMeta24 = stringAppend(tmpMeta23,_OMC_LIT29);
    tmpMeta25 = stringAppend(tmpMeta24,intString(listLength(_regulars)));
    tmpMeta26 = stringAppend(tmpMeta25,_OMC_LIT22);
    tmpMeta27 = stringAppend(tmpMeta26,omc_List_toString(threadData, _regulars, boxvar_boolString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0)));
    tmpMeta28 = stringAppend(tmpMeta27,_OMC_LIT26);
    tmpMeta9 = mmc_mk_cons(tmpMeta28, MMC_REFSTRUCTLIT(mmc_nil));
    omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta9);

    MMC_THROW_INTERNAL();
  }
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveMixed(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _skip_idx, modelica_metatype _ty, modelica_metatype _frames, modelica_metatype _regulars, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_skip_idx);
  omc_NBSlice_resolveMixed(threadData, _cref, _original_cref, _eqn_name, tmp1, _ty, _frames, _regulars, _map, _m, _mapping, _modes);
  return;
}

PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveAllRegular(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _skip_idx, modelica_integer _size, modelica_integer _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_metatype _mode = NULL;
  modelica_metatype _scalarized = NULL;
  modelica_metatype _map3 = NULL;
  modelica_integer _scal_size;
  modelica_integer _shift;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_integer tmp8;
  modelica_integer tmp9;
  modelica_integer tmp10;
  modelica_real tmp11;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _mode has no default value.
  // _scalarized has no default value.
  // _map3 has no default value.
  // _scal_size has no default value.
  // _shift has no default value.
  tmpMeta1 = mmc_mk_cons(_original_cref, MMC_REFSTRUCTLIT(mmc_nil));
  _mode = omc_NBAdjacency_Mode_create(threadData, _eqn_name, tmpMeta1, 0 /* false */);

  _scalarized = listReverse(omc_NFComponentRef_scalarizeAll(threadData, _cref, 1 /* true */));

  _map3 = omc_UnorderedMap_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 1));

  {
    modelica_metatype _scal;
    for (tmpMeta2 = _scalarized; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _scal = MMC_CAR(tmpMeta2);
      omc_UnorderedMap_add(threadData, _scal, omc_NBSlice_getCrefInFrameIndices(threadData, _scal, _frames, _mapping, _map), _map3);
    }
  }

  _scal_size = listLength(omc_List_flatten(threadData, omc_UnorderedMap_valueList(threadData, _map3)));

  if(((_size == _scal_size) || (omc_UnorderedSet_contains(threadData, _cref, _rep) && (modelica_integer_mod(_size, _scal_size) == ((modelica_integer) 0)))))
  {
    _shift = ((modelica_integer) 0);

    tmp11 = ((modelica_real)_scal_size);
    if (tmp11 == 0) {MMC_THROW_INTERNAL();}
    tmp8 = 1.0; tmp9 = 1; tmp10 = (((modelica_real)_size)) / tmp11;
    if(!(((tmp9 > 0) && (tmp8 > tmp10)) || ((tmp9 < 0) && (tmp8 < tmp10))))
    {
      modelica_integer _i;
      for(_i = 1.0; in_range_integer(_i, tmp8, tmp10); _i += tmp9)
      {
        {
          modelica_metatype _scal;
          for (tmpMeta4 = _scalarized; !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
          {
            _scal = MMC_CAR(tmpMeta4);
            {
              modelica_metatype _scal_idx;
              for (tmpMeta5 = omc_UnorderedMap_getSafe(threadData, _scal, _map3, _OMC_LIT31); !listEmpty(tmpMeta5); tmpMeta5=MMC_CDR(tmpMeta5))
              {
                _scal_idx = MMC_CAR(tmpMeta5);
                omc_NBSlice_addMatrixEntry(threadData, _m, _modes, _skip_idx + _shift, mmc_unbox_integer(_scal_idx), _mode);

                _shift = ((modelica_integer) 1) + _shift;
              }
            }
          }
        }
      }
    }
  }
  else
  {
    omc_NBSlice_resolveAllReduced(threadData, _cref, _original_cref, _eqn_name, _skip_idx, _size, _iter_size, _frames, _rep, _map, _m, _mapping, _modes);
  }
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveAllRegular(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _skip_idx, modelica_metatype _size, modelica_metatype _iter_size, modelica_metatype _frames, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_integer tmp3;
  tmp1 = mmc_unbox_integer(_skip_idx);
  tmp2 = mmc_unbox_integer(_size);
  tmp3 = mmc_unbox_integer(_iter_size);
  omc_NBSlice_resolveAllRegular(threadData, _cref, _original_cref, _eqn_name, tmp1, tmp2, tmp3, _frames, _rep, _map, _m, _mapping, _modes);
  return;
}

PROTECTED_FUNCTION_STATIC void omc_NBSlice_resolveDependency(threadData_t *threadData, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_integer _eqn_arr_idx, modelica_metatype _iter, modelica_metatype _ty, modelica_metatype _dep, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _fullmap, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_metatype _d = NULL;
  modelica_metatype _skip_lst = NULL;
  modelica_metatype _skip_ty = NULL;
  modelica_integer _skip_idx;
  modelica_integer _start;
  modelica_integer _size;
  modelica_integer _body_size;
  modelica_integer _iter_size;
  modelica_metatype _names = NULL;
  modelica_metatype _ranges = NULL;
  modelica_metatype _maps = NULL;
  modelica_metatype _frames = NULL;
  modelica_metatype _regulars = NULL;
  modelica_metatype _cref = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _d has no default value.
  // _skip_lst has no default value.
  // _skip_ty has no default value.
  // _skip_idx has no default value.
  // _start has no default value.
  // _size has no default value.
  // _body_size has no default value.
  // _iter_size has no default value.
  // _names has no default value.
  // _ranges has no default value.
  // _maps has no default value.
  // _frames has no default value.
  // _regulars has no default value.
  // _cref has no default value.
  { /* matchcontinue expression */
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      MMC_TRY_INTERNAL(mmc_jumper)
      tmp2_top:
      threadData->mmc_jumper = &new_mmc_jumper;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_integer tmp7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_integer tmp13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          /* Pattern matching succeeded */
          _cref = omc_NFComponentRef_mapExp(threadData, _original_cref, boxvar_NFExpression_replaceResizableParameter);

          _d = omc_UnorderedMap_getSafe(threadData, _original_cref, _dep, _OMC_LIT32);

          /* Pattern-matching assignment */
          tmpMeta5 = arrayGet((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mapping), 4))),_eqn_arr_idx) /* DAE.ASUB */;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 1));
          tmp7 = mmc_unbox_integer(tmpMeta6);
          _start = tmp7  /* pattern as ty=Integer */;

          if((!omc_UnorderedSet_contains(threadData, _cref, _rep)))
          {
            _skip_lst = omc_NBSlice_resolveSkipsLst(threadData, _start, _ty, arrayList((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_d), 2)))), _cref, _fullmap);
          }
          else
          {
            tmpMeta9 = mmc_mk_box2(0, mmc_mk_integer(_start), _ty);
            tmpMeta8 = mmc_mk_cons(tmpMeta9, MMC_REFSTRUCTLIT(mmc_nil));
            _skip_lst = tmpMeta8;
          }

          {
            modelica_metatype _tpl;
            for (tmpMeta10 = _skip_lst; !listEmpty(tmpMeta10); tmpMeta10=MMC_CDR(tmpMeta10))
            {
              _tpl = MMC_CAR(tmpMeta10);
              /* Pattern-matching assignment */
              tmpMeta11 = _tpl;
              tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 1));
              tmp13 = mmc_unbox_integer(tmpMeta12);
              tmpMeta14 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 2));
              _skip_idx = tmp13  /* pattern as ty=Integer */;
              _skip_ty = tmpMeta14;

              _body_size = omc_NFType_sizeOf(threadData, _skip_ty, 1 /* true */);

              _iter_size = omc_NBEquation_Iterator_size(threadData, _iter, 1 /* true */);

              _size = (_body_size) * (_iter_size);

              _names = omc_NBEquation_Iterator_getFrames(threadData, _iter ,&_ranges ,&_maps);

              _frames = omc_List_zip3(threadData, _names, _ranges, _maps);

              _regulars = omc_NBAdjacency_Dependency_toBoolean(threadData, _d);

              if(omc_List_all(threadData, _regulars, boxvar_Util_id))
              {
                omc_NBSlice_resolveAllRegular(threadData, _cref, _original_cref, _eqn_name, _skip_idx, _size, _iter_size, _frames, _rep, _map, _m, _mapping, _modes);
              }
              else
              {
                if(omc_List_any(threadData, _regulars, boxvar_Util_id))
                {
                  omc_NBSlice_resolveMixed(threadData, _cref, _original_cref, _eqn_name, _skip_idx, _ty, _frames, _regulars, _map, _m, _mapping, _modes);
                }
                else
                {
                  omc_NBSlice_resolveAllReduced(threadData, _cref, _original_cref, _eqn_name, _skip_idx, _size, _iter_size, _frames, _rep, _map, _m, _mapping, _modes);
                }
              }
            }
          }
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          /* Pattern matching succeeded */
          tmpMeta17 = stringAppend(_OMC_LIT33,omc_NFComponentRef_toString(threadData, _original_cref));
          tmpMeta18 = stringAppend(tmpMeta17,_OMC_LIT18);
          tmpMeta16 = mmc_mk_cons(tmpMeta18, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta16);

          goto goto_1;
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      tmp2_done:
      (void)tmp3;
      MMC_RESTORE_INTERNAL(mmc_jumper);
      goto tmp2_done2;
      goto_1:;
      MMC_CATCH_INTERNAL(mmc_jumper);
      if (++tmp3 < 2) {
        goto tmp2_top;
      }
      MMC_THROW_INTERNAL();
      tmp2_done2:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBSlice_resolveDependency(threadData_t *threadData, modelica_metatype _original_cref, modelica_metatype _eqn_name, modelica_metatype _eqn_arr_idx, modelica_metatype _iter, modelica_metatype _ty, modelica_metatype _dep, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _fullmap, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_eqn_arr_idx);
  omc_NBSlice_resolveDependency(threadData, _original_cref, _eqn_name, tmp1, _iter, _ty, _dep, _rep, _map, _fullmap, _m, _mapping, _modes);
  return;
}

PROTECTED_FUNCTION_STATIC modelica_string omc_NBSlice_val1String(threadData_t *threadData, modelica_metatype _val)
{
  modelica_string _str = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _str = omc_List_toString(threadData, _val, boxvar_NFComponentRef_toString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0));
  _return: OMC_LABEL_UNUSED
  return _str;
}

PROTECTED_FUNCTION_STATIC modelica_boolean omc_NBSlice_keyEqual(threadData_t *threadData, modelica_metatype _key1, modelica_metatype _key2)
{
  modelica_boolean _b;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _b = omc_List_isEqualOnTrue(threadData, _key1, _key2, boxvar_intEq);
  _return: OMC_LABEL_UNUSED
  return _b;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_keyEqual(threadData_t *threadData, modelica_metatype _key1, modelica_metatype _key2)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NBSlice_keyEqual(threadData, _key1, _key2);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

PROTECTED_FUNCTION_STATIC modelica_integer omc_NBSlice_keyHash(threadData_t *threadData, modelica_metatype _key)
{
  modelica_integer _hash;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _hash = stringHashDjb2(omc_NBSlice_keyString(threadData, _key));
  _return: OMC_LABEL_UNUSED
  return _hash;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_keyHash(threadData_t *threadData, modelica_metatype _key)
{
  modelica_integer _hash;
  modelica_metatype out_hash;
  _hash = omc_NBSlice_keyHash(threadData, _key);
  out_hash = mmc_mk_icon(_hash);
  return out_hash;
}

PROTECTED_FUNCTION_STATIC modelica_string omc_NBSlice_keyString(threadData_t *threadData, modelica_metatype _key)
{
  modelica_string _str = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _str = omc_List_toString(threadData, _key, boxvar_intString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0));
  _return: OMC_LABEL_UNUSED
  return _str;
}

PROTECTED_FUNCTION_STATIC modelica_integer omc_NBSlice_resolveSkips(threadData_t *threadData, modelica_integer __omcQ_24in_5Findex, modelica_metatype __omcQ_24in_5Fty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap, modelica_metatype *out_ty)
{
  modelica_integer _index;
  modelica_metatype _ty = NULL;
  modelica_integer tmp1_c0 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _index = __omcQ_24in_5Findex;
  _ty = __omcQ_24in_5Fty;
  
  
  { /* match expression */
    modelica_metatype tmp4_1;modelica_metatype tmp4_2;
    tmp4_1 = _ty;
    tmp4_2 = _skips;
    {
      modelica_integer _skip;
      modelica_metatype _rest = NULL;
      modelica_metatype _tail = NULL;
      modelica_metatype _sub_ty = NULL;
      modelica_metatype _rest_ty = NULL;
      modelica_metatype _parent = NULL;
      modelica_metatype _crefs = NULL;
      modelica_metatype _field = NULL;
      modelica_metatype _subs = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _skip has no default value.
      // _rest has no default value.
      // _tail has no default value.
      // _sub_ty has no default value.
      // _rest_ty has no default value.
      // _parent has no default value.
      // _crefs has no default value.
      // _field has no default value.
      // _subs has no default value.
      tmp4 = 0;
      for (; tmp4 < 9; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_integer tmp8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,2) == 0) goto tmp3_end;
          if (listEmpty(tmp4_2)) goto tmp3_end;
          tmpMeta6 = MMC_CAR(tmp4_2);
          tmpMeta7 = MMC_CDR(tmp4_2);
          tmp8 = mmc_unbox_integer(tmpMeta6);
          if (0 != tmp8) goto tmp3_end;
          /* Pattern matching succeeded */
          tmp1_c0 = _index;
          tmpMeta[0+1] = _ty;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_integer tmp12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_integer tmp16;
          modelica_integer tmp17;
          modelica_integer tmp18;
          modelica_metatype tmpMeta19;
          modelica_metatype tmpMeta20;
          modelica_metatype tmpMeta21;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,2) == 0) goto tmp3_end;
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (listEmpty(tmp4_2)) goto tmp3_end;
          tmpMeta10 = MMC_CAR(tmp4_2);
          tmpMeta11 = MMC_CDR(tmp4_2);
          tmp12 = mmc_unbox_integer(tmpMeta10);
          _rest_ty = tmpMeta9;
          _skip = tmp12  /* pattern as ty=Integer */;
          _rest = tmpMeta11;
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(_skip <= listLength(_rest_ty))) goto tmp3_end;
          tmp16 = ((modelica_integer) 1); tmp17 = 1; tmp18 = ((modelica_integer) -1) + _skip;
          if(!(((tmp17 > 0) && (tmp16 > tmp18)) || ((tmp17 < 0) && (tmp16 < tmp18))))
          {
            modelica_integer _i;
            for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp16, tmp18); _i += tmp17)
            {
              /* Pattern-matching assignment */
              tmpMeta13 = _rest_ty;
              if (listEmpty(tmpMeta13)) goto goto_2;
              tmpMeta14 = MMC_CAR(tmpMeta13);
              tmpMeta15 = MMC_CDR(tmpMeta13);
              _sub_ty = tmpMeta14;
              _rest_ty = tmpMeta15;

              _index = _index + omc_NFType_sizeOf(threadData, _sub_ty, 0 /* false */);
            }
          }

          /* Pattern-matching assignment */
          tmpMeta19 = _rest_ty;
          if (listEmpty(tmpMeta19)) goto goto_2;
          tmpMeta20 = MMC_CAR(tmpMeta19);
          tmpMeta21 = MMC_CDR(tmpMeta19);
          _sub_ty = tmpMeta20;
          _rest_ty = tmpMeta21;
          /* Tail recursive call */
          __omcQ_24in_5Findex = _index;
          __omcQ_24in_5Fty = _sub_ty;
          _skips = _rest;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta22;
          modelica_metatype tmpMeta23;
          modelica_integer tmp24;
          modelica_metatype tmpMeta25;
          modelica_metatype tmpMeta26;
          if (listEmpty(tmp4_2)) goto tmp3_end;
          tmpMeta22 = MMC_CAR(tmp4_2);
          tmpMeta23 = MMC_CDR(tmp4_2);
          tmp24 = mmc_unbox_integer(tmpMeta22);
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,11,2) == 0) goto tmp3_end;
          tmpMeta25 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta25,4,3) == 0) goto tmp3_end;
          
          _skip = tmp24  /* pattern as ty=Integer */;
          _rest = tmpMeta23;
          /* Pattern matching succeeded */
          { /* match expression */
            modelica_metatype tmp29_1;
            tmp29_1 = omc_NBVariable_getParent(threadData, omc_NBVariable_getVarPointer(threadData, _cref, _OMC_LIT34));
            {
              volatile mmc_switch_type tmp29;
              int tmp30;
              tmp29 = 0;
              for (; tmp29 < 2; tmp29++) {
                switch (MMC_SWITCH_CAST(tmp29)) {
                case 0: {
                  modelica_metatype tmpMeta31;
                  modelica_metatype tmpMeta32;
                  modelica_metatype tmpMeta36;
                  modelica_metatype tmpMeta40;
                  modelica_metatype tmpMeta41;
                  modelica_metatype tmpMeta42;
                  modelica_integer tmp43;
                  modelica_integer tmp44;
                  modelica_integer tmp45;
                  modelica_metatype tmpMeta46;
                  modelica_metatype tmpMeta47;
                  modelica_metatype tmpMeta48;
                  modelica_metatype tmpMeta49;
                  modelica_metatype tmpMeta50;
                  modelica_metatype tmpMeta51;
                  modelica_metatype tmpMeta52;
                  modelica_metatype tmpMeta53;
                  if (optionNone(tmp29_1)) goto tmp28_end;
                  tmpMeta31 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp29_1), 1));
                  _parent = tmpMeta31;
                  /* Pattern matching succeeded */
                  _subs = omc_NFComponentRef_subscriptsAll(threadData, _cref);

                  {
                    modelica_metatype __omcQ_24tmpVar17;
                    modelica_metatype* tmp33;
                    modelica_metatype tmpMeta34;
                    modelica_metatype __omcQ_24tmpVar16;
                    modelica_integer tmp35;
                    modelica_metatype _child_loopVar = 0;
                    modelica_metatype _child;
                    _child_loopVar = omc_NBVariable_getRecordChildren(threadData, _parent);
                    tmpMeta34 = MMC_REFSTRUCTLIT(mmc_nil);
                    __omcQ_24tmpVar17 = tmpMeta34; /* defaultValue */
                    tmp33 = &__omcQ_24tmpVar17;
                    while(1) {
                      tmp35 = 1;
                      if (!listEmpty(_child_loopVar)) {
                        _child = MMC_CAR(_child_loopVar);
                        _child_loopVar = MMC_CDR(_child_loopVar);
                        tmp35--;
                      }
                      if (tmp35 == 0) {
                        __omcQ_24tmpVar16 = omc_NBVariable_getVarName(threadData, _child);
                        *tmp33 = mmc_mk_cons(__omcQ_24tmpVar16,0);
                        tmp33 = &MMC_CDR(*tmp33);
                      } else if (tmp35 == 1) {
                        break;
                      } else {
                        goto goto_27;
                      }
                    }
                    *tmp33 = mmc_mk_nil();
                    tmpMeta32 = __omcQ_24tmpVar17;
                  }
                  _crefs = tmpMeta32;

                  {
                    modelica_metatype __omcQ_24tmpVar19;
                    modelica_metatype* tmp37;
                    modelica_metatype tmpMeta38;
                    modelica_metatype __omcQ_24tmpVar18;
                    modelica_integer tmp39;
                    modelica_metatype _c_loopVar = 0;
                    modelica_metatype _c;
                    _c_loopVar = _crefs;
                    tmpMeta38 = MMC_REFSTRUCTLIT(mmc_nil);
                    __omcQ_24tmpVar19 = tmpMeta38; /* defaultValue */
                    tmp37 = &__omcQ_24tmpVar19;
                    while(1) {
                      tmp39 = 1;
                      while (!listEmpty(_c_loopVar)) {
                        _c = MMC_CAR(_c_loopVar);
                        _c_loopVar = MMC_CDR(_c_loopVar);
                        if (omc_UnorderedMap_contains(threadData, _c, _fullmap)) {
                          tmp39--;
                          break;
                        }
                      }
                      if (tmp39 == 0) {
                        __omcQ_24tmpVar18 = _c;
                        *tmp37 = mmc_mk_cons(__omcQ_24tmpVar18,0);
                        tmp37 = &MMC_CDR(*tmp37);
                      } else if (tmp39 == 1) {
                        break;
                      } else {
                        goto goto_27;
                      }
                    }
                    *tmp37 = mmc_mk_nil();
                    tmpMeta36 = __omcQ_24tmpVar19;
                  }
                  _crefs = tmpMeta36;

                  if((_skip <= listLength(_crefs)))
                  {
                    tmp43 = ((modelica_integer) 1); tmp44 = 1; tmp45 = ((modelica_integer) -1) + _skip;
                    if(!(((tmp44 > 0) && (tmp43 > tmp45)) || ((tmp44 < 0) && (tmp43 < tmp45))))
                    {
                      modelica_integer _i;
                      for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp43, tmp45); _i += tmp44)
                      {
                        /* Pattern-matching assignment */
                        tmpMeta40 = _crefs;
                        if (listEmpty(tmpMeta40)) goto goto_27;
                        tmpMeta41 = MMC_CAR(tmpMeta40);
                        tmpMeta42 = MMC_CDR(tmpMeta40);
                        _field = tmpMeta41;
                        _crefs = tmpMeta42;

                        _field = omc_NFComponentRef_setSubscriptsList(threadData, _subs, _field);

                        _index = _index + omc_NFType_sizeOf(threadData, omc_NFComponentRef_getSubscriptedType(threadData, _field, 0 /* false */), 0 /* false */);
                      }
                    }

                    /* Pattern-matching assignment */
                    tmpMeta46 = _crefs;
                    if (listEmpty(tmpMeta46)) goto goto_27;
                    tmpMeta47 = MMC_CAR(tmpMeta46);
                    tmpMeta48 = MMC_CDR(tmpMeta46);
                    _field = tmpMeta47;
                    _crefs = tmpMeta48;

                    _field = omc_NFComponentRef_setSubscriptsList(threadData, _subs, _field);
                  }
                  else
                  {
                    tmpMeta50 = stringAppend(_OMC_LIT35,intString(_skip));
                    tmpMeta51 = stringAppend(tmpMeta50,_OMC_LIT36);
                    tmpMeta52 = stringAppend(tmpMeta51,omc_List_toString(threadData, _crefs, boxvar_NFComponentRef_toString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0)));
                    tmpMeta53 = stringAppend(tmpMeta52,_OMC_LIT18);
                    tmpMeta49 = mmc_mk_cons(tmpMeta53, MMC_REFSTRUCTLIT(mmc_nil));
                    omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta49);

                    goto goto_27;
                  }
                  tmpMeta26 = _field;
                  goto tmp28_done;
                }
                case 1: {
                  modelica_metatype tmpMeta54;
                  modelica_metatype tmpMeta55;
                  modelica_metatype tmpMeta56;
                  modelica_metatype tmpMeta57;
                  modelica_metatype tmpMeta58;
                  modelica_metatype tmpMeta59;
                  modelica_metatype tmpMeta60;
                  
                  /* Pattern matching succeeded */
                  tmpMeta55 = stringAppend(_OMC_LIT35,intString(_skip));
                  tmpMeta56 = stringAppend(tmpMeta55,_OMC_LIT37);
                  tmpMeta57 = stringAppend(tmpMeta56,omc_NFType_toString(threadData, _ty));
                  tmpMeta58 = stringAppend(tmpMeta57,_OMC_LIT38);
                  tmpMeta59 = stringAppend(tmpMeta58,omc_NFComponentRef_toString(threadData, _cref));
                  tmpMeta60 = stringAppend(tmpMeta59,_OMC_LIT18);
                  tmpMeta54 = mmc_mk_cons(tmpMeta60, MMC_REFSTRUCTLIT(mmc_nil));
                  omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta54);
                  goto goto_27;
                  goto tmp28_done;
                }
                }
                goto tmp28_end;
                tmp28_end: ;
              }
              goto goto_27;
              goto_27:;
              goto goto_2;
              goto tmp28_done;
              tmp28_done:;
            }
          }
          _field = tmpMeta26;
          /* Tail recursive call */
          __omcQ_24in_5Findex = _index;
          __omcQ_24in_5Fty = omc_NFComponentRef_getSubscriptedType(threadData, _field, 0 /* false */);
          _skips = _rest;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 3: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,2) == 0) goto tmp3_end;
          
          _rest = tmp4_2;
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(omc_NFDimension_sizesProduct(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 3))), 1 /* true */) == ((modelica_integer) 1))) goto tmp3_end;
          /* Tail recursive call */
          __omcQ_24in_5Findex = _index;
          __omcQ_24in_5Fty = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 2)));
          _skips = _rest;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta61;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,2) == 0) goto tmp3_end;
          
          _rest = tmp4_2;
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(omc_List_compareLength(threadData, _rest, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 3)))) >= ((modelica_integer) 0))) goto tmp3_end;
          _rest = omc_List_split(threadData, _rest, listLength((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 3)))) ,&_tail);

          {
            modelica_metatype __omcQ_24tmpVar21;
            modelica_metatype* tmp62;
            modelica_metatype tmpMeta63;
            modelica_metatype __omcQ_24tmpVar20;
            modelica_integer tmp64;
            modelica_metatype _dim_loopVar = 0;
            modelica_metatype _dim;
            _dim_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 3)));
            tmpMeta63 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar21 = tmpMeta63; /* defaultValue */
            tmp62 = &__omcQ_24tmpVar21;
            while(1) {
              tmp64 = 1;
              if (!listEmpty(_dim_loopVar)) {
                _dim = MMC_CAR(_dim_loopVar);
                _dim_loopVar = MMC_CDR(_dim_loopVar);
                tmp64--;
              }
              if (tmp64 == 0) {
                __omcQ_24tmpVar20 = mmc_mk_integer(omc_NFDimension_size(threadData, _dim, 1 /* true */));
                *tmp62 = mmc_mk_cons(__omcQ_24tmpVar20,0);
                tmp62 = &MMC_CDR(*tmp62);
              } else if (tmp64 == 1) {
                break;
              } else {
                goto goto_2;
              }
            }
            *tmp62 = mmc_mk_nil();
            tmpMeta61 = __omcQ_24tmpVar21;
          }
          _index = omc_NBSlice_locationToIndex(threadData, tmpMeta61, _rest, _index);
          /* Tail recursive call */
          __omcQ_24in_5Findex = _index;
          __omcQ_24in_5Fty = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 2)));
          _skips = _tail;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 5: {
          modelica_metatype tmpMeta65;
          modelica_metatype tmpMeta66;
          modelica_integer tmp67;
          modelica_metatype tmpMeta68;
          modelica_metatype tmpMeta69;
          modelica_metatype tmpMeta70;
          modelica_metatype tmpMeta71;
          modelica_metatype tmpMeta72;
          if (listEmpty(tmp4_2)) goto tmp3_end;
          tmpMeta65 = MMC_CAR(tmp4_2);
          tmpMeta66 = MMC_CDR(tmp4_2);
          tmp67 = mmc_unbox_integer(tmpMeta65);
          
          _skip = tmp67  /* pattern as ty=Integer */;
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(omc_NFType_isTuple(threadData, _ty) || omc_NFType_isArray(threadData, _ty))) goto tmp3_end;
          tmpMeta69 = stringAppend(_OMC_LIT35,intString(_skip));
          tmpMeta70 = stringAppend(tmpMeta69,_OMC_LIT37);
          tmpMeta71 = stringAppend(tmpMeta70,omc_NFType_toString(threadData, _ty));
          tmpMeta72 = stringAppend(tmpMeta71,_OMC_LIT39);
          tmpMeta68 = mmc_mk_cons(tmpMeta72, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta68);
          goto goto_2;
          goto tmp3_done;
        }
        case 6: {
          modelica_metatype tmpMeta73;
          modelica_metatype tmpMeta74;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,2) == 0) goto tmp3_end;
          if (!listEmpty(tmp4_2)) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta74 = stringAppend(_OMC_LIT40,omc_NFType_toString(threadData, _ty));
          tmpMeta73 = mmc_mk_cons(tmpMeta74, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta73);
          goto goto_2;
          goto tmp3_done;
        }
        case 7: {
          modelica_metatype tmpMeta75;
          modelica_metatype tmpMeta76;
          modelica_integer tmp77;
          modelica_metatype tmpMeta78;
          modelica_metatype tmpMeta79;
          modelica_metatype tmpMeta80;
          modelica_metatype tmpMeta81;
          modelica_metatype tmpMeta82;
          if (listEmpty(tmp4_2)) goto tmp3_end;
          tmpMeta75 = MMC_CAR(tmp4_2);
          tmpMeta76 = MMC_CDR(tmp4_2);
          tmp77 = mmc_unbox_integer(tmpMeta75);
          
          _skip = tmp77  /* pattern as ty=Integer */;
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(_skip != ((modelica_integer) 1))) goto tmp3_end;
          tmpMeta79 = stringAppend(_OMC_LIT35,intString(_skip));
          tmpMeta80 = stringAppend(tmpMeta79,_OMC_LIT37);
          tmpMeta81 = stringAppend(tmpMeta80,omc_NFType_toString(threadData, _ty));
          tmpMeta82 = stringAppend(tmpMeta81,_OMC_LIT41);
          tmpMeta78 = mmc_mk_cons(tmpMeta82, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta78);
          goto goto_2;
          goto tmp3_done;
        }
        case 8: {
          
          /* Pattern matching succeeded */
          tmp1_c0 = _index;
          tmpMeta[0+1] = _ty;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _index = tmp1_c0;
  _ty = tmpMeta[0+1];
  _return: OMC_LABEL_UNUSED
  if (out_ty) { *out_ty = _ty; }
  return _index;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveSkips(threadData_t *threadData, modelica_metatype __omcQ_24in_5Findex, modelica_metatype __omcQ_24in_5Fty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap, modelica_metatype *out_ty)
{
  modelica_integer tmp1;
  modelica_integer _index;
  modelica_metatype out_index;
  tmp1 = mmc_unbox_integer(__omcQ_24in_5Findex);
  _index = omc_NBSlice_resolveSkips(threadData, tmp1, __omcQ_24in_5Fty, _skips, _cref, _fullmap, out_ty);
  out_index = mmc_mk_icon(_index);
  /* skip box _ty; NFType */
  return out_index;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveSkipsLst(threadData_t *threadData, modelica_integer _index, modelica_metatype _ty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap)
{
  modelica_metatype _skip_lst = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _combinations = NULL;
  modelica_integer _sub_idx;
  modelica_metatype _sub_ty = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _skip_lst = tmpMeta1;
  _combinations = omc_List_combination(threadData, _skips);
  // _sub_idx has no default value.
  // _sub_ty has no default value.
  if(listEmpty(_combinations))
  {
    tmpMeta3 = mmc_mk_box2(0, mmc_mk_integer(_index), _ty);
    tmpMeta2 = mmc_mk_cons(tmpMeta3, MMC_REFSTRUCTLIT(mmc_nil));
    _skip_lst = tmpMeta2;
  }
  else
  {
    {
      modelica_metatype _com;
      for (tmpMeta4 = _combinations; !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
      {
        _com = MMC_CAR(tmpMeta4);
        _sub_idx = omc_NBSlice_resolveSkips(threadData, _index, _ty, _com, _cref, _fullmap ,&_sub_ty);

        tmpMeta6 = mmc_mk_box2(0, mmc_mk_integer(_sub_idx), _sub_ty);
        tmpMeta5 = mmc_mk_cons(tmpMeta6, _skip_lst);
        _skip_lst = tmpMeta5;
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  return _skip_lst;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveSkipsLst(threadData_t *threadData, modelica_metatype _index, modelica_metatype _ty, modelica_metatype _skips, modelica_metatype _cref, modelica_metatype _fullmap)
{
  modelica_integer tmp1;
  modelica_metatype _skip_lst = NULL;
  modelica_metatype tmpMeta2;
  tmp1 = mmc_unbox_integer(_index);
  _skip_lst = omc_NBSlice_resolveSkipsLst(threadData, tmp1, _ty, _skips, _cref, _fullmap);
  /* skip box _skip_lst; list<tuple<#Integer, NFType>> */
  return _skip_lst;
}

DLLDirection
void omc_NBSlice_upgradeRow(threadData_t *threadData, modelica_metatype _eqn_name, modelica_integer _eqn_arr_idx, modelica_metatype _iter, modelica_metatype _ty, modelica_metatype _dependencies, modelica_metatype _dep, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _fullmap, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  {
    modelica_metatype _cref;
    for (tmpMeta1 = _dependencies; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _cref = MMC_CAR(tmpMeta1);
      omc_NBSlice_resolveDependency(threadData, _cref, _eqn_name, _eqn_arr_idx, _iter, _ty, _dep, _rep, _map, _fullmap, _m, _mapping, _modes);
    }
  }
  _return: OMC_LABEL_UNUSED
  return;
}
void boxptr_NBSlice_upgradeRow(threadData_t *threadData, modelica_metatype _eqn_name, modelica_metatype _eqn_arr_idx, modelica_metatype _iter, modelica_metatype _ty, modelica_metatype _dependencies, modelica_metatype _dep, modelica_metatype _rep, modelica_metatype _map, modelica_metatype _fullmap, modelica_metatype _m, modelica_metatype _mapping, modelica_metatype _modes)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_eqn_arr_idx);
  omc_NBSlice_upgradeRow(threadData, _eqn_name, tmp1, _iter, _ty, _dependencies, _dep, _rep, _map, _fullmap, _m, _mapping, _modes);
  return;
}

DLLDirection
modelica_metatype omc_NBSlice_upgradeRowFull(threadData_t *threadData, modelica_metatype _dependencies, modelica_metatype _map, modelica_metatype _mapping)
{
  modelica_metatype _indices = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _scalarized_dependencies = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _replaced = NULL;
  modelica_metatype _stripped = NULL;
  modelica_integer _var_arr_idx;
  modelica_integer _var_start;
  modelica_integer _var_scal_idx;
  modelica_metatype _sizes = NULL;
  modelica_metatype _int_subs = NULL;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_integer tmp9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _indices = tmpMeta1;
  {
    modelica_metatype __omcQ_24tmpVar23;
    modelica_metatype* tmp3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar22;
    modelica_integer tmp5;
    modelica_metatype _dep_loopVar = 0;
    modelica_metatype _dep;
    _dep_loopVar = _dependencies;
    tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar23 = tmpMeta4; /* defaultValue */
    tmp3 = &__omcQ_24tmpVar23;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_dep_loopVar)) {
        _dep = MMC_CAR(_dep_loopVar);
        _dep_loopVar = MMC_CDR(_dep_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        __omcQ_24tmpVar22 = omc_NFComponentRef_scalarizeAll(threadData, _dep, 1 /* true */);
        *tmp3 = mmc_mk_cons(__omcQ_24tmpVar22,0);
        tmp3 = &MMC_CDR(*tmp3);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp3 = mmc_mk_nil();
    tmpMeta2 = __omcQ_24tmpVar23;
  }
  _scalarized_dependencies = omc_List_flatten(threadData, tmpMeta2);
  // _replaced has no default value.
  // _stripped has no default value.
  // _var_arr_idx has no default value.
  // _var_start has no default value.
  // _var_scal_idx has no default value.
  // _sizes has no default value.
  // _int_subs has no default value.
  {
    modelica_metatype _cref;
    for (tmpMeta6 = _scalarized_dependencies; !listEmpty(tmpMeta6); tmpMeta6=MMC_CDR(tmpMeta6))
    {
      _cref = MMC_CAR(tmpMeta6);
      _replaced = omc_NFComponentRef_mapExp(threadData, _cref, boxvar_NFExpression_replaceResizableParameter);

      _stripped = omc_NFComponentRef_stripSubscriptsAll(threadData, _replaced);

      _var_arr_idx = mmc_unbox_integer(omc_UnorderedMap_getSafe(threadData, _stripped, _map, _OMC_LIT42));

      /* Pattern-matching assignment */
      tmpMeta7 = arrayGet((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mapping), 5))),_var_arr_idx) /* DAE.ASUB */;
      tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 1));
      tmp9 = mmc_unbox_integer(tmpMeta8);
      _var_start = tmp9  /* pattern as ty=Integer */;

      tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
      _sizes = omc_NFComponentRef_sizes(threadData, _stripped, 0 /* false */, 0 /* false */, tmpMeta10);

      _int_subs = omc_NFComponentRef_subscriptsToInteger(threadData, _replaced);

      _var_scal_idx = omc_NBSlice_locationToIndex(threadData, _sizes, _int_subs, _var_start);

      tmpMeta11 = mmc_mk_cons(mmc_mk_integer(_var_scal_idx), _indices);
      _indices = tmpMeta11;
    }
  }
  _return: OMC_LABEL_UNUSED
  return _indices;
}

DLLDirection
modelica_metatype omc_NBSlice_naiveSeparation(threadData_t *threadData, modelica_metatype _indices)
{
  modelica_metatype _index_clusters = NULL;
  modelica_metatype tmpMeta1;
  modelica_integer _i;
  modelica_metatype _rest = NULL;
  modelica_metatype _current = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_integer tmp6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _index_clusters = tmpMeta1;
  // _i has no default value.
  // _rest has no default value.
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _current = tmpMeta2;
  if((!listEmpty(_indices)))
  {
    /* Pattern-matching assignment */
    tmpMeta3 = listReverse(_indices);
    if (listEmpty(tmpMeta3)) MMC_THROW_INTERNAL();
    tmpMeta4 = MMC_CAR(tmpMeta3);
    tmpMeta5 = MMC_CDR(tmpMeta3);
    tmp6 = mmc_unbox_integer(tmpMeta4);
    _i = tmp6  /* pattern as ty=Integer */;
    _rest = tmpMeta5;

    tmpMeta7 = mmc_mk_cons(mmc_mk_integer(_i), MMC_REFSTRUCTLIT(mmc_nil));
    _current = tmpMeta7;

    {
      modelica_metatype _i2;
      for (tmpMeta8 = _rest; !listEmpty(tmpMeta8); tmpMeta8=MMC_CDR(tmpMeta8))
      {
        _i2 = MMC_CAR(tmpMeta8);
        if((_i - (mmc_unbox_integer(_i2)) == ((modelica_integer) 1)))
        {
          tmpMeta9 = mmc_mk_cons(_i2, _current);
          _current = tmpMeta9;
        }
        else
        {
          tmpMeta10 = mmc_mk_cons(_current, _index_clusters);
          _index_clusters = tmpMeta10;

          tmpMeta11 = mmc_mk_cons(_i2, MMC_REFSTRUCTLIT(mmc_nil));
          _current = tmpMeta11;
        }

        _i = mmc_unbox_integer(_i2);
      }
    }

    tmpMeta13 = mmc_mk_cons(_current, _index_clusters);
    _index_clusters = tmpMeta13;
  }
  _return: OMC_LABEL_UNUSED
  return _index_clusters;
}

DLLDirection
modelica_metatype omc_NBSlice_reconstructDiagonal(threadData_t *threadData, modelica_metatype _frame_locations_transposed, modelica_metatype _starts, modelica_metatype _steps, modelica_metatype _stops, modelica_metatype _shifts, modelica_metatype _failed)
{
  modelica_metatype _diagonal = NULL;
  modelica_metatype tmpMeta1;
  modelica_integer _start;
  modelica_integer _step;
  modelica_integer _stop;
  modelica_integer _pos;
  modelica_integer _shift;
  modelica_boolean _fail_;
  modelica_metatype _start_rest = NULL;
  modelica_metatype _step_rest = NULL;
  modelica_metatype _stop_rest = NULL;
  modelica_metatype _shift_rest = NULL;
  modelica_metatype _fail_rest = NULL;
  modelica_metatype _dim = NULL;
  modelica_metatype _missing_dims = NULL;
  modelica_metatype _frame = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_integer tmp9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_integer tmp13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_integer tmp17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_integer tmp21;
  modelica_metatype tmpMeta22;
  modelica_metatype tmpMeta23;
  modelica_integer tmp24;
  modelica_integer tmp25;
  modelica_integer tmp26;
  modelica_metatype tmpMeta27;
  modelica_metatype tmpMeta28;
  modelica_integer tmp29;
  modelica_integer tmp30;
  modelica_integer tmp31;
  modelica_metatype tmpMeta32;
  modelica_metatype tmpMeta33;
  modelica_metatype tmpMeta34;
  modelica_metatype tmpMeta35;
  modelica_metatype tmpMeta36;
  modelica_integer tmp37;
  modelica_metatype tmpMeta38;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _diagonal = tmpMeta1;
  // _start has no default value.
  // _step has no default value.
  // _stop has no default value.
  // _pos has no default value.
  _shift = ((modelica_integer) 1);
  // _fail_ has no default value.
  _start_rest = _starts;
  _step_rest = _steps;
  _stop_rest = _stops;
  _shift_rest = _shifts;
  _fail_rest = _failed;
  // _dim has no default value.
  // _missing_dims has no default value.
  // _frame has no default value.
  {
    modelica_metatype _tpl;
    for (tmpMeta2 = _frame_locations_transposed; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _tpl = MMC_CAR(tmpMeta2);
      /* Pattern-matching assignment */
      tmpMeta3 = _tpl;
      tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta3), 1));
      tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta3), 2));
      _dim = tmpMeta4;
      _frame = tmpMeta5;

      /* Pattern-matching assignment */
      tmpMeta6 = _start_rest;
      if (listEmpty(tmpMeta6)) MMC_THROW_INTERNAL();
      tmpMeta7 = MMC_CAR(tmpMeta6);
      tmpMeta8 = MMC_CDR(tmpMeta6);
      tmp9 = mmc_unbox_integer(tmpMeta7);
      _start = tmp9  /* pattern as ty=Integer */;
      _start_rest = tmpMeta8;

      /* Pattern-matching assignment */
      tmpMeta10 = _step_rest;
      if (listEmpty(tmpMeta10)) MMC_THROW_INTERNAL();
      tmpMeta11 = MMC_CAR(tmpMeta10);
      tmpMeta12 = MMC_CDR(tmpMeta10);
      tmp13 = mmc_unbox_integer(tmpMeta11);
      _step = tmp13  /* pattern as ty=Integer */;
      _step_rest = tmpMeta12;

      /* Pattern-matching assignment */
      tmpMeta14 = _stop_rest;
      if (listEmpty(tmpMeta14)) MMC_THROW_INTERNAL();
      tmpMeta15 = MMC_CAR(tmpMeta14);
      tmpMeta16 = MMC_CDR(tmpMeta14);
      tmp17 = mmc_unbox_integer(tmpMeta15);
      _stop = tmp17  /* pattern as ty=Integer */;
      _stop_rest = tmpMeta16;

      /* Pattern-matching assignment */
      tmpMeta18 = _fail_rest;
      if (listEmpty(tmpMeta18)) MMC_THROW_INTERNAL();
      tmpMeta19 = MMC_CAR(tmpMeta18);
      tmpMeta20 = MMC_CDR(tmpMeta18);
      tmp21 = mmc_unbox_integer(tmpMeta19);
      _fail_ = tmp21  /* pattern as ty=Boolean */;
      _fail_rest = tmpMeta20;

      tmpMeta22 = MMC_REFSTRUCTLIT(mmc_nil);
      _missing_dims = tmpMeta22;

      _pos = _start;

      if(_fail_)
      {
        tmp24 = ((modelica_integer) 1); tmp25 = _shift; tmp26 = arrayLength(_dim);
        if(!tmp25) {
          omc_assert(threadData, omc_dummyFileInfo, "assertion range step != 0 failed");
        } else if(!(((tmp25 > 0) && (tmp24 > tmp26)) || ((tmp25 < 0) && (tmp24 < tmp26))))
        {
          modelica_integer _i;
          for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp24, tmp26); _i += tmp25)
          {
            while(1)
            {
              if(!(mmc_unbox_integer(arrayGet(_dim,_i) /* DAE.ASUB */) != _pos)) break;
              tmpMeta23 = mmc_mk_cons(mmc_mk_integer(_pos), _missing_dims);
              _missing_dims = tmpMeta23;

              _pos = _pos + _step;

              if(((sign(((modelica_real)_step))) * (_pos) > (sign(((modelica_real)_step))) * (_stop)))
              {
                break;
              }
            }

            if(((sign(((modelica_real)_step))) * (_pos + _step) > (sign(((modelica_real)_step))) * (_stop)))
            {
              _pos = _start;
            }
            else
            {
              _pos = _pos + _step;
            }
          }
        }

        while(1)
        {
          if(!((sign(((modelica_real)_step))) * (_pos) <= (sign(((modelica_real)_step))) * (_stop))) break;
          tmpMeta27 = mmc_mk_cons(mmc_mk_integer(_pos), _missing_dims);
          _missing_dims = tmpMeta27;

          _pos = _pos + _step;
        }
      }
      else
      {
        tmp29 = ((modelica_integer) 1); tmp30 = _shift; tmp31 = arrayLength(_dim);
        if(!tmp30) {
          omc_assert(threadData, omc_dummyFileInfo, "assertion range step != 0 failed");
        } else if(!(((tmp30 > 0) && (tmp29 > tmp31)) || ((tmp30 < 0) && (tmp29 < tmp31))))
        {
          modelica_integer _i;
          for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp29, tmp31); _i += tmp30)
          {
            tmpMeta28 = mmc_mk_cons(arrayGet(_dim,_i) /* DAE.ASUB */, _missing_dims);
            _missing_dims = tmpMeta28;
          }
        }
      }

      tmpMeta33 = mmc_mk_box2(0, listArray(listReverse(_missing_dims)), _frame);
      tmpMeta32 = mmc_mk_cons(tmpMeta33, _diagonal);
      _diagonal = tmpMeta32;

      /* Pattern-matching assignment */
      tmpMeta34 = _shift_rest;
      if (listEmpty(tmpMeta34)) MMC_THROW_INTERNAL();
      tmpMeta35 = MMC_CAR(tmpMeta34);
      tmpMeta36 = MMC_CDR(tmpMeta34);
      tmp37 = mmc_unbox_integer(tmpMeta35);
      _shift = tmp37  /* pattern as ty=Integer */;
      _shift_rest = tmpMeta36;
    }
  }

  _diagonal = listReverse(_diagonal);
  _return: OMC_LABEL_UNUSED
  return _diagonal;
}

DLLDirection
modelica_metatype omc_NBSlice_recollectRangesHeuristic(threadData_t *threadData, modelica_metatype _frame_locations_transposed, modelica_metatype *out_removed_diagonal, modelica_integer *out_status)
{
  modelica_metatype _frames = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _removed_diagonal = NULL;
  modelica_integer _status;
  modelica_metatype _dim = NULL;
  modelica_metatype _frame = NULL;
  modelica_integer _check_shift;
  modelica_integer _pre_shift;
  modelica_integer _shift;
  modelica_integer _start;
  modelica_integer _step;
  modelica_integer _stop;
  modelica_integer _max_size;
  modelica_integer _new_step;
  modelica_integer _new_stop;
  modelica_integer _check_stop;
  modelica_boolean _fail_;
  modelica_metatype _rest = NULL;
  modelica_metatype _starts = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _stops = NULL;
  modelica_metatype tmpMeta3;
  modelica_metatype _steps = NULL;
  modelica_metatype tmpMeta4;
  modelica_metatype _shifts = NULL;
  modelica_metatype tmpMeta5;
  modelica_metatype _failed = NULL;
  modelica_metatype tmpMeta6;
  modelica_integer _min_dim;
  modelica_integer _max_dim;
  modelica_metatype _diagonal = NULL;
  modelica_metatype _replacements = NULL;
  modelica_integer _fos;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_metatype tmpMeta21;
  modelica_metatype tmpMeta22;
  modelica_integer tmp23;
  modelica_integer tmp26;
  modelica_metatype tmpMeta29;
  modelica_metatype tmpMeta30;
  modelica_metatype tmpMeta31;
  modelica_metatype tmpMeta32;
  modelica_metatype tmpMeta33;
  modelica_metatype tmpMeta34;
  modelica_metatype tmpMeta35;
  modelica_metatype tmpMeta36;
  modelica_metatype tmpMeta37;
  modelica_boolean tmp38;
  modelica_metatype tmpMeta39;
  modelica_metatype tmpMeta40;
  modelica_metatype tmpMeta41;
  modelica_boolean tmp42;
  modelica_metatype tmpMeta43;
  modelica_metatype tmpMeta44;
  modelica_metatype tmpMeta45;
  modelica_metatype tmpMeta46;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _frames = tmpMeta1;
  _removed_diagonal = mmc_mk_none();
  // _status has no default value.
  // _dim has no default value.
  // _frame has no default value.
  // _check_shift has no default value.
  // _pre_shift has no default value.
  _shift = ((modelica_integer) 1);
  // _start has no default value.
  // _step has no default value.
  // _stop has no default value.
  // _max_size has no default value.
  // _new_step has no default value.
  // _new_stop has no default value.
  // _check_stop has no default value.
  // _fail_ has no default value.
  // _rest has no default value.
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _starts = tmpMeta2;
  tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
  _stops = tmpMeta3;
  tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
  _steps = tmpMeta4;
  tmpMeta5 = MMC_REFSTRUCTLIT(mmc_nil);
  _shifts = tmpMeta5;
  tmpMeta6 = MMC_REFSTRUCTLIT(mmc_nil);
  _failed = tmpMeta6;
  // _min_dim has no default value.
  // _max_dim has no default value.
  // _diagonal has no default value.
  // _replacements has no default value.
  // _fos has no default value.
  {
    modelica_metatype _tpl;
    for (tmpMeta7 = _frame_locations_transposed; !listEmpty(tmpMeta7); tmpMeta7=MMC_CDR(tmpMeta7))
    {
      _tpl = MMC_CAR(tmpMeta7);
      _fail_ = 0 /* false */;

      /* Pattern-matching assignment */
      tmpMeta8 = _tpl;
      tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta8), 1));
      tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta8), 2));
      _dim = tmpMeta9;
      _frame = tmpMeta10;

      _pre_shift = _shift;

      _max_size = arrayLength(_dim);

      if((_max_size == ((modelica_integer) 1)))
      {
        tmpMeta12 = mmc_mk_box3(0, arrayGet(_dim,((modelica_integer) 1)) /* DAE.ASUB */, mmc_mk_integer(((modelica_integer) 1)), arrayGet(_dim,((modelica_integer) 1)) /* DAE.ASUB */);
        tmpMeta11 = mmc_mk_cons(omc_NBSlice_applyNewFrameRange(threadData, _frame, tmpMeta12), _frames);
        _frames = tmpMeta11;

        tmpMeta13 = mmc_mk_cons(arrayGet(_dim,((modelica_integer) 1)) /* DAE.ASUB */, _starts);
        _starts = tmpMeta13;

        tmpMeta14 = mmc_mk_cons(mmc_mk_integer(((modelica_integer) 0)), _steps);
        _steps = tmpMeta14;

        tmpMeta15 = mmc_mk_cons(arrayGet(_dim,((modelica_integer) 1)) /* DAE.ASUB */, _stops);
        _stops = tmpMeta15;

        tmpMeta16 = mmc_mk_cons(mmc_mk_integer(_shift), _shifts);
        _shifts = tmpMeta16;
      }
      else
      {
        _start = mmc_unbox_integer(arrayGet(_dim,((modelica_integer) 1)) /* DAE.ASUB */);

        _stop = mmc_unbox_integer(arrayGet(_dim,((modelica_integer) 1) + _shift) /* DAE.ASUB */);

        _step = _stop - _start;

        if((_step == ((modelica_integer) 0)))
        {
          tmpMeta18 = mmc_mk_box3(0, mmc_mk_integer(_start), mmc_mk_integer(((modelica_integer) 1)), mmc_mk_integer(_stop));
          tmpMeta17 = mmc_mk_cons(omc_NBSlice_applyNewFrameRange(threadData, _frame, tmpMeta18), _frames);
          _frames = tmpMeta17;

          tmpMeta19 = mmc_mk_cons(mmc_mk_integer(_start), _starts);
          _starts = tmpMeta19;

          tmpMeta20 = mmc_mk_cons(mmc_mk_integer(_step), _steps);
          _steps = tmpMeta20;

          tmpMeta21 = mmc_mk_cons(mmc_mk_integer(_stop), _stops);
          _stops = tmpMeta21;

          tmpMeta22 = mmc_mk_cons(mmc_mk_integer(_shift), _shifts);
          _shifts = tmpMeta22;
        }
        else
        {
          _new_step = _step;

          _new_stop = _stop;

          while(1)
          {
            if(!((_new_step == _step) && (_shift + _pre_shift < _max_size))) break;
            _stop = _new_stop;

            _shift = _shift + _pre_shift;

            _new_stop = mmc_unbox_integer(arrayGet(_dim,((modelica_integer) 1) + _shift) /* DAE.ASUB */);

            _new_step = _new_stop - _stop;
          }

          if((_new_step == _step))
          {
            _stop = _new_stop;

            _shift = _shift + _pre_shift;
          }
          else
          {
            _check_shift = _shift;

            while(1)
            {
              if(!(_check_shift + _pre_shift < _max_size)) break;
              _new_step = _step;

              while(1)
              {
                if(!((_new_step == _step) && (_check_shift + _pre_shift < _max_size))) break;
                _check_stop = _new_stop;

                _check_shift = _check_shift + _pre_shift;

                _new_stop = mmc_unbox_integer(arrayGet(_dim,((modelica_integer) 1) + _check_shift) /* DAE.ASUB */);

                _new_step = _new_stop - _check_stop;
              }

              if((_check_shift + _pre_shift == _max_size))
              {
                _check_shift = _check_shift + _pre_shift;
              }

              if((!(modelica_integer_mod(_check_shift, _shift) == ((modelica_integer) 0))))
              {
                _fail_ = 1 /* true */;

                break;
              }
            }
          }

          {
            modelica_integer __omcQ_24tmpVar25;
            modelica_integer __omcQ_24tmpVar24;
            modelica_integer tmp24;
            modelica_metatype _d_loopVar = 0;
            modelica_integer tmp25;
            modelica_metatype _d;
            _d_loopVar = _dim;
            tmp25 = 1;
            __omcQ_24tmpVar25 = ((modelica_integer) 4611686018427387903); /* defaultValue */
            while(1) {
              tmp24 = 1;
              if (tmp25 <= arrayLength(_d_loopVar)) {
                _d = arrayGet(_d_loopVar, tmp25++);
                tmp24--;
              }
              if (tmp24 == 0) {
                __omcQ_24tmpVar24 = mmc_unbox_integer(_d);
                __omcQ_24tmpVar25 = modelica_integer_min((modelica_integer)(__omcQ_24tmpVar24),(modelica_integer)(__omcQ_24tmpVar25));
              } else if (tmp24 == 1) {
                break;
              } else {
                MMC_THROW_INTERNAL();
              }
            }
            tmp23 = __omcQ_24tmpVar25;
          }
          _min_dim = tmp23;

          {
            modelica_integer __omcQ_24tmpVar27;
            modelica_integer __omcQ_24tmpVar26;
            modelica_integer tmp27;
            modelica_metatype _d_loopVar = 0;
            modelica_integer tmp28;
            modelica_metatype _d;
            _d_loopVar = _dim;
            tmp28 = 1;
            __omcQ_24tmpVar27 = ((modelica_integer) -4611686018427387903); /* defaultValue */
            while(1) {
              tmp27 = 1;
              if (tmp28 <= arrayLength(_d_loopVar)) {
                _d = arrayGet(_d_loopVar, tmp28++);
                tmp27--;
              }
              if (tmp27 == 0) {
                __omcQ_24tmpVar26 = mmc_unbox_integer(_d);
                __omcQ_24tmpVar27 = modelica_integer_max((modelica_integer)(__omcQ_24tmpVar26),(modelica_integer)(__omcQ_24tmpVar27));
              } else if (tmp27 == 1) {
                break;
              } else {
                MMC_THROW_INTERNAL();
              }
            }
            tmp26 = __omcQ_24tmpVar27;
          }
          _max_dim = tmp26;

          if(_fail_)
          {
            if((_step > ((modelica_integer) 0)))
            {
              tmpMeta30 = mmc_mk_box3(0, mmc_mk_integer(_min_dim), mmc_mk_integer(_step), mmc_mk_integer(_max_dim));
              tmpMeta29 = mmc_mk_cons(omc_NBSlice_applyNewFrameRange(threadData, _frame, tmpMeta30), _frames);
              _frames = tmpMeta29;
            }
            else
            {
              tmpMeta32 = mmc_mk_box3(0, mmc_mk_integer(_max_dim), mmc_mk_integer(_step), mmc_mk_integer(_min_dim));
              tmpMeta31 = mmc_mk_cons(omc_NBSlice_applyNewFrameRange(threadData, _frame, tmpMeta32), _frames);
              _frames = tmpMeta31;
            }
          }
          else
          {
            tmpMeta34 = mmc_mk_box3(0, mmc_mk_integer(_start), mmc_mk_integer(_step), mmc_mk_integer(_stop));
            tmpMeta33 = mmc_mk_cons(omc_NBSlice_applyNewFrameRange(threadData, _frame, tmpMeta34), _frames);
            _frames = tmpMeta33;
          }

          tmpMeta35 = mmc_mk_cons(mmc_mk_integer(_step), _steps);
          _steps = tmpMeta35;

          tmp38 = (modelica_boolean)(_step > ((modelica_integer) 0));
          if(tmp38)
          {
            tmpMeta36 = mmc_mk_cons(mmc_mk_integer(_min_dim), _starts);
            tmpMeta39 = tmpMeta36;
          }
          else
          {
            tmpMeta37 = mmc_mk_cons(mmc_mk_integer(_max_dim), _starts);
            tmpMeta39 = tmpMeta37;
          }
          _starts = tmpMeta39;

          tmp42 = (modelica_boolean)(_step > ((modelica_integer) 0));
          if(tmp42)
          {
            tmpMeta40 = mmc_mk_cons(mmc_mk_integer(_max_dim), _stops);
            tmpMeta43 = tmpMeta40;
          }
          else
          {
            tmpMeta41 = mmc_mk_cons(mmc_mk_integer(_min_dim), _stops);
            tmpMeta43 = tmpMeta41;
          }
          _stops = tmpMeta43;

          tmpMeta44 = mmc_mk_cons(mmc_mk_integer(_shift), _shifts);
          _shifts = tmpMeta44;

          tmpMeta45 = mmc_mk_cons(mmc_mk_boolean(_fail_), _failed);
          _failed = tmpMeta45;
        }
      }
    }
  }

  if(mmc_unbox_boolean(omc_List_fold(threadData, _failed, boxvar_boolOr, mmc_mk_boolean(0 /* false */))))
  {
    _diagonal = omc_NBSlice_reconstructDiagonal(threadData, _frame_locations_transposed, listReverse(_starts), listReverse(_steps), listReverse(_stops), listReverse(_shifts), listReverse(_failed));

    _diagonal = omc_NBSlice_orderTransposedFrameLocations(threadData, _diagonal ,&_replacements ,&_fos);

    if(((modelica_integer)_fos == 2))
    {
      _removed_diagonal = mmc_mk_some(_replacements);

      _status = 1;
    }
    else
    {
      _status = 2;
    }
  }
  else
  {
    _status = 1;
  }
  _return: OMC_LABEL_UNUSED
  if (out_removed_diagonal) { *out_removed_diagonal = _removed_diagonal; }
  if (out_status) { *out_status = _status; }
  return _frames;
}
modelica_metatype boxptr_NBSlice_recollectRangesHeuristic(threadData_t *threadData, modelica_metatype _frame_locations_transposed, modelica_metatype *out_removed_diagonal, modelica_metatype *out_status)
{
  modelica_integer _status;
  modelica_metatype _frames = NULL;
  modelica_metatype tmpMeta1;
  _frames = omc_NBSlice_recollectRangesHeuristic(threadData, _frame_locations_transposed, out_removed_diagonal, &_status);
  /* skip box _frames; list<tuple<NFComponentRef, NFExpression, Option<NBEquation.Iterator>>> */
  /* skip box _removed_diagonal; Option<UnorderedMap<NFComponentRef,NFExpression>> */
  if (out_status) { *out_status = mmc_mk_icon(_status); }
  return _frames;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_resolveEqualInertia(threadData_t *threadData, modelica_metatype _frame_inertia_lst, modelica_metatype _replacements, modelica_integer *out_status)
{
  modelica_metatype _resolved = NULL;
  modelica_metatype tmpMeta1;
  modelica_integer _status;
  modelica_metatype _tpl1 = NULL;
  modelica_metatype _tpl2 = NULL;
  modelica_metatype _rest = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta42;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _resolved = tmpMeta1;
  _status = 1;
  // _tpl1 has no default value.
  // _tpl2 has no default value.
  // _rest has no default value.
  /* Pattern-matching assignment */
  tmpMeta2 = _frame_inertia_lst;
  if (listEmpty(tmpMeta2)) MMC_THROW_INTERNAL();
  tmpMeta3 = MMC_CAR(tmpMeta2);
  tmpMeta4 = MMC_CDR(tmpMeta2);
  _tpl1 = tmpMeta3;
  _rest = tmpMeta4;

  while(1)
  {
    if(!(!listEmpty(_rest))) break;
    /* Pattern-matching assignment */
    tmpMeta5 = _rest;
    if (listEmpty(tmpMeta5)) MMC_THROW_INTERNAL();
    tmpMeta6 = MMC_CAR(tmpMeta5);
    tmpMeta7 = MMC_CDR(tmpMeta5);
    _tpl2 = tmpMeta6;
    _rest = tmpMeta7;

    { /* match expression */
      modelica_metatype tmp11_1;modelica_metatype tmp11_2;
      tmp11_1 = _tpl1;
      tmp11_2 = _tpl2;
      {
        modelica_integer _inertia1;
        modelica_integer _inertia2;
        modelica_integer _m;
        modelica_integer _b;
        modelica_metatype _loc1 = NULL;
        modelica_metatype _loc2 = NULL;
        modelica_metatype _name1 = NULL;
        modelica_metatype _name2 = NULL;
        modelica_metatype _addOp = NULL;
        modelica_metatype _mulOp = NULL;
        modelica_metatype _linMap = NULL;
        volatile mmc_switch_type tmp11;
        int tmp12;
        // _inertia1 has no default value.
        // _inertia2 has no default value.
        // _m has no default value.
        // _b has no default value.
        // _loc1 has no default value.
        // _loc2 has no default value.
        // _name1 has no default value.
        // _name2 has no default value.
        // _addOp has no default value.
        // _mulOp has no default value.
        // _linMap has no default value.
        tmp11 = 0;
        for (; tmp11 < 2; tmp11++) {
          switch (MMC_SWITCH_CAST(tmp11)) {
          case 0: {
            modelica_metatype tmpMeta13;
            modelica_integer tmp14;
            modelica_metatype tmpMeta15;
            modelica_metatype tmpMeta16;
            modelica_metatype tmpMeta17;
            modelica_metatype tmpMeta18;
            modelica_metatype tmpMeta19;
            modelica_integer tmp20;
            modelica_metatype tmpMeta21;
            modelica_metatype tmpMeta22;
            modelica_metatype tmpMeta23;
            modelica_metatype tmpMeta24;
            modelica_metatype tmpMeta25;
            modelica_metatype tmpMeta26;
            modelica_metatype tmpMeta27;
            modelica_metatype tmpMeta28;
            modelica_real tmp29;
            modelica_integer tmp30;
            modelica_integer tmp31;
            modelica_integer tmp32;
            modelica_metatype tmpMeta33;
            modelica_metatype tmpMeta34;
            modelica_metatype tmpMeta35;
            modelica_metatype tmpMeta36;
            modelica_metatype tmpMeta37;
            modelica_metatype tmpMeta38;
            modelica_metatype tmpMeta39;
            modelica_metatype tmpMeta40;
            tmpMeta13 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp11_1), 1));
            tmp14 = mmc_unbox_integer(tmpMeta13);
            tmpMeta15 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp11_1), 2));
            tmpMeta16 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta15), 1));
            tmpMeta17 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta15), 2));
            tmpMeta18 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta17), 1));
            tmpMeta19 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp11_2), 1));
            tmp20 = mmc_unbox_integer(tmpMeta19);
            tmpMeta21 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp11_2), 2));
            tmpMeta22 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta21), 1));
            tmpMeta23 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta21), 2));
            tmpMeta24 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta23), 1));
            
            _inertia1 = tmp14  /* pattern as ty=Integer */;
            _loc1 = tmpMeta16;
            _name1 = tmpMeta18;
            _inertia2 = tmp20  /* pattern as ty=Integer */;
            _loc2 = tmpMeta22;
            _name2 = tmpMeta24;
            /* Pattern matching succeeded */
            /* Check guard condition after assignments */
            if (!(_inertia1 == _inertia2)) goto tmp10_end;
            _addOp = omc_NFOperator_fromClassification(threadData, _OMC_LIT43, _OMC_LIT44);

            _mulOp = omc_NFOperator_fromClassification(threadData, _OMC_LIT45, _OMC_LIT44);

            if((arrayLength(_loc1) != arrayLength(_loc2)))
            {
              _status = 3;

              goto _return;
            }
            else
            {
              if((arrayLength(_loc1) == ((modelica_integer) 1)))
              {
                _b = mmc_unbox_integer(arrayGet(_loc2,((modelica_integer) 1)) /* DAE.ASUB */) - (mmc_unbox_integer(arrayGet(_loc1,((modelica_integer) 1)) /* DAE.ASUB */));

                _linMap = omc_NFExpression_fromCref(threadData, _name1, 0 /* false */);

                if((_b != ((modelica_integer) 0)))
                {
                  tmpMeta26 = mmc_mk_box2(3, &NFExpression_INTEGER__desc, mmc_mk_integer(_b));
                  tmpMeta25 = mmc_mk_cons(tmpMeta26, mmc_mk_cons(_linMap, MMC_REFSTRUCTLIT(mmc_nil)));
                  tmpMeta27 = MMC_REFSTRUCTLIT(mmc_nil);
                  tmpMeta28 = mmc_mk_box4(24, &NFExpression_MULTARY__desc, tmpMeta25, tmpMeta27, _addOp);
                  _linMap = tmpMeta28;
                }

                omc_UnorderedMap_add(threadData, _name2, _linMap, _replacements);

                _status = 2;
              }
              else
              {
                tmp29 = ((modelica_real)mmc_unbox_integer(arrayGet(_loc1,((modelica_integer) 1)) /* DAE.ASUB */) - (mmc_unbox_integer(arrayGet(_loc1,((modelica_integer) 1) + _inertia1) /* DAE.ASUB */)));
                if (tmp29 == 0) {goto goto_9;}
                _m = ((modelica_integer)floor((((modelica_real)mmc_unbox_integer(arrayGet(_loc2,((modelica_integer) 1)) /* DAE.ASUB */) - (mmc_unbox_integer(arrayGet(_loc2,((modelica_integer) 1) + _inertia2) /* DAE.ASUB */)))) / tmp29));

                _b = mmc_unbox_integer(arrayGet(_loc2,((modelica_integer) 1)) /* DAE.ASUB */) - ((_m) * (mmc_unbox_integer(arrayGet(_loc1,((modelica_integer) 1)) /* DAE.ASUB */)));

                tmp30 = ((modelica_integer) 2); tmp31 = 1; tmp32 = arrayLength(_loc1);
                if(!(((tmp31 > 0) && (tmp30 > tmp32)) || ((tmp31 < 0) && (tmp30 < tmp32))))
                {
                  modelica_integer _i;
                  for(_i = ((modelica_integer) 2); in_range_integer(_i, tmp30, tmp32); _i += tmp31)
                  {
                    if((mmc_unbox_integer(arrayGet(_loc2,_i) /* DAE.ASUB */) != (_m) * (mmc_unbox_integer(arrayGet(_loc1,_i) /* DAE.ASUB */)) + _b))
                    {
                      _status = 3;

                      goto _return;
                    }
                  }
                }

                _linMap = omc_NFExpression_fromCref(threadData, _name1, 0 /* false */);

                if((_m != ((modelica_integer) 1)))
                {
                  tmpMeta34 = mmc_mk_box2(3, &NFExpression_INTEGER__desc, mmc_mk_integer(_m));
                  tmpMeta33 = mmc_mk_cons(tmpMeta34, mmc_mk_cons(_linMap, MMC_REFSTRUCTLIT(mmc_nil)));
                  tmpMeta35 = MMC_REFSTRUCTLIT(mmc_nil);
                  tmpMeta36 = mmc_mk_box4(24, &NFExpression_MULTARY__desc, tmpMeta33, tmpMeta35, _mulOp);
                  _linMap = tmpMeta36;
                }

                if((_b != ((modelica_integer) 0)))
                {
                  tmpMeta38 = mmc_mk_box2(3, &NFExpression_INTEGER__desc, mmc_mk_integer(_b));
                  tmpMeta37 = mmc_mk_cons(tmpMeta38, mmc_mk_cons(_linMap, MMC_REFSTRUCTLIT(mmc_nil)));
                  tmpMeta39 = MMC_REFSTRUCTLIT(mmc_nil);
                  tmpMeta40 = mmc_mk_box4(24, &NFExpression_MULTARY__desc, tmpMeta37, tmpMeta39, _addOp);
                  _linMap = tmpMeta40;
                }

                omc_UnorderedMap_add(threadData, _name2, _linMap, _replacements);

                _status = 2;
              }
            }
            tmpMeta8 = _tpl1;
            goto tmp10_done;
          }
          case 1: {
            modelica_metatype tmpMeta41;
            
            /* Pattern matching succeeded */
            tmpMeta41 = mmc_mk_cons(_tpl1, _resolved);
            _resolved = tmpMeta41;
            tmpMeta8 = _tpl2;
            goto tmp10_done;
          }
          }
          goto tmp10_end;
          tmp10_end: ;
        }
        goto goto_9;
        goto_9:;
        MMC_THROW_INTERNAL();
        goto tmp10_done;
        tmp10_done:;
      }
    }
    _tpl1 = tmpMeta8;
  }

  tmpMeta42 = mmc_mk_cons(_tpl1, _resolved);
  _resolved = listReverse(tmpMeta42);
  _return: OMC_LABEL_UNUSED
  if (out_status) { *out_status = _status; }
  return _resolved;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_resolveEqualInertia(threadData_t *threadData, modelica_metatype _frame_inertia_lst, modelica_metatype _replacements, modelica_metatype *out_status)
{
  modelica_integer _status;
  modelica_metatype _resolved = NULL;
  modelica_metatype tmpMeta1;
  _resolved = omc_NBSlice_resolveEqualInertia(threadData, _frame_inertia_lst, _replacements, &_status);
  /* skip box _resolved; list<tuple<#Integer, tuple<array<#Integer>, tuple<NFComponentRef, NFExpression, Option<NBEquation.Iterator>>>>> */
  if (out_status) { *out_status = mmc_mk_icon(_status); }
  return _resolved;
}

PROTECTED_FUNCTION_STATIC modelica_integer omc_NBSlice_frameLocationInertia(threadData_t *threadData, modelica_metatype _frameLocation)
{
  modelica_integer _inertia;
  modelica_metatype _dim = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _inertia = ((modelica_integer) 1);
  // _dim has no default value.
  _dim = omc_Util_tuple21(threadData, _frameLocation);

  while(1)
  {
    if(!((_inertia < arrayLength(_dim)) && (mmc_unbox_integer(arrayGet(_dim,_inertia) /* DAE.ASUB */) == mmc_unbox_integer(arrayGet(_dim,((modelica_integer) 1) + _inertia) /* DAE.ASUB */)))) break;
    _inertia = ((modelica_integer) 1) + _inertia;
  }
  _return: OMC_LABEL_UNUSED
  return _inertia;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_frameLocationInertia(threadData_t *threadData, modelica_metatype _frameLocation)
{
  modelica_integer _inertia;
  modelica_metatype out_inertia;
  _inertia = omc_NBSlice_frameLocationInertia(threadData, _frameLocation);
  out_inertia = mmc_mk_icon(_inertia);
  return out_inertia;
}

DLLDirection
modelica_metatype omc_NBSlice_orderTransposedFrameLocations(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fframe_5Flocations_5Ftransposed, modelica_metatype *out_replacements, modelica_integer *out_status)
{
  modelica_metatype _frame_locations_transposed = NULL;
  modelica_metatype _replacements = NULL;
  modelica_integer _status;
  modelica_metatype _frame_inertia_lst = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _frame_locations_transposed = __omcQ_24in_5Fframe_5Flocations_5Ftransposed;
  _replacements = omc_UnorderedMap_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 1));
  // _status has no default value.
  // _frame_inertia_lst has no default value.
  {
    modelica_metatype __omcQ_24tmpVar29;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar28;
    modelica_integer tmp5;
    modelica_metatype _frame_loopVar = 0;
    modelica_metatype _frame;
    _frame_loopVar = _frame_locations_transposed;
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar29 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar29;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_frame_loopVar)) {
        _frame = MMC_CAR(_frame_loopVar);
        _frame_loopVar = MMC_CDR(_frame_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        tmpMeta4 = mmc_mk_box2(0, mmc_mk_integer(omc_NBSlice_frameLocationInertia(threadData, _frame)), _frame);
        __omcQ_24tmpVar28 = tmpMeta4;
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar28,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar29;
  }
  _frame_inertia_lst = tmpMeta1;

  _frame_inertia_lst = omc_List_sort(threadData, _frame_inertia_lst, boxvar_Util_compareTupleIntGt);

  _frame_inertia_lst = omc_NBSlice_resolveEqualInertia(threadData, _frame_inertia_lst, _replacements ,&_status);

  {
    modelica_metatype __omcQ_24tmpVar31;
    modelica_metatype* tmp7;
    modelica_metatype tmpMeta8;
    modelica_metatype __omcQ_24tmpVar30;
    modelica_integer tmp9;
    modelica_metatype _frame_inertia_loopVar = 0;
    modelica_metatype _frame_inertia;
    _frame_inertia_loopVar = _frame_inertia_lst;
    tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar31 = tmpMeta8; /* defaultValue */
    tmp7 = &__omcQ_24tmpVar31;
    while(1) {
      tmp9 = 1;
      if (!listEmpty(_frame_inertia_loopVar)) {
        _frame_inertia = MMC_CAR(_frame_inertia_loopVar);
        _frame_inertia_loopVar = MMC_CDR(_frame_inertia_loopVar);
        tmp9--;
      }
      if (tmp9 == 0) {
        __omcQ_24tmpVar30 = omc_Util_tuple22(threadData, _frame_inertia);
        *tmp7 = mmc_mk_cons(__omcQ_24tmpVar30,0);
        tmp7 = &MMC_CDR(*tmp7);
      } else if (tmp9 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp7 = mmc_mk_nil();
    tmpMeta6 = __omcQ_24tmpVar31;
  }
  _frame_locations_transposed = tmpMeta6;
  _return: OMC_LABEL_UNUSED
  if (out_replacements) { *out_replacements = _replacements; }
  if (out_status) { *out_status = _status; }
  return _frame_locations_transposed;
}
modelica_metatype boxptr_NBSlice_orderTransposedFrameLocations(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fframe_5Flocations_5Ftransposed, modelica_metatype *out_replacements, modelica_metatype *out_status)
{
  modelica_integer _status;
  modelica_metatype _frame_locations_transposed = NULL;
  _frame_locations_transposed = omc_NBSlice_orderTransposedFrameLocations(threadData, __omcQ_24in_5Fframe_5Flocations_5Ftransposed, out_replacements, &_status);
  /* skip box _frame_locations_transposed; list<tuple<array<#Integer>, tuple<NFComponentRef, NFExpression, Option<NBEquation.Iterator>>>> */
  /* skip box _replacements; UnorderedMap<NFComponentRef,NFExpression> */
  if (out_status) { *out_status = mmc_mk_icon(_status); }
  return _frame_locations_transposed;
}

DLLDirection
modelica_metatype omc_NBSlice_transposeLocations(threadData_t *threadData, modelica_metatype _locations, modelica_integer _out_size)
{
  modelica_metatype _locations_transposed = NULL;
  modelica_metatype _lT_tmp = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _lT_tmp2 = NULL;
  modelica_integer _idx;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_integer tmp7;
  modelica_integer tmp8;
  modelica_integer tmp9;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _locations_transposed has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _lT_tmp = arrayCreate(_out_size, tmpMeta1);
  _lT_tmp2 = arrayCreate(_out_size, arrayCreate(((modelica_integer) 0), mmc_mk_integer(((modelica_integer) 0))));
  // _idx has no default value.
  {
    modelica_metatype _location;
    for (tmpMeta2 = _locations; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _location = MMC_CAR(tmpMeta2);
      _idx = ((modelica_integer) 1);

      {
        modelica_metatype _i;
        for (tmpMeta3 = _location; !listEmpty(tmpMeta3); tmpMeta3=MMC_CDR(tmpMeta3))
        {
          _i = MMC_CAR(tmpMeta3);
          tmpMeta4 = mmc_mk_cons(_i, arrayGet(_lT_tmp,_idx) /* DAE.ASUB */);
          arrayUpdate(_lT_tmp,_idx,tmpMeta4);

          _idx = ((modelica_integer) 1) + _idx;
        }
      }
    }
  }

  tmp7 = ((modelica_integer) 1); tmp8 = 1; tmp9 = arrayLength(_lT_tmp);
  if(!(((tmp8 > 0) && (tmp7 > tmp9)) || ((tmp8 < 0) && (tmp7 < tmp9))))
  {
    modelica_integer _j;
    for(_j = ((modelica_integer) 1); in_range_integer(_j, tmp7, tmp9); _j += tmp8)
    {
      arrayUpdate(_lT_tmp2,_j,listArray(listReverse(arrayGet(_lT_tmp,_j) /* DAE.ASUB */)));
    }
  }

  _locations_transposed = listReverse(arrayList(_lT_tmp2));
  _return: OMC_LABEL_UNUSED
  return _locations_transposed;
}
modelica_metatype boxptr_NBSlice_transposeLocations(threadData_t *threadData, modelica_metatype _locations, modelica_metatype _out_size)
{
  modelica_integer tmp1;
  modelica_metatype _locations_transposed = NULL;
  tmp1 = mmc_unbox_integer(_out_size);
  _locations_transposed = omc_NBSlice_transposeLocations(threadData, _locations, tmp1);
  /* skip box _locations_transposed; list<array<#Integer>> */
  return _locations_transposed;
}

DLLDirection
modelica_metatype omc_NBSlice_indexToLocation(threadData_t *threadData, modelica_integer _index, modelica_metatype _sizes)
{
  modelica_metatype _vals = NULL;
  modelica_metatype tmpMeta1;
  modelica_integer _iterator;
  modelica_integer _divisor;
  modelica_integer tmp2;
  modelica_metatype tmpMeta4;
  modelica_integer tmp5;
  modelica_metatype tmpMeta6;
  modelica_integer tmp7;
  modelica_metatype tmpMeta8;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _vals = tmpMeta1;
  _iterator = _index;
  {
    modelica_integer __omcQ_24tmpVar33;
    modelica_integer __omcQ_24tmpVar32;
    modelica_integer tmp3;
    modelica_metatype _s_loopVar = 0;
    modelica_metatype _s;
    _s_loopVar = _sizes;
    __omcQ_24tmpVar33 = ((modelica_integer) 1); /* defaultValue */
    while(1) {
      tmp3 = 1;
      if (!listEmpty(_s_loopVar)) {
        _s = MMC_CAR(_s_loopVar);
        _s_loopVar = MMC_CDR(_s_loopVar);
        tmp3--;
      }
      if (tmp3 == 0) {
        __omcQ_24tmpVar32 = mmc_unbox_integer(_s);
        __omcQ_24tmpVar33 = (__omcQ_24tmpVar33) * (__omcQ_24tmpVar32);
      } else if (tmp3 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    tmp2 = __omcQ_24tmpVar33;
  }
  _divisor = tmp2;
  {
    modelica_metatype _size;
    for (tmpMeta4 = _sizes; !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
    {
      _size = MMC_CAR(tmpMeta4);
      tmp5 = mmc_unbox_integer(_size);
      if (tmp5 == 0) {MMC_THROW_INTERNAL();}
      _divisor = modelica_div_integer(_divisor,tmp5).quot;

      tmp7 = _divisor;
      if (tmp7 == 0) {MMC_THROW_INTERNAL();}
      tmpMeta6 = mmc_mk_cons(mmc_mk_integer(modelica_div_integer(_iterator,tmp7).quot), _vals);
      _vals = tmpMeta6;

      _iterator = modelica_integer_mod(_iterator, _divisor);
    }
  }
  _return: OMC_LABEL_UNUSED
  return _vals;
}
modelica_metatype boxptr_NBSlice_indexToLocation(threadData_t *threadData, modelica_metatype _index, modelica_metatype _sizes)
{
  modelica_integer tmp1;
  modelica_metatype _vals = NULL;
  modelica_metatype tmpMeta2;
  tmp1 = mmc_unbox_integer(_index);
  _vals = omc_NBSlice_indexToLocation(threadData, tmp1, _sizes);
  /* skip box _vals; list<#Integer> */
  return _vals;
}

DLLDirection
modelica_integer omc_NBSlice_locationToIndex(threadData_t *threadData, modelica_metatype _sizes, modelica_metatype _values, modelica_integer __omcQ_24in_5Findex)
{
  modelica_integer _index;
  modelica_integer _factor;
  modelica_integer _size;
  modelica_metatype _rest_sizes = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_integer tmp5;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _index = __omcQ_24in_5Findex;
  _factor = ((modelica_integer) 1);
  // _size has no default value.
  _rest_sizes = _sizes;
  {
    modelica_metatype _v;
    for (tmpMeta1 = _values; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _v = MMC_CAR(tmpMeta1);
      /* Pattern-matching assignment */
      tmpMeta2 = _rest_sizes;
      if (listEmpty(tmpMeta2)) MMC_THROW_INTERNAL();
      tmpMeta3 = MMC_CAR(tmpMeta2);
      tmpMeta4 = MMC_CDR(tmpMeta2);
      tmp5 = mmc_unbox_integer(tmpMeta3);
      _size = tmp5  /* pattern as ty=Integer */;
      _rest_sizes = tmpMeta4;

      _index = _index + (((modelica_integer) -1) + mmc_unbox_integer(_v)) * (_factor);

      _factor = (_factor) * (_size);
    }
  }
  _return: OMC_LABEL_UNUSED
  return _index;
}
modelica_metatype boxptr_NBSlice_locationToIndex(threadData_t *threadData, modelica_metatype _sizes, modelica_metatype _values, modelica_metatype __omcQ_24in_5Findex)
{
  modelica_integer tmp1;
  modelica_integer _index;
  modelica_metatype out_index;
  tmp1 = mmc_unbox_integer(__omcQ_24in_5Findex);
  _index = omc_NBSlice_locationToIndex(threadData, _sizes, _values, tmp1);
  out_index = mmc_mk_icon(_index);
  return out_index;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep(threadData_t *threadData, modelica_integer _row_size, modelica_metatype __omcQ_24in_5Fsingle_5Fdep, modelica_metatype _full_deps)
{
  modelica_metatype _single_dep = NULL;
  modelica_integer _div;
  modelica_integer _dep_size;
  modelica_real tmp1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _single_dep = __omcQ_24in_5Fsingle_5Fdep;
  // _div has no default value.
  _dep_size = listLength(_single_dep);
  if((_row_size > _dep_size))
  {
    if((modelica_integer_mod(_row_size, _dep_size) == ((modelica_integer) 0)))
    {
      tmp1 = ((modelica_real)listLength(_single_dep));
      if (tmp1 == 0) {MMC_THROW_INTERNAL();}
      _single_dep = omc_List_repeat(threadData, _single_dep, ((modelica_integer)floor((((modelica_real)_row_size)) / tmp1)));
    }
    else
    {
      tmpMeta3 = stringAppend(_OMC_LIT46,intString(_dep_size));
      tmpMeta4 = stringAppend(tmpMeta3,_OMC_LIT47);
      tmpMeta5 = stringAppend(tmpMeta4,intString(_row_size));
      tmpMeta6 = stringAppend(tmpMeta5,_OMC_LIT18);
      tmpMeta2 = mmc_mk_cons(tmpMeta6, MMC_REFSTRUCTLIT(mmc_nil));
      omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta2);

      MMC_THROW_INTERNAL();
    }
  }
  else
  {
    if((_row_size < _dep_size))
    {
      omc_Pointer_update(threadData, _full_deps, listAppend(_single_dep, omc_Pointer_access(threadData, _full_deps)));

      tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
      _single_dep = tmpMeta7;
    }
  }
  _return: OMC_LABEL_UNUSED
  return _single_dep;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep(threadData_t *threadData, modelica_metatype _row_size, modelica_metatype __omcQ_24in_5Fsingle_5Fdep, modelica_metatype _full_deps)
{
  modelica_integer tmp1;
  modelica_metatype _single_dep = NULL;
  tmp1 = mmc_unbox_integer(_row_size);
  _single_dep = omc_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep(threadData, tmp1, __omcQ_24in_5Fsingle_5Fdep, _full_deps);
  /* skip box _single_dep; list<NFComponentRef> */
  return _single_dep;
}

DLLDirection
modelica_metatype omc_NBSlice_getDependentCrefsPseudoArrayCausalized(threadData_t *threadData, modelica_metatype _row_cref, modelica_metatype _dependencies, modelica_metatype _slice)
{
  modelica_metatype _tpl_lst = NULL;
  modelica_metatype _row_cref_scal = NULL;
  modelica_integer _row_size;
  modelica_metatype _dependencies_scal = NULL;
  modelica_metatype _full_deps = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta18;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _tpl_lst has no default value.
  // _row_cref_scal has no default value.
  // _row_size has no default value.
  // _dependencies_scal has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _full_deps = omc_Pointer_create(threadData, tmpMeta1);
  _row_cref_scal = omc_NFComponentRef_scalarizeSlice(threadData, _row_cref, _slice, 1 /* true */);

  _row_size = listLength(_row_cref_scal);

  {
    modelica_metatype __omcQ_24tmpVar35;
    modelica_metatype* tmp3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar34;
    modelica_integer tmp5;
    modelica_metatype _dep_loopVar = 0;
    modelica_metatype _dep;
    _dep_loopVar = _dependencies;
    tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar35 = tmpMeta4; /* defaultValue */
    tmp3 = &__omcQ_24tmpVar35;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_dep_loopVar)) {
        _dep = MMC_CAR(_dep_loopVar);
        _dep_loopVar = MMC_CDR(_dep_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        __omcQ_24tmpVar34 = omc_NFComponentRef_scalarizeSlice(threadData, _dep, _slice, 1 /* true */);
        *tmp3 = mmc_mk_cons(__omcQ_24tmpVar34,0);
        tmp3 = &MMC_CDR(*tmp3);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp3 = mmc_mk_nil();
    tmpMeta2 = __omcQ_24tmpVar35;
  }
  _dependencies_scal = tmpMeta2;

  if((!listEmpty(_dependencies_scal)))
  {
    {
      modelica_metatype __omcQ_24tmpVar37;
      modelica_metatype* tmp7;
      modelica_metatype tmpMeta8;
      modelica_metatype __omcQ_24tmpVar36;
      modelica_integer tmp9;
      modelica_metatype _d_loopVar = 0;
      modelica_metatype _d;
      _d_loopVar = _dependencies_scal;
      tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
      __omcQ_24tmpVar37 = tmpMeta8; /* defaultValue */
      tmp7 = &__omcQ_24tmpVar37;
      while(1) {
        tmp9 = 1;
        if (!listEmpty(_d_loopVar)) {
          _d = MMC_CAR(_d_loopVar);
          _d_loopVar = MMC_CDR(_d_loopVar);
          tmp9--;
        }
        if (tmp9 == 0) {
          __omcQ_24tmpVar36 = omc_NBSlice_getDependentCrefsPseudoArrayCausalized_fixSingleDep(threadData, _row_size, _d, _full_deps);
          *tmp7 = mmc_mk_cons(__omcQ_24tmpVar36,0);
          tmp7 = &MMC_CDR(*tmp7);
        } else if (tmp9 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      *tmp7 = mmc_mk_nil();
      tmpMeta6 = __omcQ_24tmpVar37;
    }
    _dependencies_scal = tmpMeta6;

    {
      modelica_metatype __omcQ_24tmpVar39;
      modelica_metatype* tmp11;
      modelica_metatype tmpMeta12;
      modelica_metatype __omcQ_24tmpVar38;
      modelica_integer tmp13;
      modelica_metatype _d_loopVar = 0;
      modelica_metatype _d;
      _d_loopVar = _dependencies_scal;
      tmpMeta12 = MMC_REFSTRUCTLIT(mmc_nil);
      __omcQ_24tmpVar39 = tmpMeta12; /* defaultValue */
      tmp11 = &__omcQ_24tmpVar39;
      while(1) {
        tmp13 = 1;
        while (!listEmpty(_d_loopVar)) {
          _d = MMC_CAR(_d_loopVar);
          _d_loopVar = MMC_CDR(_d_loopVar);
          if ((!listEmpty(_d))) {
            tmp13--;
            break;
          }
        }
        if (tmp13 == 0) {
          __omcQ_24tmpVar38 = _d;
          *tmp11 = mmc_mk_cons(__omcQ_24tmpVar38,0);
          tmp11 = &MMC_CDR(*tmp11);
        } else if (tmp13 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      *tmp11 = mmc_mk_nil();
      tmpMeta10 = __omcQ_24tmpVar39;
    }
    _dependencies_scal = tmpMeta10;

    if(listEmpty(_dependencies_scal))
    {
      _dependencies_scal = omc_List_fill(threadData, omc_Pointer_access(threadData, _full_deps), _row_size);
    }
    else
    {
      {
        modelica_metatype __omcQ_24tmpVar41;
        modelica_metatype* tmp15;
        modelica_metatype tmpMeta16;
        modelica_metatype __omcQ_24tmpVar40;
        modelica_integer tmp17;
        modelica_metatype _d_loopVar = 0;
        modelica_metatype _d;
        _d_loopVar = omc_List_transposeList(threadData, _dependencies_scal);
        tmpMeta16 = MMC_REFSTRUCTLIT(mmc_nil);
        __omcQ_24tmpVar41 = tmpMeta16; /* defaultValue */
        tmp15 = &__omcQ_24tmpVar41;
        while(1) {
          tmp17 = 1;
          if (!listEmpty(_d_loopVar)) {
            _d = MMC_CAR(_d_loopVar);
            _d_loopVar = MMC_CDR(_d_loopVar);
            tmp17--;
          }
          if (tmp17 == 0) {
            __omcQ_24tmpVar40 = listAppend(omc_Pointer_access(threadData, _full_deps), _d);
            *tmp15 = mmc_mk_cons(__omcQ_24tmpVar40,0);
            tmp15 = &MMC_CDR(*tmp15);
          } else if (tmp17 == 1) {
            break;
          } else {
            MMC_THROW_INTERNAL();
          }
        }
        *tmp15 = mmc_mk_nil();
        tmpMeta14 = __omcQ_24tmpVar41;
      }
      _dependencies_scal = tmpMeta14;
    }

    _tpl_lst = omc_List_zip(threadData, _row_cref_scal, _dependencies_scal);
  }
  else
  {
    {
      modelica_metatype __omcQ_24tmpVar43;
      modelica_metatype* tmp19;
      modelica_metatype tmpMeta20;
      modelica_metatype tmpMeta21;
      modelica_metatype tmpMeta22;
      modelica_metatype __omcQ_24tmpVar42;
      modelica_integer tmp23;
      modelica_metatype _cref_loopVar = 0;
      modelica_metatype _cref;
      _cref_loopVar = _row_cref_scal;
      tmpMeta20 = MMC_REFSTRUCTLIT(mmc_nil);
      __omcQ_24tmpVar43 = tmpMeta20; /* defaultValue */
      tmp19 = &__omcQ_24tmpVar43;
      while(1) {
        tmp23 = 1;
        if (!listEmpty(_cref_loopVar)) {
          _cref = MMC_CAR(_cref_loopVar);
          _cref_loopVar = MMC_CDR(_cref_loopVar);
          tmp23--;
        }
        if (tmp23 == 0) {
          tmpMeta21 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta22 = mmc_mk_box2(0, _cref, tmpMeta21);
          __omcQ_24tmpVar42 = tmpMeta22;
          *tmp19 = mmc_mk_cons(__omcQ_24tmpVar42,0);
          tmp19 = &MMC_CDR(*tmp19);
        } else if (tmp23 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      *tmp19 = mmc_mk_nil();
      tmpMeta18 = __omcQ_24tmpVar43;
    }
    _tpl_lst = tmpMeta18;
  }
  _return: OMC_LABEL_UNUSED
  return _tpl_lst;
}

DLLDirection
modelica_integer omc_NBSlice_updateDependenciesInteger(threadData_t *threadData, modelica_integer __omcQ_24in_5Feqn_5Fidx, modelica_integer _var_idx, modelica_integer _mode, modelica_metatype _mode_to_var, modelica_metatype _indices)
{
  modelica_integer _eqn_idx;
  modelica_metatype _mode_to_var_row = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eqn_idx = __omcQ_24in_5Feqn_5Fidx;
  // _mode_to_var_row has no default value.
  _mode_to_var_row = arrayGet(_mode_to_var,_eqn_idx) /* DAE.ASUB */;

  arrayUpdate(_mode_to_var_row, _mode, mmc_mk_integer(_var_idx));

  tmpMeta1 = mmc_mk_cons(mmc_mk_integer(_var_idx), arrayGet(_indices,_eqn_idx) /* DAE.ASUB */);
  arrayUpdate(_indices, _eqn_idx, tmpMeta1);

  _eqn_idx = ((modelica_integer) 1) + _eqn_idx;
  _return: OMC_LABEL_UNUSED
  return _eqn_idx;
}
modelica_metatype boxptr_NBSlice_updateDependenciesInteger(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feqn_5Fidx, modelica_metatype _var_idx, modelica_metatype _mode, modelica_metatype _mode_to_var, modelica_metatype _indices)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_integer tmp3;
  modelica_integer _eqn_idx;
  modelica_metatype out_eqn_idx;
  tmp1 = mmc_unbox_integer(__omcQ_24in_5Feqn_5Fidx);
  tmp2 = mmc_unbox_integer(_var_idx);
  tmp3 = mmc_unbox_integer(_mode);
  _eqn_idx = omc_NBSlice_updateDependenciesInteger(threadData, tmp1, tmp2, tmp3, _mode_to_var, _indices);
  out_eqn_idx = mmc_mk_icon(_eqn_idx);
  return out_eqn_idx;
}

DLLDirection
modelica_integer omc_NBSlice_updateDependenciesCref(threadData_t *threadData, modelica_integer __omcQ_24in_5Feqn_5Fidx, modelica_integer _var_idx, modelica_metatype _accum_dep_arr, modelica_metatype _vars, modelica_metatype _mapping)
{
  modelica_integer _eqn_idx;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eqn_idx = __omcQ_24in_5Feqn_5Fidx;
  tmpMeta1 = mmc_mk_cons(omc_NBVariable_VariablePointers_varSlice(threadData, _vars, _var_idx, _mapping), arrayGet(_accum_dep_arr,_eqn_idx) /* DAE.ASUB */);
  arrayUpdate(_accum_dep_arr, _eqn_idx, tmpMeta1);

  _eqn_idx = ((modelica_integer) 1) + _eqn_idx;
  _return: OMC_LABEL_UNUSED
  return _eqn_idx;
}
modelica_metatype boxptr_NBSlice_updateDependenciesCref(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feqn_5Fidx, modelica_metatype _var_idx, modelica_metatype _accum_dep_arr, modelica_metatype _vars, modelica_metatype _mapping)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_integer _eqn_idx;
  modelica_metatype out_eqn_idx;
  tmp1 = mmc_unbox_integer(__omcQ_24in_5Feqn_5Fidx);
  tmp2 = mmc_unbox_integer(_var_idx);
  _eqn_idx = omc_NBSlice_updateDependenciesCref(threadData, tmp1, tmp2, _accum_dep_arr, _vars, _mapping);
  out_eqn_idx = mmc_mk_icon(_eqn_idx);
  return out_eqn_idx;
}

DLLDirection
void omc_NBSlice_fillDependencyArray(threadData_t *threadData, modelica_metatype _dep, modelica_integer _body_size, modelica_metatype _frames, modelica_metatype _mapping, modelica_metatype _map, modelica_fnptr _func)
{
  modelica_metatype _scal_cref = NULL;
  modelica_integer _scal_length;
  modelica_integer _body_repeat;
  modelica_integer _element_repeat;
  modelica_integer _eqn_idx;
  modelica_metatype _scal_lst = NULL;
  modelica_metatype _scal_tpl_lst = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_real tmp6;
  modelica_real tmp7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_metatype tmpMeta21;
  modelica_integer tmp22;
  modelica_integer tmp23;
  modelica_integer tmp24;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _scal_cref has no default value.
  // _scal_length has no default value.
  // _body_repeat has no default value.
  // _element_repeat has no default value.
  // _eqn_idx has no default value.
  // _scal_lst has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _scal_tpl_lst = tmpMeta1;
  {
    modelica_metatype _scal_cref;
    for (tmpMeta2 = omc_NFComponentRef_scalarizeAll(threadData, _dep, 1 /* true */); !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _scal_cref = MMC_CAR(tmpMeta2);
      _scal_lst = omc_NBSlice_getCrefInFrameIndices(threadData, _scal_cref, _frames, _mapping, _map);

      tmpMeta4 = mmc_mk_box2(0, _scal_cref, _scal_lst);
      tmpMeta3 = mmc_mk_cons(tmpMeta4, _scal_tpl_lst);
      _scal_tpl_lst = tmpMeta3;
    }
  }

  _scal_length = listLength(_scal_tpl_lst);

  if((modelica_integer_mod(_scal_length, _body_size) == ((modelica_integer) 0)))
  {
    tmp6 = ((modelica_real)_body_size);
    if (tmp6 == 0) {MMC_THROW_INTERNAL();}
    _body_repeat = ((modelica_integer)floor((((modelica_real)_scal_length)) / tmp6));

    _element_repeat = ((modelica_integer) 1);
  }
  else
  {
    if((modelica_integer_mod(_body_size, _scal_length) == ((modelica_integer) 0)))
    {
      _body_repeat = ((modelica_integer) 1);

      tmp7 = ((modelica_real)_scal_length);
      if (tmp7 == 0) {MMC_THROW_INTERNAL();}
      _element_repeat = ((modelica_integer)floor((((modelica_real)_body_size)) / tmp7));
    }
    else
    {
      tmpMeta9 = stringAppend(_OMC_LIT48,intString(_scal_length));
      tmpMeta10 = stringAppend(tmpMeta9,_OMC_LIT49);
      tmpMeta11 = stringAppend(tmpMeta10,omc_NFComponentRef_toString(threadData, _dep));
      tmpMeta12 = stringAppend(tmpMeta11,_OMC_LIT50);
      tmpMeta13 = stringAppend(tmpMeta12,intString(_body_size));
      tmpMeta14 = stringAppend(tmpMeta13,_OMC_LIT51);
      tmpMeta8 = mmc_mk_cons(tmpMeta14, MMC_REFSTRUCTLIT(mmc_nil));
      omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta8);

      MMC_THROW_INTERNAL();
    }
  }

  _eqn_idx = ((modelica_integer) 1);

  tmp22 = ((modelica_integer) 1); tmp23 = 1; tmp24 = _element_repeat;
  if(!(((tmp23 > 0) && (tmp22 > tmp24)) || ((tmp23 < 0) && (tmp22 < tmp24))))
  {
    modelica_integer _i;
    for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp22, tmp24); _i += tmp23)
    {
      {
        modelica_metatype _tpl;
        for (tmpMeta15 = listReverse(_scal_tpl_lst); !listEmpty(tmpMeta15); tmpMeta15=MMC_CDR(tmpMeta15))
        {
          _tpl = MMC_CAR(tmpMeta15);
          /* Pattern-matching assignment */
          tmpMeta16 = _tpl;
          tmpMeta17 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta16), 1));
          tmpMeta18 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta16), 2));
          _scal_cref = tmpMeta17;
          _scal_lst = tmpMeta18;

          _scal_lst = listReverse(_scal_lst);

          if((_body_repeat > ((modelica_integer) 1)))
          {
            _eqn_idx = ((modelica_integer) 1);
          }

          {
            modelica_metatype _var_idx;
            for (tmpMeta19 = _scal_lst; !listEmpty(tmpMeta19); tmpMeta19=MMC_CDR(tmpMeta19))
            {
              _var_idx = MMC_CAR(tmpMeta19);
              _eqn_idx = mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), mmc_mk_integer(_eqn_idx), _var_idx) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, mmc_mk_integer(_eqn_idx), _var_idx));
            }
          }
        }
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  return;
}
void boxptr_NBSlice_fillDependencyArray(threadData_t *threadData, modelica_metatype _dep, modelica_metatype _body_size, modelica_metatype _frames, modelica_metatype _mapping, modelica_metatype _map, modelica_fnptr _func)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_body_size);
  omc_NBSlice_fillDependencyArray(threadData, _dep, tmp1, _frames, _mapping, _map, _func);
  return;
}

static modelica_metatype closure3_NBSlice_updateDependenciesCref(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_eqn_idx, modelica_metatype var_idx)
{
  modelica_metatype accum_dep_arr = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype vars = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype mapping = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  return boxptr_NBSlice_updateDependenciesCref(thData, $in_eqn_idx, var_idx, accum_dep_arr, vars, mapping);
}static modelica_metatype closure4_NBSlice_updateDependenciesCref(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_eqn_idx, modelica_metatype var_idx)
{
  modelica_metatype accum_dep_arr = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype vars = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype mapping = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  return boxptr_NBSlice_updateDependenciesCref(thData, $in_eqn_idx, var_idx, accum_dep_arr, vars, mapping);
}
DLLDirection
modelica_metatype omc_NBSlice_getDependentCrefsPseudoForCausalized(threadData_t *threadData, modelica_metatype _row_cref, modelica_metatype _dependencies, modelica_metatype _var_rep, modelica_metatype _eqn_rep, modelica_metatype _var_rep_mapping, modelica_metatype _eqn_rep_mapping, modelica_metatype _iter, modelica_integer _eqn_size, modelica_metatype _slice, modelica_boolean _implicit)
{
  modelica_metatype _tpl_lst = NULL;
  modelica_metatype _names = NULL;
  modelica_metatype _ranges = NULL;
  modelica_metatype _maps = NULL;
  modelica_metatype _frames = NULL;
  modelica_integer _iter_size;
  modelica_integer _body_size;
  modelica_metatype _row_crefs = NULL;
  modelica_metatype _row_scal_lst = NULL;
  modelica_metatype _accum_row_lst = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _accum_dep_arr = NULL;
  modelica_metatype _accum_dep_lst = NULL;
  modelica_fnptr _func_var;
  modelica_fnptr _func_eqn;
  modelica_metatype tmpMeta2;
  modelica_real tmp3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _tpl_lst has no default value.
  // _names has no default value.
  // _ranges has no default value.
  // _maps has no default value.
  // _frames has no default value.
  // _iter_size has no default value.
  // _body_size has no default value.
  // _row_crefs has no default value.
  // _row_scal_lst has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _accum_row_lst = tmpMeta1;
  // _accum_dep_arr has no default value.
  // _accum_dep_lst has no default value.
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _accum_dep_arr = arrayCreate(_eqn_size, tmpMeta2);

  _iter_size = omc_NBEquation_Iterator_size(threadData, _iter, 0 /* false */);

  _names = omc_NBEquation_Iterator_getFrames(threadData, _iter ,&_ranges ,&_maps);

  _frames = omc_List_zip3(threadData, _names, _ranges, _maps);

  if((modelica_integer_mod(_eqn_size, _iter_size) == ((modelica_integer) 0)))
  {
    tmp3 = ((modelica_real)_iter_size);
    if (tmp3 == 0) {MMC_THROW_INTERNAL();}
    _body_size = ((modelica_integer)floor((((modelica_real)_eqn_size)) / tmp3));
  }
  else
  {
    tmpMeta5 = stringAppend(_OMC_LIT52,intString(_eqn_size));
    tmpMeta6 = stringAppend(tmpMeta5,_OMC_LIT53);
    tmpMeta7 = stringAppend(tmpMeta6,intString(_iter_size));
    tmpMeta8 = stringAppend(tmpMeta7,_OMC_LIT51);
    tmpMeta4 = mmc_mk_cons(tmpMeta8, MMC_REFSTRUCTLIT(mmc_nil));
    omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta4);
  }

  if(_implicit)
  {
    _row_crefs = omc_NFComponentRef_scalarizeSlice(threadData, _row_cref, _slice, 1 /* true */);
  }
  else
  {
    {
      modelica_metatype _cref;
      for (tmpMeta9 = omc_NFComponentRef_scalarizeAll(threadData, _row_cref, 1 /* true */); !listEmpty(tmpMeta9); tmpMeta9=MMC_CDR(tmpMeta9))
      {
        _cref = MMC_CAR(tmpMeta9);
        _row_scal_lst = omc_NBSlice_getCrefInFrameIndices(threadData, _cref, _frames, _eqn_rep_mapping, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqn_rep), 2))));

        tmpMeta10 = mmc_mk_cons(_row_scal_lst, _accum_row_lst);
        _accum_row_lst = tmpMeta10;
      }
    }

    _row_scal_lst = omc_List_flatten(threadData, _accum_row_lst);

    _row_scal_lst = (listEmpty(_slice)?_row_scal_lst:omc_List_getAtIndexLst(threadData, _row_scal_lst, _slice, 1 /* true */));

    {
      modelica_metatype __omcQ_24tmpVar45;
      modelica_metatype* tmp13;
      modelica_metatype tmpMeta14;
      modelica_metatype __omcQ_24tmpVar44;
      modelica_integer tmp15;
      modelica_metatype _i_loopVar = 0;
      modelica_metatype _i;
      _i_loopVar = _row_scal_lst;
      tmpMeta14 = MMC_REFSTRUCTLIT(mmc_nil);
      __omcQ_24tmpVar45 = tmpMeta14; /* defaultValue */
      tmp13 = &__omcQ_24tmpVar45;
      while(1) {
        tmp15 = 1;
        if (!listEmpty(_i_loopVar)) {
          _i = MMC_CAR(_i_loopVar);
          _i_loopVar = MMC_CDR(_i_loopVar);
          tmp15--;
        }
        if (tmp15 == 0) {
          __omcQ_24tmpVar44 = omc_NBVariable_VariablePointers_varSlice(threadData, _eqn_rep, mmc_unbox_integer(_i), _eqn_rep_mapping);
          *tmp13 = mmc_mk_cons(__omcQ_24tmpVar44,0);
          tmp13 = &MMC_CDR(*tmp13);
        } else if (tmp15 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      *tmp13 = mmc_mk_nil();
      tmpMeta12 = __omcQ_24tmpVar45;
    }
    _row_crefs = tmpMeta12;
  }

  tmpMeta16 = mmc_mk_box3(0, _accum_dep_arr, _var_rep, _var_rep_mapping);
  _func_var = (modelica_fnptr) (modelica_fnptr) mmc_mk_box2(0,closure3_NBSlice_updateDependenciesCref,tmpMeta16);

  tmpMeta17 = mmc_mk_box3(0, _accum_dep_arr, _eqn_rep, _eqn_rep_mapping);
  _func_eqn = (modelica_fnptr) (modelica_fnptr) mmc_mk_box2(0,closure4_NBSlice_updateDependenciesCref,tmpMeta17);

  {
    modelica_metatype _dep;
    for (tmpMeta18 = _dependencies; !listEmpty(tmpMeta18); tmpMeta18=MMC_CDR(tmpMeta18))
    {
      _dep = MMC_CAR(tmpMeta18);
      if(omc_UnorderedMap_contains(threadData, _dep, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var_rep), 2)))))
      {
        omc_NBSlice_fillDependencyArray(threadData, _dep, _body_size, _frames, _var_rep_mapping, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var_rep), 2))), ((modelica_fnptr) _func_var));
      }
      else
      {
        if(omc_UnorderedMap_contains(threadData, _dep, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqn_rep), 2)))))
        {
          omc_NBSlice_fillDependencyArray(threadData, _dep, _body_size, _frames, _eqn_rep_mapping, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqn_rep), 2))), ((modelica_fnptr) _func_eqn));
        }
      }
    }
  }

  _accum_dep_lst = listReverse(arrayList(_accum_dep_arr));

  _accum_dep_lst = (listEmpty(_slice)?_accum_dep_lst:omc_List_getAtIndexLst(threadData, _accum_dep_lst, _slice, 1 /* true */));

  _tpl_lst = omc_List_zip(threadData, _row_crefs, _accum_dep_lst);
  _return: OMC_LABEL_UNUSED
  return _tpl_lst;
}
modelica_metatype boxptr_NBSlice_getDependentCrefsPseudoForCausalized(threadData_t *threadData, modelica_metatype _row_cref, modelica_metatype _dependencies, modelica_metatype _var_rep, modelica_metatype _eqn_rep, modelica_metatype _var_rep_mapping, modelica_metatype _eqn_rep_mapping, modelica_metatype _iter, modelica_metatype _eqn_size, modelica_metatype _slice, modelica_metatype _implicit)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_metatype _tpl_lst = NULL;
  tmp1 = mmc_unbox_integer(_eqn_size);
  tmp2 = mmc_unbox_integer(_implicit);
  _tpl_lst = omc_NBSlice_getDependentCrefsPseudoForCausalized(threadData, _row_cref, _dependencies, _var_rep, _eqn_rep, _var_rep_mapping, _eqn_rep_mapping, _iter, tmp1, _slice, tmp2);
  /* skip box _tpl_lst; list<tuple<NFComponentRef, list<NFComponentRef>>> */
  return _tpl_lst;
}

static modelica_metatype closure5_NBSlice_updateDependenciesInteger(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_eqn_idx, modelica_metatype var_idx)
{
  modelica_metatype mode = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype mode_to_var = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype indices = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  return boxptr_NBSlice_updateDependenciesInteger(thData, $in_eqn_idx, var_idx, mode, mode_to_var, indices);
}
DLLDirection
modelica_metatype omc_NBSlice_getDependentCrefIndicesPseudoFor(threadData_t *threadData, modelica_metatype _dependencies, modelica_metatype _map, modelica_metatype _mapping, modelica_integer _eqn_arr_idx, modelica_metatype _iter, modelica_metatype *out_mode_to_var)
{
  modelica_metatype _indices = NULL;
  modelica_metatype _mode_to_var = NULL;
  modelica_metatype _names = NULL;
  modelica_metatype _ranges = NULL;
  modelica_metatype _maps = NULL;
  modelica_metatype _frames = NULL;
  modelica_integer _eqn_size;
  modelica_integer _iter_size;
  modelica_integer _body_size;
  modelica_integer _mode;
  modelica_fnptr _func;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_integer tmp3;
  modelica_metatype tmpMeta4;
  modelica_real tmp5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_integer tmp11;
  modelica_integer tmp12;
  modelica_integer tmp13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_integer tmp17;
  modelica_integer tmp18;
  modelica_integer tmp19;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _indices has no default value.
  // _mode_to_var has no default value.
  // _names has no default value.
  // _ranges has no default value.
  // _maps has no default value.
  // _frames has no default value.
  // _eqn_size has no default value.
  // _iter_size has no default value.
  // _body_size has no default value.
  _mode = ((modelica_integer) 1);
  _iter_size = omc_NBEquation_Iterator_size(threadData, _iter, 0 /* false */);

  _names = omc_NBEquation_Iterator_getFrames(threadData, _iter ,&_ranges ,&_maps);

  _frames = omc_List_zip3(threadData, _names, _ranges, _maps);

  /* Pattern-matching assignment */
  tmpMeta1 = arrayGet((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mapping), 4))),_eqn_arr_idx) /* DAE.ASUB */;
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmp3 = mmc_unbox_integer(tmpMeta2);
  _eqn_size = tmp3  /* pattern as ty=Integer */;

  tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
  _indices = arrayCreate(_eqn_size, tmpMeta4);

  _mode_to_var = arrayCreate(_eqn_size, arrayCreate(((modelica_integer) 0), mmc_mk_integer(((modelica_integer) 0))));

  if((modelica_integer_mod(_eqn_size, _iter_size) == ((modelica_integer) 0)))
  {
    tmp5 = ((modelica_real)_iter_size);
    if (tmp5 == 0) {MMC_THROW_INTERNAL();}
    _body_size = ((modelica_integer)floor((((modelica_real)_eqn_size)) / tmp5));
  }
  else
  {
    tmpMeta7 = stringAppend(_OMC_LIT54,intString(_eqn_size));
    tmpMeta8 = stringAppend(tmpMeta7,_OMC_LIT53);
    tmpMeta9 = stringAppend(tmpMeta8,intString(_iter_size));
    tmpMeta10 = stringAppend(tmpMeta9,_OMC_LIT51);
    tmpMeta6 = mmc_mk_cons(tmpMeta10, MMC_REFSTRUCTLIT(mmc_nil));
    omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta6);
  }

  tmp11 = ((modelica_integer) 1); tmp12 = 1; tmp13 = _eqn_size;
  if(!(((tmp12 > 0) && (tmp11 > tmp13)) || ((tmp12 < 0) && (tmp11 < tmp13))))
  {
    modelica_integer _i;
    for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp11, tmp13); _i += tmp12)
    {
      arrayUpdate(_mode_to_var,_i,arrayCreate(listLength(_dependencies), mmc_mk_integer(((modelica_integer) -1))));
    }
  }

  {
    modelica_metatype _dep;
    for (tmpMeta14 = _dependencies; !listEmpty(tmpMeta14); tmpMeta14=MMC_CDR(tmpMeta14))
    {
      _dep = MMC_CAR(tmpMeta14);
      tmpMeta15 = mmc_mk_box3(0, mmc_mk_integer(_mode), _mode_to_var, _indices);
      _func = (modelica_fnptr) (modelica_fnptr) mmc_mk_box2(0,closure5_NBSlice_updateDependenciesInteger,tmpMeta15);

      omc_NBSlice_fillDependencyArray(threadData, _dep, _body_size, _frames, _mapping, _map, ((modelica_fnptr) _func));

      _mode = ((modelica_integer) 1) + _mode;
    }
  }

  tmp17 = ((modelica_integer) 1); tmp18 = 1; tmp19 = arrayLength(_indices);
  if(!(((tmp18 > 0) && (tmp17 > tmp19)) || ((tmp18 < 0) && (tmp17 < tmp19))))
  {
    modelica_integer _i;
    for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp17, tmp19); _i += tmp18)
    {
      arrayUpdate(_indices,_i,omc_List_sort(threadData, omc_UnorderedSet_unique__list(threadData, arrayGet(_indices,_i) /* DAE.ASUB */, boxvar_Util_id, boxvar_intEq), boxvar_intLt));
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_mode_to_var) { *out_mode_to_var = _mode_to_var; }
  return _indices;
}
modelica_metatype boxptr_NBSlice_getDependentCrefIndicesPseudoFor(threadData_t *threadData, modelica_metatype _dependencies, modelica_metatype _map, modelica_metatype _mapping, modelica_metatype _eqn_arr_idx, modelica_metatype _iter, modelica_metatype *out_mode_to_var)
{
  modelica_integer tmp1;
  modelica_metatype _indices = NULL;
  tmp1 = mmc_unbox_integer(_eqn_arr_idx);
  _indices = omc_NBSlice_getDependentCrefIndicesPseudoFor(threadData, _dependencies, _map, _mapping, tmp1, _iter, out_mode_to_var);
  /* skip box _indices; array<list<#Integer>> */
  /* skip box _mode_to_var; array<array<#Integer>> */
  return _indices;
}

DLLDirection
modelica_metatype omc_NBSlice_getDependentCrefIndicesPseudoFull(threadData_t *threadData, modelica_metatype _dependencies, modelica_metatype _map, modelica_metatype _mapping, modelica_integer _eqn_arr_idx, modelica_metatype *out_mode_to_var)
{
  modelica_metatype _indices = NULL;
  modelica_metatype _mode_to_var = NULL;
  modelica_metatype _scalarized_dependencies = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _stripped = NULL;
  modelica_integer _eqn_start;
  modelica_integer _eqn_size;
  modelica_integer _var_arr_idx;
  modelica_integer _var_scal_idx;
  modelica_integer _mode;
  modelica_metatype _scal_lst = NULL;
  modelica_integer _idx;
  modelica_metatype _mode_to_var_row = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype _dims = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_integer tmp7;
  modelica_metatype tmpMeta8;
  modelica_integer tmp9;
  modelica_metatype tmpMeta10;
  modelica_integer tmp11;
  modelica_integer tmp12;
  modelica_integer tmp13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_real tmp21;
  modelica_metatype tmpMeta22;
  modelica_metatype tmpMeta23;
  modelica_metatype tmpMeta24;
  modelica_metatype tmpMeta25;
  modelica_integer tmp26;
  modelica_integer tmp27;
  modelica_integer tmp28;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _indices has no default value.
  // _mode_to_var has no default value.
  {
    modelica_metatype __omcQ_24tmpVar47;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype __omcQ_24tmpVar46;
    modelica_integer tmp4;
    modelica_metatype _dep_loopVar = 0;
    modelica_metatype _dep;
    _dep_loopVar = _dependencies;
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar47 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar47;
    while(1) {
      tmp4 = 1;
      if (!listEmpty(_dep_loopVar)) {
        _dep = MMC_CAR(_dep_loopVar);
        _dep_loopVar = MMC_CDR(_dep_loopVar);
        tmp4--;
      }
      if (tmp4 == 0) {
        __omcQ_24tmpVar46 = omc_NFComponentRef_scalarizeAll(threadData, _dep, 1 /* true */);
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar46,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp4 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar47;
  }
  _scalarized_dependencies = omc_List_flatten(threadData, tmpMeta1);
  // _stripped has no default value.
  // _eqn_start has no default value.
  // _eqn_size has no default value.
  // _var_arr_idx has no default value.
  // _var_scal_idx has no default value.
  _mode = ((modelica_integer) 1);
  // _scal_lst has no default value.
  // _idx has no default value.
  // _mode_to_var_row has no default value.
  // _subs has no default value.
  // _dims has no default value.
  // _ty has no default value.
  /* Pattern-matching assignment */
  tmpMeta5 = arrayGet((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mapping), 4))),_eqn_arr_idx) /* DAE.ASUB */;
  tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 1));
  tmp7 = mmc_unbox_integer(tmpMeta6);
  tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 2));
  tmp9 = mmc_unbox_integer(tmpMeta8);
  _eqn_start = tmp7  /* pattern as ty=Integer */;
  _eqn_size = tmp9  /* pattern as ty=Integer */;

  tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
  _indices = arrayCreate(_eqn_size, tmpMeta10);

  _mode_to_var = arrayCreate(_eqn_size, arrayCreate(((modelica_integer) 0), mmc_mk_integer(((modelica_integer) 0))));

  tmp11 = ((modelica_integer) 1); tmp12 = 1; tmp13 = _eqn_size;
  if(!(((tmp12 > 0) && (tmp11 > tmp13)) || ((tmp12 < 0) && (tmp11 < tmp13))))
  {
    modelica_integer _i;
    for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp11, tmp13); _i += tmp12)
    {
      arrayUpdate(_mode_to_var,_i,arrayCreate(listLength(_scalarized_dependencies), mmc_mk_integer(((modelica_integer) -1))));
    }
  }

  {
    modelica_metatype _cref;
    for (tmpMeta14 = _scalarized_dependencies; !listEmpty(tmpMeta14); tmpMeta14=MMC_CDR(tmpMeta14))
    {
      _cref = MMC_CAR(tmpMeta14);
      _stripped = omc_NFComponentRef_stripSubscriptsAll(threadData, _cref);

      _var_arr_idx = mmc_unbox_integer(omc_UnorderedMap_getSafe(threadData, _stripped, _map, _OMC_LIT55));

      _subs = omc_NFComponentRef_subscriptsAllWithWholeFlat(threadData, _cref);

      _ty = omc_NFComponentRef_getSubscriptedType(threadData, _stripped, 1 /* true */);

      _dims = omc_NFType_arrayDims(threadData, _ty);

      _scal_lst = omc_NBAdjacency_Mapping_getVarScalIndices(threadData, _var_arr_idx, _mapping, _subs, _dims, 1 /* true */);

      if((modelica_integer_mod(_eqn_size, listLength(_scal_lst)) != ((modelica_integer) 0)))
      {
        tmpMeta16 = stringAppend(_OMC_LIT56,intString(listLength(_scal_lst)));
        tmpMeta17 = stringAppend(tmpMeta16,_OMC_LIT57);
        tmpMeta18 = stringAppend(tmpMeta17,intString(_eqn_size));
        tmpMeta19 = stringAppend(tmpMeta18,_OMC_LIT58);
        tmpMeta20 = stringAppend(tmpMeta19,omc_List_toString(threadData, _scal_lst, boxvar_intString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, ((modelica_integer) 0)));
        tmpMeta15 = mmc_mk_cons(tmpMeta20, MMC_REFSTRUCTLIT(mmc_nil));
        omc_Error_addMessage(threadData, _OMC_LIT4, tmpMeta15);

        MMC_THROW_INTERNAL();
      }
      else
      {
        tmp21 = ((modelica_real)listLength(_scal_lst));
        if (tmp21 == 0) {MMC_THROW_INTERNAL();}
        _scal_lst = omc_List_repeat(threadData, _scal_lst, ((modelica_integer)floor((((modelica_real)_eqn_size)) / tmp21)));
      }

      _idx = ((modelica_integer) 1);

      {
        modelica_metatype _var_scal_idx;
        for (tmpMeta22 = listReverse(_scal_lst); !listEmpty(tmpMeta22); tmpMeta22=MMC_CDR(tmpMeta22))
        {
          _var_scal_idx = MMC_CAR(tmpMeta22);
          _mode_to_var_row = arrayGet(_mode_to_var,_idx) /* DAE.ASUB */;

          arrayUpdate(_mode_to_var_row, _mode, _var_scal_idx);

          arrayUpdate(_mode_to_var, _idx, _mode_to_var_row);

          tmpMeta23 = mmc_mk_cons(_var_scal_idx, arrayGet(_indices,_idx) /* DAE.ASUB */);
          arrayUpdate(_indices,_idx,tmpMeta23);

          _idx = ((modelica_integer) 1) + _idx;
        }
      }

      _mode = ((modelica_integer) 1) + _mode;
    }
  }

  tmp26 = ((modelica_integer) 1); tmp27 = 1; tmp28 = arrayLength(_indices);
  if(!(((tmp27 > 0) && (tmp26 > tmp28)) || ((tmp27 < 0) && (tmp26 < tmp28))))
  {
    modelica_integer _i;
    for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp26, tmp28); _i += tmp27)
    {
      arrayUpdate(_indices,_i,omc_List_sort(threadData, omc_UnorderedSet_unique__list(threadData, arrayGet(_indices,_i) /* DAE.ASUB */, boxvar_Util_id, boxvar_intEq), boxvar_intLt));
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_mode_to_var) { *out_mode_to_var = _mode_to_var; }
  return _indices;
}
modelica_metatype boxptr_NBSlice_getDependentCrefIndicesPseudoFull(threadData_t *threadData, modelica_metatype _dependencies, modelica_metatype _map, modelica_metatype _mapping, modelica_metatype _eqn_arr_idx, modelica_metatype *out_mode_to_var)
{
  modelica_integer tmp1;
  modelica_metatype _indices = NULL;
  tmp1 = mmc_unbox_integer(_eqn_arr_idx);
  _indices = omc_NBSlice_getDependentCrefIndicesPseudoFull(threadData, _dependencies, _map, _mapping, tmp1, out_mode_to_var);
  /* skip box _indices; array<list<#Integer>> */
  /* skip box _mode_to_var; array<array<#Integer>> */
  return _indices;
}

DLLDirection
modelica_metatype omc_NBSlice_getDependentCrefIndicesPseudoScalar(threadData_t *threadData, modelica_metatype _dependencies, modelica_metatype _map, modelica_metatype _mapping)
{
  modelica_metatype _indices = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _scalarized_dependencies = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _stripped = NULL;
  modelica_integer _var_arr_idx;
  modelica_integer _var_start;
  modelica_integer _var_scal_idx;
  modelica_metatype _sizes = NULL;
  modelica_metatype _int_subs = NULL;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_integer tmp9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_integer tmp13;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _indices = tmpMeta1;
  {
    modelica_metatype __omcQ_24tmpVar49;
    modelica_metatype* tmp3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar48;
    modelica_integer tmp5;
    modelica_metatype _dep_loopVar = 0;
    modelica_metatype _dep;
    _dep_loopVar = _dependencies;
    tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar49 = tmpMeta4; /* defaultValue */
    tmp3 = &__omcQ_24tmpVar49;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_dep_loopVar)) {
        _dep = MMC_CAR(_dep_loopVar);
        _dep_loopVar = MMC_CDR(_dep_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        __omcQ_24tmpVar48 = omc_NFComponentRef_scalarizeAll(threadData, _dep, 1 /* true */);
        *tmp3 = mmc_mk_cons(__omcQ_24tmpVar48,0);
        tmp3 = &MMC_CDR(*tmp3);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp3 = mmc_mk_nil();
    tmpMeta2 = __omcQ_24tmpVar49;
  }
  _scalarized_dependencies = omc_List_flatten(threadData, tmpMeta2);
  // _stripped has no default value.
  // _var_arr_idx has no default value.
  // _var_start has no default value.
  // _var_scal_idx has no default value.
  // _sizes has no default value.
  // _int_subs has no default value.
  {
    modelica_metatype _cref;
    for (tmpMeta6 = _scalarized_dependencies; !listEmpty(tmpMeta6); tmpMeta6=MMC_CDR(tmpMeta6))
    {
      _cref = MMC_CAR(tmpMeta6);
      _stripped = omc_NFComponentRef_stripSubscriptsAll(threadData, _cref);

      _var_arr_idx = mmc_unbox_integer(omc_UnorderedMap_getSafe(threadData, _stripped, _map, _OMC_LIT59));

      /* Pattern-matching assignment */
      tmpMeta7 = arrayGet((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mapping), 5))),_var_arr_idx) /* DAE.ASUB */;
      tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 1));
      tmp9 = mmc_unbox_integer(tmpMeta8);
      _var_start = tmp9  /* pattern as ty=Integer */;

      tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
      _sizes = omc_NFComponentRef_sizes(threadData, _stripped, 0 /* false */, 0 /* false */, tmpMeta10);

      _int_subs = omc_NFComponentRef_subscriptsToInteger(threadData, _cref);

      _var_scal_idx = omc_NBSlice_locationToIndex(threadData, _sizes, _int_subs, _var_start);

      tmpMeta11 = mmc_mk_cons(mmc_mk_integer(_var_scal_idx), _indices);
      _indices = tmpMeta11;
    }
  }

  if((!listEmpty(_indices)))
  {
    {
      modelica_integer __omcQ_24tmpVar51;
      modelica_integer __omcQ_24tmpVar50;
      modelica_integer tmp14;
      modelica_metatype _i_loopVar = 0;
      modelica_metatype _i;
      _i_loopVar = _indices;
      __omcQ_24tmpVar51 = ((modelica_integer) -4611686018427387903); /* defaultValue */
      while(1) {
        tmp14 = 1;
        if (!listEmpty(_i_loopVar)) {
          _i = MMC_CAR(_i_loopVar);
          _i_loopVar = MMC_CDR(_i_loopVar);
          tmp14--;
        }
        if (tmp14 == 0) {
          __omcQ_24tmpVar50 = mmc_unbox_integer(_i);
          __omcQ_24tmpVar51 = modelica_integer_max((modelica_integer)(__omcQ_24tmpVar50),(modelica_integer)(__omcQ_24tmpVar51));
        } else if (tmp14 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      tmp13 = __omcQ_24tmpVar51;
    }
    _indices = omc_List_sort(threadData, omc_List_uniqueIntN(threadData, _indices, tmp13), boxvar_intLt);
  }
  _return: OMC_LABEL_UNUSED
  return _indices;
}

static modelica_metatype closure7_NBSlice_getDependentCref(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_cref, modelica_metatype acc)
{
  modelica_metatype map = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype pseudo = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_getDependentCref(thData, $in_cref, acc, map, pseudo);
}static modelica_metatype closure6_NBSlice_filterExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_fnptr filter = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_filterExp(thData, $in_exp, filter, acc);
}static modelica_metatype closure9_NBSlice_getDependentCref(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_cref, modelica_metatype acc)
{
  modelica_metatype map = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype pseudo = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_getDependentCref(thData, $in_cref, acc, map, pseudo);
}static modelica_metatype closure8_NBSlice_filterExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_fnptr filter = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_filterExp(thData, $in_exp, filter, acc);
}static modelica_metatype closure11_NBSlice_getDependentCref(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_cref, modelica_metatype acc)
{
  modelica_metatype map = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype pseudo = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_getDependentCref(thData, $in_cref, acc, map, pseudo);
}static modelica_metatype closure10_NBSlice_filterExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_fnptr filter = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_filterExp(thData, $in_exp, filter, acc);
}
DLLDirection
modelica_metatype omc_NBSlice_getUnsolvableExpCrefs(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc, modelica_metatype _map, modelica_boolean _pseudo)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 13: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          
          /* Pattern matching succeeded */
          tmpMeta6 = mmc_mk_box2(0, _map, mmc_mk_boolean(_pseudo));
          tmpMeta5 = mmc_mk_box2(0, (modelica_fnptr) mmc_mk_box2(0,closure7_NBSlice_getDependentCref,tmpMeta6), _acc);
          tmpMeta1 = omc_NFExpression_mapShallow(threadData, _exp, (modelica_fnptr) mmc_mk_box2(0,closure6_NBSlice_filterExp,tmpMeta5));
          goto tmp3_done;
        }
        case 21: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          
          /* Pattern matching succeeded */
          tmpMeta8 = mmc_mk_box2(0, _map, mmc_mk_boolean(_pseudo));
          tmpMeta7 = mmc_mk_box2(0, (modelica_fnptr) mmc_mk_box2(0,closure9_NBSlice_getDependentCref,tmpMeta8), _acc);
          tmpMeta1 = omc_NFExpression_mapShallow(threadData, _exp, (modelica_fnptr) mmc_mk_box2(0,closure8_NBSlice_filterExp,tmpMeta7));
          goto tmp3_done;
        }
        case 23: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          
          /* Pattern matching succeeded */
          tmpMeta10 = mmc_mk_box2(0, _map, mmc_mk_boolean(_pseudo));
          tmpMeta9 = mmc_mk_box2(0, (modelica_fnptr) mmc_mk_box2(0,closure11_NBSlice_getDependentCref,tmpMeta10), _acc);
          tmpMeta1 = omc_NFExpression_mapShallow(threadData, _exp, (modelica_fnptr) mmc_mk_box2(0,closure10_NBSlice_filterExp,tmpMeta9));
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}
modelica_metatype boxptr_NBSlice_getUnsolvableExpCrefs(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc, modelica_metatype _map, modelica_metatype _pseudo)
{
  modelica_integer tmp1;
  modelica_metatype _exp = NULL;
  tmp1 = mmc_unbox_integer(_pseudo);
  _exp = omc_NBSlice_getUnsolvableExpCrefs(threadData, __omcQ_24in_5Fexp, _acc, _map, tmp1);
  /* skip box _exp; NFExpression */
  return _exp;
}

DLLDirection
modelica_metatype omc_NBSlice_getDependentCrefCausalized(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcref, modelica_metatype _acc, modelica_metatype _set)
{
  modelica_metatype _cref = NULL;
  modelica_metatype _checkCref = NULL;
  modelica_metatype _childCref = NULL;
  modelica_metatype _record_children = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cref = __omcQ_24in_5Fcref;
  // _checkCref has no default value.
  // _childCref has no default value.
  // _record_children has no default value.
  _checkCref = omc_NFComponentRef_stripSubscriptsAll(threadData, _cref);

  _record_children = omc_NBVariable_getRecordChildren(threadData, omc_NBVariable_getVarPointer(threadData, _checkCref, _OMC_LIT60));

  if(listEmpty(_record_children))
  {
    if(omc_UnorderedSet_contains(threadData, _checkCref, _set))
    {
      omc_UnorderedSet_add(threadData, _cref, _acc);
    }
  }
  else
  {
    {
      modelica_metatype _child;
      for (tmpMeta1 = _record_children; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
      {
        _child = MMC_CAR(tmpMeta1);
        _childCref = omc_NBVariable_getVarName(threadData, _child);

        if(omc_UnorderedSet_contains(threadData, _childCref, _set))
        {
          omc_UnorderedSet_add(threadData, _childCref, _acc);
        }
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  return _cref;
}

DLLDirection
modelica_metatype omc_NBSlice_getDependentCref(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcref, modelica_metatype _acc, modelica_metatype _map, modelica_boolean _pseudo)
{
  modelica_metatype _cref = NULL;
  modelica_metatype _checkCref = NULL;
  modelica_metatype _childCref = NULL;
  modelica_metatype _record_children = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cref = __omcQ_24in_5Fcref;
  // _checkCref has no default value.
  // _childCref has no default value.
  // _record_children has no default value.
  _checkCref = (_pseudo?omc_NFComponentRef_stripSubscriptsAll(threadData, _cref):_cref);

  _record_children = omc_NBVariable_getRecordChildren(threadData, omc_NBVariable_getVarPointer(threadData, _checkCref, _OMC_LIT61));

  if(listEmpty(_record_children))
  {
    if(omc_UnorderedMap_contains(threadData, _checkCref, _map))
    {
      omc_UnorderedSet_add(threadData, _cref, _acc);
    }
  }
  else
  {
    {
      modelica_metatype _child;
      for (tmpMeta1 = _record_children; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
      {
        _child = MMC_CAR(tmpMeta1);
        _childCref = omc_NBVariable_getVarName(threadData, _child);

        if(omc_UnorderedMap_contains(threadData, _childCref, _map))
        {
          omc_UnorderedSet_add(threadData, _childCref, _acc);
        }
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  return _cref;
}
modelica_metatype boxptr_NBSlice_getDependentCref(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcref, modelica_metatype _acc, modelica_metatype _map, modelica_metatype _pseudo)
{
  modelica_integer tmp1;
  modelica_metatype _cref = NULL;
  tmp1 = mmc_unbox_integer(_pseudo);
  _cref = omc_NBSlice_getDependentCref(threadData, __omcQ_24in_5Fcref, _acc, _map, tmp1);
  /* skip box _cref; NFComponentRef */
  return _cref;
}

DLLDirection
modelica_metatype omc_NBSlice_getSliceCandidates(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcref, modelica_metatype _acc, modelica_metatype _name)
{
  modelica_metatype _cref = NULL;
  modelica_metatype _checkCref = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cref = __omcQ_24in_5Fcref;
  _checkCref = omc_NFComponentRef_stripSubscriptsAll(threadData, _cref);
  if((omc_NFComponentRef_isEqual(threadData, _name, _checkCref) || omc_NFComponentRef_isEqualRecordChild(threadData, _name, _checkCref)))
  {
    omc_UnorderedSet_add(threadData, _cref, _acc);
  }
  _return: OMC_LABEL_UNUSED
  return _cref;
}

static modelica_metatype closure12_NBSlice_filterExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_fnptr filter = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_filterExp(thData, $in_exp, filter, acc);
}static modelica_metatype closure13_NBSlice_filterExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_fnptr filter = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_filterExp(thData, $in_exp, filter, acc);
}
DLLDirection
modelica_metatype omc_NBSlice_filterExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_fnptr _filter, modelica_metatype _acc)
{
  modelica_metatype _exp = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _exp;
    {
      modelica_metatype _call_exp = NULL;
      modelica_metatype _call = NULL;
      volatile mmc_switch_type tmp3;
      int tmp4;
      // _call_exp has no default value.
      // _call has no default value.
      tmp3 = 0;
      for (; tmp3 < 3; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,6,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_filter), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_filter), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_filter), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _acc) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_filter), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _acc);
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,13,1) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,6,8) == 0) goto tmp2_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 6));
          
          _call = tmpMeta5;
          _call_exp = tmpMeta6;
          /* Pattern matching succeeded */
          {
            modelica_metatype _iter;
            for (tmpMeta7 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 7))); !listEmpty(tmpMeta7); tmpMeta7=MMC_CDR(tmpMeta7))
            {
              _iter = MMC_CAR(tmpMeta7);
              _call_exp = omc_NFExpression_replaceIterator(threadData, _call_exp, omc_Util_tuple21(threadData, _iter), omc_Util_tuple22(threadData, _iter));
            }
          }

          tmpMeta9 = mmc_mk_box2(0, ((modelica_fnptr) _filter), _acc);
          omc_NFExpression_mapShallow(threadData, _call_exp, (modelica_fnptr) mmc_mk_box2(0,closure12_NBSlice_filterExp,tmpMeta9));
          goto tmp2_done;
        }
        case 2: {
          modelica_metatype tmpMeta10;
          
          /* Pattern matching succeeded */
          tmpMeta10 = mmc_mk_box2(0, ((modelica_fnptr) _filter), _acc);
          omc_NFExpression_mapShallow(threadData, _exp, (modelica_fnptr) mmc_mk_box2(0,closure13_NBSlice_filterExp,tmpMeta10));
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
void omc_NBSlice_applyMutable(threadData_t *threadData, modelica_metatype _slice, modelica_fnptr _func)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((void(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)))) : ((void(*)(threadData_t*, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2))));
  _return: OMC_LABEL_UNUSED
  return;
}

DLLDirection
modelica_metatype omc_NBSlice_apply(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fslice, modelica_fnptr _func)
{
  modelica_metatype _slice = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _slice = __omcQ_24in_5Fslice;
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(4));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_slice), 4*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[2] = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)))) : ((modelica_metatype(*)(threadData_t*, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2))));
  _slice = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _slice;
}

DLLDirection
modelica_metatype omc_NBSlice_fromMap(threadData_t *threadData, modelica_metatype _map)
{
  modelica_metatype _slices = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  {
    modelica_metatype __omcQ_24tmpVar53;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype __omcQ_24tmpVar52;
    modelica_integer tmp4;
    modelica_metatype _tpl_loopVar = 0;
    modelica_metatype _tpl;
    _tpl_loopVar = omc_UnorderedMap_toList(threadData, _map);
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar53 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar53;
    while(1) {
      tmp4 = 1;
      if (!listEmpty(_tpl_loopVar)) {
        _tpl = MMC_CAR(_tpl_loopVar);
        _tpl_loopVar = MMC_CDR(_tpl_loopVar);
        tmp4--;
      }
      if (tmp4 == 0) {
        __omcQ_24tmpVar52 = omc_NBSlice_fromTpl(threadData, _tpl);
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar52,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp4 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar53;
  }
  _slices = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _slices;
}

DLLDirection
modelica_metatype omc_NBSlice_fromTpl(threadData_t *threadData, modelica_metatype _tpl)
{
  modelica_metatype _slice = NULL;
  modelica_metatype _t = NULL;
  modelica_metatype _lst = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _slice has no default value.
  // _t has no default value.
  // _lst has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _tpl;
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  _t = tmpMeta2;
  _lst = tmpMeta3;

  tmpMeta4 = mmc_mk_box3(3, &NBSlice_SLICE__desc, _t, _lst);
  _slice = tmpMeta4;
  _return: OMC_LABEL_UNUSED
  return _slice;
}

DLLDirection
void omc_NBSlice_addToSliceMap(threadData_t *threadData, modelica_metatype _t, modelica_integer _i, modelica_metatype _map)
{
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  tmpMeta1 = mmc_mk_cons(mmc_mk_integer(_i), omc_UnorderedMap_getOrDefault(threadData, _t, _map, tmpMeta2));
  omc_UnorderedMap_add(threadData, _t, tmpMeta1, _map);
  _return: OMC_LABEL_UNUSED
  return;
}
void boxptr_NBSlice_addToSliceMap(threadData_t *threadData, modelica_metatype _t, modelica_metatype _i, modelica_metatype _map)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_i);
  omc_NBSlice_addToSliceMap(threadData, _t, tmp1, _map);
  return;
}

DLLDirection
modelica_metatype omc_NBSlice_simplify(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fslice, modelica_fnptr _func)
{
  modelica_metatype _slice = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _slice = __omcQ_24in_5Fslice;
  if((listLength((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 3)))) == mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)))) : ((modelica_metatype(*)(threadData_t*, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)))))))
  {
    tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
    tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(4));
    memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_slice), 4*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[3] = tmpMeta2;
    _slice = tmpMeta1;
  }
  else
  {
    tmpMeta3 = MMC_TAGPTR(mmc_alloc_words(4));
    memcpy(MMC_UNTAGPTR(tmpMeta3), MMC_UNTAGPTR(_slice), 4*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta3))[3] = omc_List_sort(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 3))), boxvar_intGt);
    _slice = tmpMeta3;
  }
  _return: OMC_LABEL_UNUSED
  return _slice;
}

DLLDirection
modelica_integer omc_NBSlice_size(threadData_t *threadData, modelica_metatype _slice, modelica_fnptr _func)
{
  modelica_integer _s;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _s has no default value.
  if(listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 3)))))
  {
    _s = mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)))) : ((modelica_metatype(*)(threadData_t*, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)))));
  }
  else
  {
    _s = listLength((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 3))));
  }
  _return: OMC_LABEL_UNUSED
  return _s;
}
modelica_metatype boxptr_NBSlice_size(threadData_t *threadData, modelica_metatype _slice, modelica_fnptr _func)
{
  modelica_integer _s;
  modelica_metatype out_s;
  _s = omc_NBSlice_size(threadData, _slice, _func);
  out_s = mmc_mk_icon(_s);
  return out_s;
}

DLLDirection
modelica_boolean omc_NBSlice_isFull(threadData_t *threadData, modelica_metatype _slice)
{
  modelica_boolean _b;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _b = listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 3))));
  _return: OMC_LABEL_UNUSED
  return _b;
}
modelica_metatype boxptr_NBSlice_isFull(threadData_t *threadData, modelica_metatype _slice)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NBSlice_isFull(threadData, _slice);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

static modelica_metatype closure14_NBSlice_toString(threadData_t *thData, modelica_metatype closure, modelica_metatype slice)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype maxLength = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NBSlice_toString(thData, slice, func, maxLength);
}
DLLDirection
modelica_string omc_NBSlice_lstToString(threadData_t *threadData, modelica_metatype _lst, modelica_fnptr _func, modelica_integer _maxLength)
{
  modelica_string _str = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = mmc_mk_box2(0, ((modelica_fnptr) _func), mmc_mk_integer(_maxLength));
  _str = omc_List_toString(threadData, _lst, (modelica_fnptr) mmc_mk_box2(0,closure14_NBSlice_toString,tmpMeta1), _OMC_LIT7, _OMC_LIT62, _OMC_LIT63, _OMC_LIT64, 0 /* false */, ((modelica_integer) 0));
  _return: OMC_LABEL_UNUSED
  return _str;
}
modelica_metatype boxptr_NBSlice_lstToString(threadData_t *threadData, modelica_metatype _lst, modelica_fnptr _func, modelica_metatype _maxLength)
{
  modelica_integer tmp1;
  modelica_string _str = NULL;
  modelica_metatype tmpMeta2;
  tmp1 = mmc_unbox_integer(_maxLength);
  _str = omc_NBSlice_lstToString(threadData, _lst, _func, tmp1);
  /* skip box _str; String */
  return _str;
}

DLLDirection
modelica_string omc_NBSlice_toString(threadData_t *threadData, modelica_metatype _slice, modelica_fnptr _func, modelica_integer _maxLength)
{
  modelica_string _str = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _str has no default value.
  _str = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)))) : ((modelica_metatype(*)(threadData_t*, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2))));

  if(((_maxLength > ((modelica_integer) 0)) && (!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 3)))))))
  {
    tmpMeta1 = stringAppend(_str,_OMC_LIT65);
    tmpMeta2 = stringAppend(tmpMeta1,omc_List_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 3))), boxvar_intString, _OMC_LIT7, _OMC_LIT23, _OMC_LIT24, _OMC_LIT25, 1 /* true */, _maxLength));
    _str = tmpMeta2;
  }
  _return: OMC_LABEL_UNUSED
  return _str;
}
modelica_metatype boxptr_NBSlice_toString(threadData_t *threadData, modelica_metatype _slice, modelica_fnptr _func, modelica_metatype _maxLength)
{
  modelica_integer tmp1;
  modelica_string _str = NULL;
  tmp1 = mmc_unbox_integer(_maxLength);
  _str = omc_NBSlice_toString(threadData, _slice, _func, tmp1);
  /* skip box _str; String */
  return _str;
}

DLLDirection
modelica_boolean omc_NBSlice_isEqual(threadData_t *threadData, modelica_metatype _slice1, modelica_metatype _slice2, modelica_fnptr _func)
{
  modelica_boolean _b;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _b = (mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice1), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice2), 2)))) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice1), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice2), 2))))) && omc_List_isEqualOnTrue(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice1), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice2), 3))), boxvar_intEq));
  _return: OMC_LABEL_UNUSED
  return _b;
}
modelica_metatype boxptr_NBSlice_isEqual(threadData_t *threadData, modelica_metatype _slice1, modelica_metatype _slice2, modelica_fnptr _func)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NBSlice_isEqual(threadData, _slice1, _slice2, _func);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

DLLDirection
modelica_metatype omc_NBSlice_getT(threadData_t *threadData, modelica_metatype _slice)
{
  modelica_metatype _t = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _t = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_slice), 2)));
  _return: OMC_LABEL_UNUSED
  return _t;
}

