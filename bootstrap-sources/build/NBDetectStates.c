#include "omc_simulation_settings.h"
#include "NBDetectStates.h"
#define _OMC_LIT0_data "/home/adrpo33/OpenModelica/OMCompiler/Compiler/NBackEnd/Modules/2_Pre/NBDetectStates.mo"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT0,87,_OMC_LIT0_data);
#define _OMC_LIT0 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT0)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT1_6,1.758197185e9);
#define _OMC_LIT1_6 MMC_REFREALLIT(_OMC_LIT_STRUCT1_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT1,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(657)),MMC_IMMEDIATE(MMC_TAGFIXNUM(5)),MMC_IMMEDIATE(MMC_TAGFIXNUM(667)),MMC_IMMEDIATE(MMC_TAGFIXNUM(14)),_OMC_LIT1_6}};
#define _OMC_LIT1 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT1)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT2_6,1.758197185e9);
#define _OMC_LIT2_6 MMC_REFREALLIT(_OMC_LIT_STRUCT2_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT2,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(609)),MMC_IMMEDIATE(MMC_TAGFIXNUM(11)),MMC_IMMEDIATE(MMC_TAGFIXNUM(609)),MMC_IMMEDIATE(MMC_TAGFIXNUM(73)),_OMC_LIT2_6}};
#define _OMC_LIT2 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT2)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT3_6,1.758197185e9);
#define _OMC_LIT3_6 MMC_REFREALLIT(_OMC_LIT_STRUCT3_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT3,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(546)),MMC_IMMEDIATE(MMC_TAGFIXNUM(11)),MMC_IMMEDIATE(MMC_TAGFIXNUM(546)),MMC_IMMEDIATE(MMC_TAGFIXNUM(73)),_OMC_LIT3_6}};
#define _OMC_LIT3 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT3)
#define _OMC_LIT4_data "[stateselection] Natural discrete states from "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT4,46,_OMC_LIT4_data);
#define _OMC_LIT4 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT4)
#define _OMC_LIT5_data ":"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT5,1,_OMC_LIT5_data);
#define _OMC_LIT5 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT5)
#define _OMC_LIT6_data ""
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT6,0,_OMC_LIT6_data);
#define _OMC_LIT6 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data "	"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,1,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
#define _OMC_LIT8_data "\n	"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT8,2,_OMC_LIT8_data);
#define _OMC_LIT8 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT8)
#define _OMC_LIT9_data "\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT9,1,_OMC_LIT9_data);
#define _OMC_LIT9 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "[stateselection] Natural clocked states from "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,45,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
#define _OMC_LIT11_data "stateselection"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT11,14,_OMC_LIT11_data);
#define _OMC_LIT11 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT11)
#define _OMC_LIT12_data "Enables dumping of selected states. Extends -d=backenddaeinfo."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT12,62,_OMC_LIT12_data);
#define _OMC_LIT12 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT12)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT13,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT12}};
#define _OMC_LIT13 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT13)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT14,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(70)),_OMC_LIT11,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT13}};
#define _OMC_LIT14 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT14)
#define _OMC_LIT15_data "[discreteinfo] pre() and previous() variables from "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT15,51,_OMC_LIT15_data);
#define _OMC_LIT15 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT15)
#define _OMC_LIT16_data "discreteinfo"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT16,12,_OMC_LIT16_data);
#define _OMC_LIT16 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT16)
#define _OMC_LIT17_data "Enables dumping of discrete variables. Extends -d=backenddaeinfo."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT17,65,_OMC_LIT17_data);
#define _OMC_LIT17 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT17)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT18,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT17}};
#define _OMC_LIT18 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT18)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT19,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(91)),_OMC_LIT16,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT18}};
#define _OMC_LIT19 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT19)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT20_6,1.758197185e9);
#define _OMC_LIT20_6 MMC_REFREALLIT(_OMC_LIT_STRUCT20_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT20,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(444)),MMC_IMMEDIATE(MMC_TAGFIXNUM(86)),MMC_IMMEDIATE(MMC_TAGFIXNUM(445)),MMC_IMMEDIATE(MMC_TAGFIXNUM(7)),_OMC_LIT20_6}};
#define _OMC_LIT20 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT20)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT21_6,1.758197185e9);
#define _OMC_LIT21_6 MMC_REFREALLIT(_OMC_LIT_STRUCT21_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT21,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(445)),MMC_IMMEDIATE(MMC_TAGFIXNUM(86)),MMC_IMMEDIATE(MMC_TAGFIXNUM(446)),MMC_IMMEDIATE(MMC_TAGFIXNUM(7)),_OMC_LIT21_6}};
#define _OMC_LIT21 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT21)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT22,1,5) {&ErrorTypes_MessageType_TRANSLATION__desc,}};
#define _OMC_LIT22 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT22)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT23,1,4) {&ErrorTypes_Severity_ERROR__desc,}};
#define _OMC_LIT23 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT23)
#define _OMC_LIT24_data "Internal error %s"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT24,17,_OMC_LIT24_data);
#define _OMC_LIT24 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT24)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT25,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT24}};
#define _OMC_LIT25 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT25)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT26,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(63)),_OMC_LIT22,_OMC_LIT23,_OMC_LIT25}};
#define _OMC_LIT26 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT26)
#define _OMC_LIT27_data "NBDetectStates.preFromArgs failed because of unexpected expression "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT27,67,_OMC_LIT27_data);
#define _OMC_LIT27 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT27)
#define _OMC_LIT28_data "("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT28,1,_OMC_LIT28_data);
#define _OMC_LIT28 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT28)
#define _OMC_LIT29_data ", "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT29,2,_OMC_LIT29_data);
#define _OMC_LIT29 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT29)
#define _OMC_LIT30_data ")."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT30,2,_OMC_LIT30_data);
#define _OMC_LIT30 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT30)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT31,2,6) {&NFExpression_BOOLEAN__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT31 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT31)
#define _OMC_LIT32_data "previous"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT32,8,_OMC_LIT32_data);
#define _OMC_LIT32 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT32)
#define _OMC_LIT33_data "pre"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT33,3,_OMC_LIT33_data);
#define _OMC_LIT33 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT33)
#define _OMC_LIT34_data "edge"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT34,4,_OMC_LIT34_data);
#define _OMC_LIT34 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT34)
#define _OMC_LIT35_data "change"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT35,6,_OMC_LIT35_data);
#define _OMC_LIT35 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT35)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT36_6,1.758197185e9);
#define _OMC_LIT36_6 MMC_REFREALLIT(_OMC_LIT_STRUCT36_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT36,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(396)),MMC_IMMEDIATE(MMC_TAGFIXNUM(13)),MMC_IMMEDIATE(MMC_TAGFIXNUM(396)),MMC_IMMEDIATE(MMC_TAGFIXNUM(138)),_OMC_LIT36_6}};
#define _OMC_LIT36 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT36)
#define _OMC_LIT37_data "NBDetectStates.collectPreAndPrevious failed because previous() can only contain component references, but contained: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT37,117,_OMC_LIT37_data);
#define _OMC_LIT37 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT37)
#define _OMC_LIT38_data "[stateselection] ("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT38,18,_OMC_LIT38_data);
#define _OMC_LIT38 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT38)
#define _OMC_LIT39_data ") Natural states before index reduction:"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT39,40,_OMC_LIT39_data);
#define _OMC_LIT39 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT39)
#define _OMC_LIT40_data "	<no states>\n\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT40,14,_OMC_LIT40_data);
#define _OMC_LIT40 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT40)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT41_6,1.758197185e9);
#define _OMC_LIT41_6 MMC_REFREALLIT(_OMC_LIT_STRUCT41_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT41,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(322)),MMC_IMMEDIATE(MMC_TAGFIXNUM(12)),MMC_IMMEDIATE(MMC_TAGFIXNUM(322)),MMC_IMMEDIATE(MMC_TAGFIXNUM(30)),_OMC_LIT41_6}};
#define _OMC_LIT41 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT41)
#define _OMC_LIT42_data "NBDetectStates.resolveGeneralDer"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT42,32,_OMC_LIT42_data);
#define _OMC_LIT42 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT42)
#define _OMC_LIT43_data "NBDetectStates.resolveGeneralDer failed because the number of algebraic variables were miscounted! Expected: 0 or 1, got: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT43,122,_OMC_LIT43_data);
#define _OMC_LIT43 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT43)
#define _OMC_LIT44_data "$AUX"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT44,4,_OMC_LIT44_data);
#define _OMC_LIT44 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT44)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT45,1,5) {&NBEquation_Iterator_EMPTY__desc,}};
#define _OMC_LIT45 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT45)
#define _OMC_LIT46_data "der"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT46,3,_OMC_LIT46_data);
#define _OMC_LIT46 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT46)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT47_6,1.758197185e9);
#define _OMC_LIT47_6 MMC_REFREALLIT(_OMC_LIT_STRUCT47_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT47,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(241)),MMC_IMMEDIATE(MMC_TAGFIXNUM(11)),MMC_IMMEDIATE(MMC_TAGFIXNUM(241)),MMC_IMMEDIATE(MMC_TAGFIXNUM(73)),_OMC_LIT47_6}};
#define _OMC_LIT47 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT47)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT48_6,1.758197185e9);
#define _OMC_LIT48_6 MMC_REFREALLIT(_OMC_LIT_STRUCT48_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT48,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(253)),MMC_IMMEDIATE(MMC_TAGFIXNUM(15)),MMC_IMMEDIATE(MMC_TAGFIXNUM(253)),MMC_IMMEDIATE(MMC_TAGFIXNUM(77)),_OMC_LIT48_6}};
#define _OMC_LIT48 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT48)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT49,1,5) {&NFFlatten_FunctionTreeImpl_Tree_EMPTY__desc,}};
#define _OMC_LIT49 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT49)
#define _OMC_LIT50_data ") Created auxiliary equations:"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT50,30,_OMC_LIT50_data);
#define _OMC_LIT50 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT50)
#define _OMC_LIT51_data "discrete equations"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT51,18,_OMC_LIT51_data);
#define _OMC_LIT51 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT51)
#define _OMC_LIT52_data "clocked equations"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT52,17,_OMC_LIT52_data);
#define _OMC_LIT52 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT52)
#define _OMC_LIT53_data "continuous equations"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT53,20,_OMC_LIT53_data);
#define _OMC_LIT53 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT53)
#define _OMC_LIT54_data "initial equations"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT54,17,_OMC_LIT54_data);
#define _OMC_LIT54 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT54)
#define _OMC_LIT55_data "[stateselection] State Order:"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT55,29,_OMC_LIT55_data);
#define _OMC_LIT55 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT55)
#define _OMC_LIT56_data " --d/dt--> "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT56,11,_OMC_LIT56_data);
#define _OMC_LIT56 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT56)
#define _OMC_LIT57_data "\n\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT57,2,_OMC_LIT57_data);
#define _OMC_LIT57 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT57)
#define _OMC_LIT58_data "default"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT58,7,_OMC_LIT58_data);
#define _OMC_LIT58 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT58)
#define _OMC_LIT59_data "NBDetectStates.main failed."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT59,27,_OMC_LIT59_data);
#define _OMC_LIT59 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT59)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT60,2,1) {_OMC_LIT59,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT60 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT60)
#include "util/modelica.h"

#include "NBDetectStates_includes.h"


/* default, do not make protected functions static */
#if !defined(PROTECTED_FUNCTION_STATIC)
#define PROTECTED_FUNCTION_STATIC
#endif
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_getPreVar(threadData_t *threadData, modelica_metatype _var_cref, modelica_metatype _var_ptr, modelica_metatype _acc_previous, modelica_boolean _scalarized);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_getPreVar(threadData_t *threadData, modelica_metatype _var_cref, modelica_metatype _var_ptr, modelica_metatype _acc_previous, modelica_metatype _scalarized);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_getPreVar,2,0) {(void*) boxptr_NBDetectStates_getPreVar,0}};
#define boxvar_NBDetectStates_getPreVar MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_getPreVar)
PROTECTED_FUNCTION_STATIC void omc_NBDetectStates_collectDiscreteStatesFromWhenInIf(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_boolean _scalarized);
PROTECTED_FUNCTION_STATIC void boxptr_NBDetectStates_collectDiscreteStatesFromWhenInIf(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_metatype _scalarized);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_collectDiscreteStatesFromWhenInIf,2,0) {(void*) boxptr_NBDetectStates_collectDiscreteStatesFromWhenInIf,0}};
#define boxvar_NBDetectStates_collectDiscreteStatesFromWhenInIf MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_collectDiscreteStatesFromWhenInIf)
PROTECTED_FUNCTION_STATIC void omc_NBDetectStates_collectDiscreteStatesFromWhenBody(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_boolean _scalarized);
PROTECTED_FUNCTION_STATIC void boxptr_NBDetectStates_collectDiscreteStatesFromWhenBody(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_metatype _scalarized);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_collectDiscreteStatesFromWhenBody,2,0) {(void*) boxptr_NBDetectStates_collectDiscreteStatesFromWhenBody,0}};
#define boxvar_NBDetectStates_collectDiscreteStatesFromWhenBody MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_collectDiscreteStatesFromWhenBody)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_collectDiscreteStatesFromWhen(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feqn, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_boolean _scalarized);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_collectDiscreteStatesFromWhen(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feqn, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_metatype _scalarized);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_collectDiscreteStatesFromWhen,2,0) {(void*) boxptr_NBDetectStates_collectDiscreteStatesFromWhen,0}};
#define boxvar_NBDetectStates_collectDiscreteStatesFromWhen MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_collectDiscreteStatesFromWhen)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_updateDiscreteStatesAndPrevious(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fdiscretes, modelica_metatype __omcQ_24in_5Fdiscrete_5Fstates, modelica_metatype __omcQ_24in_5Fclocked_5Fstates, modelica_metatype __omcQ_24in_5Fprevious, modelica_metatype _acc_discrete_states, modelica_metatype _acc_clocked_states, modelica_metatype _acc_previous, modelica_string _context, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_discretes, modelica_metatype *out_discrete_states, modelica_metatype *out_clocked_states, modelica_metatype *out_previous);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_updateDiscreteStatesAndPrevious,2,0) {(void*) boxptr_NBDetectStates_updateDiscreteStatesAndPrevious,0}};
#define boxvar_NBDetectStates_updateDiscreteStatesAndPrevious MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_updateDiscreteStatesAndPrevious)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_preFromArgs(threadData_t *threadData, modelica_metatype _args, modelica_metatype _acc_previous, modelica_boolean _scalarized, modelica_string _context, modelica_metatype *out_old_exp);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_preFromArgs(threadData_t *threadData, modelica_metatype _args, modelica_metatype _acc_previous, modelica_metatype _scalarized, modelica_metatype _context, modelica_metatype *out_old_exp);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_preFromArgs,2,0) {(void*) boxptr_NBDetectStates_preFromArgs,0}};
#define boxvar_NBDetectStates_preFromArgs MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_preFromArgs)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_collectPreAndPrevious(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_previous, modelica_metatype _acc_clocked_states, modelica_boolean _scalarized);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_collectPreAndPrevious(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_previous, modelica_metatype _acc_clocked_states, modelica_metatype _scalarized);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_collectPreAndPrevious,2,0) {(void*) boxptr_NBDetectStates_collectPreAndPrevious,0}};
#define boxvar_NBDetectStates_collectPreAndPrevious MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_collectPreAndPrevious)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_updateStatesAndDerivatives(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Funknowns, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fstates, modelica_metatype __omcQ_24in_5Fderivatives, modelica_metatype __omcQ_24in_5Falgebraics, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_metatype *out_unknowns, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_states, modelica_metatype *out_derivatives, modelica_metatype *out_algebraics);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_updateStatesAndDerivatives,2,0) {(void*) boxptr_NBDetectStates_updateStatesAndDerivatives,0}};
#define boxvar_NBDetectStates_updateStatesAndDerivatives MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_updateStatesAndDerivatives)
PROTECTED_FUNCTION_STATIC modelica_integer omc_NBDetectStates_checkAlgebraic(threadData_t *threadData, modelica_metatype _exp, modelica_integer __omcQ_24in_5Fi);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_checkAlgebraic(threadData_t *threadData, modelica_metatype _exp, modelica_metatype __omcQ_24in_5Fi);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_checkAlgebraic,2,0) {(void*) boxptr_NBDetectStates_checkAlgebraic,0}};
#define boxvar_NBDetectStates_checkAlgebraic MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_checkAlgebraic)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_resolveGeneralDer(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_metatype _acc_aux_equations, modelica_metatype _uniqueIndex, modelica_metatype _diffArgs);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_resolveGeneralDer,2,0) {(void*) boxptr_NBDetectStates_resolveGeneralDer,0}};
#define boxvar_NBDetectStates_resolveGeneralDer MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_resolveGeneralDer)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_collectStatesAndDerivatives(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_boolean _scalarized);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_collectStatesAndDerivatives(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_metatype _scalarized);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_collectStatesAndDerivatives,2,0) {(void*) boxptr_NBDetectStates_collectStatesAndDerivatives,0}};
#define boxvar_NBDetectStates_collectStatesAndDerivatives MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_collectStatesAndDerivatives)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_detectDiscreteStatesDefault(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fdiscretes, modelica_metatype __omcQ_24in_5Fdiscrete_5Fstates, modelica_metatype __omcQ_24in_5Fclocked_5Fstates, modelica_metatype __omcQ_24in_5Fprevious, modelica_string _context, modelica_metatype *out_equations, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_discretes, modelica_metatype *out_discrete_states, modelica_metatype *out_clocked_states, modelica_metatype *out_previous);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_detectDiscreteStatesDefault,2,0) {(void*) boxptr_NBDetectStates_detectDiscreteStatesDefault,0}};
#define boxvar_NBDetectStates_detectDiscreteStatesDefault MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_detectDiscreteStatesDefault)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_detectContinuousStatesDefault(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Funknowns, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fstates, modelica_metatype __omcQ_24in_5Fderivatives, modelica_metatype __omcQ_24in_5Falgebraics, modelica_metatype _equations, modelica_metatype *out_unknowns, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_states, modelica_metatype *out_derivatives, modelica_metatype *out_algebraics, modelica_metatype *out_aux_eqns);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_detectContinuousStatesDefault,2,0) {(void*) boxptr_NBDetectStates_detectContinuousStatesDefault,0}};
#define boxvar_NBDetectStates_detectContinuousStatesDefault MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_detectContinuousStatesDefault)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_detectStatesDefault(threadData_t *threadData, modelica_metatype __omcQ_24in_5FvarData, modelica_metatype __omcQ_24in_5FeqData, modelica_fnptr _continuousFunc, modelica_fnptr _discreteFunc, modelica_metatype *out_eqData);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NBDetectStates_detectStatesDefault,2,0) {(void*) boxptr_NBDetectStates_detectStatesDefault,0}};
#define boxvar_NBDetectStates_detectStatesDefault MMC_REFSTRUCTLIT(boxvar_lit_NBDetectStates_detectStatesDefault)

DLLDirection
void omc_NBDetectStates_updateStateOrder(threadData_t *threadData, modelica_metatype _lhs, modelica_metatype _rhs, modelica_metatype _state_order)
{
  modelica_metatype _state = NULL;
  modelica_metatype _lhs_k = NULL;
  modelica_metatype _rhs_k = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _state has no default value.
  // _lhs_k has no default value.
  // _rhs_k has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;modelica_metatype tmp3_2;
    tmp3_1 = omc_NBVariable_getVarKind(threadData, omc_NBVariable_getVarPointer(threadData, _lhs, _OMC_LIT1));
    tmp3_2 = omc_NBVariable_getVarKind(threadData, omc_NBVariable_getVarPointer(threadData, _rhs, _OMC_LIT1));
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 3; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,3,2) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 2));
          
          _state = tmpMeta5;
          /* Pattern matching succeeded */
          omc_UnorderedMap_add(threadData, omc_NBVariable_getVarName(threadData, _state), _lhs, _state_order);
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,3,2) == 0) goto tmp2_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
          
          _state = tmpMeta6;
          /* Pattern matching succeeded */
          omc_UnorderedMap_add(threadData, omc_NBVariable_getVarName(threadData, _state), _rhs, _state_order);
          goto tmp2_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}

DLLDirection
modelica_metatype omc_NBDetectStates_stateOrder(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feqn, modelica_metatype _state_order)
{
  modelica_metatype _eqn = NULL;
  modelica_metatype _lhs = NULL;
  modelica_metatype _rhs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eqn = __omcQ_24in_5Feqn;
  // _lhs has no default value.
  // _rhs has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _eqn;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 4; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,5) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,6,2) == 0) goto tmp2_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,6,2) == 0) goto tmp2_end;
          
          _lhs = tmpMeta5;
          _rhs = tmpMeta6;
          /* Pattern matching succeeded */
          omc_NBDetectStates_updateStateOrder(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_lhs), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_rhs), 3))), _state_order);
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,6) == 0) goto tmp2_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,6,2) == 0) goto tmp2_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta8,6,2) == 0) goto tmp2_end;
          
          _lhs = tmpMeta7;
          _rhs = tmpMeta8;
          /* Pattern matching succeeded */
          omc_NBDetectStates_updateStateOrder(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_lhs), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_rhs), 3))), _state_order);
          goto tmp2_done;
        }
        case 2: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,5,5) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype _b;
            for (tmpMeta9 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqn), 4))); !listEmpty(tmpMeta9); tmpMeta9=MMC_CDR(tmpMeta9))
            {
              _b = MMC_CAR(tmpMeta9);
              omc_NBDetectStates_stateOrder(threadData, _b, _state_order);
            }
          }
          goto tmp2_done;
        }
        case 3: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _eqn;
}

DLLDirection
void omc_NBDetectStates_findDiscreteStatesFromWhenBody(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous)
{
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta15;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  {
    modelica_metatype _body_stmt;
    for (tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_body), 3))); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _body_stmt = MMC_CAR(tmpMeta1);
      { /* match expression */
        modelica_metatype tmp4_1;
        tmp4_1 = _body_stmt;
        {
          modelica_metatype _state_cref = NULL;
          modelica_metatype _state_var = NULL;
          modelica_metatype _pre_var = NULL;
          volatile mmc_switch_type tmp4;
          int tmp5;
          // _state_cref has no default value.
          // _state_var has no default value.
          // _pre_var has no default value.
          tmp4 = 0;
          for (; tmp4 < 2; tmp4++) {
            switch (MMC_SWITCH_CAST(tmp4)) {
            case 0: {
              modelica_metatype tmpMeta6;
              modelica_metatype tmpMeta7;
              modelica_metatype tmpMeta14;
              if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,3) == 0) goto tmp3_end;
              tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
              if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,6,2) == 0) goto tmp3_end;
              tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 3));
              
              _state_cref = tmpMeta7;
              /* Pattern matching succeeded */
              _state_var = omc_NBVariable_getVarPointer(threadData, _state_cref, _OMC_LIT2);

              { /* match expression */
                modelica_metatype tmp10_1;
                tmp10_1 = omc_NBVariable_getVarPre(threadData, _state_var, NULL);
                {
                  volatile mmc_switch_type tmp10;
                  int tmp11;
                  tmp10 = 0;
                  for (; tmp10 < 2; tmp10++) {
                    switch (MMC_SWITCH_CAST(tmp10)) {
                    case 0: {
                      modelica_metatype tmpMeta12;
                      modelica_metatype tmpMeta13;
                      if (optionNone(tmp10_1)) goto tmp9_end;
                      tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp10_1), 1));
                      _pre_var = tmpMeta12;
                      /* Pattern matching succeeded */
                      tmpMeta13 = mmc_mk_cons(_pre_var, omc_Pointer_access(threadData, _acc_previous));
                      omc_Pointer_update(threadData, _acc_previous, tmpMeta13);
                      goto tmp9_done;
                    }
                    case 1: {
                      
                      /* Pattern matching succeeded */
                      goto tmp9_done;
                    }
                    }
                    goto tmp9_end;
                    tmp9_end: ;
                  }
                  goto goto_8;
                  goto_8:;
                  goto goto_2;
                  goto tmp9_done;
                  tmp9_done:;
                }
              }
              ;

              tmpMeta14 = mmc_mk_cons(_state_var, omc_Pointer_access(threadData, _acc_discrete_states));
              omc_Pointer_update(threadData, _acc_discrete_states, tmpMeta14);
              goto tmp3_done;
            }
            case 1: {
              
              /* Pattern matching succeeded */
              goto tmp3_done;
            }
            }
            goto tmp3_end;
            tmp3_end: ;
          }
          goto goto_2;
          goto_2:;
          MMC_THROW_INTERNAL();
          goto tmp3_done;
          tmp3_done:;
        }
      }
      ;
    }
  }
  _return: OMC_LABEL_UNUSED
  return;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_getPreVar(threadData_t *threadData, modelica_metatype _var_cref, modelica_metatype _var_ptr, modelica_metatype _acc_previous, modelica_boolean _scalarized)
{
  modelica_metatype _pre_cref = NULL;
  modelica_metatype _pre = NULL;
  modelica_metatype _pre_var = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _pre_cref has no default value.
  _pre = omc_NBVariable_getVarPre(threadData, _var_ptr, NULL);
  // _pre_var has no default value.
  if(isSome(_pre))
  {
    /* Pattern-matching assignment */
    tmpMeta1 = _pre;
    if (optionNone(tmpMeta1)) MMC_THROW_INTERNAL();
    tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
    _pre_var = tmpMeta2;

    _pre_cref = omc_NBVariable_getVarName(threadData, _pre_var);
  }
  else
  {
    if((!_scalarized))
    {
      _pre_cref = omc_NBVariable_makePreVar(threadData, omc_NFComponentRef_stripSubscriptsAll(threadData, _var_cref) ,&_pre_var);

      _pre_cref = omc_NFComponentRef_copySubscripts(threadData, _var_cref, _pre_cref);
    }
    else
    {
      _pre_cref = omc_NBVariable_makePreVar(threadData, _var_cref ,&_pre_var);
    }

    tmpMeta3 = mmc_mk_cons(_pre_var, omc_Pointer_access(threadData, _acc_previous));
    omc_Pointer_update(threadData, _acc_previous, tmpMeta3);
  }
  _return: OMC_LABEL_UNUSED
  return _pre_cref;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_getPreVar(threadData_t *threadData, modelica_metatype _var_cref, modelica_metatype _var_ptr, modelica_metatype _acc_previous, modelica_metatype _scalarized)
{
  modelica_integer tmp1;
  modelica_metatype _pre_cref = NULL;
  tmp1 = mmc_unbox_integer(_scalarized);
  _pre_cref = omc_NBDetectStates_getPreVar(threadData, _var_cref, _var_ptr, _acc_previous, tmp1);
  /* skip box _pre_cref; NFComponentRef */
  return _pre_cref;
}

PROTECTED_FUNCTION_STATIC void omc_NBDetectStates_collectDiscreteStatesFromWhenInIf(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_boolean _scalarized)
{
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  {
    modelica_metatype _eqn;
    for (tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_body), 3))); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _eqn = MMC_CAR(tmpMeta1);
      omc_NBDetectStates_collectDiscreteStatesFromWhen(threadData, omc_Pointer_access(threadData, _eqn), _acc_discrete_states, _acc_previous, _scalarized);
    }
  }

  if(isSome((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_body), 4)))))
  {
    /* Tail recursive call */
    _body = omc_Util_getOption(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_body), 4))));
    goto _tailrecursive;
    /* TODO: Make sure any eventual dead code below is never generated */
    ;
  }
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBDetectStates_collectDiscreteStatesFromWhenInIf(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_metatype _scalarized)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_scalarized);
  omc_NBDetectStates_collectDiscreteStatesFromWhenInIf(threadData, _body, _acc_discrete_states, _acc_previous, tmp1);
  return;
}

PROTECTED_FUNCTION_STATIC void omc_NBDetectStates_collectDiscreteStatesFromWhenBody(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_boolean _scalarized)
{
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta9;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  {
    modelica_metatype _body_stmt;
    for (tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_body), 3))); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _body_stmt = MMC_CAR(tmpMeta1);
      { /* match expression */
        modelica_metatype tmp4_1;
        tmp4_1 = _body_stmt;
        {
          modelica_metatype _state_cref = NULL;
          modelica_metatype _state_var = NULL;
          volatile mmc_switch_type tmp4;
          int tmp5;
          // _state_cref has no default value.
          // _state_var has no default value.
          tmp4 = 0;
          for (; tmp4 < 2; tmp4++) {
            switch (MMC_SWITCH_CAST(tmp4)) {
            case 0: {
              modelica_metatype tmpMeta6;
              modelica_metatype tmpMeta7;
              modelica_metatype tmpMeta8;
              if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,3) == 0) goto tmp3_end;
              tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
              if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,6,2) == 0) goto tmp3_end;
              tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 3));
              
              _state_cref = tmpMeta7;
              /* Pattern matching succeeded */
              _state_var = omc_NBVariable_getVarPointer(threadData, _state_cref, _OMC_LIT3);

              omc_NBVariable_makeDiscreteStateVar(threadData, _state_var);

              omc_NBDetectStates_getPreVar(threadData, _state_cref, _state_var, _acc_previous, _scalarized);

              tmpMeta8 = mmc_mk_cons(_state_var, omc_Pointer_access(threadData, _acc_discrete_states));
              omc_Pointer_update(threadData, _acc_discrete_states, tmpMeta8);
              goto tmp3_done;
            }
            case 1: {
              
              /* Pattern matching succeeded */
              goto tmp3_done;
            }
            }
            goto tmp3_end;
            tmp3_end: ;
          }
          goto goto_2;
          goto_2:;
          MMC_THROW_INTERNAL();
          goto tmp3_done;
          tmp3_done:;
        }
      }
      ;
    }
  }
  _return: OMC_LABEL_UNUSED
  return;
}
PROTECTED_FUNCTION_STATIC void boxptr_NBDetectStates_collectDiscreteStatesFromWhenBody(threadData_t *threadData, modelica_metatype _body, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_metatype _scalarized)
{
  modelica_integer tmp1;
  tmp1 = mmc_unbox_integer(_scalarized);
  omc_NBDetectStates_collectDiscreteStatesFromWhenBody(threadData, _body, _acc_discrete_states, _acc_previous, tmp1);
  return;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_collectDiscreteStatesFromWhen(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feqn, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_boolean _scalarized)
{
  modelica_metatype _eqn = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eqn = __omcQ_24in_5Feqn;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _eqn;
    {
      int tmp3;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
        case 9: {
          
          /* Pattern matching succeeded */
          omc_NBDetectStates_collectDiscreteStatesFromWhenBody(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqn), 3))), _acc_discrete_states, _acc_previous, _scalarized);
          goto tmp2_done;
        }
        case 8: {
          modelica_metatype tmpMeta4;
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype _b_eqn;
            for (tmpMeta4 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqn), 4))); !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
            {
              _b_eqn = MMC_CAR(tmpMeta4);
              omc_NBDetectStates_collectDiscreteStatesFromWhen(threadData, _b_eqn, _acc_discrete_states, _acc_previous, _scalarized);
            }
          }
          goto tmp2_done;
        }
        case 7: {
          
          /* Pattern matching succeeded */
          omc_NBDetectStates_collectDiscreteStatesFromWhenInIf(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqn), 3))), _acc_discrete_states, _acc_previous, _scalarized);
          goto tmp2_done;
        }
        default:
        tmp2_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _eqn;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_collectDiscreteStatesFromWhen(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feqn, modelica_metatype _acc_discrete_states, modelica_metatype _acc_previous, modelica_metatype _scalarized)
{
  modelica_integer tmp1;
  modelica_metatype _eqn = NULL;
  tmp1 = mmc_unbox_integer(_scalarized);
  _eqn = omc_NBDetectStates_collectDiscreteStatesFromWhen(threadData, __omcQ_24in_5Feqn, _acc_discrete_states, _acc_previous, tmp1);
  /* skip box _eqn; NBEquation.Equation */
  return _eqn;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_updateDiscreteStatesAndPrevious(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fdiscretes, modelica_metatype __omcQ_24in_5Fdiscrete_5Fstates, modelica_metatype __omcQ_24in_5Fclocked_5Fstates, modelica_metatype __omcQ_24in_5Fprevious, modelica_metatype _acc_discrete_states, modelica_metatype _acc_clocked_states, modelica_metatype _acc_previous, modelica_string _context, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_discretes, modelica_metatype *out_discrete_states, modelica_metatype *out_clocked_states, modelica_metatype *out_previous)
{
  modelica_metatype _variables = NULL;
  modelica_metatype _knowns = NULL;
  modelica_metatype _initials = NULL;
  modelica_metatype _discretes = NULL;
  modelica_metatype _discrete_states = NULL;
  modelica_metatype _clocked_states = NULL;
  modelica_metatype _previous = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _variables = __omcQ_24in_5Fvariables;
  _knowns = __omcQ_24in_5Fknowns;
  _initials = __omcQ_24in_5Finitials;
  _discretes = __omcQ_24in_5Fdiscretes;
  _discrete_states = __omcQ_24in_5Fdiscrete_5Fstates;
  _clocked_states = __omcQ_24in_5Fclocked_5Fstates;
  _previous = __omcQ_24in_5Fprevious;
  _variables = omc_NBVariable_VariablePointers_addList(threadData, _acc_previous, _variables);

  _knowns = omc_NBVariable_VariablePointers_addList(threadData, _acc_previous, _knowns);

  _initials = omc_NBVariable_VariablePointers_addList(threadData, _acc_previous, _initials);

  _previous = omc_NBVariable_VariablePointers_addList(threadData, _acc_previous, _previous);

  _discrete_states = omc_NBVariable_VariablePointers_addList(threadData, _acc_discrete_states, _discrete_states);

  _clocked_states = omc_NBVariable_VariablePointers_addList(threadData, _acc_clocked_states, _clocked_states);

  _discretes = omc_NBVariable_VariablePointers_removeList(threadData, _acc_discrete_states, _discretes);

  _discretes = omc_NBVariable_VariablePointers_removeList(threadData, _acc_clocked_states, _discretes);

  _discrete_states = omc_NBVariable_VariablePointers_removeList(threadData, _acc_clocked_states, _discrete_states);

  if(omc_Flags_isSet(threadData, _OMC_LIT14))
  {
    if((!listEmpty(_acc_discrete_states)))
    {
      tmpMeta1 = stringAppend(_OMC_LIT4,_context);
      tmpMeta2 = stringAppend(tmpMeta1,_OMC_LIT5);
      fputs(MMC_STRINGDATA(omc_StringUtil_headline__4(threadData, tmpMeta2)),stdout);

      tmpMeta3 = stringAppend(omc_List_toString(threadData, _acc_discrete_states, boxvar_NBVariable_pointerToString, _OMC_LIT6, _OMC_LIT7, _OMC_LIT8, _OMC_LIT9, 1 /* true */, ((modelica_integer) 0)),_OMC_LIT9);
      fputs(MMC_STRINGDATA(tmpMeta3),stdout);
    }

    if((!listEmpty(_acc_clocked_states)))
    {
      tmpMeta4 = stringAppend(_OMC_LIT10,_context);
      tmpMeta5 = stringAppend(tmpMeta4,_OMC_LIT5);
      fputs(MMC_STRINGDATA(omc_StringUtil_headline__4(threadData, tmpMeta5)),stdout);

      tmpMeta6 = stringAppend(omc_List_toString(threadData, _acc_clocked_states, boxvar_NBVariable_pointerToString, _OMC_LIT6, _OMC_LIT7, _OMC_LIT8, _OMC_LIT9, 1 /* true */, ((modelica_integer) 0)),_OMC_LIT9);
      fputs(MMC_STRINGDATA(tmpMeta6),stdout);
    }
  }

  if(omc_Flags_isSet(threadData, _OMC_LIT19))
  {
    if((!listEmpty(_acc_previous)))
    {
      tmpMeta7 = stringAppend(_OMC_LIT15,_context);
      tmpMeta8 = stringAppend(tmpMeta7,_OMC_LIT5);
      fputs(MMC_STRINGDATA(omc_StringUtil_headline__4(threadData, tmpMeta8)),stdout);

      tmpMeta9 = stringAppend(omc_List_toString(threadData, _acc_previous, boxvar_NBVariable_pointerToString, _OMC_LIT6, _OMC_LIT7, _OMC_LIT8, _OMC_LIT9, 1 /* true */, ((modelica_integer) 0)),_OMC_LIT9);
      fputs(MMC_STRINGDATA(tmpMeta9),stdout);
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_knowns) { *out_knowns = _knowns; }
  if (out_initials) { *out_initials = _initials; }
  if (out_discretes) { *out_discretes = _discretes; }
  if (out_discrete_states) { *out_discrete_states = _discrete_states; }
  if (out_clocked_states) { *out_clocked_states = _clocked_states; }
  if (out_previous) { *out_previous = _previous; }
  return _variables;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_preFromArgs(threadData_t *threadData, modelica_metatype _args, modelica_metatype _acc_previous, modelica_boolean _scalarized, modelica_string _context, modelica_metatype *out_old_exp)
{
  modelica_metatype _new_exp = NULL;
  modelica_metatype _old_exp = NULL;
  modelica_metatype _state_cref = NULL;
  modelica_metatype _pre_cref = NULL;
  modelica_metatype _state_var = NULL;
  modelica_metatype _pre_var = NULL;
  modelica_boolean _negated;
  modelica_boolean tmp1_c2 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _new_exp has no default value.
  // _old_exp has no default value.
  // _state_cref has no default value.
  // _pre_cref has no default value.
  // _state_var has no default value.
  // _pre_var has no default value.
  // _negated has no default value.
  
  
  
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _args;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (listEmpty(tmp4_1)) goto tmp3_end;
          tmpMeta6 = MMC_CAR(tmp4_1);
          tmpMeta7 = MMC_CDR(tmp4_1);
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,6,2) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 3));
          if (!listEmpty(tmpMeta7)) goto tmp3_end;
          _old_exp = tmpMeta6;
          _state_cref = tmpMeta8;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NBVariable_getVarPointer(threadData, _state_cref, _OMC_LIT20);
          tmpMeta[0+1] = _old_exp;
          tmp1_c2 = 0 /* false */;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          if (listEmpty(tmp4_1)) goto tmp3_end;
          tmpMeta9 = MMC_CAR(tmp4_1);
          tmpMeta10 = MMC_CDR(tmp4_1);
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta9,19,2) == 0) goto tmp3_end;
          tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta9), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta11,6,2) == 0) goto tmp3_end;
          tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 3));
          if (!listEmpty(tmpMeta10)) goto tmp3_end;
          _old_exp = tmpMeta9;
          _state_cref = tmpMeta12;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NBVariable_getVarPointer(threadData, _state_cref, _OMC_LIT21);
          tmpMeta[0+1] = _old_exp;
          tmp1_c2 = 1 /* true */;
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          
          /* Pattern matching succeeded */
          tmpMeta14 = stringAppend(_OMC_LIT27,_context);
          tmpMeta15 = stringAppend(tmpMeta14,_OMC_LIT28);
          tmpMeta16 = stringAppend(tmpMeta15,omc_List_toString(threadData, _args, boxvar_NFExpression_toString, _OMC_LIT6, _OMC_LIT6, _OMC_LIT29, _OMC_LIT6, 1 /* true */, ((modelica_integer) 0)));
          tmpMeta17 = stringAppend(tmpMeta16,_OMC_LIT30);
          tmpMeta13 = mmc_mk_cons(tmpMeta17, MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addMessage(threadData, _OMC_LIT26, tmpMeta13);
          goto goto_2;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _state_var = tmpMeta[0+0];
  _old_exp = tmpMeta[0+1];
  _negated = tmp1_c2;

  _pre_cref = omc_NBDetectStates_getPreVar(threadData, _state_cref, _state_var, _acc_previous, _scalarized);

  if((!_scalarized))
  {
    _pre_cref = omc_NFComponentRef_copySubscripts(threadData, _state_cref, _pre_cref);
  }

  _new_exp = omc_NFExpression_fromCref(threadData, _pre_cref, 0 /* false */);

  if(_negated)
  {
    _new_exp = omc_NFExpression_logicNegate(threadData, _new_exp);
  }
  _return: OMC_LABEL_UNUSED
  if (out_old_exp) { *out_old_exp = _old_exp; }
  return _new_exp;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_preFromArgs(threadData_t *threadData, modelica_metatype _args, modelica_metatype _acc_previous, modelica_metatype _scalarized, modelica_metatype _context, modelica_metatype *out_old_exp)
{
  modelica_integer tmp1;
  modelica_metatype _new_exp = NULL;
  tmp1 = mmc_unbox_integer(_scalarized);
  _new_exp = omc_NBDetectStates_preFromArgs(threadData, _args, _acc_previous, tmp1, _context, out_old_exp);
  /* skip box _new_exp; NFExpression */
  /* skip box _old_exp; NFExpression */
  return _new_exp;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_collectPreAndPrevious(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_previous, modelica_metatype _acc_clocked_states, modelica_boolean _scalarized)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      modelica_metatype _fn = NULL;
      modelica_boolean _b;
      modelica_metatype _args = NULL;
      modelica_metatype _new_exp = NULL;
      modelica_metatype _old_exp = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _fn has no default value.
      // _b has no default value.
      // _args has no default value.
      // _new_exp has no default value.
      // _old_exp has no default value.
      tmp4 = 0;
      for (; tmp4 < 6; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_integer tmp12;
          modelica_metatype tmpMeta13;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,2,6) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 2));
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 6));
          if (listEmpty(tmpMeta8)) goto tmp3_end;
          tmpMeta9 = MMC_CAR(tmpMeta8);
          tmpMeta10 = MMC_CDR(tmpMeta8);
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta9,3,1) == 0) goto tmp3_end;
          tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta9), 2));
          tmp12 = mmc_unbox_integer(tmpMeta11);
          if (!listEmpty(tmpMeta10)) goto tmp3_end;
          
          _fn = tmpMeta7;
          _b = tmp12  /* pattern as ty=Boolean */;
          /* Pattern matching succeeded */
          { /* match expression */
            modelica_metatype tmp16_1;
            tmp16_1 = _fn;
            {
              volatile mmc_switch_type tmp16;
              int tmp17;
              tmp16 = 0;
              for (; tmp16 < 5; tmp16++) {
                switch (MMC_SWITCH_CAST(tmp16)) {
                case 0: {
                  modelica_metatype tmpMeta18;
                  modelica_metatype tmpMeta19;
                  modelica_metatype tmpMeta20;
                  if (mmc__uniontype__metarecord__typedef__equal(tmp16_1,0,13) == 0) goto tmp15_end;
                  tmpMeta18 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp16_1), 2));
                  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta18,1,1) == 0) goto tmp15_end;
                  tmpMeta19 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta18), 2));
                  if (8 != MMC_STRLEN(tmpMeta19) || strcmp(MMC_STRINGDATA(_OMC_LIT32), MMC_STRINGDATA(tmpMeta19)) != 0) goto tmp15_end;
                  
                  /* Pattern matching succeeded */
                  tmpMeta20 = mmc_mk_box2(6, &NFExpression_BOOLEAN__desc, mmc_mk_boolean(_b));
                  tmpMeta13 = tmpMeta20;
                  goto tmp15_done;
                }
                case 1: {
                  modelica_metatype tmpMeta21;
                  modelica_metatype tmpMeta22;
                  modelica_metatype tmpMeta23;
                  if (mmc__uniontype__metarecord__typedef__equal(tmp16_1,0,13) == 0) goto tmp15_end;
                  tmpMeta21 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp16_1), 2));
                  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta21,1,1) == 0) goto tmp15_end;
                  tmpMeta22 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta21), 2));
                  if (3 != MMC_STRLEN(tmpMeta22) || strcmp(MMC_STRINGDATA(_OMC_LIT33), MMC_STRINGDATA(tmpMeta22)) != 0) goto tmp15_end;
                  
                  /* Pattern matching succeeded */
                  tmpMeta23 = mmc_mk_box2(6, &NFExpression_BOOLEAN__desc, mmc_mk_boolean(_b));
                  tmpMeta13 = tmpMeta23;
                  goto tmp15_done;
                }
                case 2: {
                  modelica_metatype tmpMeta24;
                  modelica_metatype tmpMeta25;
                  if (mmc__uniontype__metarecord__typedef__equal(tmp16_1,0,13) == 0) goto tmp15_end;
                  tmpMeta24 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp16_1), 2));
                  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta24,1,1) == 0) goto tmp15_end;
                  tmpMeta25 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta24), 2));
                  if (4 != MMC_STRLEN(tmpMeta25) || strcmp(MMC_STRINGDATA(_OMC_LIT34), MMC_STRINGDATA(tmpMeta25)) != 0) goto tmp15_end;
                  
                  /* Pattern matching succeeded */
                  tmpMeta13 = _OMC_LIT31;
                  goto tmp15_done;
                }
                case 3: {
                  modelica_metatype tmpMeta26;
                  modelica_metatype tmpMeta27;
                  if (mmc__uniontype__metarecord__typedef__equal(tmp16_1,0,13) == 0) goto tmp15_end;
                  tmpMeta26 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp16_1), 2));
                  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta26,1,1) == 0) goto tmp15_end;
                  tmpMeta27 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta26), 2));
                  if (6 != MMC_STRLEN(tmpMeta27) || strcmp(MMC_STRINGDATA(_OMC_LIT35), MMC_STRINGDATA(tmpMeta27)) != 0) goto tmp15_end;
                  
                  /* Pattern matching succeeded */
                  tmpMeta13 = _OMC_LIT31;
                  goto tmp15_done;
                }
                case 4: {
                  
                  /* Pattern matching succeeded */
                  tmpMeta13 = _exp;
                  goto tmp15_done;
                }
                }
                goto tmp15_end;
                tmp15_end: ;
              }
              goto goto_14;
              goto_14:;
              goto goto_2;
              goto tmp15_done;
              tmp15_done:;
            }
          }tmpMeta1 = tmpMeta13;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta28;
          modelica_metatype tmpMeta29;
          modelica_metatype tmpMeta30;
          modelica_metatype tmpMeta31;
          modelica_metatype tmpMeta32;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          tmpMeta28 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta28,2,6) == 0) goto tmp3_end;
          tmpMeta29 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta28), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta29,0,13) == 0) goto tmp3_end;
          tmpMeta30 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta29), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta30,1,1) == 0) goto tmp3_end;
          tmpMeta31 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta30), 2));
          if (8 != MMC_STRLEN(tmpMeta31) || strcmp(MMC_STRINGDATA(_OMC_LIT32), MMC_STRINGDATA(tmpMeta31)) != 0) goto tmp3_end;
          tmpMeta32 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta28), 6));
          
          _args = tmpMeta32;
          /* Pattern matching succeeded */
          _new_exp = omc_NBDetectStates_preFromArgs(threadData, _args, _acc_previous, _scalarized, _OMC_LIT32 ,&_old_exp);

          { /* match expression */
            modelica_metatype tmp35_1;
            tmp35_1 = _old_exp;
            {
              volatile mmc_switch_type tmp35;
              int tmp36;
              tmp35 = 0;
              for (; tmp35 < 2; tmp35++) {
                switch (MMC_SWITCH_CAST(tmp35)) {
                case 0: {
                  modelica_metatype tmpMeta37;
                  if (mmc__uniontype__metarecord__typedef__equal(tmp35_1,6,2) == 0) goto tmp34_end;
                  
                  /* Pattern matching succeeded */
                  tmpMeta37 = mmc_mk_cons(omc_NBVariable_getVarPointer(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_old_exp), 3))), _OMC_LIT36), omc_Pointer_access(threadData, _acc_clocked_states));
                  omc_Pointer_update(threadData, _acc_clocked_states, tmpMeta37);
                  goto tmp34_done;
                }
                case 1: {
                  modelica_metatype tmpMeta38;
                  modelica_metatype tmpMeta39;
                  
                  /* Pattern matching succeeded */
                  tmpMeta39 = stringAppend(_OMC_LIT37,omc_NFExpression_toString(threadData, _old_exp));
                  tmpMeta38 = mmc_mk_cons(tmpMeta39, MMC_REFSTRUCTLIT(mmc_nil));
                  omc_Error_addMessage(threadData, _OMC_LIT26, tmpMeta38);
                  goto goto_33;
                  goto tmp34_done;
                }
                }
                goto tmp34_end;
                tmp34_end: ;
              }
              goto goto_33;
              goto_33:;
              goto goto_2;
              goto tmp34_done;
              tmp34_done:;
            }
          }
          ;
          tmpMeta1 = _new_exp;
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta40;
          modelica_metatype tmpMeta41;
          modelica_metatype tmpMeta42;
          modelica_metatype tmpMeta43;
          modelica_metatype tmpMeta44;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          tmpMeta40 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta40,2,6) == 0) goto tmp3_end;
          tmpMeta41 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta40), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta41,0,13) == 0) goto tmp3_end;
          tmpMeta42 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta41), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta42,1,1) == 0) goto tmp3_end;
          tmpMeta43 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta42), 2));
          if (3 != MMC_STRLEN(tmpMeta43) || strcmp(MMC_STRINGDATA(_OMC_LIT33), MMC_STRINGDATA(tmpMeta43)) != 0) goto tmp3_end;
          tmpMeta44 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta40), 6));
          
          _args = tmpMeta44;
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NBDetectStates_preFromArgs(threadData, _args, _acc_previous, _scalarized, _OMC_LIT33, NULL);
          goto tmp3_done;
        }
        case 3: {
          modelica_metatype tmpMeta45;
          modelica_metatype tmpMeta46;
          modelica_metatype tmpMeta47;
          modelica_metatype tmpMeta48;
          modelica_metatype tmpMeta49;
          modelica_metatype tmpMeta50;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          tmpMeta45 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta45,2,6) == 0) goto tmp3_end;
          tmpMeta46 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta45), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta46,0,13) == 0) goto tmp3_end;
          tmpMeta47 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta46), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta47,1,1) == 0) goto tmp3_end;
          tmpMeta48 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta47), 2));
          if (4 != MMC_STRLEN(tmpMeta48) || strcmp(MMC_STRINGDATA(_OMC_LIT34), MMC_STRINGDATA(tmpMeta48)) != 0) goto tmp3_end;
          tmpMeta49 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta45), 6));
          
          _args = tmpMeta49;
          /* Pattern matching succeeded */
          _new_exp = omc_NBDetectStates_preFromArgs(threadData, _args, _acc_previous, _scalarized, _OMC_LIT34 ,&_old_exp);
          tmpMeta50 = mmc_mk_box4(21, &NFExpression_LBINARY__desc, _old_exp, omc_NFOperator_makeAnd(threadData, omc_NFExpression_typeOf(threadData, _old_exp)), omc_NFExpression_logicNegate(threadData, _new_exp));
          tmpMeta1 = tmpMeta50;
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta51;
          modelica_metatype tmpMeta52;
          modelica_metatype tmpMeta53;
          modelica_metatype tmpMeta54;
          modelica_metatype tmpMeta55;
          modelica_metatype tmpMeta56;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          tmpMeta51 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta51,2,6) == 0) goto tmp3_end;
          tmpMeta52 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta51), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta52,0,13) == 0) goto tmp3_end;
          tmpMeta53 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta52), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta53,1,1) == 0) goto tmp3_end;
          tmpMeta54 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta53), 2));
          if (6 != MMC_STRLEN(tmpMeta54) || strcmp(MMC_STRINGDATA(_OMC_LIT35), MMC_STRINGDATA(tmpMeta54)) != 0) goto tmp3_end;
          tmpMeta55 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta51), 6));
          
          _args = tmpMeta55;
          /* Pattern matching succeeded */
          _new_exp = omc_NBDetectStates_preFromArgs(threadData, _args, _acc_previous, _scalarized, _OMC_LIT35 ,&_old_exp);
          tmpMeta56 = mmc_mk_box5(23, &NFExpression_RELATION__desc, _old_exp, omc_NFOperator_makeNotEqual(threadData, omc_NFExpression_typeOf(threadData, _old_exp)), _new_exp, mmc_mk_integer(((modelica_integer) -1)));
          tmpMeta1 = tmpMeta56;
          goto tmp3_done;
        }
        case 5: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_collectPreAndPrevious(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_previous, modelica_metatype _acc_clocked_states, modelica_metatype _scalarized)
{
  modelica_integer tmp1;
  modelica_metatype _exp = NULL;
  tmp1 = mmc_unbox_integer(_scalarized);
  _exp = omc_NBDetectStates_collectPreAndPrevious(threadData, __omcQ_24in_5Fexp, _acc_previous, _acc_clocked_states, tmp1);
  /* skip box _exp; NFExpression */
  return _exp;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_updateStatesAndDerivatives(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Funknowns, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fstates, modelica_metatype __omcQ_24in_5Fderivatives, modelica_metatype __omcQ_24in_5Falgebraics, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_metatype *out_unknowns, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_states, modelica_metatype *out_derivatives, modelica_metatype *out_algebraics)
{
  modelica_metatype _variables = NULL;
  modelica_metatype _unknowns = NULL;
  modelica_metatype _knowns = NULL;
  modelica_metatype _initials = NULL;
  modelica_metatype _states = NULL;
  modelica_metatype _derivatives = NULL;
  modelica_metatype _algebraics = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _variables = __omcQ_24in_5Fvariables;
  _unknowns = __omcQ_24in_5Funknowns;
  _knowns = __omcQ_24in_5Fknowns;
  _initials = __omcQ_24in_5Finitials;
  _states = __omcQ_24in_5Fstates;
  _derivatives = __omcQ_24in_5Fderivatives;
  _algebraics = __omcQ_24in_5Falgebraics;
  _variables = omc_NBVariable_VariablePointers_addList(threadData, _acc_derivatives, _variables);

  _unknowns = omc_NBVariable_VariablePointers_addList(threadData, _acc_derivatives, _unknowns);

  _initials = omc_NBVariable_VariablePointers_addList(threadData, _acc_derivatives, _initials);

  _derivatives = omc_NBVariable_VariablePointers_addList(threadData, _acc_derivatives, _derivatives);

  _variables = omc_NBVariable_VariablePointers_addList(threadData, _acc_states, _variables);

  _states = omc_NBVariable_VariablePointers_addList(threadData, _acc_states, _states);

  _unknowns = omc_NBVariable_VariablePointers_removeList(threadData, _acc_states, _unknowns);

  _algebraics = omc_NBVariable_VariablePointers_removeList(threadData, _acc_states, _algebraics);

  if(omc_Flags_isSet(threadData, _OMC_LIT14))
  {
    tmpMeta1 = stringAppend(_OMC_LIT38,intString(listLength(_acc_states)));
    tmpMeta2 = stringAppend(tmpMeta1,_OMC_LIT39);
    fputs(MMC_STRINGDATA(omc_StringUtil_headline__4(threadData, tmpMeta2)),stdout);

    if(listEmpty(_acc_states))
    {
      fputs(MMC_STRINGDATA(_OMC_LIT40),stdout);
    }
    else
    {
      tmpMeta3 = stringAppend(omc_List_toString(threadData, _acc_states, boxvar_NBVariable_pointerToString, _OMC_LIT6, _OMC_LIT7, _OMC_LIT8, _OMC_LIT9, 1 /* true */, ((modelica_integer) 0)),_OMC_LIT9);
      fputs(MMC_STRINGDATA(tmpMeta3),stdout);
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_unknowns) { *out_unknowns = _unknowns; }
  if (out_knowns) { *out_knowns = _knowns; }
  if (out_initials) { *out_initials = _initials; }
  if (out_states) { *out_states = _states; }
  if (out_derivatives) { *out_derivatives = _derivatives; }
  if (out_algebraics) { *out_algebraics = _algebraics; }
  return _variables;
}

PROTECTED_FUNCTION_STATIC modelica_integer omc_NBDetectStates_checkAlgebraic(threadData_t *threadData, modelica_metatype _exp, modelica_integer __omcQ_24in_5Fi)
{
  modelica_integer _i;
  modelica_integer tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _i = __omcQ_24in_5Fi;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!omc_NBVariable_isAlgebraic(threadData, omc_NBVariable_getVarPointer(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _OMC_LIT41))) goto tmp3_end;
          tmp1 = ((modelica_integer) 1) + _i;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = _i;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _i = tmp1;
  _return: OMC_LABEL_UNUSED
  return _i;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_checkAlgebraic(threadData_t *threadData, modelica_metatype _exp, modelica_metatype __omcQ_24in_5Fi)
{
  modelica_integer tmp1;
  modelica_integer _i;
  modelica_metatype out_i;
  tmp1 = mmc_unbox_integer(__omcQ_24in_5Fi);
  _i = omc_NBDetectStates_checkAlgebraic(threadData, _exp, tmp1);
  out_i = mmc_mk_icon(_i);
  return out_i;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_resolveGeneralDer(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_metatype _acc_aux_equations, modelica_metatype _uniqueIndex, modelica_metatype _diffArgs)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      modelica_metatype _state_cref = NULL;
      modelica_metatype _der_cref = NULL;
      modelica_metatype _state_var = NULL;
      modelica_metatype _der_var = NULL;
      modelica_metatype _arg = NULL;
      modelica_metatype _returnExp = NULL;
      modelica_metatype _aux_equation = NULL;
      modelica_metatype _oDiffArgs = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _state_cref has no default value.
      // _der_cref has no default value.
      // _state_var has no default value.
      // _der_var has no default value.
      // _arg has no default value.
      // _returnExp has no default value.
      // _aux_equation has no default value.
      // _oDiffArgs has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          modelica_metatype tmpMeta19;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,2,6) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,0,13) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta8,1,1) == 0) goto tmp3_end;
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta8), 2));
          if (3 != MMC_STRLEN(tmpMeta9) || strcmp(MMC_STRINGDATA(_OMC_LIT46), MMC_STRINGDATA(tmpMeta9)) != 0) goto tmp3_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 6));
          if (listEmpty(tmpMeta10)) goto tmp3_end;
          tmpMeta11 = MMC_CAR(tmpMeta10);
          tmpMeta12 = MMC_CDR(tmpMeta10);
          if (!listEmpty(tmpMeta12)) goto tmp3_end;
          
          _arg = tmpMeta11;
          /* Pattern matching succeeded */
          if((mmc_unbox_integer(omc_NFExpression_fold(threadData, _arg, boxvar_NBDetectStates_checkAlgebraic, mmc_mk_integer(((modelica_integer) 0)))) > ((modelica_integer) 1)))
          {
            _state_var = omc_NBVariable_makeAuxStateVar(threadData, mmc_unbox_integer(omc_Pointer_access(threadData, _uniqueIndex)), mmc_mk_some(_arg) ,&_state_cref ,&_der_var ,&_der_cref);

            _aux_equation = omc_NBEquation_Equation_makeAssignment(threadData, omc_NFExpression_fromCref(threadData, _state_cref, 0 /* false */), _arg, _uniqueIndex, _OMC_LIT44, _OMC_LIT45, omc_NBEquation_default(threadData, 1, 0 /* false */, mmc_mk_none()));

            _returnExp = omc_NFExpression_fromCref(threadData, _der_cref, 0 /* false */);

            tmpMeta13 = mmc_mk_cons(_state_var, omc_Pointer_access(threadData, _acc_states));
            omc_Pointer_update(threadData, _acc_states, tmpMeta13);

            tmpMeta14 = mmc_mk_cons(_der_var, omc_Pointer_access(threadData, _acc_derivatives));
            omc_Pointer_update(threadData, _acc_derivatives, tmpMeta14);

            tmpMeta15 = mmc_mk_cons(_aux_equation, omc_Pointer_access(threadData, _acc_aux_equations));
            omc_Pointer_update(threadData, _acc_aux_equations, tmpMeta15);
          }
          else
          {
            _returnExp = omc_NBDifferentiate_differentiateExpression(threadData, _arg, _diffArgs ,&_oDiffArgs);

            _returnExp = omc_NFSimplifyExp_simplifyDump(threadData, _returnExp, 1 /* true */, _OMC_LIT42, _OMC_LIT6);

            if(omc_List_hasOneElement(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_oDiffArgs), 3)))))
            {
              _der_var = listHead((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_oDiffArgs), 3))));

              tmpMeta16 = mmc_mk_cons(_der_var, omc_Pointer_access(threadData, _acc_derivatives));
              omc_Pointer_update(threadData, _acc_derivatives, tmpMeta16);

              tmpMeta17 = mmc_mk_cons(omc_Util_getOption(threadData, omc_NBVariable_getVarState(threadData, _der_var, NULL)), omc_Pointer_access(threadData, _acc_states));
              omc_Pointer_update(threadData, _acc_states, tmpMeta17);
            }
            else
            {
              if(omc_List_hasSeveralElements(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_oDiffArgs), 3)))))
              {
                tmpMeta19 = stringAppend(_OMC_LIT43,intString(listLength((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_oDiffArgs), 3))))));
                tmpMeta18 = mmc_mk_cons(tmpMeta19, MMC_REFSTRUCTLIT(mmc_nil));
                omc_Error_addMessage(threadData, _OMC_LIT26, tmpMeta18);

                goto goto_2;
              }
            }
          }
          tmpMeta1 = _returnExp;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_collectStatesAndDerivatives(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_boolean _scalarized)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      modelica_metatype _res = NULL;
      modelica_metatype _state_cref = NULL;
      modelica_metatype _der_cref = NULL;
      modelica_metatype _state_var = NULL;
      modelica_metatype _der_var = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _res has no default value.
      // _state_cref has no default value.
      // _der_cref has no default value.
      // _state_var has no default value.
      // _der_var has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,2,6) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,0,13) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta8,1,1) == 0) goto tmp3_end;
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta8), 2));
          if (3 != MMC_STRLEN(tmpMeta9) || strcmp(MMC_STRINGDATA(_OMC_LIT46), MMC_STRINGDATA(tmpMeta9)) != 0) goto tmp3_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 6));
          if (listEmpty(tmpMeta10)) goto tmp3_end;
          tmpMeta11 = MMC_CAR(tmpMeta10);
          tmpMeta12 = MMC_CDR(tmpMeta10);
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta11,6,2) == 0) goto tmp3_end;
          tmpMeta13 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 3));
          if (!listEmpty(tmpMeta12)) goto tmp3_end;
          
          _state_cref = tmpMeta13;
          /* Pattern matching succeeded */
          _state_var = omc_NBVariable_getVarPointer(threadData, _state_cref, _OMC_LIT47);

          if((!omc_NBVariable_isContinuous(threadData, _state_var, 0 /* false */)))
          {
            _res = omc_NFExpression_makeZero(threadData, omc_NFComponentRef_getSubscriptedType(threadData, _state_cref, 0 /* false */));
          }
          else
          {
            if(omc_NBVariable_hasDerVar(threadData, _state_var))
            {
              _der_cref = omc_NBVariable_getPartnerCref(threadData, _state_cref, boxvar_NBVariable_getVarDer, _scalarized);
            }
            else
            {
              _der_cref = omc_NBVariable_makeDerVar(threadData, _state_cref, _scalarized ,&_der_var);

              _state_var = omc_NBVariable_getVarPointer(threadData, _state_cref, _OMC_LIT48);

              omc_NBVariable_setStateDerivativeVar(threadData, _state_var, _der_var);

              tmpMeta14 = mmc_mk_cons(_state_var, omc_Pointer_access(threadData, _acc_states));
              omc_Pointer_update(threadData, _acc_states, tmpMeta14);

              tmpMeta15 = mmc_mk_cons(_der_var, omc_Pointer_access(threadData, _acc_derivatives));
              omc_Pointer_update(threadData, _acc_derivatives, tmpMeta15);
            }

            _res = omc_NFExpression_fromCref(threadData, _der_cref, 0 /* false */);
          }
          tmpMeta1 = _res;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NBDetectStates_collectStatesAndDerivatives(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _acc_states, modelica_metatype _acc_derivatives, modelica_metatype _scalarized)
{
  modelica_integer tmp1;
  modelica_metatype _exp = NULL;
  tmp1 = mmc_unbox_integer(_scalarized);
  _exp = omc_NBDetectStates_collectStatesAndDerivatives(threadData, __omcQ_24in_5Fexp, _acc_states, _acc_derivatives, tmp1);
  /* skip box _exp; NFExpression */
  return _exp;
}

static modelica_metatype closure0_NBDetectStates_collectDiscreteStatesFromWhen(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_eqn)
{
  modelica_metatype acc_discrete_states = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc_previous = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype scalarized = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  return boxptr_NBDetectStates_collectDiscreteStatesFromWhen(thData, $in_eqn, acc_discrete_states, acc_previous, scalarized);
}static modelica_metatype closure1_NBDetectStates_collectPreAndPrevious(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype acc_previous = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc_clocked_states = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype scalarized = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  return boxptr_NBDetectStates_collectPreAndPrevious(thData, $in_exp, acc_previous, acc_clocked_states, scalarized);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_detectDiscreteStatesDefault(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fdiscretes, modelica_metatype __omcQ_24in_5Fdiscrete_5Fstates, modelica_metatype __omcQ_24in_5Fclocked_5Fstates, modelica_metatype __omcQ_24in_5Fprevious, modelica_string _context, modelica_metatype *out_equations, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_discretes, modelica_metatype *out_discrete_states, modelica_metatype *out_clocked_states, modelica_metatype *out_previous)
{
  modelica_metatype _variables = NULL;
  modelica_metatype _equations = NULL;
  modelica_metatype _knowns = NULL;
  modelica_metatype _initials = NULL;
  modelica_metatype _discretes = NULL;
  modelica_metatype _discrete_states = NULL;
  modelica_metatype _clocked_states = NULL;
  modelica_metatype _previous = NULL;
  modelica_metatype _acc_discrete_states = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _acc_clocked_states = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _acc_previous = NULL;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _variables = __omcQ_24in_5Fvariables;
  _equations = __omcQ_24in_5Fequations;
  _knowns = __omcQ_24in_5Fknowns;
  _initials = __omcQ_24in_5Finitials;
  _discretes = __omcQ_24in_5Fdiscretes;
  _discrete_states = __omcQ_24in_5Fdiscrete_5Fstates;
  _clocked_states = __omcQ_24in_5Fclocked_5Fstates;
  _previous = __omcQ_24in_5Fprevious;
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _acc_discrete_states = omc_Pointer_create(threadData, tmpMeta1);
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _acc_clocked_states = omc_Pointer_create(threadData, tmpMeta2);
  tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
  _acc_previous = omc_Pointer_create(threadData, tmpMeta3);
  tmpMeta4 = mmc_mk_box3(0, _acc_discrete_states, _acc_previous, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variables), 4))));
  omc_NBEquation_EquationPointers_map(threadData, _equations, (modelica_fnptr) mmc_mk_box2(0,closure0_NBDetectStates_collectDiscreteStatesFromWhen,tmpMeta4));

  tmpMeta5 = mmc_mk_box3(0, _acc_previous, _acc_clocked_states, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variables), 4))));
  omc_NBEquation_EquationPointers_mapExp(threadData, _equations, (modelica_fnptr) mmc_mk_box2(0,closure1_NBDetectStates_collectPreAndPrevious,tmpMeta5), mmc_mk_none());

  _variables = omc_NBDetectStates_updateDiscreteStatesAndPrevious(threadData, _variables, _knowns, _initials, _discretes, _discrete_states, _clocked_states, _previous, omc_Pointer_access(threadData, _acc_discrete_states), omc_Pointer_access(threadData, _acc_clocked_states), omc_Pointer_access(threadData, _acc_previous), _context ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous);
  _return: OMC_LABEL_UNUSED
  if (out_equations) { *out_equations = _equations; }
  if (out_knowns) { *out_knowns = _knowns; }
  if (out_initials) { *out_initials = _initials; }
  if (out_discretes) { *out_discretes = _discretes; }
  if (out_discrete_states) { *out_discrete_states = _discrete_states; }
  if (out_clocked_states) { *out_clocked_states = _clocked_states; }
  if (out_previous) { *out_previous = _previous; }
  return _variables;
}

static modelica_metatype closure2_NBDetectStates_collectStatesAndDerivatives(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype acc_states = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc_derivatives = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype scalarized = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  return boxptr_NBDetectStates_collectStatesAndDerivatives(thData, $in_exp, acc_states, acc_derivatives, scalarized);
}static modelica_metatype closure3_NBDetectStates_resolveGeneralDer(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype acc_states = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype acc_derivatives = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype acc_aux_equations = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  modelica_metatype uniqueIndex = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),4));
  modelica_metatype diffArgs = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),5));
  return boxptr_NBDetectStates_resolveGeneralDer(thData, $in_exp, acc_states, acc_derivatives, acc_aux_equations, uniqueIndex, diffArgs);
}static modelica_metatype closure4_NBEquation_Equation_pointerToString(threadData_t *thData, modelica_metatype closure, modelica_metatype eqn_ptr)
{
  modelica_string $in_str = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NBEquation_Equation_pointerToString(thData, eqn_ptr, $in_str);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_detectContinuousStatesDefault(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariables, modelica_metatype __omcQ_24in_5Funknowns, modelica_metatype __omcQ_24in_5Fknowns, modelica_metatype __omcQ_24in_5Finitials, modelica_metatype __omcQ_24in_5Fstates, modelica_metatype __omcQ_24in_5Fderivatives, modelica_metatype __omcQ_24in_5Falgebraics, modelica_metatype _equations, modelica_metatype *out_unknowns, modelica_metatype *out_knowns, modelica_metatype *out_initials, modelica_metatype *out_states, modelica_metatype *out_derivatives, modelica_metatype *out_algebraics, modelica_metatype *out_aux_eqns)
{
  modelica_metatype _variables = NULL;
  modelica_metatype _unknowns = NULL;
  modelica_metatype _knowns = NULL;
  modelica_metatype _initials = NULL;
  modelica_metatype _states = NULL;
  modelica_metatype _derivatives = NULL;
  modelica_metatype _algebraics = NULL;
  modelica_metatype _aux_eqns = NULL;
  modelica_metatype _acc_states = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _acc_derivatives = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _acc_aux_equations = NULL;
  modelica_metatype tmpMeta3;
  modelica_metatype _uniqueIndex = NULL;
  modelica_metatype _diffArgs = NULL;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _variables = __omcQ_24in_5Fvariables;
  _unknowns = __omcQ_24in_5Funknowns;
  _knowns = __omcQ_24in_5Fknowns;
  _initials = __omcQ_24in_5Finitials;
  _states = __omcQ_24in_5Fstates;
  _derivatives = __omcQ_24in_5Fderivatives;
  _algebraics = __omcQ_24in_5Falgebraics;
  // _aux_eqns has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _acc_states = omc_Pointer_create(threadData, tmpMeta1);
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _acc_derivatives = omc_Pointer_create(threadData, tmpMeta2);
  tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
  _acc_aux_equations = omc_Pointer_create(threadData, tmpMeta3);
  _uniqueIndex = omc_Pointer_create(threadData, mmc_mk_integer(((modelica_integer) 0)));
  _diffArgs = omc_NBDifferentiate_DifferentiationArguments_default(threadData, 1, _OMC_LIT49);
  tmpMeta4 = mmc_mk_box3(0, _acc_states, _acc_derivatives, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variables), 4))));
  omc_NBEquation_EquationPointers_mapExp(threadData, _equations, (modelica_fnptr) mmc_mk_box2(0,closure2_NBDetectStates_collectStatesAndDerivatives,tmpMeta4), mmc_mk_none());

  tmpMeta5 = mmc_mk_box5(0, _acc_states, _acc_derivatives, _acc_aux_equations, _uniqueIndex, _diffArgs);
  omc_NBEquation_EquationPointers_mapExp(threadData, _equations, (modelica_fnptr) mmc_mk_box2(0,closure3_NBDetectStates_resolveGeneralDer,tmpMeta5), mmc_mk_none());

  _variables = omc_NBDetectStates_updateStatesAndDerivatives(threadData, _variables, _unknowns, _knowns, _initials, _states, _derivatives, _algebraics, omc_Pointer_access(threadData, _acc_states), omc_Pointer_access(threadData, _acc_derivatives) ,&_unknowns ,&_knowns ,&_initials ,&_states ,&_derivatives ,&_algebraics);

  _aux_eqns = omc_Pointer_access(threadData, _acc_aux_equations);

  if((omc_Flags_isSet(threadData, _OMC_LIT14) && (!listEmpty(_aux_eqns))))
  {
    tmpMeta6 = stringAppend(_OMC_LIT38,intString(listLength(_aux_eqns)));
    tmpMeta7 = stringAppend(tmpMeta6,_OMC_LIT50);
    fputs(MMC_STRINGDATA(omc_StringUtil_headline__4(threadData, tmpMeta7)),stdout);

    tmpMeta8 = mmc_mk_box1(0, _OMC_LIT6);
    tmpMeta9 = stringAppend(omc_List_toString(threadData, _aux_eqns, (modelica_fnptr) mmc_mk_box2(0,closure4_NBEquation_Equation_pointerToString,tmpMeta8), _OMC_LIT6, _OMC_LIT7, _OMC_LIT8, _OMC_LIT9, 1 /* true */, ((modelica_integer) 0)),_OMC_LIT9);
    fputs(MMC_STRINGDATA(tmpMeta9),stdout);
  }
  _return: OMC_LABEL_UNUSED
  if (out_unknowns) { *out_unknowns = _unknowns; }
  if (out_knowns) { *out_knowns = _knowns; }
  if (out_initials) { *out_initials = _initials; }
  if (out_states) { *out_states = _states; }
  if (out_derivatives) { *out_derivatives = _derivatives; }
  if (out_algebraics) { *out_algebraics = _algebraics; }
  if (out_aux_eqns) { *out_aux_eqns = _aux_eqns; }
  return _variables;
}

static modelica_metatype closure5_NBDetectStates_stateOrder(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_eqn)
{
  modelica_metatype state_order = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NBDetectStates_stateOrder(thData, $in_eqn, state_order);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NBDetectStates_detectStatesDefault(threadData_t *threadData, modelica_metatype __omcQ_24in_5FvarData, modelica_metatype __omcQ_24in_5FeqData, modelica_fnptr _continuousFunc, modelica_fnptr _discreteFunc, modelica_metatype *out_eqData)
{
  modelica_metatype _varData = NULL;
  modelica_metatype _eqData = NULL;
  modelica_metatype _variables = NULL;
  modelica_metatype _equations = NULL;
  modelica_metatype _disc_eqns = NULL;
  modelica_metatype _init_eqns = NULL;
  modelica_metatype _unknowns = NULL;
  modelica_metatype _knowns = NULL;
  modelica_metatype _initials = NULL;
  modelica_metatype _states = NULL;
  modelica_metatype _derivatives = NULL;
  modelica_metatype _algebraics = NULL;
  modelica_metatype _discretes = NULL;
  modelica_metatype _discrete_states = NULL;
  modelica_metatype _clocked_states = NULL;
  modelica_metatype _previous = NULL;
  modelica_metatype _aux_eqns = NULL;
  modelica_metatype _newEqData = NULL;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _varData = __omcQ_24in_5FvarData;
  _eqData = __omcQ_24in_5FeqData;
  // _variables has no default value.
  // _equations has no default value.
  // _disc_eqns has no default value.
  // _init_eqns has no default value.
  // _unknowns has no default value.
  // _knowns has no default value.
  // _initials has no default value.
  // _states has no default value.
  // _derivatives has no default value.
  // _algebraics has no default value.
  // _discretes has no default value.
  // _discrete_states has no default value.
  // _clocked_states has no default value.
  // _previous has no default value.
  // _aux_eqns has no default value.
  // _newEqData has no default value.
  
  
  { /* match expression */
    modelica_metatype tmp4_1;modelica_metatype tmp4_2;
    tmp4_1 = _varData;
    tmp4_2 = _eqData;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          modelica_metatype tmpMeta19;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,23) == 0) goto tmp3_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,0,9) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          _variables = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_continuousFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_continuousFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_continuousFunc), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 16))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 9))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 10))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 3))) ,&_unknowns ,&_knowns ,&_initials ,&_states ,&_derivatives ,&_algebraics ,&_aux_eqns) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_continuousFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 16))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 9))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 10))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 3))) ,&_unknowns ,&_knowns ,&_initials ,&_states ,&_derivatives ,&_algebraics ,&_aux_eqns);

          _variables = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 7))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 11))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 12))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 13))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 14))), _OMC_LIT51 ,&_disc_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 7))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 11))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 12))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 13))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 14))), _OMC_LIT51 ,&_disc_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous);

          _variables = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))), _variables, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 6))), _knowns, _initials, _discretes, _discrete_states, _clocked_states, _previous, _OMC_LIT52 ,&_disc_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, _variables, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 6))), _knowns, _initials, _discretes, _discrete_states, _clocked_states, _previous, _OMC_LIT52 ,&_disc_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous);

          _variables = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))), _variables, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 5))), _knowns, _initials, _discretes, _discrete_states, _clocked_states, _previous, _OMC_LIT53 ,&_disc_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, _variables, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 5))), _knowns, _initials, _discretes, _discrete_states, _clocked_states, _previous, _OMC_LIT53 ,&_disc_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous);

          _variables = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 2))), _variables, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 8))), _knowns, _initials, _discretes, _discrete_states, _clocked_states, _previous, _OMC_LIT54 ,&_init_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_string, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_discreteFunc), 1)))) (threadData, _variables, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eqData), 8))), _knowns, _initials, _discretes, _discrete_states, _clocked_states, _previous, _OMC_LIT54 ,&_init_eqns ,&_knowns ,&_initials ,&_discretes ,&_discrete_states ,&_clocked_states ,&_previous);

          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[2] = _variables;
          _varData = tmpMeta6;

          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[3] = _unknowns;
          _varData = tmpMeta7;

          tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[4] = _knowns;
          _varData = tmpMeta8;

          tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[5] = _initials;
          _varData = tmpMeta9;

          tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[9] = _derivatives;
          _varData = tmpMeta10;

          tmpMeta11 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta11), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta11))[10] = _algebraics;
          _varData = tmpMeta11;

          tmpMeta12 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta12), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta12))[11] = _discretes;
          _varData = tmpMeta12;

          tmpMeta13 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta13), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta13))[12] = _discrete_states;
          _varData = tmpMeta13;

          tmpMeta14 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta14), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta14))[13] = _clocked_states;
          _varData = tmpMeta14;

          tmpMeta15 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta15), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta15))[14] = _previous;
          _varData = tmpMeta15;

          tmpMeta16 = MMC_TAGPTR(mmc_alloc_words(25));
          memcpy(MMC_UNTAGPTR(tmpMeta16), MMC_UNTAGPTR(_varData), 25*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta16))[16] = _states;
          _varData = tmpMeta16;

          _newEqData = omc_NBEquation_EqData_addTypedList(threadData, _eqData, _aux_eqns, 1, 0 /* false */);

          tmpMeta17 = mmc_mk_box1(0, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 24))));
          omc_NBEquation_EquationPointers_map(threadData, omc_NBEquation_EqData_getEquations(threadData, _newEqData), (modelica_fnptr) mmc_mk_box2(0,closure5_NBDetectStates_stateOrder,tmpMeta17));

          if((omc_Flags_isSet(threadData, _OMC_LIT14) && (!omc_UnorderedMap_isEmpty(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 24)))))))
          {
            fputs(MMC_STRINGDATA(omc_StringUtil_headline__4(threadData, _OMC_LIT55)),stdout);

            tmpMeta18 = stringAppend(_OMC_LIT7,omc_UnorderedMap_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_varData), 24))), boxvar_NFComponentRef_toString, boxvar_NFComponentRef_toString, _OMC_LIT8, _OMC_LIT56));
            tmpMeta19 = stringAppend(tmpMeta18,_OMC_LIT57);
            fputs(MMC_STRINGDATA(tmpMeta19),stdout);
          }
          tmpMeta[0+0] = _varData;
          tmpMeta[0+1] = _newEqData;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _varData;
          tmpMeta[0+1] = _eqData;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _varData = tmpMeta[0+0];
  _eqData = tmpMeta[0+1];
  _return: OMC_LABEL_UNUSED
  if (out_eqData) { *out_eqData = _eqData; }
  return _varData;
}

DLLDirection
modelica_fnptr omc_NBDetectStates_getModule(threadData_t *threadData, modelica_fnptr *out_contFunc, modelica_fnptr *out_discFunc)
{
  modelica_fnptr _mainFunc;
  modelica_fnptr _contFunc;
  modelica_fnptr _discFunc;
  modelica_string _flag = NULL;
  modelica_fnptr tmp1_c0 __attribute__((unused)) = 0;
  modelica_fnptr tmp1_c1 __attribute__((unused)) = 0;
  modelica_fnptr tmp1_c2 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flag = _OMC_LIT58;
  
  
  
  { /* match expression */
    modelica_string tmp4_1;
    tmp4_1 = _flag;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 1; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (7 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT58), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmp1_c0 = boxvar_NBDetectStates_detectStatesDefault;
          tmp1_c1 = boxvar_NBDetectStates_detectContinuousStatesDefault;
          tmp1_c2 = boxvar_NBDetectStates_detectDiscreteStatesDefault;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _mainFunc = tmp1_c0;
  _contFunc = tmp1_c1;
  _discFunc = tmp1_c2;
  _return: OMC_LABEL_UNUSED
  if (out_contFunc) { *out_contFunc = (modelica_fnptr)_contFunc; }
  if (out_discFunc) { *out_discFunc = (modelica_fnptr)_discFunc; }
  return _mainFunc;
}

DLLDirection
modelica_metatype omc_NBDetectStates_main(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbdae)
{
  modelica_metatype _bdae = NULL;
  modelica_fnptr _mainFunc;
  modelica_fnptr _contFunc;
  modelica_fnptr _discFunc;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _bdae = __omcQ_24in_5Fbdae;
  _mainFunc = omc_NBDetectStates_getModule(threadData ,&_contFunc ,&_discFunc);

  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _bdae;
    {
      modelica_metatype _varData = NULL;
      modelica_metatype _eqData = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _varData has no default value.
      // _eqData has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,13) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 10));
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 11));
          
          _varData = tmpMeta6;
          _eqData = tmpMeta7;
          /* Pattern matching succeeded */
          _varData = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mainFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_fnptr, modelica_fnptr, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mainFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mainFunc), 2))), _varData, _eqData, ((modelica_fnptr) _contFunc), ((modelica_fnptr) _discFunc) ,&_eqData) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_fnptr, modelica_fnptr, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mainFunc), 1)))) (threadData, _varData, _eqData, ((modelica_fnptr) _contFunc), ((modelica_fnptr) _discFunc) ,&_eqData);

          tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(15));
          memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_bdae), 15*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[10] = _varData;
          _bdae = tmpMeta8;

          tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(15));
          memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_bdae), 15*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[11] = _eqData;
          _bdae = tmpMeta9;
          tmpMeta1 = _bdae;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          omc_Error_addMessage(threadData, _OMC_LIT26, _OMC_LIT60);
          goto goto_2;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _bdae = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _bdae;
}

