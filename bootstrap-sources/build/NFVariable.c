#include "omc_simulation_settings.h"
#include "NFVariable.h"
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT0,1,11) {&NFInstNode_InstNode_EMPTY__NODE__desc,}};
#define _OMC_LIT0 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT0)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT1,1,3) {&DAE_Prefix_NOPRE__desc,}};
#define _OMC_LIT1 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT1)
#define _OMC_LIT2_data ""
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT2,0,_OMC_LIT2_data);
#define _OMC_LIT2 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT2)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT3,1,11) {&DAE_Type_T__UNKNOWN__desc,}};
#define _OMC_LIT3 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT3)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT4,4,4) {&DAE_ComponentRef_CREF__IDENT__desc,_OMC_LIT2,_OMC_LIT3,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT4 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT4)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT5,2,0) {_OMC_LIT4,_OMC_LIT4}};
#define _OMC_LIT5 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT5)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT6,1,3) {&NFBinding_UNBOUND__desc,}};
#define _OMC_LIT6 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data "NFVariable.toFlatStreamModifier"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,31,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT8,1,4) {&IOStream_IOStreamType_LIST__desc,}};
#define _OMC_LIT8 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT8)
#define _OMC_LIT9_data ", "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT9,2,_OMC_LIT9_data);
#define _OMC_LIT9 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,1,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
#define _OMC_LIT11_data ")"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT11,1,_OMC_LIT11_data);
#define _OMC_LIT11 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT11)
#define _OMC_LIT12_data " = "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT12,3,_OMC_LIT12_data);
#define _OMC_LIT12 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT12)
#define _OMC_LIT13_data ") "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT13,2,_OMC_LIT13_data);
#define _OMC_LIT13 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT13)
#define _OMC_LIT14_data " "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT14,1,_OMC_LIT14_data);
#define _OMC_LIT14 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT14)
#define _OMC_LIT15_data "protected "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT15,10,_OMC_LIT15_data);
#define _OMC_LIT15 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT15)
#define _OMC_LIT16_data "each "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT16,5,_OMC_LIT16_data);
#define _OMC_LIT16 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT16)
#define _OMC_LIT17_data "NFVariable.toString"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT17,19,_OMC_LIT17_data);
#define _OMC_LIT17 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT17)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT18,0.0);
#define _OMC_LIT18 MMC_REFREALLIT(_OMC_LIT_STRUCT18)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT19,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT2,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),_OMC_LIT18}};
#define _OMC_LIT19 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT19)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT20,4,3) {&NFCeval_EvalTarget_EVAL__TARGET__desc,_OMC_LIT19,MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT20 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT20)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT21,1,4) {&SCode_Final_NOT__FINAL__desc,}};
#define _OMC_LIT21 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT21)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT22,1,4) {&SCode_Each_NOT__EACH__desc,}};
#define _OMC_LIT22 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT22)
#define _OMC_LIT23_data "/home/adrpo33/OpenModelica/OMCompiler/Compiler/NFFrontEnd/NFVariable.mo"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT23,71,_OMC_LIT23_data);
#define _OMC_LIT23 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT23)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT24_6,1.758197185e9);
#define _OMC_LIT24_6 MMC_REFREALLIT(_OMC_LIT_STRUCT24_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT24,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT23,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(445)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(451)),MMC_IMMEDIATE(MMC_TAGFIXNUM(39)),_OMC_LIT24_6}};
#define _OMC_LIT24 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT24)
#define _OMC_LIT25_data ".moc"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT25,4,_OMC_LIT25_data);
#define _OMC_LIT25 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT25)
#define _OMC_LIT26_data "NFVariable.expand failed to expand "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT26,35,_OMC_LIT26_data);
#define _OMC_LIT26 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT26)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT27_6,1.758197185e9);
#define _OMC_LIT27_6 MMC_REFREALLIT(_OMC_LIT_STRUCT27_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT27,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT23,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(182)),MMC_IMMEDIATE(MMC_TAGFIXNUM(13)),MMC_IMMEDIATE(MMC_TAGFIXNUM(183)),MMC_IMMEDIATE(MMC_TAGFIXNUM(61)),_OMC_LIT27_6}};
#define _OMC_LIT27 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT27)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT28,1,35) {&NFBackendExtension_VariableKind_FRONTEND__DUMMY__desc,}};
#define _OMC_LIT28 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT28)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT29,17,3) {&NFBackendExtension_VariableAttributes_VAR__ATTR__REAL__desc,MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT29 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT29)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT30,3,3) {&NFBackendExtension_Annotations_ANNOTATIONS__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT30 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT30)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT31,8,3) {&NFBackendExtension_BackendInfo_BACKEND__INFO__desc,_OMC_LIT28,_OMC_LIT29,_OMC_LIT30,MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT31 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT31)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT32,1,16) {&NFBackendExtension_VariableKind_ITERATOR__desc,}};
#define _OMC_LIT32 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT32)
#include "util/modelica.h"

#include "NFVariable_includes.h"



DLLDirection
modelica_metatype omc_NFVariable_getNominal(threadData_t *threadData, modelica_metatype _var)
{
  modelica_metatype _nominal = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _nominal = omc_NFBackendExtension_VariableAttributes_getNominal(threadData, omc_NFVariable_getVariableAttributes(threadData, _var));
  _return: OMC_LABEL_UNUSED
  return _nominal;
}

DLLDirection
modelica_metatype omc_NFVariable_getVariableAttributes(threadData_t *threadData, modelica_metatype _var)
{
  modelica_metatype _variableAttributes = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _variableAttributes = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 11)))), 3)));
  _return: OMC_LABEL_UNUSED
  return _variableAttributes;
}

DLLDirection
modelica_metatype omc_NFVariable_moveBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype *out_equations)
{
  modelica_metatype _var = NULL;
  modelica_metatype _equations = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  _equations = __omcQ_24in_5Fequations;
  if(((omc_NFVariable_variability(threadData, _var) >= 5) && omc_NFBinding_isBound(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))))))
  {
    tmpMeta1 = mmc_mk_cons(omc_NFEquation_makeEquality(threadData, omc_NFExpression_fromCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))), 0 /* false */), omc_NFBinding_getExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4)))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _OMC_LIT0, omc_ElementSource_createElementSource(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 10))), mmc_mk_none(), _OMC_LIT1, _OMC_LIT5)), _equations);
    _equations = tmpMeta1;

    tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(12));
    memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[4] = _OMC_LIT6;
    _var = tmpMeta2;
  }
  _return: OMC_LABEL_UNUSED
  if (out_equations) { *out_equations = _equations; }
  return _var;
}

DLLDirection
modelica_metatype omc_NFVariable_toFlatStreamModifier(threadData_t *threadData, modelica_metatype _children, modelica_boolean _overwrittenBinding, modelica_boolean _printBindingType, modelica_metatype _format, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_metatype _s = NULL;
  modelica_boolean _empty;
  modelica_boolean _overwritten_binding;
  modelica_metatype _ss = NULL;
  modelica_integer _src;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _s = __omcQ_24in_5Fs;
  _empty = 1 /* true */;
  // _overwritten_binding has no default value.
  // _ss has no default value.
  // _src has no default value.
  {
    modelica_metatype _child;
    for (tmpMeta1 = _children; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _child = MMC_CAR(tmpMeta1);
      _ss = omc_IOStream_create(threadData, _OMC_LIT7, _OMC_LIT8);

      if((!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 7))))))
      {
        _ss = omc_NFComponent_typeAttrsToFlatStream(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 7))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 3))), _format, _ss);
      }
      else
      {
        if((!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 8))))))
        {
          _overwritten_binding = (_overwrittenBinding || omc_NFBinding_isBound(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 4)))));

          _ss = omc_NFVariable_toFlatStreamModifier(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 8))), _overwritten_binding, _printBindingType, _format, _ss);
        }
      }

      if((!_overwrittenBinding))
      {
        _src = omc_NFBinding_source(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 4))));

        if((((modelica_integer)_src == 3) || ((modelica_integer)_src == 4)))
        {
          _ss = omc_NFVariable_toFlatStreamBinding(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 4))), _printBindingType, _format, _ss);
        }
      }

      if((!omc_IOStream_empty(threadData, _ss)))
      {
        if(_empty)
        {
          _s = omc_IOStream_append(threadData, _s, _OMC_LIT10);

          _empty = 0 /* false */;
        }
        else
        {
          _s = omc_IOStream_append(threadData, _s, _OMC_LIT9);
        }

        _s = omc_IOStream_append(threadData, _s, omc_Util_makeQuotedIdentifier(threadData, omc_NFComponentRef_firstName(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 2))), 0 /* false */)));

        _s = omc_IOStream_appendListStream(threadData, _ss, _s);
      }
    }
  }

  if((!_empty))
  {
    _s = omc_IOStream_append(threadData, _s, _OMC_LIT11);
  }
  _return: OMC_LABEL_UNUSED
  return _s;
}
modelica_metatype boxptr_NFVariable_toFlatStreamModifier(threadData_t *threadData, modelica_metatype _children, modelica_metatype _overwrittenBinding, modelica_metatype _printBindingType, modelica_metatype _format, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_metatype _s = NULL;
  tmp1 = mmc_unbox_integer(_overwrittenBinding);
  tmp2 = mmc_unbox_integer(_printBindingType);
  _s = omc_NFVariable_toFlatStreamModifier(threadData, _children, tmp1, tmp2, _format, __omcQ_24in_5Fs);
  /* skip box _s; IOStream.IOStream */
  return _s;
}

DLLDirection
modelica_metatype omc_NFVariable_toFlatStreamBinding(threadData_t *threadData, modelica_metatype _binding, modelica_boolean _printBindingType, modelica_metatype _format, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_metatype _s = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _s = __omcQ_24in_5Fs;
  if(omc_NFBinding_isBound(threadData, _binding))
  {
    _s = omc_IOStream_append(threadData, _s, _OMC_LIT12);

    if(_printBindingType)
    {
      _s = omc_IOStream_append(threadData, _s, _OMC_LIT10);

      _s = omc_IOStream_append(threadData, _s, omc_NFType_toFlatString(threadData, omc_NFBinding_getType(threadData, _binding), _format));

      _s = omc_IOStream_append(threadData, _s, _OMC_LIT13);
    }

    _s = omc_IOStream_append(threadData, _s, omc_NFBinding_toFlatString(threadData, _binding, _format, _OMC_LIT2));
  }
  _return: OMC_LABEL_UNUSED
  return _s;
}
modelica_metatype boxptr_NFVariable_toFlatStreamBinding(threadData_t *threadData, modelica_metatype _binding, modelica_metatype _printBindingType, modelica_metatype _format, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_integer tmp1;
  modelica_metatype _s = NULL;
  tmp1 = mmc_unbox_integer(_printBindingType);
  _s = omc_NFVariable_toFlatStreamBinding(threadData, _binding, tmp1, _format, __omcQ_24in_5Fs);
  /* skip box _s; IOStream.IOStream */
  return _s;
}

DLLDirection
modelica_metatype omc_NFVariable_toFlatStream(threadData_t *threadData, modelica_metatype _var, modelica_metatype _format, modelica_string _indent, modelica_boolean _printBindingType, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_metatype _s = NULL;
  modelica_boolean _first;
  modelica_metatype _b = NULL;
  modelica_integer _var_dims;
  modelica_integer _binding_dims;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _s = __omcQ_24in_5Fs;
  // _first has no default value.
  // _b has no default value.
  // _var_dims has no default value.
  // _binding_dims has no default value.
  _s = omc_IOStream_append(threadData, _s, _indent);

  _s = omc_NFAttributes_toFlatStream(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 6))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _s, omc_NFComponentRef_isSimple(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))));

  _s = omc_IOStream_append(threadData, _s, omc_NFType_toFlatString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _format));

  _s = omc_IOStream_append(threadData, _s, _OMC_LIT14);

  _s = omc_IOStream_append(threadData, _s, omc_NFComponentRef_toFlatString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))), _format));

  if((!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7))))))
  {
    _s = omc_NFComponent_typeAttrsToFlatStream(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _format, _s);
  }
  else
  {
    if((!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 8))))))
    {
      _s = omc_NFVariable_toFlatStreamModifier(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 8))), (mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_format), 4)))) || omc_NFBinding_isBound(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))))), _printBindingType, _format, _s);
    }
  }

  _s = omc_NFVariable_toFlatStreamBinding(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))), _printBindingType, _format, _s);

  _s = omc_NFFlatModelicaUtil_appendComment(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 9))), 4, _s);
  _return: OMC_LABEL_UNUSED
  return _s;
}
modelica_metatype boxptr_NFVariable_toFlatStream(threadData_t *threadData, modelica_metatype _var, modelica_metatype _format, modelica_metatype _indent, modelica_metatype _printBindingType, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_integer tmp1;
  modelica_metatype _s = NULL;
  tmp1 = mmc_unbox_integer(_printBindingType);
  _s = omc_NFVariable_toFlatStream(threadData, _var, _format, _indent, tmp1, __omcQ_24in_5Fs);
  /* skip box _s; IOStream.IOStream */
  return _s;
}

DLLDirection
modelica_metatype omc_NFVariable_toStream(threadData_t *threadData, modelica_metatype _var, modelica_string _indent, modelica_boolean _printBindingType, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_metatype _s = NULL;
  modelica_boolean _first;
  modelica_metatype _b = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _s = __omcQ_24in_5Fs;
  // _first has no default value.
  // _b has no default value.
  _s = omc_IOStream_append(threadData, _s, _indent);

  if((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 5)))) == 2))
  {
    _s = omc_IOStream_append(threadData, _s, _OMC_LIT15);
  }

  _s = omc_IOStream_append(threadData, _s, omc_NFAttributes_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 6))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3)))));

  _s = omc_IOStream_append(threadData, _s, omc_NFType_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3)))));

  _s = omc_IOStream_append(threadData, _s, _OMC_LIT14);

  _s = omc_IOStream_append(threadData, _s, omc_NFComponentRef_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))));

  if((!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7))))))
  {
    _s = omc_IOStream_append(threadData, _s, _OMC_LIT10);

    _first = 1 /* true */;

    {
      modelica_metatype _a;
      for (tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7))); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
      {
        _a = MMC_CAR(tmpMeta1);
        if(_first)
        {
          _first = 0 /* false */;
        }
        else
        {
          _s = omc_IOStream_append(threadData, _s, _OMC_LIT9);
        }

        _b = omc_Util_tuple22(threadData, _a);

        if(omc_NFBinding_isEach(threadData, _b))
        {
          _s = omc_IOStream_append(threadData, _s, _OMC_LIT16);
        }

        _s = omc_IOStream_append(threadData, _s, omc_Util_tuple21(threadData, _a));

        _s = omc_IOStream_append(threadData, _s, _OMC_LIT12);

        _s = omc_IOStream_append(threadData, _s, omc_NFBinding_toString(threadData, _b, _OMC_LIT2));
      }
    }

    _s = omc_IOStream_append(threadData, _s, _OMC_LIT11);
  }

  if(omc_NFBinding_isBound(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4)))))
  {
    _s = omc_IOStream_append(threadData, _s, _OMC_LIT12);

    if(_printBindingType)
    {
      _s = omc_IOStream_append(threadData, _s, _OMC_LIT10);

      _s = omc_IOStream_append(threadData, _s, omc_NFType_toString(threadData, omc_NFBinding_getType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))))));

      _s = omc_IOStream_append(threadData, _s, _OMC_LIT13);
    }

    _s = omc_IOStream_append(threadData, _s, omc_NFBinding_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))), _OMC_LIT2));
  }
  _return: OMC_LABEL_UNUSED
  return _s;
}
modelica_metatype boxptr_NFVariable_toStream(threadData_t *threadData, modelica_metatype _var, modelica_metatype _indent, modelica_metatype _printBindingType, modelica_metatype __omcQ_24in_5Fs)
{
  modelica_integer tmp1;
  modelica_metatype _s = NULL;
  tmp1 = mmc_unbox_integer(_printBindingType);
  _s = omc_NFVariable_toStream(threadData, _var, _indent, tmp1, __omcQ_24in_5Fs);
  /* skip box _s; IOStream.IOStream */
  return _s;
}

DLLDirection
modelica_string omc_NFVariable_toString(threadData_t *threadData, modelica_metatype _var, modelica_string _indent, modelica_boolean _printBindingType)
{
  modelica_string _str = NULL;
  modelica_metatype _s = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _str has no default value.
  // _s has no default value.
  _s = omc_IOStream_create(threadData, _OMC_LIT17, _OMC_LIT8);

  _s = omc_NFVariable_toStream(threadData, _var, _indent, _printBindingType, _s);

  _str = omc_IOStream_string(threadData, _s);

  omc_IOStream_delete(threadData, _s);
  _return: OMC_LABEL_UNUSED
  return _str;
}
modelica_metatype boxptr_NFVariable_toString(threadData_t *threadData, modelica_metatype _var, modelica_metatype _indent, modelica_metatype _printBindingType)
{
  modelica_integer tmp1;
  modelica_string _str = NULL;
  tmp1 = mmc_unbox_integer(_printBindingType);
  _str = omc_NFVariable_toString(threadData, _var, _indent, tmp1);
  /* skip box _str; String */
  return _str;
}

DLLDirection
modelica_metatype omc_NFVariable_mapExpShallow(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_fnptr _fn)
{
  modelica_metatype _var = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[4] = omc_NFBinding_mapExpShallow(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))), ((modelica_fnptr) _fn));
  _var = tmpMeta1;

  {
    modelica_metatype __omcQ_24tmpVar1;
    modelica_metatype* tmp4;
    modelica_metatype tmpMeta5;
    modelica_metatype tmpMeta6;
    modelica_metatype __omcQ_24tmpVar0;
    modelica_integer tmp7;
    modelica_metatype _a_loopVar = 0;
    modelica_metatype _a;
    _a_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7)));
    tmpMeta5 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar1 = tmpMeta5; /* defaultValue */
    tmp4 = &__omcQ_24tmpVar1;
    while(1) {
      tmp7 = 1;
      if (!listEmpty(_a_loopVar)) {
        _a = MMC_CAR(_a_loopVar);
        _a_loopVar = MMC_CDR(_a_loopVar);
        tmp7--;
      }
      if (tmp7 == 0) {
        tmpMeta6 = mmc_mk_box2(0, omc_Util_tuple21(threadData, _a), omc_NFBinding_mapExpShallow(threadData, omc_Util_tuple22(threadData, _a), ((modelica_fnptr) _fn)));
        __omcQ_24tmpVar0 = tmpMeta6;
        *tmp4 = mmc_mk_cons(__omcQ_24tmpVar0,0);
        tmp4 = &MMC_CDR(*tmp4);
      } else if (tmp7 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp4 = mmc_mk_nil();
    tmpMeta3 = __omcQ_24tmpVar1;
  }
  tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[7] = tmpMeta3;
  _var = tmpMeta2;

  {
    modelica_metatype __omcQ_24tmpVar3;
    modelica_metatype* tmp10;
    modelica_metatype tmpMeta11;
    modelica_metatype __omcQ_24tmpVar2;
    modelica_integer tmp12;
    modelica_metatype _v_loopVar = 0;
    modelica_metatype _v;
    _v_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 8)));
    tmpMeta11 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar3 = tmpMeta11; /* defaultValue */
    tmp10 = &__omcQ_24tmpVar3;
    while(1) {
      tmp12 = 1;
      if (!listEmpty(_v_loopVar)) {
        _v = MMC_CAR(_v_loopVar);
        _v_loopVar = MMC_CDR(_v_loopVar);
        tmp12--;
      }
      if (tmp12 == 0) {
        __omcQ_24tmpVar2 = omc_NFVariable_mapExpShallow(threadData, _v, ((modelica_fnptr) _fn));
        *tmp10 = mmc_mk_cons(__omcQ_24tmpVar2,0);
        tmp10 = &MMC_CDR(*tmp10);
      } else if (tmp12 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp10 = mmc_mk_nil();
    tmpMeta9 = __omcQ_24tmpVar3;
  }
  tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[8] = tmpMeta9;
  _var = tmpMeta8;
  _return: OMC_LABEL_UNUSED
  return _var;
}

static modelica_metatype closure0_NFDimension_mapExp(threadData_t *thData, modelica_metatype closure, modelica_metatype dim)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFDimension_mapExp(thData, dim, func);
}static modelica_metatype closure2_NFDimension_mapExp(threadData_t *thData, modelica_metatype closure, modelica_metatype dim)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFDimension_mapExp(thData, dim, func);
}static modelica_metatype closure1_NFType_applyToDims(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_ty)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFType_applyToDims(thData, $in_ty, func);
}
DLLDirection
modelica_metatype omc_NFVariable_mapExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_fnptr _fn)
{
  modelica_metatype _var = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[4] = omc_NFBinding_mapExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))), ((modelica_fnptr) _fn));
  _var = tmpMeta1;

  {
    modelica_metatype __omcQ_24tmpVar5;
    modelica_metatype* tmp4;
    modelica_metatype tmpMeta5;
    modelica_metatype tmpMeta6;
    modelica_metatype __omcQ_24tmpVar4;
    modelica_integer tmp7;
    modelica_metatype _a_loopVar = 0;
    modelica_metatype _a;
    _a_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7)));
    tmpMeta5 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar5 = tmpMeta5; /* defaultValue */
    tmp4 = &__omcQ_24tmpVar5;
    while(1) {
      tmp7 = 1;
      if (!listEmpty(_a_loopVar)) {
        _a = MMC_CAR(_a_loopVar);
        _a_loopVar = MMC_CDR(_a_loopVar);
        tmp7--;
      }
      if (tmp7 == 0) {
        tmpMeta6 = mmc_mk_box2(0, omc_Util_tuple21(threadData, _a), omc_NFBinding_mapExp(threadData, omc_Util_tuple22(threadData, _a), ((modelica_fnptr) _fn)));
        __omcQ_24tmpVar4 = tmpMeta6;
        *tmp4 = mmc_mk_cons(__omcQ_24tmpVar4,0);
        tmp4 = &MMC_CDR(*tmp4);
      } else if (tmp7 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp4 = mmc_mk_nil();
    tmpMeta3 = __omcQ_24tmpVar5;
  }
  tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[7] = tmpMeta3;
  _var = tmpMeta2;

  {
    modelica_metatype __omcQ_24tmpVar7;
    modelica_metatype* tmp10;
    modelica_metatype tmpMeta11;
    modelica_metatype __omcQ_24tmpVar6;
    modelica_integer tmp12;
    modelica_metatype _v_loopVar = 0;
    modelica_metatype _v;
    _v_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 8)));
    tmpMeta11 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar7 = tmpMeta11; /* defaultValue */
    tmp10 = &__omcQ_24tmpVar7;
    while(1) {
      tmp12 = 1;
      if (!listEmpty(_v_loopVar)) {
        _v = MMC_CAR(_v_loopVar);
        _v_loopVar = MMC_CDR(_v_loopVar);
        tmp12--;
      }
      if (tmp12 == 0) {
        __omcQ_24tmpVar6 = omc_NFVariable_mapExp(threadData, _v, ((modelica_fnptr) _fn));
        *tmp10 = mmc_mk_cons(__omcQ_24tmpVar6,0);
        tmp10 = &MMC_CDR(*tmp10);
      } else if (tmp12 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp10 = mmc_mk_nil();
    tmpMeta9 = __omcQ_24tmpVar7;
  }
  tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[8] = tmpMeta9;
  _var = tmpMeta8;

  tmpMeta13 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta13), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta13))[11] = omc_NFBackendExtension_BackendInfo_map(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 11))), ((modelica_fnptr) _fn));
  _var = tmpMeta13;

  tmpMeta15 = mmc_mk_box1(0, ((modelica_fnptr) _fn));
  tmpMeta14 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta14), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta14))[3] = omc_NFType_applyToDims(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), (modelica_fnptr) mmc_mk_box2(0,closure0_NFDimension_mapExp,tmpMeta15));
  _var = tmpMeta14;

  tmpMeta18 = mmc_mk_box1(0, ((modelica_fnptr) _fn));
  tmpMeta17 = mmc_mk_box1(0, (modelica_fnptr) mmc_mk_box2(0,closure2_NFDimension_mapExp,tmpMeta18));
  tmpMeta16 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta16), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta16))[2] = omc_NFComponentRef_mapTypes(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))), (modelica_fnptr) mmc_mk_box2(0,closure1_NFType_applyToDims,tmpMeta17));
  _var = tmpMeta16;
  _return: OMC_LABEL_UNUSED
  return _var;
}

DLLDirection
modelica_metatype omc_NFVariable_removeNonTopLevelDirection(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar)
{
  modelica_metatype _var = NULL;
  modelica_metatype _rest_name = NULL;
  modelica_metatype _node = NULL;
  modelica_metatype _attr = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  // _rest_name has no default value.
  // _node has no default value.
  // _attr has no default value.
  if((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 6)))), 5)))) == 1))
  {
    goto _return;
  }

  _rest_name = omc_NFComponentRef_rest(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))));

  while(1)
  {
    if(!(!omc_NFComponentRef_isEmpty(threadData, _rest_name))) break;
    _node = omc_NFComponentRef_node(threadData, _rest_name);

    if((!(omc_NFInstNode_InstNode_isConnector(threadData, _node) || omc_NFInstNode_InstNode_isInput(threadData, _node))))
    {
      _attr = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 6)));

      tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(11));
      memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_attr), 11*sizeof(modelica_metatype));
      ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[5] = mmc_mk_integer(1);
      _attr = tmpMeta1;

      tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(12));
      memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
      ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[6] = _attr;
      _var = tmpMeta2;

      goto _return;
    }

    _rest_name = omc_NFComponentRef_rest(threadData, _rest_name);
  }
  _return: OMC_LABEL_UNUSED
  return _var;
}

DLLDirection
modelica_metatype omc_NFVariable_propagateAnnotation(threadData_t *threadData, modelica_string _name, modelica_boolean _overwrite, modelica_boolean _evaluate, modelica_metatype __omcQ_24in_5Fvar)
{
  modelica_metatype _var = NULL;
  modelica_metatype _node = NULL;
  modelica_metatype _mod = NULL;
  modelica_metatype _aexp = NULL;
  modelica_metatype _exp = NULL;
  modelica_metatype _anno = NULL;
  modelica_metatype _scope = NULL;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  // _node has no default value.
  // _mod has no default value.
  // _aexp has no default value.
  // _exp has no default value.
  // _anno has no default value.
  // _scope has no default value.
  if(omc_NFComponentRef_isCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))))
  {
    _node = omc_NFComponentRef_node(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))));

    if((_overwrite && omc_NFInstNode_InstNode_isComponent(threadData, _node)))
    {
      _node = omc_NFInstNode_InstNode_parent(threadData, _node);
    }

    _mod = omc_NFInstNode_InstNode_getAnnotation(threadData, _name, _node ,&_scope);

    if((!omc_SCodeUtil_isEmptyMod(threadData, _mod)))
    {
      if(_evaluate)
      {
        { /* matchcontinue expression */
          volatile modelica_metatype tmp3_1;
          tmp3_1 = _mod;
          {
            volatile mmc_switch_type tmp3;
            int tmp4;
            tmp3 = 0;
            MMC_TRY_INTERNAL(mmc_jumper)
            tmp2_top:
            threadData->mmc_jumper = &new_mmc_jumper;
            for (; tmp3 < 2; tmp3++) {
              switch (MMC_SWITCH_CAST(tmp3)) {
              case 0: {
                modelica_metatype tmpMeta5;
                modelica_metatype tmpMeta6;
                modelica_metatype tmpMeta7;
                if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,6) == 0) goto tmp2_end;
                tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 5));
                if (optionNone(tmpMeta5)) goto tmp2_end;
                tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 1));
                
                _aexp = tmpMeta6;
                /* Pattern matching succeeded */
                _exp = omc_NFInst_instExp(threadData, _aexp, _scope, ((modelica_integer) 67108864), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 7))));

                _exp = omc_NFTyping_typeExp(threadData, _exp, ((modelica_integer) 67108864), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 7))), 0 /* false */, NULL, NULL, NULL);

                _exp = omc_NFCeval_evalExp(threadData, _exp, _OMC_LIT20);

                tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(8));
                memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_mod), 8*sizeof(modelica_metatype));
                ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[5] = mmc_mk_some(omc_NFExpression_toAbsyn(threadData, _exp));
                _mod = tmpMeta7;
                goto tmp2_done;
              }
              case 1: {
                
                /* Pattern matching succeeded */
                goto tmp2_done;
              }
              }
              goto tmp2_end;
              tmp2_end: ;
            }
            goto goto_1;
            tmp2_done:
            (void)tmp3;
            MMC_RESTORE_INTERNAL(mmc_jumper);
            goto tmp2_done2;
            goto_1:;
            MMC_CATCH_INTERNAL(mmc_jumper);
            if (++tmp3 < 2) {
              goto tmp2_top;
            }
            MMC_THROW_INTERNAL();
            tmp2_done2:;
          }
        }
        ;
      }

      tmpMeta9 = mmc_mk_box3(3, &SCode_SubMod_NAMEMOD__desc, _name, _mod);
      tmpMeta8 = mmc_mk_cons(tmpMeta9, MMC_REFSTRUCTLIT(mmc_nil));
      tmpMeta10 = mmc_mk_box7(3, &SCode_Mod_MOD__desc, _OMC_LIT21, _OMC_LIT22, tmpMeta8, mmc_mk_none(), mmc_mk_none(), _OMC_LIT24);
      tmpMeta11 = mmc_mk_box2(3, &SCode_Annotation_ANNOTATION__desc, tmpMeta10);
      _anno = tmpMeta11;

      tmpMeta12 = MMC_TAGPTR(mmc_alloc_words(12));
      memcpy(MMC_UNTAGPTR(tmpMeta12), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
      ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta12))[9] = omc_SCodeUtil_appendAnnotationToComment(threadData, _anno, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 9))), 1 /* true */);
      _var = tmpMeta12;
    }
  }
  _return: OMC_LABEL_UNUSED
  return _var;
}
modelica_metatype boxptr_NFVariable_propagateAnnotation(threadData_t *threadData, modelica_metatype _name, modelica_metatype _overwrite, modelica_metatype _evaluate, modelica_metatype __omcQ_24in_5Fvar)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_metatype _var = NULL;
  tmp1 = mmc_unbox_integer(_overwrite);
  tmp2 = mmc_unbox_integer(_evaluate);
  _var = omc_NFVariable_propagateAnnotation(threadData, _name, tmp1, tmp2, __omcQ_24in_5Fvar);
  /* skip box _var; NFVariable */
  return _var;
}

DLLDirection
modelica_metatype omc_NFVariable_applyToType(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_fnptr _func)
{
  modelica_metatype _var = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[3] = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3)))) : ((modelica_metatype(*)(threadData_t*, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))));
  _var = tmpMeta1;

  tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[2] = omc_NFComponentRef_applyToType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))), ((modelica_fnptr) _func));
  _var = tmpMeta2;
  _return: OMC_LABEL_UNUSED
  return _var;
}

DLLDirection
modelica_metatype omc_NFVariable_lookupTypeAttribute(threadData_t *threadData, modelica_string _name, modelica_metatype _var)
{
  modelica_metatype _binding = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _binding has no default value.
  {
    modelica_metatype _attr;
    for (tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7))); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _attr = MMC_CAR(tmpMeta1);
      if((stringEqual(omc_Util_tuple21(threadData, _attr), _name)))
      {
        _binding = omc_Util_tuple22(threadData, _attr);

        goto _return;
      }
    }
  }

  _binding = _OMC_LIT6;
  _return: OMC_LABEL_UNUSED
  return _binding;
}

DLLDirection
modelica_boolean omc_NFVariable_isAccessible(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isAccessible;
  modelica_metatype _oaccess = NULL;
  modelica_integer _access;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_integer tmp3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _isAccessible has no default value.
  // _oaccess has no default value.
  // _access has no default value.
  _oaccess = omc_NFInstNode_InstNode_getAccessLevel(threadData, omc_NFComponentRef_node(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 2)))));

  if(isSome(_oaccess))
  {
    /* Pattern-matching assignment */
    tmpMeta1 = _oaccess;
    if (optionNone(tmpMeta1)) MMC_THROW_INTERNAL();
    tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
    tmp3 = mmc_unbox_integer(tmpMeta2);
    _access = tmp3  /* pattern as ty=enumeration(HIDE, ICON, DOCUMENTATION, DIAGRAM, NON_PACKAGE_TEXT, NON_PACKAGE_DUPLICATE, PACKAGE_TEXT, PACKAGE_DUPLICATE) */;
  }
  else
  {
    _access = (omc_NFVariable_isEncrypted(threadData, _variable)?3:8);
  }

  if(((modelica_integer)_access < 2))
  {
    _isAccessible = 0 /* false */;
  }
  else
  {
    if(((modelica_integer)_access < 5))
    {
      _isAccessible = (!omc_NFVariable_isProtected(threadData, _variable));
    }
    else
    {
      _isAccessible = 1 /* true */;
    }
  }
  _return: OMC_LABEL_UNUSED
  return _isAccessible;
}
modelica_metatype boxptr_NFVariable_isAccessible(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isAccessible;
  modelica_metatype out_isAccessible;
  _isAccessible = omc_NFVariable_isAccessible(threadData, _variable);
  out_isAccessible = mmc_mk_icon(_isAccessible);
  return out_isAccessible;
}

DLLDirection
modelica_boolean omc_NFVariable_isEncrypted(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isEncrypted;
  modelica_metatype _name = NULL;
  modelica_metatype _info = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _isEncrypted has no default value.
  // _name has no default value.
  // _info has no default value.
  _name = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 2)));

  while(1)
  {
    if(!omc_NFComponentRef_isCref(threadData, _name)) break;
    _info = omc_NFInstNode_InstNode_info(threadData, omc_NFComponentRef_node(threadData, _name));

    if(omc_StringUtil_endsWith(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_info), 2))), _OMC_LIT25))
    {
      _isEncrypted = 1 /* true */;

      goto _return;
    }

    _name = omc_NFComponentRef_rest(threadData, _name);
  }

  _isEncrypted = 0 /* false */;
  _return: OMC_LABEL_UNUSED
  return _isEncrypted;
}
modelica_metatype boxptr_NFVariable_isEncrypted(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isEncrypted;
  modelica_metatype out_isEncrypted;
  _isEncrypted = omc_NFVariable_isEncrypted(threadData, _variable);
  out_isEncrypted = mmc_mk_icon(_isEncrypted);
  return out_isEncrypted;
}

DLLDirection
modelica_boolean omc_NFVariable_isProtected(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isProtected;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _isProtected = (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 5)))) == 2);
  _return: OMC_LABEL_UNUSED
  return _isProtected;
}
modelica_metatype boxptr_NFVariable_isProtected(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isProtected;
  modelica_metatype out_isProtected;
  _isProtected = omc_NFVariable_isProtected(threadData, _variable);
  out_isProtected = mmc_mk_icon(_isProtected);
  return out_isProtected;
}

DLLDirection
modelica_boolean omc_NFVariable_isPublic(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isPublic;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _isPublic = (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 5)))) == 1);
  _return: OMC_LABEL_UNUSED
  return _isPublic;
}
modelica_metatype boxptr_NFVariable_isPublic(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isPublic;
  modelica_metatype out_isPublic;
  _isPublic = omc_NFVariable_isPublic(threadData, _variable);
  out_isPublic = mmc_mk_icon(_isPublic);
  return out_isPublic;
}

DLLDirection
modelica_boolean omc_NFVariable_isTopLevelInput(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _topInput;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _topInput = (omc_NFComponentRef_isTopLevel(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 2)))) && (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 5)))) == 2));
  _return: OMC_LABEL_UNUSED
  return _topInput;
}
modelica_metatype boxptr_NFVariable_isTopLevelInput(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _topInput;
  modelica_metatype out_topInput;
  _topInput = omc_NFVariable_isTopLevelInput(threadData, _variable);
  out_topInput = mmc_mk_icon(_topInput);
  return out_topInput;
}

DLLDirection
modelica_boolean omc_NFVariable_isInput(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _b;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _b = (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 5)))) == 2);
  _return: OMC_LABEL_UNUSED
  return _b;
}
modelica_metatype boxptr_NFVariable_isInput(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NFVariable_isInput(threadData, _variable);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

DLLDirection
modelica_boolean omc_NFVariable_isStream(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _potential;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _potential = omc_NFPrefixes_ConnectorType_isStream(threadData, mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 2)))));
  _return: OMC_LABEL_UNUSED
  return _potential;
}
modelica_metatype boxptr_NFVariable_isStream(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _potential;
  modelica_metatype out_potential;
  _potential = omc_NFVariable_isStream(threadData, _variable);
  out_potential = mmc_mk_icon(_potential);
  return out_potential;
}

DLLDirection
modelica_boolean omc_NFVariable_isFlow(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _potential;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _potential = omc_NFPrefixes_ConnectorType_isFlow(threadData, mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 2)))));
  _return: OMC_LABEL_UNUSED
  return _potential;
}
modelica_metatype boxptr_NFVariable_isFlow(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _potential;
  modelica_metatype out_potential;
  _potential = omc_NFVariable_isFlow(threadData, _variable);
  out_potential = mmc_mk_icon(_potential);
  return out_potential;
}

DLLDirection
modelica_boolean omc_NFVariable_isPotential(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _potential;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _potential = omc_NFPrefixes_ConnectorType_isPotential(threadData, mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 2)))));
  _return: OMC_LABEL_UNUSED
  return _potential;
}
modelica_metatype boxptr_NFVariable_isPotential(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _potential;
  modelica_metatype out_potential;
  _potential = omc_NFVariable_isPotential(threadData, _variable);
  out_potential = mmc_mk_icon(_potential);
  return out_potential;
}

DLLDirection
modelica_boolean omc_NFVariable_isPresent(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _present;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _present = (!omc_NFPrefixes_ConnectorType_isPotentiallyPresent(threadData, mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 2))))));
  _return: OMC_LABEL_UNUSED
  return _present;
}
modelica_metatype boxptr_NFVariable_isPresent(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _present;
  modelica_metatype out_present;
  _present = omc_NFVariable_isPresent(threadData, _variable);
  out_present = mmc_mk_icon(_present);
  return out_present;
}

DLLDirection
modelica_boolean omc_NFVariable_isDeleted(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _deleted;
  modelica_metatype _node = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _deleted has no default value.
  // _node has no default value.
  _node = omc_NFComponentRef_node(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 2))));

  _deleted = (omc_NFInstNode_InstNode_isComponent(threadData, _node) && omc_NFComponent_isDeleted(threadData, omc_NFInstNode_InstNode_component(threadData, _node)));
  _return: OMC_LABEL_UNUSED
  return _deleted;
}
modelica_metatype boxptr_NFVariable_isDeleted(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _deleted;
  modelica_metatype out_deleted;
  _deleted = omc_NFVariable_isDeleted(threadData, _variable);
  out_deleted = mmc_mk_icon(_deleted);
  return out_deleted;
}

DLLDirection
modelica_boolean omc_NFVariable_isEmptyArray(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isEmpty;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _isEmpty = omc_NFType_isEmptyArray(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 3))));
  _return: OMC_LABEL_UNUSED
  return _isEmpty;
}
modelica_metatype boxptr_NFVariable_isEmptyArray(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _isEmpty;
  modelica_metatype out_isEmpty;
  _isEmpty = omc_NFVariable_isEmptyArray(threadData, _variable);
  out_isEmpty = mmc_mk_icon(_isEmpty);
  return out_isEmpty;
}

DLLDirection
modelica_boolean omc_NFVariable_isStructural(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _structural;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _structural = (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 4)))) <= 2);
  _return: OMC_LABEL_UNUSED
  return _structural;
}
modelica_metatype boxptr_NFVariable_isStructural(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_boolean _structural;
  modelica_metatype out_structural;
  _structural = omc_NFVariable_isStructural(threadData, _variable);
  out_structural = mmc_mk_icon(_structural);
  return out_structural;
}

DLLDirection
modelica_boolean omc_NFVariable_isComplexArray(threadData_t *threadData, modelica_metatype _var)
{
  modelica_boolean _b;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _b = omc_NFType_isComplexArray(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))));
  _return: OMC_LABEL_UNUSED
  return _b;
}
modelica_metatype boxptr_NFVariable_isComplexArray(threadData_t *threadData, modelica_metatype _var)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NFVariable_isComplexArray(threadData, _var);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

DLLDirection
modelica_boolean omc_NFVariable_isComplex(threadData_t *threadData, modelica_metatype _var)
{
  modelica_boolean _b;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _b = omc_NFType_isComplex(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))));
  _return: OMC_LABEL_UNUSED
  return _b;
}
modelica_metatype boxptr_NFVariable_isComplex(threadData_t *threadData, modelica_metatype _var)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NFVariable_isComplex(threadData, _var);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

DLLDirection
modelica_integer omc_NFVariable_visibility(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_integer _visibility;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _visibility = mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 5))));
  _return: OMC_LABEL_UNUSED
  return _visibility;
}
modelica_metatype boxptr_NFVariable_visibility(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_integer _visibility;
  modelica_metatype out_visibility;
  _visibility = omc_NFVariable_visibility(threadData, _variable);
  out_visibility = mmc_mk_icon(_visibility);
  return out_visibility;
}

DLLDirection
modelica_metatype omc_NFVariable_setVariability(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariable, modelica_integer _variability)
{
  modelica_metatype _variable = NULL;
  modelica_metatype _attr = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _variable = __omcQ_24in_5Fvariable;
  // _attr has no default value.
  _attr = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)));

  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(11));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_attr), 11*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[4] = mmc_mk_integer((modelica_integer)_variability);
  _attr = tmpMeta1;

  tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_variable), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[6] = _attr;
  _variable = tmpMeta2;
  _return: OMC_LABEL_UNUSED
  return _variable;
}
modelica_metatype boxptr_NFVariable_setVariability(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvariable, modelica_metatype _variability)
{
  modelica_integer tmp1;
  modelica_metatype _variable = NULL;
  tmp1 = mmc_unbox_integer(_variability);
  _variable = omc_NFVariable_setVariability(threadData, __omcQ_24in_5Fvariable, tmp1);
  /* skip box _variable; NFVariable */
  return _variable;
}

DLLDirection
modelica_integer omc_NFVariable_variability(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_integer _variability;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _variability = mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)))), 4))));
  _return: OMC_LABEL_UNUSED
  return _variability;
}
modelica_metatype boxptr_NFVariable_variability(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_integer _variability;
  modelica_metatype out_variability;
  _variability = omc_NFVariable_variability(threadData, _variable);
  out_variability = mmc_mk_icon(_variability);
  return out_variability;
}

DLLDirection
modelica_metatype omc_NFVariable_attributes(threadData_t *threadData, modelica_metatype _variable)
{
  modelica_metatype _attributes = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _attributes = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)));
  _return: OMC_LABEL_UNUSED
  return _attributes;
}

DLLDirection
modelica_metatype omc_NFVariable_typeOf(threadData_t *threadData, modelica_metatype _var)
{
  modelica_metatype _ty = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _ty = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3)));
  _return: OMC_LABEL_UNUSED
  return _ty;
}

DLLDirection
modelica_metatype omc_NFVariable_expandChildren(threadData_t *threadData, modelica_metatype _var, modelica_metatype _arrayDims, modelica_boolean _addDimensions)
{
  modelica_metatype _children = NULL;
  modelica_metatype _newArrayDims = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _children has no default value.
  // _newArrayDims has no default value.
  if((_addDimensions && (!listEmpty(_arrayDims))))
  {
    tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(12));
    memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[3] = omc_NFType_liftArrayLeftList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _arrayDims);
    _var = tmpMeta1;
  }

  _newArrayDims = omc_NFType_arrayDims(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))));

  {
    modelica_metatype __omcQ_24tmpVar9;
    modelica_metatype* tmp4;
    modelica_metatype tmpMeta5;
    modelica_metatype __omcQ_24tmpVar8;
    modelica_integer tmp6;
    modelica_metatype _v_loopVar = 0;
    modelica_metatype _v;
    _v_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 8)));
    tmpMeta5 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar9 = tmpMeta5; /* defaultValue */
    tmp4 = &__omcQ_24tmpVar9;
    while(1) {
      tmp6 = 1;
      if (!listEmpty(_v_loopVar)) {
        _v = MMC_CAR(_v_loopVar);
        _v_loopVar = MMC_CDR(_v_loopVar);
        tmp6--;
      }
      if (tmp6 == 0) {
        __omcQ_24tmpVar8 = omc_NFVariable_expandChildren(threadData, _v, _newArrayDims, _addDimensions);
        *tmp4 = mmc_mk_cons(__omcQ_24tmpVar8,0);
        tmp4 = &MMC_CDR(*tmp4);
      } else if (tmp6 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp4 = mmc_mk_nil();
    tmpMeta3 = __omcQ_24tmpVar9;
  }
  tmpMeta2 = mmc_mk_cons(_var, omc_List_flatten(threadData, tmpMeta3));
  _children = tmpMeta2;
  _return: OMC_LABEL_UNUSED
  return _children;
}
modelica_metatype boxptr_NFVariable_expandChildren(threadData_t *threadData, modelica_metatype _var, modelica_metatype _arrayDims, modelica_metatype _addDimensions)
{
  modelica_integer tmp1;
  modelica_metatype _children = NULL;
  tmp1 = mmc_unbox_integer(_addDimensions);
  _children = omc_NFVariable_expandChildren(threadData, _var, _arrayDims, tmp1);
  /* skip box _children; list<NFVariable> */
  return _children;
}

DLLDirection
modelica_metatype omc_NFVariable_expand(threadData_t *threadData, modelica_metatype _var, modelica_boolean _backend)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _crefs = NULL;
  modelica_metatype _v = NULL;
  modelica_metatype _binding = NULL;
  modelica_integer _bind_var;
  modelica_integer _bind_src;
  modelica_metatype _bind_exp = NULL;
  modelica_metatype _exp = NULL;
  modelica_metatype _expl = NULL;
  modelica_integer _crefs_len;
  modelica_integer _expl_len;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_integer tmp8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_metatype tmpMeta21;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _vars has no default value.
  // _crefs has no default value.
  // _v has no default value.
  // _binding has no default value.
  // _bind_var has no default value.
  // _bind_src has no default value.
  // _bind_exp has no default value.
  // _exp has no default value.
  // _expl has no default value.
  // _crefs_len has no default value.
  // _expl_len has no default value.
  if(omc_NFType_isArray(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3)))))
  {
    _exp = omc_NFExpression_fromCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))), 0 /* false */);

    _exp = omc_NFExpandExp_expandCref(threadData, _exp, _backend, NULL);

    _expl = omc_NFExpression_arrayScalarElements(threadData, _exp);

    {
      modelica_metatype __omcQ_24tmpVar11;
      modelica_metatype* tmp2;
      modelica_metatype tmpMeta3;
      modelica_metatype __omcQ_24tmpVar10;
      modelica_integer tmp4;
      modelica_metatype _e_loopVar = 0;
      modelica_metatype _e;
      _e_loopVar = _expl;
      tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
      __omcQ_24tmpVar11 = tmpMeta3; /* defaultValue */
      tmp2 = &__omcQ_24tmpVar11;
      while(1) {
        tmp4 = 1;
        if (!listEmpty(_e_loopVar)) {
          _e = MMC_CAR(_e_loopVar);
          _e_loopVar = MMC_CDR(_e_loopVar);
          tmp4--;
        }
        if (tmp4 == 0) {
          __omcQ_24tmpVar10 = omc_NFExpression_toCref(threadData, _e);
          *tmp2 = mmc_mk_cons(__omcQ_24tmpVar10,0);
          tmp2 = &MMC_CDR(*tmp2);
        } else if (tmp4 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      *tmp2 = mmc_mk_nil();
      tmpMeta1 = __omcQ_24tmpVar11;
    }
    _crefs = tmpMeta1;

    _v = _var;

    tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(12));
    memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_v), 12*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[3] = omc_NFType_arrayElementType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_v), 3))));
    _v = tmpMeta5;

    tmpMeta6 = MMC_REFSTRUCTLIT(mmc_nil);
    _vars = tmpMeta6;

    _binding = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4)));

    if(omc_NFBinding_isBound(threadData, _binding))
    {
      _bind_exp = omc_NFBinding_getTypedExp(threadData, _binding);

      _expl = omc_NFExpression_arrayScalarElements(threadData, omc_NFExpandExp_expand(threadData, _bind_exp, 0 /* false */, NULL));

      _crefs_len = listLength(_crefs);

      _expl_len = listLength(_expl);

      if((_expl_len < _crefs_len))
      {
        if((modelica_integer_mod(_crefs_len, _expl_len) != ((modelica_integer) 0)))
        {
          tmpMeta7 = stringAppend(_OMC_LIT26,omc_NFComponentRef_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))));
          omc_Error_assertion(threadData, 0 /* false */, tmpMeta7, _OMC_LIT27);
        }

        tmp8 = _expl_len;
        if (tmp8 == 0) {MMC_THROW_INTERNAL();}
        _expl = omc_List_flatten(threadData, omc_List_fill(threadData, _expl, modelica_div_integer(_crefs_len,tmp8).quot));
      }

      _bind_var = omc_NFBinding_variability(threadData, _binding);

      _bind_src = omc_NFBinding_source(threadData, _binding);

      {
        modelica_metatype _cr;
        for (tmpMeta9 = _crefs; !listEmpty(tmpMeta9); tmpMeta9=MMC_CDR(tmpMeta9))
        {
          _cr = MMC_CAR(tmpMeta9);
          tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(12));
          memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_v), 12*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[2] = _cr;
          _v = tmpMeta10;

          /* Pattern-matching assignment */
          tmpMeta11 = _expl;
          if (listEmpty(tmpMeta11)) MMC_THROW_INTERNAL();
          tmpMeta12 = MMC_CAR(tmpMeta11);
          tmpMeta13 = MMC_CDR(tmpMeta11);
          _exp = tmpMeta12;
          _expl = tmpMeta13;

          tmpMeta14 = MMC_TAGPTR(mmc_alloc_words(12));
          memcpy(MMC_UNTAGPTR(tmpMeta14), MMC_UNTAGPTR(_v), 12*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta14))[4] = omc_NFBinding_makeFlat(threadData, _exp, (modelica_integer)_bind_var, (modelica_integer)_bind_src);
          _v = tmpMeta14;

          tmpMeta15 = mmc_mk_cons(_v, _vars);
          _vars = tmpMeta15;
        }
      }
    }
    else
    {
      {
        modelica_metatype _cr;
        for (tmpMeta17 = _crefs; !listEmpty(tmpMeta17); tmpMeta17=MMC_CDR(tmpMeta17))
        {
          _cr = MMC_CAR(tmpMeta17);
          tmpMeta18 = MMC_TAGPTR(mmc_alloc_words(12));
          memcpy(MMC_UNTAGPTR(tmpMeta18), MMC_UNTAGPTR(_v), 12*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta18))[2] = _cr;
          _v = tmpMeta18;

          tmpMeta19 = mmc_mk_cons(_v, _vars);
          _vars = tmpMeta19;
        }
      }
    }

    _vars = listReverseInPlace(_vars);
  }
  else
  {
    tmpMeta21 = mmc_mk_cons(_var, MMC_REFSTRUCTLIT(mmc_nil));
    _vars = tmpMeta21;
  }
  _return: OMC_LABEL_UNUSED
  return _vars;
}
modelica_metatype boxptr_NFVariable_expand(threadData_t *threadData, modelica_metatype _var, modelica_metatype _backend)
{
  modelica_integer tmp1;
  modelica_metatype _vars = NULL;
  tmp1 = mmc_unbox_integer(_backend);
  _vars = omc_NFVariable_expand(threadData, _var, tmp1);
  /* skip box _vars; list<NFVariable> */
  return _vars;
}

DLLDirection
modelica_boolean omc_NFVariable_equalName(threadData_t *threadData, modelica_metatype _var1, modelica_metatype _var2)
{
  modelica_boolean _b;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _b = omc_NFComponentRef_isEqual(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var1), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var2), 2))));
  _return: OMC_LABEL_UNUSED
  return _b;
}
modelica_metatype boxptr_NFVariable_equalName(threadData_t *threadData, modelica_metatype _var1, modelica_metatype _var2)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NFVariable_equalName(threadData, _var1, _var2);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

DLLDirection
modelica_integer omc_NFVariable_hash(threadData_t *threadData, modelica_metatype _var)
{
  modelica_integer _i;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _i = omc_NFComponentRef_hash(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))));
  _return: OMC_LABEL_UNUSED
  return _i;
}
modelica_metatype boxptr_NFVariable_hash(threadData_t *threadData, modelica_metatype _var)
{
  modelica_integer _i;
  modelica_metatype out_i;
  _i = omc_NFVariable_hash(threadData, _var);
  out_i = mmc_mk_icon(_i);
  return out_i;
}

DLLDirection
modelica_integer omc_NFVariable_size(threadData_t *threadData, modelica_metatype _var, modelica_boolean _resize)
{
  modelica_integer _s;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _s = omc_NFType_sizeOf(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _resize);
  _return: OMC_LABEL_UNUSED
  return _s;
}
modelica_metatype boxptr_NFVariable_size(threadData_t *threadData, modelica_metatype _var, modelica_metatype _resize)
{
  modelica_integer tmp1;
  modelica_integer _s;
  modelica_metatype out_s;
  tmp1 = mmc_unbox_integer(_resize);
  _s = omc_NFVariable_size(threadData, _var, tmp1);
  out_s = mmc_mk_icon(_s);
  return out_s;
}

DLLDirection
modelica_metatype omc_NFVariable_fromCref(threadData_t *threadData, modelica_metatype _cref)
{
  modelica_metatype _variable = NULL;
  modelica_metatype _crefs = NULL;
  modelica_metatype _node = NULL;
  modelica_metatype _class_node = NULL;
  modelica_metatype _comp = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _binding = NULL;
  modelica_integer _vis;
  modelica_metatype _attr = NULL;
  modelica_metatype _cmt = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype _binfo = NULL;
  modelica_metatype _child_nodes = NULL;
  modelica_metatype _children = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _variable has no default value.
  // _crefs has no default value.
  // _node has no default value.
  // _class_node has no default value.
  // _comp has no default value.
  // _ty has no default value.
  // _binding has no default value.
  // _vis has no default value.
  // _attr has no default value.
  // _cmt has no default value.
  // _info has no default value.
  _binfo = _OMC_LIT31;
  // _child_nodes has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _children = tmpMeta1;
  _node = omc_NFComponentRef_node(threadData, _cref);

  _comp = omc_NFInstNode_InstNode_component(threadData, _node);

  _ty = omc_NFComponentRef_getSubscriptedType(threadData, _cref, 0 /* false */);

  _vis = omc_NFInstNode_InstNode_visibility(threadData, _node);

  _attr = omc_NFComponent_getAttributes(threadData, _comp);

  _cmt = omc_NFComponent_comment(threadData, _comp);

  _info = omc_NFInstNode_InstNode_info(threadData, _node);

  if(omc_NFComponentRef_isIterator(threadData, _cref))
  {
    _binding = _OMC_LIT6;

    tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(9));
    memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_binfo), 9*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[2] = _OMC_LIT32;
    _binfo = tmpMeta2;
  }
  else
  {
    _binding = omc_NFComponent_getImplicitBinding(threadData, _comp, omc_NFInstNode_InstNode_instanceParent(threadData, _node));
  }

  if((!omc_NFType_isExternalObject(threadData, _ty)))
  {
    { /* match expression */
      modelica_metatype tmp6_1;
      tmp6_1 = omc_NFType_arrayElementType(threadData, _ty);
      {
        volatile mmc_switch_type tmp6;
        int tmp7;
        tmp6 = 0;
        for (; tmp6 < 2; tmp6++) {
          switch (MMC_SWITCH_CAST(tmp6)) {
          case 0: {
            modelica_metatype tmpMeta8;
            modelica_metatype tmpMeta9;
            if (mmc__uniontype__metarecord__typedef__equal(tmp6_1,11,2) == 0) goto tmp5_end;
            tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp6_1), 2));
            
            _class_node = tmpMeta8;
            /* Pattern matching succeeded */
            _child_nodes = omc_NFClass_getComponents(threadData, omc_NFInstNode_InstNode_getClass(threadData, _class_node));
            {
              modelica_metatype __omcQ_24tmpVar13;
              modelica_metatype* tmp10;
              modelica_metatype tmpMeta11;
              modelica_metatype tmpMeta12;
              modelica_metatype __omcQ_24tmpVar12;
              modelica_integer tmp13;
              modelica_metatype _c_loopVar = 0;
              modelica_integer tmp14;
              modelica_metatype _c;
              _c_loopVar = _child_nodes;
              tmp14 = 1;
              tmpMeta11 = MMC_REFSTRUCTLIT(mmc_nil);
              __omcQ_24tmpVar13 = tmpMeta11; /* defaultValue */
              tmp10 = &__omcQ_24tmpVar13;
              while(1) {
                tmp13 = 1;
                if (tmp14 <= arrayLength(_c_loopVar)) {
                  _c = arrayGet(_c_loopVar, tmp14++);
                  tmp13--;
                }
                if (tmp13 == 0) {
                  tmpMeta12 = MMC_REFSTRUCTLIT(mmc_nil);
                  __omcQ_24tmpVar12 = omc_NFVariable_fromCref(threadData, omc_NFComponentRef_prefixCref(threadData, _c, omc_NFInstNode_InstNode_getType(threadData, _c), tmpMeta12, _cref));
                  *tmp10 = mmc_mk_cons(__omcQ_24tmpVar12,0);
                  tmp10 = &MMC_CDR(*tmp10);
                } else if (tmp13 == 1) {
                  break;
                } else {
                  goto goto_4;
                }
              }
              *tmp10 = mmc_mk_nil();
              tmpMeta9 = __omcQ_24tmpVar13;
            }
            tmpMeta3 = tmpMeta9;
            goto tmp5_done;
          }
          case 1: {
            modelica_metatype tmpMeta15;
            
            /* Pattern matching succeeded */
            tmpMeta15 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta3 = tmpMeta15;
            goto tmp5_done;
          }
          }
          goto tmp5_end;
          tmp5_end: ;
        }
        goto goto_4;
        goto_4:;
        MMC_THROW_INTERNAL();
        goto tmp5_done;
        tmp5_done:;
      }
    }
    _children = tmpMeta3;
  }

  tmpMeta16 = MMC_REFSTRUCTLIT(mmc_nil);
  tmpMeta17 = mmc_mk_box11(3, &NFVariable_VARIABLE__desc, _cref, _ty, _binding, mmc_mk_integer((modelica_integer)_vis), _attr, tmpMeta16, _children, _cmt, _info, _binfo);
  _variable = tmpMeta17;
  _return: OMC_LABEL_UNUSED
  return _variable;
}

