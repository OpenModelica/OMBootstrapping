#include "omc_simulation_settings.h"
#include "NFInstUtil.h"
#define _OMC_LIT0_data "$"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT0,1,_OMC_LIT0_data);
#define _OMC_LIT0 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT0)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT1,2,4) {&Absyn_Path_IDENT__desc,_OMC_LIT0}};
#define _OMC_LIT1 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT1)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT2,1,5) {&SCode_Mod_NOMOD__desc,}};
#define _OMC_LIT2 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT2)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT3,3,3) {&SCode_Comment_COMMENT__desc,MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT3 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT3)
#define _OMC_LIT4_data ""
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT4,0,_OMC_LIT4_data);
#define _OMC_LIT4 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT4)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT5,0.0);
#define _OMC_LIT5 MMC_REFREALLIT(_OMC_LIT_STRUCT5)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT6,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT4,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),_OMC_LIT5}};
#define _OMC_LIT6 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data "="
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,1,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
#define _OMC_LIT8_data ")"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT8,1,_OMC_LIT8_data);
#define _OMC_LIT8 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT8)
#define _OMC_LIT9_data ","
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT9,1,_OMC_LIT9_data);
#define _OMC_LIT9 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,1,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
#define _OMC_LIT11_data "final "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT11,6,_OMC_LIT11_data);
#define _OMC_LIT11 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT11)
#define _OMC_LIT12_data "each "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT12,5,_OMC_LIT12_data);
#define _OMC_LIT12 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT12)
#define _OMC_LIT13_data "."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT13,1,_OMC_LIT13_data);
#define _OMC_LIT13 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT13)
#define _OMC_LIT14_data "_merged_table.json"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT14,18,_OMC_LIT14_data);
#define _OMC_LIT14 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT14)
#define _OMC_LIT15_data "mergeComponents"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT15,15,_OMC_LIT15_data);
#define _OMC_LIT15 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT15)
#define _OMC_LIT16_data "Enables automatic merging of components into arrays."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT16,52,_OMC_LIT16_data);
#define _OMC_LIT16 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT16)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT17,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT16}};
#define _OMC_LIT17 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT17)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT18,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(190)),_OMC_LIT15,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT17}};
#define _OMC_LIT18 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT18)
#define _OMC_LIT19_data "NFInstUtil.mergeScalars"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT19,23,_OMC_LIT19_data);
#define _OMC_LIT19 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT19)
#define _OMC_LIT20_data "combineSubscripts"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT20,17,_OMC_LIT20_data);
#define _OMC_LIT20 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT20)
#define _OMC_LIT21_data "Move all subscripts to the end of component references."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT21,55,_OMC_LIT21_data);
#define _OMC_LIT21 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT21)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT22,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT21}};
#define _OMC_LIT22 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT22)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT23,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(183)),_OMC_LIT20,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT22}};
#define _OMC_LIT23 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT23)
#define _OMC_LIT24_data "nfScalarize"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT24,11,_OMC_LIT24_data);
#define _OMC_LIT24 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT24)
#define _OMC_LIT25_data "Run scalarization in NF, default true."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT25,38,_OMC_LIT25_data);
#define _OMC_LIT25 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT25)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT26,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT25}};
#define _OMC_LIT26 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT26)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT27,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(168)),_OMC_LIT24,MMC_IMMEDIATE(MMC_TAGFIXNUM(1 /* true */)),_OMC_LIT26}};
#define _OMC_LIT27 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT27)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT28,1,5) {&ErrorTypes_MessageType_TRANSLATION__desc,}};
#define _OMC_LIT28 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT28)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT29,1,6) {&ErrorTypes_Severity_NOTIFICATION__desc,}};
#define _OMC_LIT29 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT29)
#define _OMC_LIT30_data "The following structural parameters were evaluated in the front-end: %s\nStructural parameters are parameters used to calculate array dimensions or branch selection in certain if-equations or if-expressions among other things."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT30,225,_OMC_LIT30_data);
#define _OMC_LIT30 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT30)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT31,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT30}};
#define _OMC_LIT31 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT31)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT32,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(272)),_OMC_LIT28,_OMC_LIT29,_OMC_LIT31}};
#define _OMC_LIT32 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT32)
#define _OMC_LIT33_data ", "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT33,2,_OMC_LIT33_data);
#define _OMC_LIT33 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT33)
#define _OMC_LIT34_data "printStructuralParameters"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT34,25,_OMC_LIT34_data);
#define _OMC_LIT34 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT34)
#define _OMC_LIT35_data "Prints the structural parameters identified by the front-end"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT35,60,_OMC_LIT35_data);
#define _OMC_LIT35 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT35)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT36,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT35}};
#define _OMC_LIT36 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT36)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT37,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(100)),_OMC_LIT34,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT36}};
#define _OMC_LIT37 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT37)
#define _OMC_LIT38_data "obfuscate"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT38,9,_OMC_LIT38_data);
#define _OMC_LIT38 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT38)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT39,1,4) {&Flags_FlagVisibility_EXTERNAL__desc,}};
#define _OMC_LIT39 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT39)
#define _OMC_LIT40_data "none"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT40,4,_OMC_LIT40_data);
#define _OMC_LIT40 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT40)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT41,2,8) {&Flags_FlagData_STRING__FLAG__desc,_OMC_LIT40}};
#define _OMC_LIT41 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT41)
#define _OMC_LIT42_data "No obfuscation."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT42,15,_OMC_LIT42_data);
#define _OMC_LIT42 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT42)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT43,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT42}};
#define _OMC_LIT43 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT43)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT44,2,0) {_OMC_LIT40,_OMC_LIT43}};
#define _OMC_LIT44 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT44)
#define _OMC_LIT45_data "encrypted"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT45,9,_OMC_LIT45_data);
#define _OMC_LIT45 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT45)
#define _OMC_LIT46_data "Obfuscates protected variables in encrypted models"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT46,50,_OMC_LIT46_data);
#define _OMC_LIT46 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT46)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT47,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT46}};
#define _OMC_LIT47 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT47)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT48,2,0) {_OMC_LIT45,_OMC_LIT47}};
#define _OMC_LIT48 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT48)
#define _OMC_LIT49_data "protected"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT49,9,_OMC_LIT49_data);
#define _OMC_LIT49 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT49)
#define _OMC_LIT50_data "Obfuscates protected variables in all models."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT50,45,_OMC_LIT50_data);
#define _OMC_LIT50 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT50)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT51,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT50}};
#define _OMC_LIT51 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT51)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT52,2,0) {_OMC_LIT49,_OMC_LIT51}};
#define _OMC_LIT52 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT52)
#define _OMC_LIT53_data "full"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT53,4,_OMC_LIT53_data);
#define _OMC_LIT53 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT53)
#define _OMC_LIT54_data "Obfuscates everything."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT54,22,_OMC_LIT54_data);
#define _OMC_LIT54 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT54)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT55,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT54}};
#define _OMC_LIT55 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT55)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT56,2,0) {_OMC_LIT53,_OMC_LIT55}};
#define _OMC_LIT56 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT56)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT57,2,1) {_OMC_LIT56,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT57 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT57)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT58,2,1) {_OMC_LIT52,_OMC_LIT57}};
#define _OMC_LIT58 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT58)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT59,2,1) {_OMC_LIT48,_OMC_LIT58}};
#define _OMC_LIT59 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT59)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT60,2,1) {_OMC_LIT44,_OMC_LIT59}};
#define _OMC_LIT60 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT60)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT61,2,4) {&Flags_ValidOptions_STRING__DESC__OPTION__desc,_OMC_LIT60}};
#define _OMC_LIT61 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT61)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT62,1,1) {_OMC_LIT61}};
#define _OMC_LIT62 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT62)
#define _OMC_LIT63_data "Obfuscates identifiers in the simulation model"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT63,46,_OMC_LIT63_data);
#define _OMC_LIT63 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT63)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT64,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT63}};
#define _OMC_LIT64 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT64)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT65,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(149)),_OMC_LIT38,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT39,_OMC_LIT41,_OMC_LIT62,_OMC_LIT64}};
#define _OMC_LIT65 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT65)
#define _OMC_LIT66_data "########################################\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT66,41,_OMC_LIT66_data);
#define _OMC_LIT66 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT66)
#define _OMC_LIT67_data "\n########################################\n\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT67,43,_OMC_LIT67_data);
#define _OMC_LIT67 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT67)
#define _OMC_LIT68_data "baseModelica"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT68,12,_OMC_LIT68_data);
#define _OMC_LIT68 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT68)
#define _OMC_LIT69_data "f"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT69,1,_OMC_LIT69_data);
#define _OMC_LIT69 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT69)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT70,1,1) {_OMC_LIT69}};
#define _OMC_LIT70 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT70)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT71,2,4) {&Flags_FlagData_BOOL__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT71 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT71)
#define _OMC_LIT72_data "Outputs experimental Base Modelica."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT72,35,_OMC_LIT72_data);
#define _OMC_LIT72 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT72)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT73,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT72}};
#define _OMC_LIT73 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT73)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT74,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(135)),_OMC_LIT68,_OMC_LIT70,_OMC_LIT39,_OMC_LIT71,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT73}};
#define _OMC_LIT74 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT74)
#define _OMC_LIT75_data "\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT75,1,_OMC_LIT75_data);
#define _OMC_LIT75 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT75)
#define _OMC_LIT76_data "dumpFlatModel"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT76,13,_OMC_LIT76_data);
#define _OMC_LIT76 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT76)
#define _OMC_LIT77_data "all"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT77,3,_OMC_LIT77_data);
#define _OMC_LIT77 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT77)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT78,2,1) {_OMC_LIT77,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT78 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT78)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT79,2,9) {&Flags_FlagData_STRING__LIST__FLAG__desc,_OMC_LIT78}};
#define _OMC_LIT79 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT79)
#define _OMC_LIT80_data "flatten"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT80,7,_OMC_LIT80_data);
#define _OMC_LIT80 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT80)
#define _OMC_LIT81_data "After flattening but before connection handling."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT81,48,_OMC_LIT81_data);
#define _OMC_LIT81 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT81)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT82,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT81}};
#define _OMC_LIT82 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT82)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT83,2,0) {_OMC_LIT80,_OMC_LIT82}};
#define _OMC_LIT83 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT83)
#define _OMC_LIT84_data "connections"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT84,11,_OMC_LIT84_data);
#define _OMC_LIT84 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT84)
#define _OMC_LIT85_data "After connection handling."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT85,26,_OMC_LIT85_data);
#define _OMC_LIT85 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT85)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT86,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT85}};
#define _OMC_LIT86 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT86)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT87,2,0) {_OMC_LIT84,_OMC_LIT86}};
#define _OMC_LIT87 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT87)
#define _OMC_LIT88_data "eval"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT88,4,_OMC_LIT88_data);
#define _OMC_LIT88 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT88)
#define _OMC_LIT89_data "After evaluating constants."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT89,27,_OMC_LIT89_data);
#define _OMC_LIT89 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT89)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT90,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT89}};
#define _OMC_LIT90 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT90)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT91,2,0) {_OMC_LIT88,_OMC_LIT90}};
#define _OMC_LIT91 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT91)
#define _OMC_LIT92_data "simplify"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT92,8,_OMC_LIT92_data);
#define _OMC_LIT92 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT92)
#define _OMC_LIT93_data "After model simplification."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT93,27,_OMC_LIT93_data);
#define _OMC_LIT93 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT93)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT94,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT93}};
#define _OMC_LIT94 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT94)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT95,2,0) {_OMC_LIT92,_OMC_LIT94}};
#define _OMC_LIT95 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT95)
#define _OMC_LIT96_data "scalarize"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT96,9,_OMC_LIT96_data);
#define _OMC_LIT96 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT96)
#define _OMC_LIT97_data "After scalarizing arrays."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT97,25,_OMC_LIT97_data);
#define _OMC_LIT97 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT97)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT98,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT97}};
#define _OMC_LIT98 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT98)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT99,2,0) {_OMC_LIT96,_OMC_LIT98}};
#define _OMC_LIT99 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT99)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT100,2,1) {_OMC_LIT99,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT100 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT100)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT101,2,1) {_OMC_LIT95,_OMC_LIT100}};
#define _OMC_LIT101 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT101)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT102,2,1) {_OMC_LIT91,_OMC_LIT101}};
#define _OMC_LIT102 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT102)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT103,2,1) {_OMC_LIT87,_OMC_LIT102}};
#define _OMC_LIT103 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT103)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT104,2,1) {_OMC_LIT83,_OMC_LIT103}};
#define _OMC_LIT104 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT104)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT105,2,4) {&Flags_ValidOptions_STRING__DESC__OPTION__desc,_OMC_LIT104}};
#define _OMC_LIT105 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT105)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT106,1,1) {_OMC_LIT105}};
#define _OMC_LIT106 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT106)
#define _OMC_LIT107_data "Dumps the flat model at the given stages of the frontend."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT107,57,_OMC_LIT107_data);
#define _OMC_LIT107 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT107)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT108,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT107}};
#define _OMC_LIT108 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT108)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT109,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(147)),_OMC_LIT76,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT39,_OMC_LIT79,_OMC_LIT106,_OMC_LIT108}};
#define _OMC_LIT109 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT109)
#include "util/modelica.h"

#include "NFInstUtil_includes.h"


/* default, do not make protected functions static */
#if !defined(PROTECTED_FUNCTION_STATIC)
#define PROTECTED_FUNCTION_STATIC
#endif
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFInstUtil_getModSignature_sub__mod__lt(threadData_t *threadData, modelica_metatype _m1, modelica_metatype _m2);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFInstUtil_getModSignature_sub__mod__lt(threadData_t *threadData, modelica_metatype _m1, modelica_metatype _m2);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFInstUtil_getModSignature_sub__mod__lt,2,0) {(void*) boxptr_NFInstUtil_getModSignature_sub__mod__lt,0}};
#define boxvar_NFInstUtil_getModSignature_sub__mod__lt MMC_REFSTRUCTLIT(boxvar_lit_NFInstUtil_getModSignature_sub__mod__lt)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFInstUtil_makeMergeMap_append__merge(threadData_t *threadData, modelica_metatype _oldValue, modelica_metatype _elem);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFInstUtil_makeMergeMap_append__merge,2,0) {(void*) boxptr_NFInstUtil_makeMergeMap_append__merge,0}};
#define boxvar_NFInstUtil_makeMergeMap_append__merge MMC_REFSTRUCTLIT(boxvar_lit_NFInstUtil_makeMergeMap_append__merge)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFInstUtil_replaceEmptyArraysExp_traverser(threadData_t *threadData, modelica_metatype _exp);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFInstUtil_replaceEmptyArraysExp_traverser,2,0) {(void*) boxptr_NFInstUtil_replaceEmptyArraysExp_traverser,0}};
#define boxvar_NFInstUtil_replaceEmptyArraysExp_traverser MMC_REFSTRUCTLIT(boxvar_lit_NFInstUtil_replaceEmptyArraysExp_traverser)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFInstUtil_combineSubscriptsExp_traverser(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFInstUtil_combineSubscriptsExp_traverser,2,0) {(void*) boxptr_NFInstUtil_combineSubscriptsExp_traverser,0}};
#define boxvar_NFInstUtil_combineSubscriptsExp_traverser MMC_REFSTRUCTLIT(boxvar_lit_NFInstUtil_combineSubscriptsExp_traverser)

DLLDirection
void omc_NFInstUtil_mergeScalarsComponentBinding(threadData_t *threadData, modelica_metatype _node, modelica_metatype _nameMap)
{
  modelica_metatype _comp = NULL;
  modelica_metatype _binding = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _comp has no default value.
  // _binding has no default value.
  if((!omc_NFInstNode_InstNode_isComponent(threadData, _node)))
  {
    goto _return;
  }

  _comp = omc_NFInstNode_InstNode_component(threadData, _node);

  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _comp;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_comp), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[2] = omc_NFInstUtil_mergeScalarsElement(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_comp), 2))), _nameMap);
          _comp = tmpMeta5;

          omc_NFInstNode_InstNode_updateComponent(threadData, _comp, _node);
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}

static void closure0_NFInstUtil_mergeScalarsComponentBinding(threadData_t *thData, modelica_metatype closure, modelica_metatype node)
{
  modelica_metatype nameMap = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  boxptr_NFInstUtil_mergeScalarsComponentBinding(thData, node, nameMap);
}
DLLDirection
void omc_NFInstUtil_mergeScalarsComponentBindings(threadData_t *threadData, modelica_metatype _node, modelica_metatype _nameMap)
{
  modelica_metatype _cls = NULL;
  modelica_metatype _cls_tree = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _cls has no default value.
  // _cls_tree has no default value.
  _cls = omc_NFInstNode_InstNode_getClass(threadData, _node);

  _cls_tree = omc_NFClass_classTree(threadData, _cls);

  tmpMeta1 = mmc_mk_box1(0, _nameMap);
  omc_NFClassTree_ClassTree_applyComponents(threadData, _cls_tree, (modelica_fnptr) mmc_mk_box2(0,closure0_NFInstUtil_mergeScalarsComponentBinding,tmpMeta1));

  _cls = omc_NFClass_setClassTree(threadData, _cls_tree, _cls);

  omc_NFInstNode_InstNode_updateClass(threadData, _cls, _node);
  _return: OMC_LABEL_UNUSED
  return;
}

static modelica_metatype closure1_NFInstUtil_mergeScalarsExps(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype nameMap = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFInstUtil_mergeScalarsExps(thData, $in_exp, nameMap);
}
DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsStmt(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fstmt, modelica_metatype _nameMap)
{
  modelica_metatype _stmt = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _stmt = __omcQ_24in_5Fstmt;
  tmpMeta1 = mmc_mk_box1(0, _nameMap);
  _stmt = omc_SCodeUtil_mapStatementExps(threadData, _stmt, (modelica_fnptr) mmc_mk_box2(0,closure1_NFInstUtil_mergeScalarsExps,tmpMeta1));
  _return: OMC_LABEL_UNUSED
  return _stmt;
}

static modelica_metatype closure2_NFInstUtil_mergeScalarsStmt(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_stmt)
{
  modelica_metatype nameMap = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFInstUtil_mergeScalarsStmt(thData, $in_stmt, nameMap);
}
DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsAlgs(threadData_t *threadData, modelica_metatype __omcQ_24in_5Falgs, modelica_metatype _nameMap)
{
  modelica_metatype _algs = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _algs = __omcQ_24in_5Falgs;
  {
    modelica_metatype __omcQ_24tmpVar1;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar0;
    modelica_integer tmp5;
    modelica_metatype _a_loopVar = 0;
    modelica_metatype _a;
    _a_loopVar = _algs;
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar1 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar1;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_a_loopVar)) {
        _a = MMC_CAR(_a_loopVar);
        _a_loopVar = MMC_CDR(_a_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        tmpMeta4 = mmc_mk_box1(0, _nameMap);
        __omcQ_24tmpVar0 = omc_SCodeUtil_mapAlgorithmStatements(threadData, _a, (modelica_fnptr) mmc_mk_box2(0,closure2_NFInstUtil_mergeScalarsStmt,tmpMeta4));
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar0,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar1;
  }
  _algs = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _algs;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsCref(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcref, modelica_metatype _nameMap)
{
  modelica_metatype _cref = NULL;
  modelica_metatype _repl_ocr = NULL;
  modelica_metatype _repl_cr = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cref = __omcQ_24in_5Fcref;
  // _repl_ocr has no default value.
  // _repl_cr has no default value.
  // _subs has no default value.
  _repl_ocr = omc_UnorderedMap_get(threadData, omc_AbsynUtil_crefFirstIdent(threadData, _cref), _nameMap);

  if(isSome(_repl_ocr))
  {
    /* Pattern-matching assignment */
    tmpMeta1 = _repl_ocr;
    if (optionNone(tmpMeta1)) MMC_THROW_INTERNAL();
    tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
    _repl_cr = tmpMeta2;

    _subs = omc_AbsynUtil_crefFirstSubs(threadData, _cref);

    if((!listEmpty(_subs)))
    {
      _subs = listAppend(omc_AbsynUtil_crefFirstSubs(threadData, _repl_cr), _subs);

      _repl_cr = omc_AbsynUtil_crefSetLastSubs(threadData, _repl_cr, _subs);
    }

    _cref = omc_AbsynUtil_crefReplaceFirst(threadData, _cref, _repl_cr);
  }
  _return: OMC_LABEL_UNUSED
  return _cref;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype __omcQ_24in_5FnameMap, modelica_metatype *out_nameMap)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _nameMap = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  _nameMap = __omcQ_24in_5FnameMap;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _exp;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,1) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(!omc_AbsynUtil_crefIsWild(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2)))))) goto tmp2_end;
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(3));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_exp), 3*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[2] = omc_NFInstUtil_mergeScalarsCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), _nameMap);
          _exp = tmpMeta5;
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  if (out_nameMap) { *out_nameMap = _nameMap; }
  return _exp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsExps(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _nameMap)
{
  modelica_metatype _exp = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  _exp = omc_AbsynUtil_traverseExp(threadData, _exp, boxvar_NFInstUtil_mergeScalarsExp, _nameMap, NULL);
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsSubMod(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fmod, modelica_metatype _nameMap)
{
  modelica_metatype _mod = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _mod = __omcQ_24in_5Fmod;
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(4));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_mod), 4*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[3] = omc_NFInstUtil_mergeScalarsMod(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 3))), _nameMap);
  _mod = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _mod;
}

static modelica_metatype closure3_NFInstUtil_mergeScalarsExps(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype nameMap = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFInstUtil_mergeScalarsExps(thData, $in_exp, nameMap);
}
DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsMod(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fmod, modelica_metatype _nameMap)
{
  modelica_metatype _mod = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _mod = __omcQ_24in_5Fmod;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _mod;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,6) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = mmc_mk_box1(0, _nameMap);
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(8));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_mod), 8*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[5] = omc_Util_applyOption(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 5))), (modelica_fnptr) mmc_mk_box2(0,closure3_NFInstUtil_mergeScalarsExps,tmpMeta6));
          _mod = tmpMeta5;

          {
            modelica_metatype __omcQ_24tmpVar3;
            modelica_metatype* tmp9;
            modelica_metatype tmpMeta10;
            modelica_metatype __omcQ_24tmpVar2;
            modelica_integer tmp11;
            modelica_metatype _m_loopVar = 0;
            modelica_metatype _m;
            _m_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 4)));
            tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar3 = tmpMeta10; /* defaultValue */
            tmp9 = &__omcQ_24tmpVar3;
            while(1) {
              tmp11 = 1;
              if (!listEmpty(_m_loopVar)) {
                _m = MMC_CAR(_m_loopVar);
                _m_loopVar = MMC_CDR(_m_loopVar);
                tmp11--;
              }
              if (tmp11 == 0) {
                __omcQ_24tmpVar2 = omc_NFInstUtil_mergeScalarsSubMod(threadData, _m, _nameMap);
                *tmp9 = mmc_mk_cons(__omcQ_24tmpVar2,0);
                tmp9 = &MMC_CDR(*tmp9);
              } else if (tmp11 == 1) {
                break;
              } else {
                goto goto_1;
              }
            }
            *tmp9 = mmc_mk_nil();
            tmpMeta8 = __omcQ_24tmpVar3;
          }
          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(8));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_mod), 8*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[4] = tmpMeta8;
          _mod = tmpMeta7;
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _mod;
}

static modelica_metatype closure4_NFInstUtil_mergeScalarsExps(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype nameMap = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFInstUtil_mergeScalarsExps(thData, $in_exp, nameMap);
}
DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsEq(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feq, modelica_metatype _nameMap)
{
  modelica_metatype _eq = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eq = __omcQ_24in_5Feq;
  tmpMeta1 = mmc_mk_box1(0, _nameMap);
  _eq = omc_SCodeUtil_mapEquationExps(threadData, _eq, (modelica_fnptr) mmc_mk_box2(0,closure4_NFInstUtil_mergeScalarsExps,tmpMeta1));

  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _eq;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,3,4) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(6));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_eq), 6*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[2] = omc_NFInstUtil_mergeScalarsCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _nameMap);
          _eq = tmpMeta6;

          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(6));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_eq), 6*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[3] = omc_NFInstUtil_mergeScalarsCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _nameMap);
          _eq = tmpMeta7;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _eq;
}

static modelica_metatype closure5_NFInstUtil_mergeScalarsEq(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_eq)
{
  modelica_metatype nameMap = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFInstUtil_mergeScalarsEq(thData, $in_eq, nameMap);
}
DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsEql(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feql, modelica_metatype _nameMap)
{
  modelica_metatype _eql = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eql = __omcQ_24in_5Feql;
  tmpMeta1 = mmc_mk_box1(0, _nameMap);
  _eql = omc_SCodeUtil_mapEquationsList(threadData, _eql, (modelica_fnptr) mmc_mk_box2(0,closure5_NFInstUtil_mergeScalarsEq,tmpMeta1));
  _return: OMC_LABEL_UNUSED
  return _eql;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalarsElement(threadData_t *threadData, modelica_metatype __omcQ_24in_5Felement, modelica_metatype _nameMap)
{
  modelica_metatype _element = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _element = __omcQ_24in_5Felement;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _element;
    {
      int tmp3;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
        case 4: {
          modelica_metatype tmpMeta4;
          
          /* Pattern matching succeeded */
          tmpMeta4 = MMC_TAGPTR(mmc_alloc_words(7));
          memcpy(MMC_UNTAGPTR(tmpMeta4), MMC_UNTAGPTR(_element), 7*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta4))[4] = omc_NFInstUtil_mergeScalarsMod(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_element), 4))), _nameMap);
          _element = tmpMeta4;
          goto tmp2_done;
        }
        case 6: {
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(10));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_element), 10*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[6] = omc_NFInstUtil_mergeScalarsMod(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_element), 6))), _nameMap);
          _element = tmpMeta5;
          goto tmp2_done;
        }
        default:
        tmp2_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _element;
}

DLLDirection
modelica_metatype omc_NFInstUtil_lookupMod(threadData_t *threadData, modelica_metatype _name, modelica_metatype _mod)
{
  modelica_metatype _outMod = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outMod has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _name;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = ((stringEqual((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_name), 2))), _OMC_LIT0))?_mod:omc_SCodeUtil_lookupModInMod(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_name), 2))), _mod));
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          _outMod = omc_SCodeUtil_lookupModInMod(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_name), 2))), _mod);
          /* Tail recursive call */
          _name = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_name), 3)));
          _mod = _outMod;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outMod = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outMod;
}

DLLDirection
modelica_metatype omc_NFInstUtil_lookupModBinding(threadData_t *threadData, modelica_metatype _name, modelica_metatype _mod)
{
  modelica_metatype _binding = NULL;
  modelica_metatype _m = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _binding has no default value.
  // _m has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = omc_NFInstUtil_lookupMod(threadData, _name, _mod);
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,0,6) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 5));
  if (optionNone(tmpMeta2)) MMC_THROW_INTERNAL();
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 1));
  _binding = tmpMeta3;
  _return: OMC_LABEL_UNUSED
  return _binding;
}

DLLDirection
modelica_metatype omc_NFInstUtil_getModBindings(threadData_t *threadData, modelica_metatype _mod, modelica_metatype _names, modelica_metatype __omcQ_24in_5Fbindings)
{
  modelica_metatype _bindings = NULL;
  modelica_metatype _mod_bindings = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _bindings = __omcQ_24in_5Fbindings;
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _mod_bindings = tmpMeta1;
  {
    modelica_metatype _name;
    for (tmpMeta2 = _names; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _name = MMC_CAR(tmpMeta2);
      tmpMeta3 = mmc_mk_cons(omc_NFInstUtil_lookupModBinding(threadData, _name, _mod), _mod_bindings);
      _mod_bindings = tmpMeta3;
    }
  }

  {
    modelica_metatype __omcQ_24tmpVar5;
    modelica_metatype* tmp6;
    modelica_metatype tmpMeta7;
    modelica_metatype tmpMeta8;
    modelica_metatype __omcQ_24tmpVar4;
    modelica_integer tmp9;
    modelica_metatype _e1_loopVar = 0;
    modelica_metatype _e1;
    modelica_metatype _e2_loopVar = 0;
    modelica_metatype _e2;
    _e1_loopVar = _mod_bindings;
    _e2_loopVar = _bindings;
    tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar5 = tmpMeta7; /* defaultValue */
    tmp6 = &__omcQ_24tmpVar5;
    while(1) {
      tmp9 = 2;
      if (!listEmpty(_e1_loopVar)) {
        _e1 = MMC_CAR(_e1_loopVar);
        _e1_loopVar = MMC_CDR(_e1_loopVar);
        tmp9--;
      }if (!listEmpty(_e2_loopVar)) {
        _e2 = MMC_CAR(_e2_loopVar);
        _e2_loopVar = MMC_CDR(_e2_loopVar);
        tmp9--;
      }
      if (tmp9 == 0) {
        tmpMeta8 = mmc_mk_cons(_e1, _e2);
        __omcQ_24tmpVar4 = tmpMeta8;
        *tmp6 = mmc_mk_cons(__omcQ_24tmpVar4,0);
        tmp6 = &MMC_CDR(*tmp6);
      } else if (tmp9 == 2) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp6 = mmc_mk_nil();
    tmpMeta5 = __omcQ_24tmpVar5;
  }
  _bindings = tmpMeta5;
  _return: OMC_LABEL_UNUSED
  return _bindings;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeMods2(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fmod, modelica_metatype _bindingMap, modelica_metatype _name)
{
  modelica_metatype _mod = NULL;
  modelica_metatype _new_binding = NULL;
  modelica_metatype _submods = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _mod = __omcQ_24in_5Fmod;
  // _new_binding has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _submods = tmpMeta1;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _mod;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,6) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          if(isSome((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 5)))))
          {
            _new_binding = omc_UnorderedMap_getOrFail(threadData, omc_NFInstUtil_makeModPath(threadData, _name), _bindingMap);

            tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(8));
            memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_mod), 8*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[5] = mmc_mk_some(_new_binding);
            _mod = tmpMeta6;
          }

          if((!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 4))))))
          {
            {
              modelica_metatype _m;
              for (tmpMeta7 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 4))); !listEmpty(tmpMeta7); tmpMeta7=MMC_CDR(tmpMeta7))
              {
                _m = MMC_CAR(tmpMeta7);
                tmpMeta9 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m), 2))), _name);
                tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(4));
                memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_m), 4*sizeof(modelica_metatype));
                ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[3] = omc_NFInstUtil_mergeMods2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m), 3))), _bindingMap, tmpMeta9);
                _m = tmpMeta8;

                tmpMeta10 = mmc_mk_cons(_m, _submods);
                _submods = tmpMeta10;
              }
            }

            tmpMeta12 = MMC_TAGPTR(mmc_alloc_words(8));
            memcpy(MMC_UNTAGPTR(tmpMeta12), MMC_UNTAGPTR(_mod), 8*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta12))[4] = listReverseInPlace(_submods);
            _mod = tmpMeta12;
          }
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _mod;
}

DLLDirection
modelica_metatype omc_NFInstUtil_makeModPath(threadData_t *threadData, modelica_metatype _name)
{
  modelica_metatype _path = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _path has no default value.
  if(listEmpty(_name))
  {
    _path = _OMC_LIT1;
  }
  else
  {
    _path = omc_AbsynUtil_stringListPathReversed(threadData, _name);
  }
  _return: OMC_LABEL_UNUSED
  return _path;
}

DLLDirection
modelica_metatype omc_NFInstUtil_getModNames(threadData_t *threadData, modelica_metatype _mod, modelica_metatype _name, modelica_metatype __omcQ_24in_5Fnames)
{
  modelica_metatype _names = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _names = __omcQ_24in_5Fnames;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _mod;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,6) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          if(isSome((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 5)))))
          {
            tmpMeta6 = mmc_mk_cons(omc_NFInstUtil_makeModPath(threadData, _name), _names);
            _names = tmpMeta6;
          }

          {
            modelica_metatype _m;
            for (tmpMeta7 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 4))); !listEmpty(tmpMeta7); tmpMeta7=MMC_CDR(tmpMeta7))
            {
              _m = MMC_CAR(tmpMeta7);
              tmpMeta8 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m), 2))), _name);
              _names = omc_NFInstUtil_getModNames(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m), 3))), tmpMeta8, _names);
            }
          }
          tmpMeta1 = _names;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _names;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _names = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _names;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeMods(threadData_t *threadData, modelica_metatype _mods)
{
  modelica_metatype _mod = NULL;
  modelica_metatype _names = NULL;
  modelica_metatype _bindings = NULL;
  modelica_metatype _binding_map = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta10;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _mod has no default value.
  // _names has no default value.
  // _bindings has no default value.
  // _binding_map has no default value.
  if(listEmpty(_mods))
  {
    _mod = _OMC_LIT2;

    goto _return;
  }

  _mod = listHead(_mods);

  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _names = omc_NFInstUtil_getModNames(threadData, _mod, tmpMeta1, tmpMeta2);

  tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
  _bindings = omc_List_fill(threadData, tmpMeta3, listLength(_names));

  {
    modelica_metatype _m;
    for (tmpMeta4 = listReverse(_mods); !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
    {
      _m = MMC_CAR(tmpMeta4);
      _bindings = omc_NFInstUtil_getModBindings(threadData, _m, _names, _bindings);
    }
  }

  {
    modelica_metatype __omcQ_24tmpVar7;
    modelica_metatype tmpMeta7;
    modelica_metatype tmpMeta8;
    modelica_metatype __omcQ_24tmpVar6;
    modelica_integer tmp9;
    modelica_metatype _b_loopVar = 0;
    modelica_metatype _b;
    _b_loopVar = _bindings;
    tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar7 = tmpMeta7; /* defaultValue */
    while(1) {
      tmp9 = 1;
      if (!listEmpty(_b_loopVar)) {
        _b = MMC_CAR(_b_loopVar);
        _b_loopVar = MMC_CDR(_b_loopVar);
        tmp9--;
      }
      if (tmp9 == 0) {
        tmpMeta8 = mmc_mk_box2(16, &Absyn_Exp_ARRAY__desc, _b);
        __omcQ_24tmpVar6 = tmpMeta8;
        __omcQ_24tmpVar7 = mmc_mk_cons(__omcQ_24tmpVar6,__omcQ_24tmpVar7);
      } else if (tmp9 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    tmpMeta6 = __omcQ_24tmpVar7;
  }
  _binding_map = omc_UnorderedMap_fromLists(threadData, _names, tmpMeta6, boxvar_AbsynUtil_pathHash, boxvar_AbsynUtil_pathEqual);

  tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
  _mod = omc_NFInstUtil_mergeMods2(threadData, _mod, _binding_map, tmpMeta10);
  _return: OMC_LABEL_UNUSED
  return _mod;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeComponents(threadData_t *threadData, modelica_metatype _components, modelica_string _prefix, modelica_metatype _nameMap)
{
  modelica_metatype _mergedComponent = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _prefs = NULL;
  modelica_metatype _attrs = NULL;
  modelica_metatype _mod = NULL;
  modelica_integer _i;
  modelica_string _name = NULL;
  modelica_metatype _cref = NULL;
  modelica_metatype _mods = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _mergedComponent has no default value.
  // _ty has no default value.
  // _prefs has no default value.
  // _attrs has no default value.
  // _mod has no default value.
  _i = ((modelica_integer) 1);
  // _name has no default value.
  // _cref has no default value.
  // _mods has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = listHead(_components);
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,3,8) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 5));
  _prefs = tmpMeta2;
  _attrs = tmpMeta3;
  _ty = tmpMeta4;

  tmpMeta6 = mmc_mk_cons(omc_AbsynUtil_makeIntegerSubscript(threadData, listLength(_components)), MMC_REFSTRUCTLIT(mmc_nil));
  tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(8));
  memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_attrs), 8*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[2] = tmpMeta6;
  _attrs = tmpMeta5;

  {
    modelica_metatype __omcQ_24tmpVar9;
    modelica_metatype* tmp8;
    modelica_metatype tmpMeta9;
    modelica_metatype __omcQ_24tmpVar8;
    modelica_integer tmp10;
    modelica_metatype _c_loopVar = 0;
    modelica_metatype _c;
    _c_loopVar = _components;
    tmpMeta9 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar9 = tmpMeta9; /* defaultValue */
    tmp8 = &__omcQ_24tmpVar9;
    while(1) {
      tmp10 = 1;
      if (!listEmpty(_c_loopVar)) {
        _c = MMC_CAR(_c_loopVar);
        _c_loopVar = MMC_CDR(_c_loopVar);
        tmp10--;
      }
      if (tmp10 == 0) {
        __omcQ_24tmpVar8 = omc_SCodeUtil_componentMod(threadData, _c);
        *tmp8 = mmc_mk_cons(__omcQ_24tmpVar8,0);
        tmp8 = &MMC_CDR(*tmp8);
      } else if (tmp10 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp8 = mmc_mk_nil();
    tmpMeta7 = __omcQ_24tmpVar9;
  }
  _mods = tmpMeta7;

  _mod = omc_NFInstUtil_mergeMods(threadData, _mods);

  tmpMeta11 = mmc_mk_box9(6, &SCode_Element_COMPONENT__desc, _prefix, _prefs, _attrs, _ty, _mod, _OMC_LIT3, mmc_mk_none(), _OMC_LIT6);
  _mergedComponent = tmpMeta11;

  {
    modelica_metatype _c;
    for (tmpMeta12 = _components; !listEmpty(tmpMeta12); tmpMeta12=MMC_CDR(tmpMeta12))
    {
      _c = MMC_CAR(tmpMeta12);
      /* Pattern-matching assignment */
      tmpMeta13 = _c;
      if (mmc__uniontype__metarecord__typedef__equal(tmpMeta13,3,8) == 0) MMC_THROW_INTERNAL();
      tmpMeta14 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta13), 2));
      _name = tmpMeta14;

      tmpMeta15 = mmc_mk_cons(omc_AbsynUtil_makeIntegerSubscript(threadData, _i), MMC_REFSTRUCTLIT(mmc_nil));
      tmpMeta16 = mmc_mk_box3(5, &Absyn_ComponentRef_CREF__IDENT__desc, _prefix, tmpMeta15);
      _cref = tmpMeta16;

      _i = ((modelica_integer) 1) + _i;

      omc_UnorderedMap_addUnique(threadData, _name, _cref, _nameMap);
    }
  }
  _return: OMC_LABEL_UNUSED
  return _mergedComponent;
}

PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFInstUtil_getModSignature_sub__mod__lt(threadData_t *threadData, modelica_metatype _m1, modelica_metatype _m2)
{
  modelica_boolean _res;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _res = (stringCompare((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m1), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m2), 2)))) < 0);
  _return: OMC_LABEL_UNUSED
  return _res;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFInstUtil_getModSignature_sub__mod__lt(threadData_t *threadData, modelica_metatype _m1, modelica_metatype _m2)
{
  modelica_boolean _res;
  modelica_metatype out_res;
  _res = omc_NFInstUtil_getModSignature_sub__mod__lt(threadData, _m1, _m2);
  out_res = mmc_mk_icon(_res);
  return out_res;
}

DLLDirection
modelica_string omc_NFInstUtil_getModSignature(threadData_t *threadData, modelica_metatype _mod, modelica_string _name)
{
  modelica_string _signature = NULL;
  modelica_metatype _strl = NULL;
  modelica_metatype tmpMeta1;
  modelica_boolean _has_binding;
  modelica_boolean _has_submods;
  modelica_string tmp2 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _signature has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _strl = tmpMeta1;
  // _has_binding has no default value.
  // _has_submods has no default value.
  { /* match expression */
    modelica_metatype tmp5_1;
    tmp5_1 = _mod;
    {
      volatile mmc_switch_type tmp5;
      int tmp6;
      tmp5 = 0;
      for (; tmp5 < 2; tmp5++) {
        switch (MMC_SWITCH_CAST(tmp5)) {
        case 0: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          if (mmc__uniontype__metarecord__typedef__equal(tmp5_1,0,6) == 0) goto tmp4_end;
          
          /* Pattern matching succeeded */
          _has_binding = isSome((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 5))));

          _has_submods = (!listEmpty((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 4)))));

          if(_has_binding)
          {
            tmpMeta7 = mmc_mk_cons(_OMC_LIT7, _strl);
            _strl = tmpMeta7;
          }

          if(_has_submods)
          {
            tmpMeta8 = mmc_mk_cons(_OMC_LIT8, _strl);
            _strl = tmpMeta8;

            {
              modelica_metatype _m;
              for (tmpMeta9 = omc_List_sort(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 4))), boxvar_NFInstUtil_getModSignature_sub__mod__lt); !listEmpty(tmpMeta9); tmpMeta9=MMC_CDR(tmpMeta9))
              {
                _m = MMC_CAR(tmpMeta9);
                tmpMeta10 = mmc_mk_cons(_OMC_LIT9, _strl);
                _strl = tmpMeta10;

                tmpMeta11 = mmc_mk_cons(omc_NFInstUtil_getModSignature(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m), 2)))), _strl);
                _strl = tmpMeta11;
              }
            }

            tmpMeta13 = mmc_mk_cons(_OMC_LIT10, _strl);
            _strl = tmpMeta13;
          }

          if((_has_binding || _has_submods))
          {
            tmpMeta14 = mmc_mk_cons(_name, _strl);
            _strl = tmpMeta14;
          }

          if(omc_SCodeUtil_finalBool(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 2)))))
          {
            tmpMeta15 = mmc_mk_cons(_OMC_LIT11, _strl);
            _strl = tmpMeta15;
          }

          if(omc_SCodeUtil_eachBool(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 3)))))
          {
            tmpMeta16 = mmc_mk_cons(_OMC_LIT12, _strl);
            _strl = tmpMeta16;
          }
          tmp2 = stringAppendList(_strl);
          goto tmp4_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp2 = _OMC_LIT4;
          goto tmp4_done;
        }
        }
        goto tmp4_end;
        tmp4_end: ;
      }
      goto goto_3;
      goto_3:;
      MMC_THROW_INTERNAL();
      goto tmp4_done;
      tmp4_done:;
    }
  }
  _signature = tmp2;
  _return: OMC_LABEL_UNUSED
  return _signature;
}

DLLDirection
modelica_string omc_NFInstUtil_getComponentSignature(threadData_t *threadData, modelica_metatype _element)
{
  modelica_string _signature = NULL;
  modelica_metatype _prefs = NULL;
  modelica_metatype _attrs = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _mod = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _signature has no default value.
  // _prefs has no default value.
  // _attrs has no default value.
  // _ty has no default value.
  // _mod has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _element;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,3,8) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 5));
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 6));
  _prefs = tmpMeta2;
  _attrs = tmpMeta3;
  _ty = tmpMeta4;
  _mod = tmpMeta5;

  tmpMeta6 = mmc_mk_cons(omc_SCodeDump_visibilityStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefs), 2)))), mmc_mk_cons(omc_SCodeDump_finalStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefs), 4)))), mmc_mk_cons(omc_SCodeDump_connectorTypeStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_attrs), 3)))), mmc_mk_cons(omc_SCodeDump_variabilityString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_attrs), 5)))), mmc_mk_cons(omc_Dump_unparseDirectionSymbolStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_attrs), 6)))), mmc_mk_cons(omc_Dump_unparseTypeSpec(threadData, _ty), mmc_mk_cons(omc_NFInstUtil_getModSignature(threadData, _mod, _OMC_LIT4), MMC_REFSTRUCTLIT(mmc_nil))))))));
  _signature = stringAppendList(tmpMeta6);
  _return: OMC_LABEL_UNUSED
  return _signature;
}

DLLDirection
modelica_boolean omc_NFInstUtil_isMergeableType(threadData_t *threadData, modelica_metatype _ty)
{
  modelica_boolean _mergeable;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _mergeable has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _ty;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (!optionNone(tmpMeta6)) goto tmp3_end;
          /* Pattern matching succeeded */
          tmp1 = 1 /* true */;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _mergeable = tmp1;
  _return: OMC_LABEL_UNUSED
  return _mergeable;
}
modelica_metatype boxptr_NFInstUtil_isMergeableType(threadData_t *threadData, modelica_metatype _ty)
{
  modelica_boolean _mergeable;
  modelica_metatype out_mergeable;
  _mergeable = omc_NFInstUtil_isMergeableType(threadData, _ty);
  out_mergeable = mmc_mk_icon(_mergeable);
  return out_mergeable;
}

DLLDirection
modelica_boolean omc_NFInstUtil_isMergeableMod(threadData_t *threadData, modelica_metatype _mod)
{
  modelica_boolean _mergeable;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _mergeable has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _mod;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,6) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,1,0) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype _m;
            for (tmpMeta7 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_mod), 4))); !listEmpty(tmpMeta7); tmpMeta7=MMC_CDR(tmpMeta7))
            {
              _m = MMC_CAR(tmpMeta7);
              if((!omc_NFInstUtil_isMergeableMod(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_m), 3))))))
              {
                _mergeable = 0 /* false */;

                goto _return;
              }
            }
          }
          tmp1 = 1 /* true */;
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,0) == 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmp1 = 1 /* true */;
          goto tmp3_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          tmp1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _mergeable = tmp1;
  _return: OMC_LABEL_UNUSED
  return _mergeable;
}
modelica_metatype boxptr_NFInstUtil_isMergeableMod(threadData_t *threadData, modelica_metatype _mod)
{
  modelica_boolean _mergeable;
  modelica_metatype out_mergeable;
  _mergeable = omc_NFInstUtil_isMergeableMod(threadData, _mod);
  out_mergeable = mmc_mk_icon(_mergeable);
  return out_mergeable;
}

DLLDirection
modelica_boolean omc_NFInstUtil_isMergeableComponent(threadData_t *threadData, modelica_metatype _element)
{
  modelica_boolean _isMergeable;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _isMergeable has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _element;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,3,8) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,1,0) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 5));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta8,3,0) == 0) goto tmp3_end;
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 6));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta9,1,0) == 0) goto tmp3_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 4));
          tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta10), 2));
          if (!listEmpty(tmpMeta11)) goto tmp3_end;
          tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 8));
          if (!optionNone(tmpMeta12)) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = (omc_NFInstUtil_isMergeableType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_element), 5)))) && omc_NFInstUtil_isMergeableMod(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_element), 6)))));
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _isMergeable = tmp1;
  _return: OMC_LABEL_UNUSED
  return _isMergeable;
}
modelica_metatype boxptr_NFInstUtil_isMergeableComponent(threadData_t *threadData, modelica_metatype _element)
{
  modelica_boolean _isMergeable;
  modelica_metatype out_isMergeable;
  _isMergeable = omc_NFInstUtil_isMergeableComponent(threadData, _element);
  out_isMergeable = mmc_mk_icon(_isMergeable);
  return out_isMergeable;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFInstUtil_makeMergeMap_append__merge(threadData_t *threadData, modelica_metatype _oldValue, modelica_metatype _elem)
{
  modelica_metatype _newValue = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _newValue has no default value.
  if(isSome(_oldValue))
  {
    /* Pattern-matching assignment */
    tmpMeta1 = _oldValue;
    if (optionNone(tmpMeta1)) MMC_THROW_INTERNAL();
    tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
    _newValue = tmpMeta2;
  }
  else
  {
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    _newValue = tmpMeta3;
  }

  tmpMeta4 = mmc_mk_cons(_elem, _newValue);
  _newValue = tmpMeta4;
  _return: OMC_LABEL_UNUSED
  return _newValue;
}

static modelica_metatype closure6_NFInstUtil_makeMergeMap_append__merge(threadData_t *thData, modelica_metatype closure, modelica_metatype oldValue)
{
  modelica_metatype elem = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFInstUtil_makeMergeMap_append__merge(thData, oldValue, elem);
}
DLLDirection
modelica_metatype omc_NFInstUtil_makeMergeMap(threadData_t *threadData, modelica_metatype _elements, modelica_metatype *out_unmergeable)
{
  modelica_metatype _mergeable = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _unmergeable = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _merge_map = NULL;
  modelica_metatype _grouped_elems = NULL;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _mergeable = tmpMeta1;
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _unmergeable = tmpMeta2;
  // _merge_map has no default value.
  // _grouped_elems has no default value.
  _merge_map = omc_UnorderedMap_new(threadData, boxvar_stringHashDjb2, boxvar_stringEq, ((modelica_integer) 1));

  {
    modelica_metatype _e;
    for (tmpMeta3 = _elements; !listEmpty(tmpMeta3); tmpMeta3=MMC_CDR(tmpMeta3))
    {
      _e = MMC_CAR(tmpMeta3);
      { /* match expression */
        modelica_metatype tmp6_1;
        tmp6_1 = _e;
        {
          volatile mmc_switch_type tmp6;
          int tmp7;
          tmp6 = 0;
          for (; tmp6 < 2; tmp6++) {
            switch (MMC_SWITCH_CAST(tmp6)) {
            case 0: {
              modelica_metatype tmpMeta8;
              if (mmc__uniontype__metarecord__typedef__equal(tmp6_1,3,8) == 0) goto tmp5_end;
              
              /* Pattern matching succeeded */
              /* Check guard condition after assignments */
              if (!omc_NFInstUtil_isMergeableComponent(threadData, _e)) goto tmp5_end;
              tmpMeta8 = mmc_mk_box1(0, _e);
              omc_UnorderedMap_addUpdate(threadData, omc_NFInstUtil_getComponentSignature(threadData, _e), (modelica_fnptr) mmc_mk_box2(0,closure6_NFInstUtil_makeMergeMap_append__merge,tmpMeta8), _merge_map);
              goto tmp5_done;
            }
            case 1: {
              modelica_metatype tmpMeta9;
              
              /* Pattern matching succeeded */
              tmpMeta9 = mmc_mk_cons(_e, _unmergeable);
              _unmergeable = tmpMeta9;
              goto tmp5_done;
            }
            }
            goto tmp5_end;
            tmp5_end: ;
          }
          goto goto_4;
          goto_4:;
          MMC_THROW_INTERNAL();
          goto tmp5_done;
          tmp5_done:;
        }
      }
      ;
    }
  }

  _grouped_elems = omc_UnorderedMap_valueList(threadData, _merge_map);

  {
    modelica_metatype _el;
    for (tmpMeta11 = _grouped_elems; !listEmpty(tmpMeta11); tmpMeta11=MMC_CDR(tmpMeta11))
    {
      _el = MMC_CAR(tmpMeta11);
      if((listLength(_el) == ((modelica_integer) 1)))
      {
        tmpMeta12 = mmc_mk_cons(listHead(_el), _unmergeable);
        _unmergeable = tmpMeta12;
      }
      else
      {
        tmpMeta13 = mmc_mk_cons(listReverseInPlace(_el), _mergeable);
        _mergeable = tmpMeta13;
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_unmergeable) { *out_unmergeable = _unmergeable; }
  return _mergeable;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalars3(threadData_t *threadData, modelica_metatype _elements, modelica_metatype _nameMap)
{
  modelica_metatype _outElements = NULL;
  modelica_metatype _mergeable = NULL;
  modelica_metatype _merged_e = NULL;
  modelica_integer _i;
  modelica_metatype _ty = NULL;
  modelica_string _prefix = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_string tmp3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outElements has no default value.
  // _mergeable has no default value.
  // _merged_e has no default value.
  _i = ((modelica_integer) 1) + omc_UnorderedMap_size(threadData, _nameMap);
  // _ty has no default value.
  // _prefix has no default value.
  _mergeable = omc_NFInstUtil_makeMergeMap(threadData, _elements ,&_outElements);

  {
    modelica_metatype _el;
    for (tmpMeta1 = _mergeable; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _el = MMC_CAR(tmpMeta1);
      _ty = omc_SCodeUtil_getComponentTypeSpec(threadData, listHead(_el));

      tmpMeta2 = stringAppend(_OMC_LIT0,omc_AbsynUtil_pathLastIdent(threadData, omc_AbsynUtil_typeSpecPath(threadData, _ty)));
      _prefix = tmpMeta2;

      tmp3 = modelica_integer_to_modelica_string(_i, ((modelica_integer) 0), 1 /* true */);
      tmpMeta4 = stringAppend(_prefix,tmp3);
      _merged_e = omc_NFInstUtil_mergeComponents(threadData, _el, tmpMeta4, _nameMap);

      _i = ((modelica_integer) 1) + _i;

      tmpMeta5 = mmc_mk_cons(_merged_e, _outElements);
      _outElements = tmpMeta5;
    }
  }

  _outElements = listReverseInPlace(_outElements);
  _return: OMC_LABEL_UNUSED
  return _outElements;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalars2(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcls, modelica_metatype _classPath, modelica_boolean _isRootClass, modelica_metatype _nameMap)
{
  modelica_metatype _cls = NULL;
  modelica_metatype _cdef = NULL;
  modelica_metatype _elems = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cls = __omcQ_24in_5Fcls;
  // _cdef has no default value.
  // _elems has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _cls;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,8) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 7));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,0,8) == 0) goto tmp2_end;
          
          _cdef = tmpMeta5;
          /* Pattern matching succeeded */
          _elems = omc_NFInstUtil_mergeScalars3(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cdef), 2))), _nameMap);

          {
            modelica_metatype __omcQ_24tmpVar11;
            modelica_metatype* tmp7;
            modelica_metatype tmpMeta8;
            modelica_metatype __omcQ_24tmpVar10;
            modelica_integer tmp9;
            modelica_metatype _e_loopVar = 0;
            modelica_metatype _e;
            _e_loopVar = _elems;
            tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar11 = tmpMeta8; /* defaultValue */
            tmp7 = &__omcQ_24tmpVar11;
            while(1) {
              tmp9 = 1;
              if (!listEmpty(_e_loopVar)) {
                _e = MMC_CAR(_e_loopVar);
                _e_loopVar = MMC_CDR(_e_loopVar);
                tmp9--;
              }
              if (tmp9 == 0) {
                __omcQ_24tmpVar10 = omc_NFInstUtil_mergeScalarsElement(threadData, _e, _nameMap);
                *tmp7 = mmc_mk_cons(__omcQ_24tmpVar10,0);
                tmp7 = &MMC_CDR(*tmp7);
              } else if (tmp9 == 1) {
                break;
              } else {
                goto goto_1;
              }
            }
            *tmp7 = mmc_mk_nil();
            tmpMeta6 = __omcQ_24tmpVar11;
          }
          _elems = tmpMeta6;

          tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(10));
          memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_cdef), 10*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[2] = _elems;
          _cdef = tmpMeta10;

          tmpMeta11 = MMC_TAGPTR(mmc_alloc_words(10));
          memcpy(MMC_UNTAGPTR(tmpMeta11), MMC_UNTAGPTR(_cdef), 10*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta11))[3] = omc_NFInstUtil_mergeScalarsEql(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cdef), 3))), _nameMap);
          _cdef = tmpMeta11;

          tmpMeta12 = MMC_TAGPTR(mmc_alloc_words(10));
          memcpy(MMC_UNTAGPTR(tmpMeta12), MMC_UNTAGPTR(_cdef), 10*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta12))[4] = omc_NFInstUtil_mergeScalarsEql(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cdef), 4))), _nameMap);
          _cdef = tmpMeta12;

          tmpMeta13 = MMC_TAGPTR(mmc_alloc_words(10));
          memcpy(MMC_UNTAGPTR(tmpMeta13), MMC_UNTAGPTR(_cdef), 10*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta13))[5] = omc_NFInstUtil_mergeScalarsAlgs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cdef), 5))), _nameMap);
          _cdef = tmpMeta13;

          tmpMeta14 = MMC_TAGPTR(mmc_alloc_words(10));
          memcpy(MMC_UNTAGPTR(tmpMeta14), MMC_UNTAGPTR(_cdef), 10*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta14))[6] = omc_NFInstUtil_mergeScalarsAlgs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cdef), 6))), _nameMap);
          _cdef = tmpMeta14;

          tmpMeta15 = MMC_TAGPTR(mmc_alloc_words(10));
          memcpy(MMC_UNTAGPTR(tmpMeta15), MMC_UNTAGPTR(_cls), 10*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta15))[7] = _cdef;
          _cls = tmpMeta15;

          if(_isRootClass)
          {
            tmpMeta16 = stringAppend(omc_AbsynUtil_pathString(threadData, _classPath, _OMC_LIT13, 1 /* true */, 0 /* false */),_OMC_LIT14);
            omc_System_writeFile(threadData, tmpMeta16, omc_UnorderedMap_toJSON(threadData, _nameMap, boxvar_Util_id, boxvar_Dump_printComponentRefStr));
          }
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _cls;
}
modelica_metatype boxptr_NFInstUtil_mergeScalars2(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcls, modelica_metatype _classPath, modelica_metatype _isRootClass, modelica_metatype _nameMap)
{
  modelica_integer tmp1;
  modelica_metatype _cls = NULL;
  tmp1 = mmc_unbox_integer(_isRootClass);
  _cls = omc_NFInstUtil_mergeScalars2(threadData, __omcQ_24in_5Fcls, _classPath, tmp1, _nameMap);
  /* skip box _cls; SCode.Element */
  return _cls;
}

DLLDirection
modelica_metatype omc_NFInstUtil_mergeScalars(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fnode, modelica_metatype _classPath, modelica_boolean _isRootClass, modelica_metatype _nameMap)
{
  modelica_metatype _node = NULL;
  modelica_metatype _elem = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _node = __omcQ_24in_5Fnode;
  // _elem has no default value.
  if((!omc_Flags_isSet(threadData, _OMC_LIT18)))
  {
    goto _return;
  }

  _elem = omc_NFInstNode_InstNode_definition(threadData, _node);

  _elem = omc_NFInstUtil_mergeScalars2(threadData, _elem, _classPath, _isRootClass, _nameMap);

  _node = omc_NFInstNode_InstNode_setDefinition(threadData, _elem, _node);

  omc_ExecStat_execStat(threadData, _OMC_LIT19);
  _return: OMC_LABEL_UNUSED
  return _node;
}
modelica_metatype boxptr_NFInstUtil_mergeScalars(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fnode, modelica_metatype _classPath, modelica_metatype _isRootClass, modelica_metatype _nameMap)
{
  modelica_integer tmp1;
  modelica_metatype _node = NULL;
  tmp1 = mmc_unbox_integer(_isRootClass);
  _node = omc_NFInstUtil_mergeScalars(threadData, __omcQ_24in_5Fnode, _classPath, tmp1, _nameMap);
  /* skip box _node; NFInstNode.InstNode */
  return _node;
}

DLLDirection
modelica_metatype omc_NFInstUtil_makeMergeNameMap(threadData_t *threadData)
{
  modelica_metatype _nameMap = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _nameMap = omc_UnorderedMap_new(threadData, boxvar_stringHashDjb2, boxvar_stringEq, ((modelica_integer) 1));
  _return: OMC_LABEL_UNUSED
  return _nameMap;
}

static modelica_metatype closure7_NFExpression_map(threadData_t *thData, modelica_metatype closure, modelica_metatype exp)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpression_map(thData, exp, func);
}static modelica_metatype closure8_NFExpression_map(threadData_t *thData, modelica_metatype closure, modelica_metatype exp)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpression_map(thData, exp, func);
}
DLLDirection
modelica_metatype omc_NFInstUtil_expandSlicedCrefsFunction(threadData_t *threadData, modelica_metatype _fnPath, modelica_metatype __omcQ_24in_5Ffn)
{
  modelica_metatype _fn = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _fn = __omcQ_24in_5Ffn;
  tmpMeta1 = mmc_mk_box1(0, boxvar_NFInstUtil_expandSlicedCrefsExp);
  tmpMeta2 = mmc_mk_box1(0, boxvar_NFInstUtil_expandSlicedCrefsExp);
  _fn = omc_NFFunction_Function_mapExp(threadData, _fn, (modelica_fnptr) mmc_mk_box2(0,closure7_NFExpression_map,tmpMeta1), (modelica_fnptr) mmc_mk_box2(0,closure8_NFExpression_map,tmpMeta2), 1 /* true */, 0 /* false */);

  _fn = omc_NFFunction_Function_mapBody(threadData, _fn, boxvar_NFInstUtil_expandSlicedCrefsAlg);
  _return: OMC_LABEL_UNUSED
  return _fn;
}

static modelica_metatype closure9_NFExpression_map(threadData_t *thData, modelica_metatype closure, modelica_metatype exp)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpression_map(thData, exp, func);
}
DLLDirection
modelica_metatype omc_NFInstUtil_expandSlicedCrefsStmt(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fstmt)
{
  modelica_metatype _stmt = NULL;
  modelica_metatype _e1 = NULL;
  modelica_metatype _e2 = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _stmt = __omcQ_24in_5Fstmt;
  // _e1 has no default value.
  // _e2 has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _stmt;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,4) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _e1 = tmpMeta6;
          /* Pattern matching succeeded */
          _e2 = omc_NFExpression_map(threadData, _e1, boxvar_NFInstUtil_expandSlicedCrefsExp);

          if((!referenceEq(_e1, _e2)))
          {
            tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(6));
            memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_stmt), 6*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[3] = _e2;
            _stmt = tmpMeta7;
          }
          tmpMeta1 = _stmt;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta8;
          
          /* Pattern matching succeeded */
          tmpMeta8 = mmc_mk_box1(0, boxvar_NFInstUtil_expandSlicedCrefsExp);
          tmpMeta1 = omc_NFStatement_mapExpShallow(threadData, _stmt, (modelica_fnptr) mmc_mk_box2(0,closure9_NFExpression_map,tmpMeta8));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _stmt = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _stmt;
}

DLLDirection
modelica_metatype omc_NFInstUtil_expandSlicedCrefsAlg(threadData_t *threadData, modelica_metatype __omcQ_24in_5Falg)
{
  modelica_metatype _alg = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _alg = __omcQ_24in_5Falg;
  {
    modelica_metatype __omcQ_24tmpVar13;
    modelica_metatype* tmp3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar12;
    modelica_integer tmp5;
    modelica_metatype _s_loopVar = 0;
    modelica_metatype _s;
    _s_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 2)));
    tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar13 = tmpMeta4; /* defaultValue */
    tmp3 = &__omcQ_24tmpVar13;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_s_loopVar)) {
        _s = MMC_CAR(_s_loopVar);
        _s_loopVar = MMC_CDR(_s_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        __omcQ_24tmpVar12 = omc_NFStatement_map(threadData, _s, boxvar_NFInstUtil_expandSlicedCrefsStmt);
        *tmp3 = mmc_mk_cons(__omcQ_24tmpVar12,0);
        tmp3 = &MMC_CDR(*tmp3);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp3 = mmc_mk_nil();
    tmpMeta2 = __omcQ_24tmpVar13;
  }
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(7));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_alg), 7*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[2] = tmpMeta2;
  _alg = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _alg;
}

static modelica_metatype closure10_NFExpression_map(threadData_t *thData, modelica_metatype closure, modelica_metatype exp)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpression_map(thData, exp, func);
}
DLLDirection
modelica_metatype omc_NFInstUtil_expandSlicedCrefsEq(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feq)
{
  modelica_metatype _eq = NULL;
  modelica_metatype _e1 = NULL;
  modelica_metatype _e2 = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eq = __omcQ_24in_5Feq;
  // _e1 has no default value.
  // _e2 has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _eq;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _e1 = tmpMeta5;
          /* Pattern matching succeeded */
          _e2 = omc_NFExpression_map(threadData, _e1, boxvar_NFInstUtil_expandSlicedCrefsExp);

          if((!referenceEq(_e1, _e2)))
          {
            tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(7));
            memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_eq), 7*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[3] = _e2;
            _eq = tmpMeta6;
          }
          tmpMeta1 = _eq;
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,5) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _e1 = tmpMeta7;
          /* Pattern matching succeeded */
          _e2 = omc_NFExpression_map(threadData, _e1, boxvar_NFInstUtil_expandSlicedCrefsExp);

          if((!referenceEq(_e1, _e2)))
          {
            tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(7));
            memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_eq), 7*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[3] = _e2;
            _eq = tmpMeta8;
          }
          tmpMeta1 = _eq;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          modelica_metatype tmpMeta9;
          
          /* Pattern matching succeeded */
          tmpMeta9 = mmc_mk_box1(0, boxvar_NFInstUtil_expandSlicedCrefsExp);
          tmpMeta1 = omc_NFEquation_mapExpShallow(threadData, _eq, (modelica_fnptr) mmc_mk_box2(0,closure10_NFExpression_map,tmpMeta9));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _eq = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _eq;
}

DLLDirection
modelica_metatype omc_NFInstUtil_expandSlicedCrefsExp2(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _ty)
{
  modelica_metatype _outExp = NULL;
  modelica_metatype _cr = NULL;
  modelica_metatype _iterators = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _cr has no default value.
  // _iterators has no default value.
  _cr = omc_NFComponentRef_iterate(threadData, _cref ,&_iterators);

  tmpMeta1 = mmc_mk_box6(7, &NFCall_TYPED__ARRAY__CONSTRUCTOR__desc, _ty, mmc_mk_integer(omc_NFComponentRef_variability(threadData, _cref)), mmc_mk_integer(omc_NFComponentRef_purity(threadData, _cref)), omc_NFExpression_fromCref(threadData, _cr, 0 /* false */), _iterators);
  tmpMeta2 = mmc_mk_box2(16, &NFExpression_CALL__desc, tmpMeta1);
  _outExp = tmpMeta2;
  _return: OMC_LABEL_UNUSED
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_expandSlicedCrefsExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!omc_NFComponentRef_isSliced(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))))) goto tmp3_end;
          tmpMeta1 = omc_NFInstUtil_expandSlicedCrefsExp2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))));
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_expandSlicedCrefs(threadData_t *threadData, modelica_metatype __omcQ_24in_5FflatModel, modelica_metatype __omcQ_24in_5Ffunctions, modelica_metatype *out_functions)
{
  modelica_metatype _flatModel = NULL;
  modelica_metatype _functions = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flatModel = __omcQ_24in_5FflatModel;
  _functions = __omcQ_24in_5Ffunctions;
  if((omc_Flags_isSet(threadData, _OMC_LIT23) || (!omc_Flags_isSet(threadData, _OMC_LIT27))))
  {
    goto _return;
  }

  {
    modelica_metatype __omcQ_24tmpVar15;
    modelica_metatype* tmp3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar14;
    modelica_integer tmp5;
    modelica_metatype _v_loopVar = 0;
    modelica_metatype _v;
    _v_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3)));
    tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar15 = tmpMeta4; /* defaultValue */
    tmp3 = &__omcQ_24tmpVar15;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_v_loopVar)) {
        _v = MMC_CAR(_v_loopVar);
        _v_loopVar = MMC_CDR(_v_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        __omcQ_24tmpVar14 = omc_NFVariable_mapExpShallow(threadData, _v, boxvar_NFInstUtil_expandSlicedCrefsExp);
        *tmp3 = mmc_mk_cons(__omcQ_24tmpVar14,0);
        tmp3 = &MMC_CDR(*tmp3);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp3 = mmc_mk_nil();
    tmpMeta2 = __omcQ_24tmpVar15;
  }
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[3] = tmpMeta2;
  _flatModel = tmpMeta1;

  _flatModel = omc_NFFlatModel_mapEquations(threadData, _flatModel, boxvar_NFInstUtil_expandSlicedCrefsEq);

  _flatModel = omc_NFFlatModel_mapAlgorithms(threadData, _flatModel, boxvar_NFInstUtil_expandSlicedCrefsAlg);

  _functions = omc_NFFlatten_FunctionTreeImpl_map(threadData, _functions, boxvar_NFInstUtil_expandSlicedCrefsFunction);
  _return: OMC_LABEL_UNUSED
  if (out_functions) { *out_functions = _functions; }
  return _flatModel;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFInstUtil_replaceEmptyArraysExp_traverser(threadData_t *threadData, modelica_metatype _exp)
{
  modelica_metatype _outExp = NULL;
  modelica_metatype _cref = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _cref has no default value.
  // _subs has no default value.
  // _ty has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _cref = tmpMeta6;
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!omc_NFComponentRef_isEmptyArray(threadData, _cref)) goto tmp3_end;
          if(omc_NFComponentRef_hasSubscripts(threadData, _cref))
          {
            _cref = omc_NFComponentRef_fillSubscripts(threadData, _cref);

            _cref = omc_NFComponentRef_replaceWholeSubscripts(threadData, _cref);

            _subs = omc_NFComponentRef_subscriptsAllFlat(threadData, _cref);

            _cref = omc_NFComponentRef_stripSubscriptsAll(threadData, _cref);

            _ty = omc_NFComponentRef_getSubscriptedType(threadData, _cref, 0 /* false */);
          }
          else
          {
            tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
            _subs = tmpMeta7;

            _ty = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2)));
          }

          _outExp = omc_NFExpression_makeDefaultValue(threadData, _ty, mmc_mk_none(), mmc_mk_none());

          if((!listEmpty(_subs)))
          {
            tmpMeta8 = mmc_mk_box5(29, &NFExpression_SUBSCRIPTED__EXP__desc, _outExp, _subs, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), mmc_mk_boolean(0 /* false */));
            _outExp = tmpMeta8;
          }
          tmpMeta1 = _outExp;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outExp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_replaceEmptyArraysExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp)
{
  modelica_metatype _exp = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  _exp = omc_NFExpression_map(threadData, _exp, boxvar_NFInstUtil_replaceEmptyArraysExp_traverser);
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_replaceEmptyArrays(threadData_t *threadData, modelica_metatype __omcQ_24in_5FflatModel)
{
  modelica_metatype _flatModel = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flatModel = __omcQ_24in_5FflatModel;
  _flatModel = omc_NFFlatModel_mapExp(threadData, _flatModel, boxvar_NFInstUtil_replaceEmptyArraysExp);
  _return: OMC_LABEL_UNUSED
  return _flatModel;
}

DLLDirection
modelica_string omc_NFInstUtil_dumpFlatModel(threadData_t *threadData, modelica_metatype _flatModel, modelica_metatype _functions)
{
  modelica_string _str = NULL;
  modelica_metatype _flat_model = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _str has no default value.
  // _flat_model has no default value.
  _flat_model = omc_NFInstUtil_combineSubscripts(threadData, _flatModel);

  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _str = omc_NFFlatModel_toFlatString(threadData, _flat_model, omc_NFFlatten_FunctionTreeImpl_listValues(threadData, _functions, tmpMeta1), 0 /* false */);
  _return: OMC_LABEL_UNUSED
  return _str;
}

DLLDirection
void omc_NFInstUtil_printStructuralParameters(threadData_t *threadData, modelica_metatype _flatModel)
{
  modelica_metatype _params = NULL;
  modelica_metatype _names = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta9;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _params has no default value.
  // _names has no default value.
  if(omc_Flags_isSet(threadData, _OMC_LIT37))
  {
    {
      modelica_metatype __omcQ_24tmpVar17;
      modelica_metatype* tmp2;
      modelica_metatype tmpMeta3;
      modelica_metatype __omcQ_24tmpVar16;
      modelica_integer tmp4;
      modelica_metatype _v_loopVar = 0;
      modelica_metatype _v;
      _v_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3)));
      tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
      __omcQ_24tmpVar17 = tmpMeta3; /* defaultValue */
      tmp2 = &__omcQ_24tmpVar17;
      while(1) {
        tmp4 = 1;
        while (!listEmpty(_v_loopVar)) {
          _v = MMC_CAR(_v_loopVar);
          _v_loopVar = MMC_CDR(_v_loopVar);
          if (omc_NFVariable_isStructural(threadData, _v)) {
            tmp4--;
            break;
          }
        }
        if (tmp4 == 0) {
          __omcQ_24tmpVar16 = _v;
          *tmp2 = mmc_mk_cons(__omcQ_24tmpVar16,0);
          tmp2 = &MMC_CDR(*tmp2);
        } else if (tmp4 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      *tmp2 = mmc_mk_nil();
      tmpMeta1 = __omcQ_24tmpVar17;
    }
    _params = tmpMeta1;

    if((!listEmpty(_params)))
    {
      {
        modelica_metatype __omcQ_24tmpVar19;
        modelica_metatype* tmp6;
        modelica_metatype tmpMeta7;
        modelica_string __omcQ_24tmpVar18;
        modelica_integer tmp8;
        modelica_metatype _v_loopVar = 0;
        modelica_metatype _v;
        _v_loopVar = _params;
        tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
        __omcQ_24tmpVar19 = tmpMeta7; /* defaultValue */
        tmp6 = &__omcQ_24tmpVar19;
        while(1) {
          tmp8 = 1;
          if (!listEmpty(_v_loopVar)) {
            _v = MMC_CAR(_v_loopVar);
            _v_loopVar = MMC_CDR(_v_loopVar);
            tmp8--;
          }
          if (tmp8 == 0) {
            __omcQ_24tmpVar18 = omc_NFComponentRef_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_v), 2))));
            *tmp6 = mmc_mk_cons(__omcQ_24tmpVar18,0);
            tmp6 = &MMC_CDR(*tmp6);
          } else if (tmp8 == 1) {
            break;
          } else {
            MMC_THROW_INTERNAL();
          }
        }
        *tmp6 = mmc_mk_nil();
        tmpMeta5 = __omcQ_24tmpVar19;
      }
      _names = tmpMeta5;

      tmpMeta9 = mmc_mk_cons(stringDelimitList(_names, _OMC_LIT33), MMC_REFSTRUCTLIT(mmc_nil));
      omc_Error_addMessage(threadData, _OMC_LIT32, tmpMeta9);
    }
  }
  _return: OMC_LABEL_UNUSED
  return;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFInstUtil_combineSubscriptsExp_traverser(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp)
{
  modelica_metatype _exp = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _exp;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,6,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_exp), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[3] = omc_NFComponentRef_combineSubscripts(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))));
          _exp = tmpMeta5;
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_combineSubscriptsExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp)
{
  modelica_metatype _exp = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  _exp = omc_NFExpression_map(threadData, _exp, boxvar_NFInstUtil_combineSubscriptsExp_traverser);
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFInstUtil_combineSubscripts(threadData_t *threadData, modelica_metatype __omcQ_24in_5FflatModel)
{
  modelica_metatype _flatModel = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flatModel = __omcQ_24in_5FflatModel;
  if(omc_Flags_isSet(threadData, _OMC_LIT23))
  {
    _flatModel = omc_NFFlatModel_mapExp(threadData, _flatModel, boxvar_NFInstUtil_combineSubscriptsExp);
  }
  _return: OMC_LABEL_UNUSED
  return _flatModel;
}

DLLDirection
void omc_NFInstUtil_dumpFlatModelDebug(threadData_t *threadData, modelica_string _stage, modelica_metatype _flatModel, modelica_metatype _functions)
{
  modelica_metatype _flat_model = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flat_model = _flatModel;
  if(((stringEqual(omc_Flags_getConfigString(threadData, _OMC_LIT65), _OMC_LIT49)) || (stringEqual(omc_Flags_getConfigString(threadData, _OMC_LIT65), _OMC_LIT45))))
  {
    _flat_model = omc_NFFlatModel_obfuscate(threadData, _flat_model);
  }

  if((omc_Flags_isConfigFlagSet(threadData, _OMC_LIT109, _stage) || listEmpty(omc_Flags_getConfigStringList(threadData, _OMC_LIT109))))
  {
    _flat_model = omc_NFInstUtil_combineSubscripts(threadData, _flatModel);

    fputs(MMC_STRINGDATA(_OMC_LIT66),stdout);

    fputs(MMC_STRINGDATA(_stage),stdout);

    fputs(MMC_STRINGDATA(_OMC_LIT67),stdout);

    if(omc_Flags_getConfigBool(threadData, _OMC_LIT74))
    {
      tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
      omc_NFFlatModel_printFlatString(threadData, _flat_model, omc_NFFlatten_FunctionTreeImpl_listValues(threadData, _functions, tmpMeta1), 0 /* false */);
    }
    else
    {
      omc_NFFlatModel_printString(threadData, _flat_model, 0 /* false */);
    }

    fputs(MMC_STRINGDATA(_OMC_LIT75),stdout);
  }
  _return: OMC_LABEL_UNUSED
  return;
}

