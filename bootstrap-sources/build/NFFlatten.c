#include "omc_simulation_settings.h"
#include "NFFlatten.h"
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT0,1,5) {&ErrorTypes_MessageType_TRANSLATION__desc,}};
#define _OMC_LIT0 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT0)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT1,1,4) {&ErrorTypes_Severity_ERROR__desc,}};
#define _OMC_LIT1 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT1)
#define _OMC_LIT2_data "Negative dimension index (%s) for component %s."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT2,47,_OMC_LIT2_data);
#define _OMC_LIT2 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT2)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT3,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT2}};
#define _OMC_LIT3 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT3)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT4,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(265)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT3}};
#define _OMC_LIT4 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT4)
#define _OMC_LIT5_data "\n- Component '"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT5,14,_OMC_LIT5_data);
#define _OMC_LIT5 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT5)
#define _OMC_LIT6_data "."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT6,1,_OMC_LIT6_data);
#define _OMC_LIT6 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data "' is used in a parallel for loop."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,33,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
#define _OMC_LIT8_data "\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT8,1,_OMC_LIT8_data);
#define _OMC_LIT8 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT8)
#define _OMC_LIT9_data "- Parallel for loops can only contain references to parglobal variables"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT9,71,_OMC_LIT9_data);
#define _OMC_LIT9 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "ParModelica: %s."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,16,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT11,2,4) {&Gettext_TranslatableContent_notrans__desc,_OMC_LIT10}};
#define _OMC_LIT11 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT11)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT12,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(7005)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT11}};
#define _OMC_LIT12 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT12)
#define _OMC_LIT13_data "NFFlatten.resolveArrayConnections"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT13,33,_OMC_LIT13_data);
#define _OMC_LIT13 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT13)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT14,1,3) {&NFBinding_UNBOUND__desc,}};
#define _OMC_LIT14 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT14)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT15,1,4) {&NFComponentRef_EMPTY__desc,}};
#define _OMC_LIT15 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT15)
#define _OMC_LIT16_data "_"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT16,1,_OMC_LIT16_data);
#define _OMC_LIT16 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT16)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT17,1,11) {&NFInstNode_InstNode_EMPTY__NODE__desc,}};
#define _OMC_LIT17 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT17)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT18,1,3) {&DAE_Prefix_NOPRE__desc,}};
#define _OMC_LIT18 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT18)
#define _OMC_LIT19_data ""
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT19,0,_OMC_LIT19_data);
#define _OMC_LIT19 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT19)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT20,1,11) {&DAE_Type_T__UNKNOWN__desc,}};
#define _OMC_LIT20 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT20)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT21,4,4) {&DAE_ComponentRef_CREF__IDENT__desc,_OMC_LIT19,_OMC_LIT20,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT21 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT21)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT22,2,0) {_OMC_LIT21,_OMC_LIT21}};
#define _OMC_LIT22 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT22)
#define _OMC_LIT23_data "exposeLocalIOs"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT23,14,_OMC_LIT23_data);
#define _OMC_LIT23 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT23)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT24,1,4) {&Flags_FlagVisibility_EXTERNAL__desc,}};
#define _OMC_LIT24 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT24)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT25,2,5) {&Flags_FlagData_INT__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0))}};
#define _OMC_LIT25 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT25)
#define _OMC_LIT26_data "Introduces top-level inputs/outputs for unconnected input/output connectors at requested levels, provided they are public, 0 meaning top-level (standard Modelica), 1 inputs/outputs of top-level components, >1 going deeper. This flag is particularly useful for FMI export."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT26,271,_OMC_LIT26_data);
#define _OMC_LIT26 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT26)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT27,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT26}};
#define _OMC_LIT27 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT27)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT28,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(152)),_OMC_LIT23,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT24,_OMC_LIT25,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT27}};
#define _OMC_LIT28 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT28)
#define _OMC_LIT29_data "NFFlatten.resolveConnections"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT29,28,_OMC_LIT29_data);
#define _OMC_LIT29 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT29)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT30,2,3) {&DAE_Exp_ICONST__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(-1))}};
#define _OMC_LIT30 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT30)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT31,2,5) {&DAE_Subscript_INDEX__desc,_OMC_LIT30}};
#define _OMC_LIT31 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT31)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT32,2,1) {_OMC_LIT31,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT32 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT32)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT33,1,4) {&DAE_ComponentPrefix_NOCOMPPRE__desc,}};
#define _OMC_LIT33 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT33)
#define _OMC_LIT34_data "?"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT34,1,_OMC_LIT34_data);
#define _OMC_LIT34 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT34)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT35,2,4) {&Absyn_Path_IDENT__desc,_OMC_LIT34}};
#define _OMC_LIT35 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT35)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT36,2,3) {&ClassInf_State_UNKNOWN__desc,_OMC_LIT35}};
#define _OMC_LIT36 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT36)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT37,0.0);
#define _OMC_LIT37 MMC_REFREALLIT(_OMC_LIT_STRUCT37)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT38,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT19,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),_OMC_LIT37}};
#define _OMC_LIT38 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT38)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT39,3,3) {&NFFlatten_Prefix_PREFIX__desc,_OMC_LIT17,_OMC_LIT15}};
#define _OMC_LIT39 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT39)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT40,4,3) {&NFCeval_EvalTarget_EVAL__TARGET__desc,_OMC_LIT38,MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT40 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT40)
#define _OMC_LIT41_data "Failed to evaluate branch condition in if equation containing connect equations: `"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT41,82,_OMC_LIT41_data);
#define _OMC_LIT41 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT41)
#define _OMC_LIT42_data "`"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT42,1,_OMC_LIT42_data);
#define _OMC_LIT42 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT42)
#define _OMC_LIT43_data "Array dimension mismatch, expression %s has type %s, expected array dimensions [%s]."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT43,84,_OMC_LIT43_data);
#define _OMC_LIT43 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT43)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT44,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT43}};
#define _OMC_LIT44 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT44)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT45,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(43)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT44}};
#define _OMC_LIT45 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT45)
#define _OMC_LIT46_data "Type mismatch in if-expression in component %s. True branch: %s has type %s, false branch: %s has type %s."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT46,106,_OMC_LIT46_data);
#define _OMC_LIT46 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT46)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT47,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT46}};
#define _OMC_LIT47 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT47)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT48,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(83)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT47}};
#define _OMC_LIT48 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT48)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT49,1,8) {&NFSubscript_WHOLE__desc,}};
#define _OMC_LIT49 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT49)
#define _OMC_LIT50_data "NFFlatten.flattenBinding got untyped binding."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT50,45,_OMC_LIT50_data);
#define _OMC_LIT50 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT50)
#define _OMC_LIT51_data "/home/adrpo33/OpenModelica/OMCompiler/Compiler/NFFrontEnd/NFFlatten.mo"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT51,70,_OMC_LIT51_data);
#define _OMC_LIT51 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT51)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT52_6,1.758197185e9);
#define _OMC_LIT52_6 MMC_REFREALLIT(_OMC_LIT_STRUCT52_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT52,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT51,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1585)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1585)),MMC_IMMEDIATE(MMC_TAGFIXNUM(90)),_OMC_LIT52_6}};
#define _OMC_LIT52 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT52)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT53,1,3) {&NFType_INTEGER__desc,}};
#define _OMC_LIT53 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT53)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT54,2,3) {&NFExpression_INTEGER__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(1))}};
#define _OMC_LIT54 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT54)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT55,1,3) {&NFStatement_ForType_NORMAL__desc,}};
#define _OMC_LIT55 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT55)
#define _OMC_LIT56_data "newBackend"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT56,10,_OMC_LIT56_data);
#define _OMC_LIT56 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT56)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT57,2,4) {&Flags_FlagData_BOOL__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT57 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT57)
#define _OMC_LIT58_data "Activates experimental new backend for better array handling. This also activates the new frontend. [WIP]"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT58,105,_OMC_LIT58_data);
#define _OMC_LIT58 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT58)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT59,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT58}};
#define _OMC_LIT59 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT59)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT60,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(140)),_OMC_LIT56,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT24,_OMC_LIT57,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT59}};
#define _OMC_LIT60 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT60)
#define _OMC_LIT61_data "fill"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT61,4,_OMC_LIT61_data);
#define _OMC_LIT61 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT61)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT62,2,4) {&Absyn_Path_IDENT__desc,_OMC_LIT61}};
#define _OMC_LIT62 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT62)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT63,1,13) {&NFType_UNKNOWN__desc,}};
#define _OMC_LIT63 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT63)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT64,1,7) {&DAE_InlineType_NO__INLINE__desc,}};
#define _OMC_LIT64 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT64)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT65,3,4) {&DAE_FunctionBuiltin_FUNCTION__BUILTIN__desc,MMC_REFSTRUCTLIT(mmc_none),MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT65 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT65)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT66,1,3) {&DAE_FunctionParallelism_FP__NON__PARALLEL__desc,}};
#define _OMC_LIT66 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT66)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT67,7,3) {&DAE_FunctionAttributes_FUNCTION__ATTRIBUTES__desc,_OMC_LIT64,MMC_IMMEDIATE(MMC_TAGFIXNUM(1 /* true */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT65,_OMC_LIT66}};
#define _OMC_LIT67 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT67)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT68,1,1) {MMC_IMMEDIATE(MMC_TAGFIXNUM(1))}};
#define _OMC_LIT68 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT68)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT69,1,1) {MMC_IMMEDIATE(MMC_TAGFIXNUM(0))}};
#define _OMC_LIT69 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT69)
#define _OMC_LIT70_data "$"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT70,1,_OMC_LIT70_data);
#define _OMC_LIT70 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT70)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT71,5,3) {&NFSections_SECTIONS__desc,MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT71 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT71)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT72,1,1) {_OMC_LIT14}};
#define _OMC_LIT72 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT72)
#define _OMC_LIT73_data "NFFlatten.getRecordBindings got non-record binding "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT73,51,_OMC_LIT73_data);
#define _OMC_LIT73 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT73)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT74_6,1.758197185e9);
#define _OMC_LIT74_6 MMC_REFREALLIT(_OMC_LIT_STRUCT74_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT74,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT51,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(914)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(915)),MMC_IMMEDIATE(MMC_TAGFIXNUM(58)),_OMC_LIT74_6}};
#define _OMC_LIT74 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT74)
#define _OMC_LIT75_data "NFFlatten.getRecordBindings got record binding with wrong number of elements for "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT75,81,_OMC_LIT75_data);
#define _OMC_LIT75 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT75)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT76_6,1.758197185e9);
#define _OMC_LIT76_6 MMC_REFREALLIT(_OMC_LIT_STRUCT76_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT76,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT51,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(920)),MMC_IMMEDIATE(MMC_TAGFIXNUM(3)),MMC_IMMEDIATE(MMC_TAGFIXNUM(922)),MMC_IMMEDIATE(MMC_TAGFIXNUM(18)),_OMC_LIT76_6}};
#define _OMC_LIT76 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT76)
#define _OMC_LIT77_data "fixed"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT77,5,_OMC_LIT77_data);
#define _OMC_LIT77 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT77)
#define _OMC_LIT78_data "start"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT78,5,_OMC_LIT78_data);
#define _OMC_LIT78 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT78)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT79,1,5) {&ErrorTypes_Severity_WARNING__desc,}};
#define _OMC_LIT79 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT79)
#define _OMC_LIT80_data "Parameter %s has no value, and is fixed during initialization (fixed=true), using available start value (start=%s) as default value."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT80,132,_OMC_LIT80_data);
#define _OMC_LIT80 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT80)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT81,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT80}};
#define _OMC_LIT81 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT81)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT82,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(499)),_OMC_LIT0,_OMC_LIT79,_OMC_LIT81}};
#define _OMC_LIT82 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT82)
#define _OMC_LIT83_data "Parameter %s has neither value nor start value, and is fixed during initialization (fixed=true)."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT83,96,_OMC_LIT83_data);
#define _OMC_LIT83 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT83)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT84,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT83}};
#define _OMC_LIT84 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT84)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT85,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(500)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT84}};
#define _OMC_LIT85 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT85)
#define _OMC_LIT86_data "min"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT86,3,_OMC_LIT86_data);
#define _OMC_LIT86 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT86)
#define _OMC_LIT87_data "max"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT87,3,_OMC_LIT87_data);
#define _OMC_LIT87 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT87)
#define _OMC_LIT88_data "Constant '%s' must be fixed but has 'fixed = false'"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT88,51,_OMC_LIT88_data);
#define _OMC_LIT88 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT88)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT89,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT88}};
#define _OMC_LIT89 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT89)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT90,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(413)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT89}};
#define _OMC_LIT90 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT90)
#define _OMC_LIT91_data "Constant '%s' has no value."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT91,27,_OMC_LIT91_data);
#define _OMC_LIT91 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT91)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT92,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT91}};
#define _OMC_LIT92 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT92)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT93,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(26)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT92}};
#define _OMC_LIT93 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT93)
#define _OMC_LIT94_data "Component '%s' has an unspecified enumeration type (enumeration(:))."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT94,68,_OMC_LIT94_data);
#define _OMC_LIT94 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT94)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT95,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT94}};
#define _OMC_LIT95 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT95)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT96,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(407)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT95}};
#define _OMC_LIT96 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT96)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT97,1,6) {&ErrorTypes_Severity_NOTIFICATION__desc,}};
#define _OMC_LIT97 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT97)
#define _OMC_LIT98_data "Top-level input '%s' has a binding equation and will not be accessible as an input of the model."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT98,96,_OMC_LIT98_data);
#define _OMC_LIT98 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT98)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT99,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT98}};
#define _OMC_LIT99 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT99)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT100,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(381)),_OMC_LIT0,_OMC_LIT97,_OMC_LIT99}};
#define _OMC_LIT100 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT100)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT101,2,6) {&NFExpression_BOOLEAN__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT101 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT101)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT102,1,35) {&NFBackendExtension_VariableKind_FRONTEND__DUMMY__desc,}};
#define _OMC_LIT102 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT102)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT103,17,3) {&NFBackendExtension_VariableAttributes_VAR__ATTR__REAL__desc,MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT103 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT103)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT104,3,3) {&NFBackendExtension_Annotations_ANNOTATIONS__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT104 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT104)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT105,8,3) {&NFBackendExtension_BackendInfo_BACKEND__INFO__desc,_OMC_LIT102,_OMC_LIT103,_OMC_LIT104,MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT105 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT105)
#define _OMC_LIT106_data "The conditional expression %s could not be evaluated."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT106,53,_OMC_LIT106_data);
#define _OMC_LIT106 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT106)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT107,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT106}};
#define _OMC_LIT107 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT107)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT108,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(137)),_OMC_LIT0,_OMC_LIT1,_OMC_LIT107}};
#define _OMC_LIT108 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT108)
#define _OMC_LIT109_data "NFFlatten.flattenComponent got unknown component"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT109,48,_OMC_LIT109_data);
#define _OMC_LIT109 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT109)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT110_6,1.758197185e9);
#define _OMC_LIT110_6 MMC_REFREALLIT(_OMC_LIT_STRUCT110_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT110,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT51,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(573)),MMC_IMMEDIATE(MMC_TAGFIXNUM(15)),MMC_IMMEDIATE(MMC_TAGFIXNUM(573)),MMC_IMMEDIATE(MMC_TAGFIXNUM(97)),_OMC_LIT110_6}};
#define _OMC_LIT110 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT110)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT111_6,1.758197185e9);
#define _OMC_LIT111_6 MMC_REFREALLIT(_OMC_LIT_STRUCT111_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT111,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT51,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(589)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(589)),MMC_IMMEDIATE(MMC_TAGFIXNUM(91)),_OMC_LIT111_6}};
#define _OMC_LIT111 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT111)
#define _OMC_LIT112_data "NFFlatten.flattenClass got non-instantiated component "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT112,54,_OMC_LIT112_data);
#define _OMC_LIT112 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT112)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT113_6,1.758197185e9);
#define _OMC_LIT113_6 MMC_REFREALLIT(_OMC_LIT_STRUCT113_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT113,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT51,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(510)),MMC_IMMEDIATE(MMC_TAGFIXNUM(9)),MMC_IMMEDIATE(MMC_TAGFIXNUM(510)),MMC_IMMEDIATE(MMC_TAGFIXNUM(134)),_OMC_LIT113_6}};
#define _OMC_LIT113 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT113)
#define _OMC_LIT114_data "NFFlatten.collectFunctions"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT114,26,_OMC_LIT114_data);
#define _OMC_LIT114 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT114)
#define _OMC_LIT115_data "nfScalarize"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT115,11,_OMC_LIT115_data);
#define _OMC_LIT115 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT115)
#define _OMC_LIT116_data "Run scalarization in NF, default true."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT116,38,_OMC_LIT116_data);
#define _OMC_LIT116 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT116)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT117,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT116}};
#define _OMC_LIT117 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT117)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT118,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(168)),_OMC_LIT115,MMC_IMMEDIATE(MMC_TAGFIXNUM(1 /* true */)),_OMC_LIT117}};
#define _OMC_LIT118 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT118)
#define _OMC_LIT119_data "arrayConnect"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT119,12,_OMC_LIT119_data);
#define _OMC_LIT119 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT119)
#define _OMC_LIT120_data "Use experimental array connection handler."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT120,42,_OMC_LIT120_data);
#define _OMC_LIT120 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT120)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT121,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT120}};
#define _OMC_LIT121 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT121)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT122,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(182)),_OMC_LIT119,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT121}};
#define _OMC_LIT122 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT122)
#define _OMC_LIT123_data "nfAPI"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT123,5,_OMC_LIT123_data);
#define _OMC_LIT123 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT123)
#define _OMC_LIT124_data "Enables experimental new instantiation use in the OMC API."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT124,58,_OMC_LIT124_data);
#define _OMC_LIT124 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT124)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT125,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT124}};
#define _OMC_LIT125 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT125)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT126,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(171)),_OMC_LIT123,MMC_IMMEDIATE(MMC_TAGFIXNUM(1 /* true */)),_OMC_LIT125}};
#define _OMC_LIT126 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT126)
#define _OMC_LIT127_data "checkModel"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT127,10,_OMC_LIT127_data);
#define _OMC_LIT127 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT127)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT128,1,3) {&Flags_FlagVisibility_INTERNAL__desc,}};
#define _OMC_LIT128 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT128)
#define _OMC_LIT129_data "Set when checkModel is used to turn on specific features for checking."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT129,70,_OMC_LIT129_data);
#define _OMC_LIT129 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT129)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT130,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT129}};
#define _OMC_LIT130 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT130)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT131,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(29)),_OMC_LIT127,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT128,_OMC_LIT57,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT130}};
#define _OMC_LIT131 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT131)
#define _OMC_LIT132_data "vectorizeBindings"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT132,17,_OMC_LIT132_data);
#define _OMC_LIT132 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT132)
#define _OMC_LIT133_data "Turns on vectorization of bindings when scalarization is turned off."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT133,68,_OMC_LIT133_data);
#define _OMC_LIT133 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT133)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT134,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT133}};
#define _OMC_LIT134 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT134)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT135,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(192)),_OMC_LIT132,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),_OMC_LIT134}};
#define _OMC_LIT135 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT135)
#define _OMC_LIT136_data "allowNonStandardModelica"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT136,24,_OMC_LIT136_data);
#define _OMC_LIT136 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT136)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT137,2,9) {&Flags_FlagData_STRING__LIST__FLAG__desc,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT137 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT137)
#define _OMC_LIT138_data "nonStdMultipleExternalDeclarations"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT138,34,_OMC_LIT138_data);
#define _OMC_LIT138 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT138)
#define _OMC_LIT139_data "Allow several external declarations in functions.\nSee: https://specification.modelica.org/maint/3.5/functions.html#function-as-a-specialized-class"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT139,146,_OMC_LIT139_data);
#define _OMC_LIT139 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT139)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT140,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT139}};
#define _OMC_LIT140 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT140)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT141,2,0) {_OMC_LIT138,_OMC_LIT140}};
#define _OMC_LIT141 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT141)
#define _OMC_LIT142_data "nonStdEnumerationAsIntegers"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT142,27,_OMC_LIT142_data);
#define _OMC_LIT142 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT142)
#define _OMC_LIT143_data "Allow enumeration as integer without casting via Integer(Enum).\nSee: https://specification.modelica.org/maint/3.5/class-predefined-types-and-declarations.html#type-conversion-of-enumeration-values-to-string-or-integer"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT143,217,_OMC_LIT143_data);
#define _OMC_LIT143 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT143)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT144,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT143}};
#define _OMC_LIT144 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT144)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT145,2,0) {_OMC_LIT142,_OMC_LIT144}};
#define _OMC_LIT145 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT145)
#define _OMC_LIT146_data "nonStdIntegersAsEnumeration"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT146,27,_OMC_LIT146_data);
#define _OMC_LIT146 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT146)
#define _OMC_LIT147_data "Allow integer as enumeration without casting via Enum(Integer).\nSee: https://specification.modelica.org/maint/3.5/class-predefined-types-and-declarations.html#type-conversion-of-integer-to-enumeration-values"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT147,207,_OMC_LIT147_data);
#define _OMC_LIT147 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT147)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT148,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT147}};
#define _OMC_LIT148 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT148)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT149,2,0) {_OMC_LIT146,_OMC_LIT148}};
#define _OMC_LIT149 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT149)
#define _OMC_LIT150_data "nonStdDifferentCaseFileVsClassName"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT150,34,_OMC_LIT150_data);
#define _OMC_LIT150 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT150)
#define _OMC_LIT151_data "Allow directory or file with different case in the name than the contained class name.\nSee: https://specification.modelica.org/maint/3.5/packages.html#mapping-package-class-structures-to-a-hierarchical-file-system"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT151,213,_OMC_LIT151_data);
#define _OMC_LIT151 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT151)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT152,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT151}};
#define _OMC_LIT152 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT152)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT153,2,0) {_OMC_LIT150,_OMC_LIT152}};
#define _OMC_LIT153 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT153)
#define _OMC_LIT154_data "nonStdTopLevelOuter"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT154,19,_OMC_LIT154_data);
#define _OMC_LIT154 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT154)
#define _OMC_LIT155_data "Allow top level outer.\nSee: https://specification.modelica.org/maint/3.6/scoping-name-lookup-and-flattening.html#S4.p1"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT155,118,_OMC_LIT155_data);
#define _OMC_LIT155 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT155)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT156,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT155}};
#define _OMC_LIT156 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT156)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT157,2,0) {_OMC_LIT154,_OMC_LIT156}};
#define _OMC_LIT157 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT157)
#define _OMC_LIT158_data "protectedAccess"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT158,15,_OMC_LIT158_data);
#define _OMC_LIT158 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT158)
#define _OMC_LIT159_data "Allow access of protected elements"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT159,34,_OMC_LIT159_data);
#define _OMC_LIT159 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT159)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT160,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT159}};
#define _OMC_LIT160 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT160)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT161,2,0) {_OMC_LIT158,_OMC_LIT160}};
#define _OMC_LIT161 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT161)
#define _OMC_LIT162_data "reinitInAlgorithms"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT162,18,_OMC_LIT162_data);
#define _OMC_LIT162 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT162)
#define _OMC_LIT163_data "Allow reinit in algorithm sections"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT163,34,_OMC_LIT163_data);
#define _OMC_LIT163 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT163)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT164,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT163}};
#define _OMC_LIT164 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT164)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT165,2,0) {_OMC_LIT162,_OMC_LIT164}};
#define _OMC_LIT165 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT165)
#define _OMC_LIT166_data "unbalancedModel"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT166,15,_OMC_LIT166_data);
#define _OMC_LIT166 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT166)
#define _OMC_LIT167_data "Allow models to be locally unbalanced and to have unbalanced connectors"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT167,71,_OMC_LIT167_data);
#define _OMC_LIT167 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT167)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT168,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT167}};
#define _OMC_LIT168 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT168)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT169,2,0) {_OMC_LIT166,_OMC_LIT168}};
#define _OMC_LIT169 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT169)
#define _OMC_LIT170_data "implicitParameterStartAttribute"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT170,31,_OMC_LIT170_data);
#define _OMC_LIT170 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT170)
#define _OMC_LIT171_data "Allow fixed parameters with no binding or start attribute"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT171,57,_OMC_LIT171_data);
#define _OMC_LIT171 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT171)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT172,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT171}};
#define _OMC_LIT172 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT172)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT173,2,0) {_OMC_LIT170,_OMC_LIT172}};
#define _OMC_LIT173 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT173)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT174,2,1) {_OMC_LIT173,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT174 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT174)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT175,2,1) {_OMC_LIT169,_OMC_LIT174}};
#define _OMC_LIT175 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT175)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT176,2,1) {_OMC_LIT165,_OMC_LIT175}};
#define _OMC_LIT176 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT176)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT177,2,1) {_OMC_LIT161,_OMC_LIT176}};
#define _OMC_LIT177 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT177)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT178,2,1) {_OMC_LIT157,_OMC_LIT177}};
#define _OMC_LIT178 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT178)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT179,2,1) {_OMC_LIT153,_OMC_LIT178}};
#define _OMC_LIT179 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT179)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT180,2,1) {_OMC_LIT149,_OMC_LIT179}};
#define _OMC_LIT180 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT180)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT181,2,1) {_OMC_LIT145,_OMC_LIT180}};
#define _OMC_LIT181 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT181)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT182,2,1) {_OMC_LIT141,_OMC_LIT181}};
#define _OMC_LIT182 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT182)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT183,2,4) {&Flags_ValidOptions_STRING__DESC__OPTION__desc,_OMC_LIT182}};
#define _OMC_LIT183 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT183)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT184,1,1) {_OMC_LIT183}};
#define _OMC_LIT184 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT184)
#define _OMC_LIT185_data "Flags to allow non-standard Modelica."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT185,37,_OMC_LIT185_data);
#define _OMC_LIT185 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT185)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT186,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT185}};
#define _OMC_LIT186 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT186)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT187,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(143)),_OMC_LIT136,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT24,_OMC_LIT137,_OMC_LIT184,_OMC_LIT186}};
#define _OMC_LIT187 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT187)
#define _OMC_LIT188_data "evaluateStructuralParameters"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT188,28,_OMC_LIT188_data);
#define _OMC_LIT188 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT188)
#define _OMC_LIT189_data "all"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT189,3,_OMC_LIT189_data);
#define _OMC_LIT189 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT189)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT190,2,8) {&Flags_FlagData_STRING__FLAG__desc,_OMC_LIT189}};
#define _OMC_LIT190 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT190)
#define _OMC_LIT191_data "Evaluates all structural parameters"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT191,35,_OMC_LIT191_data);
#define _OMC_LIT191 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT191)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT192,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT191}};
#define _OMC_LIT192 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT192)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT193,2,0) {_OMC_LIT189,_OMC_LIT192}};
#define _OMC_LIT193 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT193)
#define _OMC_LIT194_data "strictlyNecessary"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT194,17,_OMC_LIT194_data);
#define _OMC_LIT194 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT194)
#define _OMC_LIT195_data "Evaluates only structural parameters strictly required by the frontend"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT195,70,_OMC_LIT195_data);
#define _OMC_LIT195 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT195)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT196,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT195}};
#define _OMC_LIT196 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT196)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT197,2,0) {_OMC_LIT194,_OMC_LIT196}};
#define _OMC_LIT197 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT197)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT198,2,1) {_OMC_LIT197,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT198 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT198)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT199,2,1) {_OMC_LIT193,_OMC_LIT198}};
#define _OMC_LIT199 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT199)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT200,2,4) {&Flags_ValidOptions_STRING__DESC__OPTION__desc,_OMC_LIT199}};
#define _OMC_LIT200 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT200)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT201,1,1) {_OMC_LIT200}};
#define _OMC_LIT201 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT201)
#define _OMC_LIT202_data "Sets which structural parameters are evaluated by the frontend."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT202,63,_OMC_LIT202_data);
#define _OMC_LIT202 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT202)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT203,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT202}};
#define _OMC_LIT203 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT203)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT204,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(158)),_OMC_LIT188,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT24,_OMC_LIT190,_OMC_LIT201,_OMC_LIT203}};
#define _OMC_LIT204 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT204)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT205,1,5) {&NFSections_EMPTY__desc,}};
#define _OMC_LIT205 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT205)
#define _OMC_LIT206_data "NFFlatten.flatten"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT206,17,_OMC_LIT206_data);
#define _OMC_LIT206 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT206)
#define _OMC_LIT207_data "flatten"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT207,7,_OMC_LIT207_data);
#define _OMC_LIT207 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT207)
#define _OMC_LIT208_data "connections"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT208,11,_OMC_LIT208_data);
#define _OMC_LIT208 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT208)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT209,1,5) {&NFFlatten_FunctionTreeImpl_Tree_EMPTY__desc,}};
#define _OMC_LIT209 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT209)
#define _OMC_LIT210_data "("
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT210,1,_OMC_LIT210_data);
#define _OMC_LIT210 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT210)
#define _OMC_LIT211_data ", "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT211,2,_OMC_LIT211_data);
#define _OMC_LIT211 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT211)
#define _OMC_LIT212_data ")"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT212,1,_OMC_LIT212_data);
#define _OMC_LIT212 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT212)
#define _OMC_LIT213_data "EMPTY()"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT213,7,_OMC_LIT213_data);
#define _OMC_LIT213 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT213)
#define _OMC_LIT214_data "     "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT214,5,_OMC_LIT214_data);
#define _OMC_LIT214 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT214)
#define _OMC_LIT215_data " │   "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT215,7,_OMC_LIT215_data);
#define _OMC_LIT215 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT215)
#define _OMC_LIT216_data " ┌"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT216,4,_OMC_LIT216_data);
#define _OMC_LIT216 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT216)
#define _OMC_LIT217_data " └"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT217,4,_OMC_LIT217_data);
#define _OMC_LIT217 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT217)
#define _OMC_LIT218_data "────"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT218,12,_OMC_LIT218_data);
#define _OMC_LIT218 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT218)
#include "util/modelica.h"

#include "NFFlatten_includes.h"


/* default, do not make protected functions static */
#if !defined(PROTECTED_FUNCTION_STATIC)
#define PROTECTED_FUNCTION_STATIC
#endif
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_splitForLoop2_is__conn__operator(threadData_t *threadData, modelica_metatype _exp);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_splitForLoop2_is__conn__operator(threadData_t *threadData, modelica_metatype _exp);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_splitForLoop2_is__conn__operator,2,0) {(void*) boxptr_NFFlatten_splitForLoop2_is__conn__operator,0}};
#define boxvar_NFFlatten_splitForLoop2_is__conn__operator MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_splitForLoop2_is__conn__operator)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_subscriptBindingOpt(threadData_t *threadData, modelica_metatype _subscripts, modelica_metatype __omcQ_24in_5Fbinding);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_subscriptBindingOpt,2,0) {(void*) boxptr_NFFlatten_subscriptBindingOpt,0}};
#define boxvar_NFFlatten_subscriptBindingOpt MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_subscriptBindingOpt)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_containsPrefix__traverse(threadData_t *threadData, modelica_metatype _exp, modelica_boolean __omcQ_24in_5Fcontains, modelica_metatype _prefix);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_containsPrefix__traverse(threadData_t *threadData, modelica_metatype _exp, modelica_metatype __omcQ_24in_5Fcontains, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_containsPrefix__traverse,2,0) {(void*) boxptr_NFFlatten_containsPrefix__traverse,0}};
#define boxvar_NFFlatten_containsPrefix__traverse MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_containsPrefix__traverse)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_containsPrefix(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _prefix);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_containsPrefix(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_containsPrefix,2,0) {(void*) boxptr_NFFlatten_containsPrefix,0}};
#define boxvar_NFFlatten_containsPrefix MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_containsPrefix)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_addIterator__traverse(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _prefix, modelica_metatype _subscripts);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_addIterator__traverse,2,0) {(void*) boxptr_NFFlatten_addIterator__traverse,0}};
#define boxvar_NFFlatten_addIterator__traverse MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_addIterator__traverse)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_addIterator(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _prefix, modelica_metatype _subscripts);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_addIterator,2,0) {(void*) boxptr_NFFlatten_addIterator,0}};
#define boxvar_NFFlatten_addIterator MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_addIterator)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeAlgorithm(threadData_t *threadData, modelica_metatype __omcQ_24in_5Falg, modelica_metatype _dimensions, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeAlgorithm,2,0) {(void*) boxptr_NFFlatten_vectorizeAlgorithm,0}};
#define boxvar_NFFlatten_vectorizeAlgorithm MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeAlgorithm)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeAlgorithms(threadData_t *threadData, modelica_metatype _algs, modelica_metatype _dimensions, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeAlgorithms,2,0) {(void*) boxptr_NFFlatten_vectorizeAlgorithms,0}};
#define boxvar_NFFlatten_vectorizeAlgorithms MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeAlgorithms)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeEquation(threadData_t *threadData, modelica_metatype _eqn, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _settings, modelica_metatype __omcQ_24in_5Fequations);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeEquation,2,0) {(void*) boxptr_NFFlatten_vectorizeEquation,0}};
#define boxvar_NFFlatten_vectorizeEquation MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeEquation)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeEquations(threadData_t *threadData, modelica_metatype _eql, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _settings);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeEquations,2,0) {(void*) boxptr_NFFlatten_vectorizeEquations,0}};
#define boxvar_NFFlatten_vectorizeEquations MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeEquations)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_fillVectorizedBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbinding, modelica_metatype _varType);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_fillVectorizedBinding,2,0) {(void*) boxptr_NFFlatten_fillVectorizedBinding,0}};
#define boxvar_NFFlatten_fillVectorizedBinding MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_fillVectorizedBinding)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbinding, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeBinding,2,0) {(void*) boxptr_NFFlatten_vectorizeBinding,0}};
#define boxvar_NFFlatten_vectorizeBinding MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeBinding)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_makeBindingIterators(threadData_t *threadData, modelica_metatype _prefix, modelica_metatype _dimensions);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_makeBindingIterators,2,0) {(void*) boxptr_NFFlatten_makeBindingIterators,0}};
#define boxvar_NFFlatten_makeBindingIterators MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_makeBindingIterators)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _cls_ty, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_vectorizeArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _cls_ty, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeArray,2,0) {(void*) boxptr_NFFlatten_vectorizeArray,0}};
#define boxvar_NFFlatten_vectorizeArray MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_vectorizeArray)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _info, modelica_metatype _settings, modelica_metatype *out_sections);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _info, modelica_metatype _settings, modelica_metatype *out_sections);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_flattenArray,2,0) {(void*) boxptr_NFFlatten_flattenArray,0}};
#define boxvar_NFFlatten_flattenArray MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_flattenArray)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_splitRecordCref(threadData_t *threadData, modelica_metatype _exp);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_splitRecordCref,2,0) {(void*) boxptr_NFFlatten_splitRecordCref,0}};
#define boxvar_NFFlatten_splitRecordCref MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_splitRecordCref)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenComplexComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_metatype _cls, modelica_metatype _nodeTy, modelica_integer _visibility, modelica_metatype _outerBinding, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenComplexComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_metatype _cls, modelica_metatype _nodeTy, modelica_metatype _visibility, modelica_metatype _outerBinding, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_flattenComplexComponent,2,0) {(void*) boxptr_NFFlatten_flattenComplexComponent,0}};
#define boxvar_NFFlatten_flattenComplexComponent MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_flattenComplexComponent)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_getRecordBindings(threadData_t *threadData, modelica_metatype _binding, modelica_metatype _comps, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_getRecordBindings,2,0) {(void*) boxptr_NFFlatten_getRecordBindings,0}};
#define boxvar_NFFlatten_getRecordBindings MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_getRecordBindings)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_verifyBinding_eval__binding(threadData_t *threadData, modelica_metatype _binding);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_verifyBinding_eval__binding,2,0) {(void*) boxptr_NFFlatten_verifyBinding_eval__binding,0}};
#define boxvar_NFFlatten_verifyBinding_eval__binding MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_verifyBinding_eval__binding)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_verifyBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_integer _variability, modelica_metatype _binding, modelica_metatype _settings);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_verifyBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_metatype _variability, modelica_metatype _binding, modelica_metatype _settings);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_verifyBinding,2,0) {(void*) boxptr_NFFlatten_verifyBinding,0}};
#define boxvar_NFFlatten_verifyBinding MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_verifyBinding)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_isTypeAttributeNamed(threadData_t *threadData, modelica_string _name, modelica_metatype _attr);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_isTypeAttributeNamed(threadData_t *threadData, modelica_metatype _name, modelica_metatype _attr);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_isTypeAttributeNamed,2,0) {(void*) boxptr_NFFlatten_isTypeAttributeNamed,0}};
#define boxvar_NFFlatten_isTypeAttributeNamed MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_isTypeAttributeNamed)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenTypeAttribute(threadData_t *threadData, modelica_metatype _attr, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_flattenTypeAttribute,2,0) {(void*) boxptr_NFFlatten_flattenTypeAttribute,0}};
#define boxvar_NFFlatten_flattenTypeAttribute MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_flattenTypeAttribute)
PROTECTED_FUNCTION_STATIC void omc_NFFlatten_checkUnspecifiedEnumType(threadData_t *threadData, modelica_metatype _ty, modelica_metatype _node, modelica_metatype _info);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_checkUnspecifiedEnumType,2,0) {(void*) boxptr_NFFlatten_checkUnspecifiedEnumType,0}};
#define boxvar_NFFlatten_checkUnspecifiedEnumType MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_checkUnspecifiedEnumType)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenSimpleComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_integer _visibility, modelica_metatype _outerBinding, modelica_metatype _typeAttrs, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _settings, modelica_metatype _children, modelica_metatype *out_sections);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenSimpleComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_metatype _visibility, modelica_metatype _outerBinding, modelica_metatype _typeAttrs, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _settings, modelica_metatype _children, modelica_metatype *out_sections);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_flattenSimpleComponent,2,0) {(void*) boxptr_NFFlatten_flattenSimpleComponent,0}};
#define boxvar_NFFlatten_flattenSimpleComponent MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_flattenSimpleComponent)
PROTECTED_FUNCTION_STATIC modelica_integer omc_NFFlatten_getComponentType(threadData_t *threadData, modelica_metatype _ty, modelica_metatype _settings);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_getComponentType(threadData_t *threadData, modelica_metatype _ty, modelica_metatype _settings);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_getComponentType,2,0) {(void*) boxptr_NFFlatten_getComponentType,0}};
#define boxvar_NFFlatten_getComponentType MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_getComponentType)
PROTECTED_FUNCTION_STATIC void omc_NFFlatten_deleteComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _prefix, modelica_metatype _deletedVars);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_deleteComponent,2,0) {(void*) boxptr_NFFlatten_deleteComponent,0}};
#define boxvar_NFFlatten_deleteComponent MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_deleteComponent)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_isDeletedComponent(threadData_t *threadData, modelica_metatype _condition, modelica_metatype _prefix);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_isDeletedComponent(threadData_t *threadData, modelica_metatype _condition, modelica_metatype _prefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_isDeletedComponent,2,0) {(void*) boxptr_NFFlatten_isDeletedComponent,0}};
#define boxvar_NFFlatten_isDeletedComponent MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_isDeletedComponent)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenComponent(threadData_t *threadData, modelica_metatype _component, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _outerBinding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenComponent(threadData_t *threadData, modelica_metatype _component, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _outerBinding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_flattenComponent,2,0) {(void*) boxptr_NFFlatten_flattenComponent,0}};
#define boxvar_NFFlatten_flattenComponent MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_flattenComponent)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenClass(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenClass(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_flattenClass,2,0) {(void*) boxptr_NFFlatten_flattenClass,0}};
#define boxvar_NFFlatten_flattenClass MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_flattenClass)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_FunctionTreeImpl_balance(threadData_t *threadData, modelica_metatype _inTree);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_balance,2,0) {(void*) boxptr_NFFlatten_FunctionTreeImpl_balance,0}};
#define boxvar_NFFlatten_FunctionTreeImpl_balance MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_balance)
PROTECTED_FUNCTION_STATIC modelica_integer omc_NFFlatten_FunctionTreeImpl_calculateBalance(threadData_t *threadData, modelica_metatype _inNode);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_calculateBalance(threadData_t *threadData, modelica_metatype _inNode);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_calculateBalance,2,0) {(void*) boxptr_NFFlatten_FunctionTreeImpl_calculateBalance,0}};
#define boxvar_NFFlatten_FunctionTreeImpl_calculateBalance MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_calculateBalance)
PROTECTED_FUNCTION_STATIC modelica_integer omc_NFFlatten_FunctionTreeImpl_height(threadData_t *threadData, modelica_metatype _inNode);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_height(threadData_t *threadData, modelica_metatype _inNode);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_height,2,0) {(void*) boxptr_NFFlatten_FunctionTreeImpl_height,0}};
#define boxvar_NFFlatten_FunctionTreeImpl_height MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_height)
PROTECTED_FUNCTION_STATIC modelica_string omc_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData_t *threadData, modelica_metatype _inTree, modelica_boolean _isLeft, modelica_string _inIndent);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype _isLeft, modelica_metatype _inIndent);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_printTreeStr2,2,0) {(void*) boxptr_NFFlatten_FunctionTreeImpl_printTreeStr2,0}};
#define boxvar_NFFlatten_FunctionTreeImpl_printTreeStr2 MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_printTreeStr2)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty(threadData_t *threadData, modelica_metatype _t1, modelica_metatype _t2);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty(threadData_t *threadData, modelica_metatype _t1, modelica_metatype _t2);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty,2,0) {(void*) boxptr_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty,0}};
#define boxvar_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_FunctionTreeImpl_rotateLeft(threadData_t *threadData, modelica_metatype _inNode);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_rotateLeft,2,0) {(void*) boxptr_NFFlatten_FunctionTreeImpl_rotateLeft,0}};
#define boxvar_NFFlatten_FunctionTreeImpl_rotateLeft MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_rotateLeft)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_FunctionTreeImpl_rotateRight(threadData_t *threadData, modelica_metatype _inNode);
static const MMC_DEFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_rotateRight,2,0) {(void*) boxptr_NFFlatten_FunctionTreeImpl_rotateRight,0}};
#define boxvar_NFFlatten_FunctionTreeImpl_rotateRight MMC_REFSTRUCTLIT(boxvar_lit_NFFlatten_FunctionTreeImpl_rotateRight)

DLLDirection
modelica_metatype omc_NFFlatten_updateVariability(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar)
{
  modelica_metatype _var = NULL;
  modelica_integer _v;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  // _v has no default value.
  if((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 6)))), 4)))) == 3))
  {
    _v = omc_NFComponent_variability(threadData, omc_NFInstNode_InstNode_component(threadData, omc_NFComponentRef_node(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2))))));

    if(((modelica_integer)_v < 3))
    {
      _var = omc_NFVariable_setVariability(threadData, _var, (modelica_integer)_v);
    }
  }
  _return: OMC_LABEL_UNUSED
  return _var;
}

DLLDirection
void omc_NFFlatten_verifyDimension(threadData_t *threadData, modelica_metatype _dimension, modelica_metatype _component)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _dimension;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_string tmp6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          if((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_dimension), 2)))) < ((modelica_integer) 0)))
          {
            tmp6 = modelica_integer_to_modelica_string(mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_dimension), 2)))), ((modelica_integer) 0), 1 /* true */);
            tmpMeta5 = mmc_mk_cons(tmp6, mmc_mk_cons(omc_NFInstNode_InstNode_name(threadData, _component), MMC_REFSTRUCTLIT(mmc_nil)));
            omc_Error_addSourceMessage(threadData, _OMC_LIT4, tmpMeta5, omc_NFInstNode_InstNode_info(threadData, _component));

            goto goto_1;
          }
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}

DLLDirection
void omc_NFFlatten_verifyDimensions(threadData_t *threadData, modelica_metatype _dimensions, modelica_metatype _component)
{
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  {
    modelica_metatype _d;
    for (tmpMeta1 = _dimensions; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _d = MMC_CAR(tmpMeta1);
      omc_NFFlatten_verifyDimension(threadData, _d, _component);
    }
  }
  _return: OMC_LABEL_UNUSED
  return;
}

DLLDirection
void omc_NFFlatten_checkParGlobalCref(threadData_t *threadData, modelica_metatype _crefInfo)
{
  modelica_metatype _cref = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype _node = NULL;
  modelica_string _errorString = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _cref has no default value.
  // _info has no default value.
  // _node has no default value.
  // _errorString has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _crefInfo;
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  _cref = tmpMeta2;
  _info = tmpMeta3;

  _node = omc_NFComponentRef_node(threadData, _cref);

  if((omc_NFComponent_parallelism(threadData, omc_NFInstNode_InstNode_component(threadData, _node)) != 2))
  {
    tmpMeta4 = stringAppend(_OMC_LIT5,omc_AbsynUtil_pathString(threadData, omc_NFComponentRef_toPath(threadData, _cref), _OMC_LIT6, 1 /* true */, 0 /* false */));
    tmpMeta5 = stringAppend(tmpMeta4,_OMC_LIT7);
    tmpMeta6 = stringAppend(tmpMeta5,_OMC_LIT8);
    tmpMeta7 = stringAppend(tmpMeta6,_OMC_LIT9);
    _errorString = tmpMeta7;

    tmpMeta8 = mmc_mk_cons(_errorString, MMC_REFSTRUCTLIT(mmc_nil));
    omc_Error_addSourceMessage(threadData, _OMC_LIT12, tmpMeta8, _info);

    MMC_THROW_INTERNAL();
  }
  _return: OMC_LABEL_UNUSED
  return;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectParallelVariablesExp(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _info, modelica_metatype __omcQ_24in_5Fvars)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _node = NULL;
  modelica_metatype _cref = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  // _node has no default value.
  // _cref has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _exp;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,6,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!((omc_NFComponentRef_isCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3)))) && (!omc_NFComponentRef_isIterator(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3)))))) && omc_NFInstNode_InstNode_isComponent(threadData, omc_NFComponentRef_node(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))))))) goto tmp2_end;
          _cref = omc_NFComponentRef_stripSubscriptsAll(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))));

          omc_UnorderedMap_tryAdd(threadData, _cref, _info, _vars);
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _vars;
}

static modelica_metatype closure1_NFFlatten_collectParallelVariablesExp(threadData_t *thData, modelica_metatype closure, modelica_metatype exp, modelica_metatype $in_vars)
{
  modelica_metatype info = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFFlatten_collectParallelVariablesExp(thData, exp, info, $in_vars);
}static modelica_metatype closure0_NFExpression_fold(threadData_t *thData, modelica_metatype closure, modelica_metatype exp, modelica_metatype arg)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpression_fold(thData, exp, func, arg);
}
DLLDirection
modelica_metatype omc_NFFlatten_collectParallelVariables(threadData_t *threadData, modelica_metatype _stmt, modelica_metatype __omcQ_24in_5Fvars)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  // _info has no default value.
  _info = omc_NFStatement_info(threadData, _stmt);

  tmpMeta2 = mmc_mk_box1(0, _info);
  tmpMeta1 = mmc_mk_box1(0, (modelica_fnptr) mmc_mk_box2(0,closure1_NFFlatten_collectParallelVariablesExp,tmpMeta2));
  _vars = omc_NFStatement_foldExp(threadData, _stmt, (modelica_fnptr) mmc_mk_box2(0,closure0_NFExpression_fold,tmpMeta1), _vars);
  _return: OMC_LABEL_UNUSED
  return _vars;
}

DLLDirection
modelica_metatype omc_NFFlatten_updateForType(threadData_t *threadData, modelica_metatype __omcQ_24in_5FforType, modelica_metatype _forBody)
{
  modelica_metatype _forType = NULL;
  modelica_metatype _vars = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _forType = __omcQ_24in_5FforType;
  // _vars has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _forType;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,0) == 0) goto tmp2_end;
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,1) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          _vars = omc_UnorderedMap_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 1));

          {
            modelica_metatype _s;
            for (tmpMeta5 = _forBody; !listEmpty(tmpMeta5); tmpMeta5=MMC_CDR(tmpMeta5))
            {
              _s = MMC_CAR(tmpMeta5);
              _vars = omc_NFStatement_fold(threadData, _s, boxvar_NFFlatten_collectParallelVariables, _vars);
            }
          }

          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(3));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_forType), 3*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[2] = omc_UnorderedMap_toList(threadData, _vars);
          _forType = tmpMeta7;

          {
            modelica_metatype _v;
            for (tmpMeta8 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_forType), 2))); !listEmpty(tmpMeta8); tmpMeta8=MMC_CDR(tmpMeta8))
            {
              _v = MMC_CAR(tmpMeta8);
              omc_NFFlatten_checkParGlobalCref(threadData, _v);
            }
          }
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _forType;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectClassFunctions(threadData_t *threadData, modelica_metatype _clsNode, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  modelica_metatype _cls = NULL;
  modelica_metatype _cls_tree = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _comp = NULL;
  modelica_metatype _binding = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  // _cls has no default value.
  // _cls_tree has no default value.
  // _sections has no default value.
  // _comp has no default value.
  // _binding has no default value.
  _cls = omc_NFInstNode_InstNode_getClass(threadData, _clsNode);

  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _cls;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 3; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_integer tmp9;
          modelica_integer tmp10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,5,5) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,3,5) == 0) goto tmp2_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
          
          _cls_tree = tmpMeta5;
          _sections = tmpMeta6;
          /* Pattern matching succeeded */
          {
            modelica_metatype _c;
            for (tmpMeta7 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cls_tree), 4))), tmp10 = arrayLength(tmpMeta7), tmp9 = 1; tmp9 <= tmp10; tmp9++)
            {
              _c = arrayGet(tmpMeta7,tmp9);
              _comp = omc_NFInstNode_InstNode_component(threadData, _c);

              _funcs = omc_NFFlatten_collectTypeFuncs(threadData, omc_NFComponent_getType(threadData, _comp), _funcs);

              _binding = omc_NFComponent_getBinding(threadData, _comp);

              if(omc_NFBinding_isExplicitlyBound(threadData, _binding))
              {
                _funcs = omc_NFFlatten_collectExpFuncs(threadData, omc_NFBinding_getTypedExp(threadData, _binding), _funcs);
              }
            }
          }

          { /* match expression */
            modelica_metatype tmp13_1;
            tmp13_1 = _sections;
            {
              volatile mmc_switch_type tmp13;
              int tmp14;
              tmp13 = 0;
              for (; tmp13 < 2; tmp13++) {
                switch (MMC_SWITCH_CAST(tmp13)) {
                case 0: {
                  if (mmc__uniontype__metarecord__typedef__equal(tmp13_1,0,4) == 0) goto tmp12_end;
                  
                  /* Pattern matching succeeded */
                  _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 4))), boxvar_NFFlatten_collectAlgorithmFuncs, _funcs);
                  goto tmp12_done;
                }
                case 1: {
                  
                  /* Pattern matching succeeded */
                  goto tmp12_done;
                }
                }
                goto tmp12_end;
                tmp12_end: ;
              }
              goto goto_11;
              goto_11:;
              goto goto_1;
              goto tmp12_done;
              tmp12_done:;
            }
          }
          ;
          goto tmp2_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,7,3) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectClassFunctions(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cls), 3))), _funcs);
          goto tmp2_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenFunction(threadData_t *threadData, modelica_metatype _func, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  modelica_metatype _fn = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_integer tmp7;
  modelica_integer tmp8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  _fn = _func;
  if((!omc_NFFunction_Function_isCollected(threadData, _fn)))
  {
    _fn = omc_NFFunction_Function_mapExp(threadData, _fn, boxvar_NFExpression_expandSplitIndices, boxvar_NFExpression_expandSplitIndices, 1 /* true */, 1 /* true */);

    _fn = omc_NFEvalConstants_evaluateFunction(threadData, _fn);

    omc_NFSimplifyModel_simplifyFunction(threadData, _fn);

    omc_NFFunction_Function_collect(threadData, _fn);

    if((!omc_NFInstNode_InstNode_isPartial(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_fn), 3))))))
    {
      _funcs = omc_NFFlatten_FunctionTreeImpl_add(threadData, _funcs, omc_NFFunction_Function_name(threadData, _fn), _fn, boxvar_NFFlatten_FunctionTreeImpl_addConflictDefault);

      _funcs = omc_NFFlatten_collectClassFunctions(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_fn), 3))), _funcs);

      {
        modelica_metatype _fn_der;
        for (tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_fn), 10))); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
        {
          _fn_der = MMC_CAR(tmpMeta1);
          {
            modelica_metatype _der_fn;
            for (tmpMeta2 = omc_NFFunction_Function_getCachedFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_fn_der), 2)))); !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
            {
              _der_fn = MMC_CAR(tmpMeta2);
              _funcs = omc_NFFlatten_flattenFunction(threadData, _der_fn, _funcs);
            }
          }
        }
      }

      {
        modelica_metatype _fn_inv;
        for (tmpMeta5 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_fn), 12))), tmp8 = arrayLength(tmpMeta5), tmp7 = 1; tmp7 <= tmp8; tmp7++)
        {
          _fn_inv = arrayGet(tmpMeta5,tmp7);
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_fn_inv), 3))), _funcs);
        }
      }

      if(omc_NFFunction_Function_isPartialDerivative(threadData, _fn))
      {
        {
          modelica_metatype _f;
          for (tmpMeta9 = omc_NFFunction_Function_getCachedFuncs(threadData, omc_NFClass_lastBaseClass(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_fn), 3))))); !listEmpty(tmpMeta9); tmpMeta9=MMC_CDR(tmpMeta9))
          {
            _f = MMC_CAR(tmpMeta9);
            omc_NFFlatten_flattenFunction(threadData, _f, _funcs);
          }
        }
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectExpFuncs__traverse(threadData_t *threadData, modelica_metatype _exp, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _exp;
    {
      int tmp3;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
        case 16: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_flattenFunction(threadData, omc_NFCall_typedFunction(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2)))), _funcs);
          goto tmp2_done;
        }
        case 9: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectTypeFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), _funcs);
          goto tmp2_done;
        }
        case 15: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectTypeFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _funcs);
          goto tmp2_done;
        }
        case 34: {
          modelica_metatype tmpMeta4;
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype _f;
            for (tmpMeta4 = omc_NFFunction_Function_getRefCache(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2)))); !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
            {
              _f = MMC_CAR(tmpMeta4);
              _funcs = omc_NFFlatten_flattenFunction(threadData, _f, _funcs);
            }
          }
          goto tmp2_done;
        }
        default:
        tmp2_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectExpFuncs(threadData_t *threadData, modelica_metatype _exp, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  _funcs = omc_NFExpression_fold(threadData, _exp, boxvar_NFFlatten_collectExpFuncs__traverse, _funcs);
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectStmtBranchFuncs(threadData_t *threadData, modelica_metatype _branch, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  _funcs = omc_NFFlatten_collectExpFuncs(threadData, omc_Util_tuple21(threadData, _branch), _funcs);

  _funcs = omc_List_fold(threadData, omc_Util_tuple22(threadData, _branch), boxvar_NFFlatten_collectStatementFuncs, _funcs);
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectStatementFuncs(threadData_t *threadData, modelica_metatype _stmt, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _stmt;
    {
      int tmp3;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), _funcs);

          _funcs = omc_NFFlatten_collectTypeFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))), _funcs);
          goto tmp2_done;
        }
        case 5: {
          
          /* Pattern matching succeeded */
          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))), boxvar_NFFlatten_collectStatementFuncs, _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, omc_Util_getOption(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3)))), _funcs);
          goto tmp2_done;
        }
        case 6: {
          
          /* Pattern matching succeeded */
          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), boxvar_NFFlatten_collectStmtBranchFuncs, _funcs);
          goto tmp2_done;
        }
        case 7: {
          
          /* Pattern matching succeeded */
          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), boxvar_NFFlatten_collectStmtBranchFuncs, _funcs);
          goto tmp2_done;
        }
        case 8: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))), _funcs);
          goto tmp2_done;
        }
        case 9: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _funcs);
          goto tmp2_done;
        }
        case 10: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), _funcs);
          goto tmp2_done;
        }
        case 11: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _funcs);
          goto tmp2_done;
        }
        case 12: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _funcs);

          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), boxvar_NFFlatten_collectStatementFuncs, _funcs);
          goto tmp2_done;
        }
        default:
        tmp2_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectAlgorithmFuncs(threadData_t *threadData, modelica_metatype _alg, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 2))), boxvar_NFFlatten_collectStatementFuncs, _funcs);
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectEqBranchFuncs(threadData_t *threadData, modelica_metatype _branch, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _branch;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,3) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_branch), 2))), _funcs);

          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_branch), 4))), boxvar_NFFlatten_collectEquationFuncs, _funcs);
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectEquationFuncs(threadData_t *threadData, modelica_metatype _eq, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _eq;
    {
      int tmp3;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _funcs);

          _funcs = omc_NFFlatten_collectTypeFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), _funcs);
          goto tmp2_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _funcs);

          _funcs = omc_NFFlatten_collectTypeFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), _funcs);
          goto tmp2_done;
        }
        case 6: {
          
          /* Pattern matching succeeded */
          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), boxvar_NFFlatten_collectEquationFuncs, _funcs);
          goto tmp2_done;
        }
        case 7: {
          
          /* Pattern matching succeeded */
          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), boxvar_NFFlatten_collectEqBranchFuncs, _funcs);
          goto tmp2_done;
        }
        case 8: {
          
          /* Pattern matching succeeded */
          _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), boxvar_NFFlatten_collectEqBranchFuncs, _funcs);
          goto tmp2_done;
        }
        case 9: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _funcs);

          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), _funcs);
          goto tmp2_done;
        }
        case 10: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _funcs);
          goto tmp2_done;
        }
        case 11: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _funcs);
          goto tmp2_done;
        }
        case 12: {
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectExpFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _funcs);
          goto tmp2_done;
        }
        default:
        tmp2_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectStructor(threadData_t *threadData, modelica_metatype _node, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  modelica_metatype _cache = NULL;
  modelica_metatype _fn = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  // _cache has no default value.
  // _fn has no default value.
  _cache = omc_NFInstNode_InstNode_getFuncCache(threadData, _node);

  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _cache;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,3) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype _fn;
            for (tmpMeta5 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cache), 2))); !listEmpty(tmpMeta5); tmpMeta5=MMC_CDR(tmpMeta5))
            {
              _fn = MMC_CAR(tmpMeta5);
              _funcs = omc_NFFlatten_flattenFunction(threadData, _fn, _funcs);
            }
          }
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectTypeFuncs(threadData_t *threadData, modelica_metatype _ty, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _ty;
    {
      modelica_metatype _con = NULL;
      modelica_metatype _de = NULL;
      modelica_metatype _fn = NULL;
      volatile mmc_switch_type tmp3;
      int tmp4;
      // _con has no default value.
      // _de has no default value.
      // _fn has no default value.
      tmp3 = 0;
      for (; tmp3 < 5; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,7,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          _funcs = omc_NFDimension_foldExpList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 3))), boxvar_NFFlatten_collectExpFuncs__traverse, _funcs);

          _funcs = omc_NFFlatten_collectTypeFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 2))), _funcs);
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta5;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,12,2) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
          
          _fn = tmpMeta5;
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_flattenFunction(threadData, _fn, _funcs);
          goto tmp2_done;
        }
        case 2: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,11,2) == 0) goto tmp2_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,5,2) == 0) goto tmp2_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 2));
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 3));
          _con = tmpMeta7;
          _de = tmpMeta8;
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectStructor(threadData, _con, _funcs);

          _funcs = omc_NFFlatten_collectStructor(threadData, _de, _funcs);
          goto tmp2_done;
        }
        case 3: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,11,2) == 0) goto tmp2_end;
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta9,4,3) == 0) goto tmp2_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta9), 2));
          
          _con = tmpMeta10;
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectStructor(threadData, _con, _funcs);
          goto tmp2_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectBindingFuncs(threadData_t *threadData, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  if(omc_NFBinding_isExplicitlyBound(threadData, _binding))
  {
    _funcs = omc_NFFlatten_collectExpFuncs(threadData, omc_NFBinding_getTypedExp(threadData, _binding), _funcs);
  }
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectComponentFuncs(threadData_t *threadData, modelica_metatype _var, modelica_metatype __omcQ_24in_5Ffuncs)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _funcs = __omcQ_24in_5Ffuncs;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _var;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 1; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,10) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          _funcs = omc_NFFlatten_collectTypeFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _funcs);

          _funcs = omc_NFFlatten_collectBindingFuncs(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))), _funcs);

          {
            modelica_metatype _attr;
            for (tmpMeta5 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7))); !listEmpty(tmpMeta5); tmpMeta5=MMC_CDR(tmpMeta5))
            {
              _attr = MMC_CAR(tmpMeta5);
              _funcs = omc_NFFlatten_collectBindingFuncs(threadData, omc_Util_tuple22(threadData, _attr), _funcs);
            }
          }

          {
            modelica_metatype _c;
            for (tmpMeta7 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 8))); !listEmpty(tmpMeta7); tmpMeta7=MMC_CDR(tmpMeta7))
            {
              _c = MMC_CAR(tmpMeta7);
              _funcs = omc_NFFlatten_collectComponentFuncs(threadData, _c, _funcs);
            }
          }
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

DLLDirection
modelica_metatype omc_NFFlatten_resolveArrayConnections(threadData_t *threadData, modelica_metatype __omcQ_24in_5FflatModel)
{
  modelica_metatype _flatModel = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flatModel = __omcQ_24in_5FflatModel;
  _flatModel = omc_NFArrayConnections_resolve(threadData, _flatModel);

  omc_ExecStat_execStat(threadData, _OMC_LIT13);
  _return: OMC_LABEL_UNUSED
  return _flatModel;
}

static modelica_metatype closure2_NFConnectEquations_evaluateOperators(threadData_t *thData, modelica_metatype closure, modelica_metatype exp)
{
  modelica_metatype sets = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype setsArray = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype variables = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  modelica_metatype ctable = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),4));
  return boxptr_NFConnectEquations_evaluateOperators(thData, exp, sets, setsArray, variables, ctable);
}
DLLDirection
modelica_metatype omc_NFFlatten_evaluateEquationConnOp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Feq, modelica_metatype _sets, modelica_metatype _setsArray, modelica_metatype _variables, modelica_metatype _ctable)
{
  modelica_metatype _eq = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _eq = __omcQ_24in_5Feq;
  tmpMeta1 = mmc_mk_box4(0, _sets, _setsArray, _variables, _ctable);
  _eq = omc_NFEquation_mapExp(threadData, _eq, (modelica_fnptr) mmc_mk_box2(0,closure2_NFConnectEquations_evaluateOperators,tmpMeta1));

  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _eq;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta11;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,4,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype _b;
            for (tmpMeta6 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))); !listEmpty(tmpMeta6); tmpMeta6=MMC_CDR(tmpMeta6))
            {
              _b = MMC_CAR(tmpMeta6);
              { /* match expression */
                modelica_metatype tmp9_1;
                tmp9_1 = _b;
                {
                  volatile mmc_switch_type tmp9;
                  int tmp10;
                  tmp9 = 0;
                  for (; tmp9 < 2; tmp9++) {
                    switch (MMC_SWITCH_CAST(tmp9)) {
                    case 0: {
                      if (mmc__uniontype__metarecord__typedef__equal(tmp9_1,0,3) == 0) goto tmp8_end;
                      
                      /* Pattern matching succeeded */
                      if(((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_b), 3)))) == 3) && (!omc_NFStructural_isExpressionNotFixed(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_b), 2))), 0 /* false */, ((modelica_integer) 100)))))
                      {
                        omc_NFStructural_markExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_b), 2))));
                      }
                      goto tmp8_done;
                    }
                    case 1: {
                      
                      /* Pattern matching succeeded */
                      goto tmp8_done;
                    }
                    }
                    goto tmp8_end;
                    tmp8_end: ;
                  }
                  goto goto_7;
                  goto_7:;
                  goto goto_2;
                  goto tmp8_done;
                  tmp8_done:;
                }
              }
              ;
            }
          }
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _eq;
}

DLLDirection
modelica_metatype omc_NFFlatten_evaluateEquationsConnOp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype _sets, modelica_metatype _setsArray, modelica_metatype _variables, modelica_metatype _ctable)
{
  modelica_metatype _equations = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _equations = __omcQ_24in_5Fequations;
  {
    modelica_metatype __omcQ_24tmpVar1;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype __omcQ_24tmpVar0;
    modelica_integer tmp4;
    modelica_metatype _eq_loopVar = 0;
    modelica_metatype _eq;
    _eq_loopVar = _equations;
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar1 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar1;
    while(1) {
      tmp4 = 1;
      if (!listEmpty(_eq_loopVar)) {
        _eq = MMC_CAR(_eq_loopVar);
        _eq_loopVar = MMC_CDR(_eq_loopVar);
        tmp4--;
      }
      if (tmp4 == 0) {
        __omcQ_24tmpVar0 = omc_NFFlatten_evaluateEquationConnOp(threadData, _eq, _sets, _setsArray, _variables, _ctable);
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar0,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp4 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar1;
  }
  _equations = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _equations;
}

DLLDirection
modelica_metatype omc_NFFlatten_evaluateBindingConnOp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_metatype _sets, modelica_metatype _setsArray, modelica_metatype _variables, modelica_metatype _ctable)
{
  modelica_metatype _var = NULL;
  modelica_metatype _binding = NULL;
  modelica_metatype _exp = NULL;
  modelica_metatype _eval_exp = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  // _binding has no default value.
  // _exp has no default value.
  // _eval_exp has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _var;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,10) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,3,9) == 0) goto tmp2_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 2));
          
          _binding = tmpMeta5;
          _exp = tmpMeta6;
          /* Pattern matching succeeded */
          _eval_exp = omc_NFConnectEquations_evaluateOperators(threadData, _exp, _sets, _setsArray, _variables, _ctable);

          if((!referenceEq(_exp, _eval_exp)))
          {
            tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(11));
            memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_binding), 11*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[2] = _eval_exp;
            _binding = tmpMeta7;

            tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(12));
            memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[4] = _binding;
            _var = tmpMeta8;
          }
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _var;
}

DLLDirection
modelica_metatype omc_NFFlatten_evaluateConnectionOperators(threadData_t *threadData, modelica_metatype __omcQ_24in_5FflatModel, modelica_metatype _sets, modelica_metatype _setsArray, modelica_metatype _variables, modelica_metatype _ctable)
{
  modelica_metatype _flatModel = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flatModel = __omcQ_24in_5FflatModel;
  {
    modelica_metatype __omcQ_24tmpVar3;
    modelica_metatype* tmp3;
    modelica_metatype tmpMeta4;
    modelica_metatype __omcQ_24tmpVar2;
    modelica_integer tmp5;
    modelica_metatype _c_loopVar = 0;
    modelica_metatype _c;
    _c_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3)));
    tmpMeta4 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar3 = tmpMeta4; /* defaultValue */
    tmp3 = &__omcQ_24tmpVar3;
    while(1) {
      tmp5 = 1;
      if (!listEmpty(_c_loopVar)) {
        _c = MMC_CAR(_c_loopVar);
        _c_loopVar = MMC_CDR(_c_loopVar);
        tmp5--;
      }
      if (tmp5 == 0) {
        __omcQ_24tmpVar2 = omc_NFFlatten_evaluateBindingConnOp(threadData, _c, _sets, _setsArray, _variables, _ctable);
        *tmp3 = mmc_mk_cons(__omcQ_24tmpVar2,0);
        tmp3 = &MMC_CDR(*tmp3);
      } else if (tmp5 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp3 = mmc_mk_nil();
    tmpMeta2 = __omcQ_24tmpVar3;
  }
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[3] = tmpMeta2;
  _flatModel = tmpMeta1;

  tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[4] = omc_NFFlatten_evaluateEquationsConnOp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 4))), _sets, _setsArray, _variables, _ctable);
  _flatModel = tmpMeta6;

  tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[5] = omc_NFFlatten_evaluateEquationsConnOp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 5))), _sets, _setsArray, _variables, _ctable);
  _flatModel = tmpMeta7;
  _return: OMC_LABEL_UNUSED
  return _flatModel;
}

DLLDirection
modelica_metatype omc_NFFlatten_generateTopLevelIOs(threadData_t *threadData, modelica_metatype _variables, modelica_metatype _connectedLocalIOs, modelica_integer _exposeLocalIOs, modelica_metatype *out_tlio_eql)
{
  modelica_metatype _tlio_vars = NULL;
  modelica_metatype _tlio_eql = NULL;
  modelica_metatype _attributes = NULL;
  modelica_metatype _tlio_var = NULL;
  modelica_metatype _cref = NULL;
  modelica_string _name = NULL;
  modelica_metatype _tlio_node = NULL;
  modelica_integer _level;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _tlio_vars has no default value.
  // _tlio_eql has no default value.
  // _attributes has no default value.
  // _tlio_var has no default value.
  // _cref has no default value.
  // _name has no default value.
  // _tlio_node has no default value.
  // _level has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _tlio_vars = tmpMeta1;

  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _tlio_eql = tmpMeta2;

  {
    modelica_metatype _variable;
    for (tmpMeta3 = omc_UnorderedMap_valueList(threadData, _variables); !listEmpty(tmpMeta3); tmpMeta3=MMC_CDR(tmpMeta3))
    {
      _variable = MMC_CAR(tmpMeta3);
      _level = ((modelica_integer) -1) + omc_NFComponentRef_depth(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 2))));

      _attributes = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 6)));

      if(((((((((modelica_integer) 0) < _level) && (_level <= _exposeLocalIOs)) && (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 5)))) == 1)) && (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_attributes), 2)))) != ((modelica_integer) 0))) && ((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_attributes), 5)))) == 2) || (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_attributes), 5)))) == 3))) && (!omc_UnorderedSet_contains(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 2))), _connectedLocalIOs))))
      {
        _tlio_var = omc_NFVariable_removeNonTopLevelDirection(threadData, _variable);

        _attributes = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tlio_var), 6)));

        if((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_attributes), 5)))) == 1))
        {
          _tlio_var = _variable;

          tmpMeta4 = MMC_TAGPTR(mmc_alloc_words(12));
          memcpy(MMC_UNTAGPTR(tmpMeta4), MMC_UNTAGPTR(_tlio_var), 12*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta4))[4] = _OMC_LIT14;
          _tlio_var = tmpMeta4;

          _cref = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tlio_var), 2)));

          tmpMeta5 = MMC_REFSTRUCTLIT(mmc_nil);
          _name = stringDelimitList(omc_NFComponentRef_toString__impl(threadData, _cref, tmpMeta5), _OMC_LIT6);

          while(1)
          {
            if(!omc_UnorderedMap_contains(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tlio_var), 2))), _variables)) break;
            tmpMeta6 = mmc_mk_box2(7, &NFInstNode_InstNode_NAME__NODE__desc, omc_Util_makeQuotedIdentifier(threadData, _name));
            _tlio_node = tmpMeta6;

            { /* match expression */
              modelica_metatype tmp11_1;
              tmp11_1 = _cref;
              {
                volatile mmc_switch_type tmp11;
                int tmp12;
                tmp11 = 0;
                for (; tmp11 < 1; tmp11++) {
                  switch (MMC_SWITCH_CAST(tmp11)) {
                  case 0: {
                    modelica_metatype tmpMeta13;
                    if (mmc__uniontype__metarecord__typedef__equal(tmp11_1,0,5) == 0) goto tmp10_end;
                    
                    /* Pattern matching succeeded */
                    tmpMeta13 = mmc_mk_box6(3, &NFComponentRef_CREF__desc, _tlio_node, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cref), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cref), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cref), 5))), _OMC_LIT15);
                    tmpMeta8 = tmpMeta13;
                    goto tmp10_done;
                  }
                  }
                  goto tmp10_end;
                  tmp10_end: ;
                }
                goto goto_9;
                goto_9:;
                MMC_THROW_INTERNAL();
                goto tmp10_done;
                tmp10_done:;
              }
            }
            tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(12));
            memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_tlio_var), 12*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[2] = tmpMeta8;
            _tlio_var = tmpMeta7;

            tmpMeta14 = stringAppend(_name,_OMC_LIT16);
            _name = tmpMeta14;
          }

          tmpMeta15 = mmc_mk_cons(_tlio_var, _tlio_vars);
          _tlio_vars = tmpMeta15;

          tmpMeta16 = mmc_mk_cons(omc_NFEquation_makeCrefEquality(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tlio_var), 2))), _OMC_LIT17, omc_ElementSource_createElementSource(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_variable), 10))), mmc_mk_none(), _OMC_LIT18, _OMC_LIT22)), _tlio_eql);
          _tlio_eql = tmpMeta16;
        }
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_tlio_eql) { *out_tlio_eql = _tlio_eql; }
  return _tlio_vars;
}
modelica_metatype boxptr_NFFlatten_generateTopLevelIOs(threadData_t *threadData, modelica_metatype _variables, modelica_metatype _connectedLocalIOs, modelica_metatype _exposeLocalIOs, modelica_metatype *out_tlio_eql)
{
  modelica_integer tmp1;
  modelica_metatype _tlio_vars = NULL;
  tmp1 = mmc_unbox_integer(_exposeLocalIOs);
  _tlio_vars = omc_NFFlatten_generateTopLevelIOs(threadData, _variables, _connectedLocalIOs, tmp1, out_tlio_eql);
  /* skip box _tlio_vars; list<NFVariable> */
  /* skip box _tlio_eql; list<NFEquation> */
  return _tlio_vars;
}

static modelica_metatype closure3_NFFlatten_isDeletedConnector(threadData_t *thData, modelica_metatype closure, modelica_metatype cref)
{
  modelica_metatype deletedVars = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFFlatten_isDeletedConnector(thData, cref, deletedVars);
}static modelica_metatype closure4_NFFlatten_isDeletedConnector(threadData_t *thData, modelica_metatype closure, modelica_metatype cref)
{
  modelica_metatype deletedVars = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFFlatten_isDeletedConnector(thData, cref, deletedVars);
}
DLLDirection
modelica_metatype omc_NFFlatten_resolveConnections(threadData_t *threadData, modelica_metatype __omcQ_24in_5FflatModel, modelica_metatype _deletedVars, modelica_metatype _settings)
{
  modelica_metatype _flatModel = NULL;
  modelica_metatype _conns = NULL;
  modelica_metatype _conn_eql = NULL;
  modelica_metatype _ec_eql = NULL;
  modelica_metatype _tlio_eql = NULL;
  modelica_metatype _tlio_vars = NULL;
  modelica_metatype _csets = NULL;
  modelica_metatype _csets_array = NULL;
  modelica_metatype _ctable = NULL;
  modelica_metatype _broken = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _vars = NULL;
  modelica_metatype _connectedLocalIOs = NULL;
  modelica_integer _exposeLocalIOs;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _flatModel = __omcQ_24in_5FflatModel;
  // _conns has no default value.
  // _conn_eql has no default value.
  // _ec_eql has no default value.
  // _tlio_eql has no default value.
  // _tlio_vars has no default value.
  // _csets has no default value.
  // _csets_array has no default value.
  // _ctable has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _broken = tmpMeta1;
  // _vars has no default value.
  // _connectedLocalIOs has no default value.
  // _exposeLocalIOs has no default value.
  _vars = omc_UnorderedMap_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, listLength((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3)))));

  {
    modelica_metatype _v;
    for (tmpMeta2 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3))); !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _v = MMC_CAR(tmpMeta2);
      omc_UnorderedMap_addNew(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_v), 2))), _v, _vars);
    }
  }

  tmpMeta4 = mmc_mk_box1(0, _deletedVars);
  _flatModel = omc_NFConnections_collectConnections(threadData, _flatModel, (modelica_fnptr) mmc_mk_box2(0,closure3_NFFlatten_isDeletedConnector,tmpMeta4) ,&_conns);

  _ctable = omc_NFCardinalityTable_fromConnections(threadData, _conns);

  _flatModel = omc_NFExpandableConnectors_elaborate(threadData, _flatModel, _conns ,&_conns);

  {
    modelica_metatype __omcQ_24tmpVar5;
    modelica_metatype* tmp7;
    modelica_metatype tmpMeta8;
    modelica_metatype __omcQ_24tmpVar4;
    modelica_integer tmp9;
    modelica_metatype _v_loopVar = 0;
    modelica_metatype _v;
    _v_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3)));
    tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar5 = tmpMeta8; /* defaultValue */
    tmp7 = &__omcQ_24tmpVar5;
    while(1) {
      tmp9 = 1;
      while (!listEmpty(_v_loopVar)) {
        _v = MMC_CAR(_v_loopVar);
        _v_loopVar = MMC_CDR(_v_loopVar);
        if (omc_NFVariable_isPresent(threadData, _v)) {
          tmp9--;
          break;
        }
      }
      if (tmp9 == 0) {
        __omcQ_24tmpVar4 = _v;
        *tmp7 = mmc_mk_cons(__omcQ_24tmpVar4,0);
        tmp7 = &MMC_CDR(*tmp7);
      } else if (tmp9 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp7 = mmc_mk_nil();
    tmpMeta6 = __omcQ_24tmpVar5;
  }
  tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[3] = tmpMeta6;
  _flatModel = tmpMeta5;

  _conns = omc_NFConnections_collectFlows(threadData, _flatModel, _conns);

  if(omc_System_getHasOverconstrainedConnectors(threadData))
  {
    tmpMeta10 = mmc_mk_box1(0, _deletedVars);
    _flatModel = omc_NFOCConnectionGraph_handleOverconstrainedConnections(threadData, _flatModel, _conns, (modelica_fnptr) mmc_mk_box2(0,closure4_NFFlatten_isDeletedConnector,tmpMeta10) ,&_broken);
  }

  _conns = omc_NFConnections_addBroken(threadData, _broken, _conns);

  _conns = omc_NFConnections_split(threadData, _conns);

  _conns = omc_NFConnections_scalarize(threadData, _conns, (!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 2))))));

  _csets = omc_NFConnectionSets_ConnectionSets_fromConnections(threadData, _conns);

  _csets_array = omc_NFConnectionSets_ConnectionSets_extractSets(threadData, _csets, NULL);

  _conn_eql = omc_NFConnectEquations_generateEquations(threadData, _csets_array, _vars ,&_connectedLocalIOs);

  if(omc_System_getHasOverconstrainedConnectors(threadData))
  {
    {
      modelica_metatype __omcQ_24tmpVar7;
      modelica_metatype* tmp12;
      modelica_metatype tmpMeta13;
      modelica_metatype __omcQ_24tmpVar6;
      modelica_integer tmp14;
      modelica_metatype _e_loopVar = 0;
      modelica_metatype _e;
      _e_loopVar = _broken;
      tmpMeta13 = MMC_REFSTRUCTLIT(mmc_nil);
      __omcQ_24tmpVar7 = tmpMeta13; /* defaultValue */
      tmp12 = &__omcQ_24tmpVar7;
      while(1) {
        tmp14 = 1;
        if (!listEmpty(_e_loopVar)) {
          _e = MMC_CAR(_e_loopVar);
          _e_loopVar = MMC_CDR(_e_loopVar);
          tmp14--;
        }
        if (tmp14 == 0) {
          __omcQ_24tmpVar6 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_e), 5)));
          *tmp12 = mmc_mk_cons(__omcQ_24tmpVar6,0);
          tmp12 = &MMC_CDR(*tmp12);
        } else if (tmp14 == 1) {
          break;
        } else {
          MMC_THROW_INTERNAL();
        }
      }
      *tmp12 = mmc_mk_nil();
      tmpMeta11 = __omcQ_24tmpVar7;
    }
    _ec_eql = omc_List_flatten(threadData, tmpMeta11);

    tmpMeta15 = MMC_TAGPTR(mmc_alloc_words(9));
    memcpy(MMC_UNTAGPTR(tmpMeta15), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta15))[4] = listAppend(_ec_eql, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 4))));
    _flatModel = tmpMeta15;
  }

  tmpMeta16 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta16), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta16))[4] = listAppend(_conn_eql, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 4))));
  _flatModel = tmpMeta16;

  _exposeLocalIOs = omc_Flags_getConfigInt(threadData, _OMC_LIT28);

  if((_exposeLocalIOs > ((modelica_integer) 0)))
  {
    _tlio_vars = omc_NFFlatten_generateTopLevelIOs(threadData, _vars, _connectedLocalIOs, _exposeLocalIOs ,&_tlio_eql);

    tmpMeta17 = MMC_TAGPTR(mmc_alloc_words(9));
    memcpy(MMC_UNTAGPTR(tmpMeta17), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta17))[3] = omc_List_append__reverse(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3))), _tlio_vars);
    _flatModel = tmpMeta17;

    tmpMeta18 = MMC_TAGPTR(mmc_alloc_words(9));
    memcpy(MMC_UNTAGPTR(tmpMeta18), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
    ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta18))[4] = omc_List_append__reverse(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 4))), _tlio_eql);
    _flatModel = tmpMeta18;
  }

  if((omc_System_getHasStreamConnectors(threadData) || omc_System_getUsesCardinality(threadData)))
  {
    _flatModel = omc_NFFlatten_evaluateConnectionOperators(threadData, _flatModel, _csets, _csets_array, _vars, _ctable);
  }

  omc_ExecStat_execStat(threadData, _OMC_LIT29);
  _return: OMC_LABEL_UNUSED
  return _flatModel;
}

DLLDirection
modelica_boolean omc_NFFlatten_isDeletedConnector(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _deletedVars)
{
  modelica_boolean _res;
  modelica_metatype _cr = NULL;
  modelica_metatype _node = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _res has no default value.
  _cr = _cref;
  // _node has no default value.
  _cr = omc_NFComponentRef_stripSubscripts(threadData, _cref, NULL);

  while(1)
  {
    if(!omc_NFComponentRef_isCref(threadData, _cr)) break;
    _node = omc_NFComponentRef_node(threadData, _cr);

    if((omc_NFInstNode_InstNode_isComponent(threadData, _node) && omc_NFComponent_hasCondition(threadData, omc_NFInstNode_InstNode_component(threadData, _node))))
    {
      if(omc_UnorderedSet_contains(threadData, _cr, _deletedVars))
      {
        _res = 1 /* true */;

        goto _return;
      }
    }

    _cr = omc_NFComponentRef_stripSubscripts(threadData, omc_NFComponentRef_rest(threadData, _cr), NULL);
  }

  _res = 0 /* false */;
  _return: OMC_LABEL_UNUSED
  return _res;
}
modelica_metatype boxptr_NFFlatten_isDeletedConnector(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _deletedVars)
{
  modelica_boolean _res;
  modelica_metatype out_res;
  _res = omc_NFFlatten_isDeletedConnector(threadData, _cref, _deletedVars);
  out_res = mmc_mk_icon(_res);
  return out_res;
}

DLLDirection
modelica_metatype omc_NFFlatten_addElementSourceArrayPrefix(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fsource, modelica_metatype _prefix)
{
  modelica_metatype _source = NULL;
  modelica_metatype _comp_pre = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _source = __omcQ_24in_5Fsource;
  // _comp_pre has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  tmpMeta2 = mmc_mk_box7(3, &DAE_ComponentPrefix_PRE__desc, omc_NFComponentRef_firstName(threadData, omc_NFFlatten_Prefix_prefix(threadData, _prefix), 0 /* false */), tmpMeta1, _OMC_LIT32, _OMC_LIT33, _OMC_LIT36, _OMC_LIT38);
  _comp_pre = tmpMeta2;

  _source = omc_ElementSource_addElementSourceInstanceOpt(threadData, _source, _comp_pre);
  _return: OMC_LABEL_UNUSED
  return _source;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenStmtBranch(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbranch, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _branch = NULL;
  modelica_metatype _cond = NULL;
  modelica_metatype _body = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _branch = __omcQ_24in_5Fbranch;
  // _cond has no default value.
  // _body has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _branch;
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  _cond = tmpMeta2;
  _body = tmpMeta3;

  _cond = omc_NFFlatten_flattenExp(threadData, _cond, _prefix, _info);

  _body = omc_NFFlatten_flattenStatements(threadData, _body, _prefix);

  tmpMeta4 = mmc_mk_box2(0, _cond, _body);
  _branch = tmpMeta4;
  _return: OMC_LABEL_UNUSED
  return _branch;
}

static modelica_metatype closure5_NFFlatten_flattenExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype info = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_flattenExp(thData, $in_exp, prefix, info);
}
DLLDirection
modelica_metatype omc_NFFlatten_flattenStatement(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fstmt, modelica_metatype _prefix)
{
  modelica_metatype _stmt = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _stmt = __omcQ_24in_5Fstmt;
  _info = omc_NFStatement_info(threadData, _stmt);
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _stmt;
    {
      modelica_metatype _e1 = NULL;
      modelica_metatype _e2 = NULL;
      modelica_metatype _e3 = NULL;
      modelica_metatype _ty = NULL;
      modelica_metatype _body = NULL;
      int tmp4;
      // _e1 has no default value.
      // _e2 has no default value.
      // _e3 has no default value.
      // _ty has no default value.
      // _body has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _prefix, _info);

          _e2 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), _prefix, _info);

          _ty = omc_NFFlatten_flattenType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))), _prefix, _info);
          tmpMeta5 = mmc_mk_box5(3, &NFStatement_ASSIGNMENT__desc, _e1, _e2, _ty, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 5))));
          tmpMeta1 = tmpMeta5;
          goto tmp3_done;
        }
        case 5: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          
          /* Pattern matching succeeded */
          tmpMeta7 = mmc_mk_box2(0, _prefix, _info);
          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(7));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_stmt), 7*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[3] = omc_Util_applyOption(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), (modelica_fnptr) mmc_mk_box2(0,closure5_NFFlatten_flattenExp,tmpMeta7));
          _stmt = tmpMeta6;

          tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(7));
          memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_stmt), 7*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[4] = omc_NFFlatten_flattenStatements(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))), _prefix);
          _stmt = tmpMeta8;

          tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(7));
          memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_stmt), 7*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[5] = omc_NFFlatten_updateForType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))));
          _stmt = tmpMeta9;
          tmpMeta1 = _stmt;
          goto tmp3_done;
        }
        case 6: {
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype __omcQ_24tmpVar9;
            modelica_metatype* tmp12;
            modelica_metatype tmpMeta13;
            modelica_metatype __omcQ_24tmpVar8;
            modelica_integer tmp14;
            modelica_metatype _b_loopVar = 0;
            modelica_metatype _b;
            _b_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2)));
            tmpMeta13 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar9 = tmpMeta13; /* defaultValue */
            tmp12 = &__omcQ_24tmpVar9;
            while(1) {
              tmp14 = 1;
              if (!listEmpty(_b_loopVar)) {
                _b = MMC_CAR(_b_loopVar);
                _b_loopVar = MMC_CDR(_b_loopVar);
                tmp14--;
              }
              if (tmp14 == 0) {
                __omcQ_24tmpVar8 = omc_NFFlatten_flattenStmtBranch(threadData, _b, _prefix, _info);
                *tmp12 = mmc_mk_cons(__omcQ_24tmpVar8,0);
                tmp12 = &MMC_CDR(*tmp12);
              } else if (tmp14 == 1) {
                break;
              } else {
                goto goto_2;
              }
            }
            *tmp12 = mmc_mk_nil();
            tmpMeta11 = __omcQ_24tmpVar9;
          }
          tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_stmt), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[2] = tmpMeta11;
          _stmt = tmpMeta10;
          tmpMeta1 = _stmt;
          goto tmp3_done;
        }
        case 7: {
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype __omcQ_24tmpVar11;
            modelica_metatype* tmp17;
            modelica_metatype tmpMeta18;
            modelica_metatype __omcQ_24tmpVar10;
            modelica_integer tmp19;
            modelica_metatype _b_loopVar = 0;
            modelica_metatype _b;
            _b_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2)));
            tmpMeta18 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar11 = tmpMeta18; /* defaultValue */
            tmp17 = &__omcQ_24tmpVar11;
            while(1) {
              tmp19 = 1;
              if (!listEmpty(_b_loopVar)) {
                _b = MMC_CAR(_b_loopVar);
                _b_loopVar = MMC_CDR(_b_loopVar);
                tmp19--;
              }
              if (tmp19 == 0) {
                __omcQ_24tmpVar10 = omc_NFFlatten_flattenStmtBranch(threadData, _b, _prefix, _info);
                *tmp17 = mmc_mk_cons(__omcQ_24tmpVar10,0);
                tmp17 = &MMC_CDR(*tmp17);
              } else if (tmp19 == 1) {
                break;
              } else {
                goto goto_2;
              }
            }
            *tmp17 = mmc_mk_nil();
            tmpMeta16 = __omcQ_24tmpVar11;
          }
          tmpMeta15 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta15), MMC_UNTAGPTR(_stmt), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta15))[2] = tmpMeta16;
          _stmt = tmpMeta15;
          tmpMeta1 = _stmt;
          goto tmp3_done;
        }
        case 8: {
          modelica_metatype tmpMeta20;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _prefix, _info);

          _e2 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), _prefix, _info);

          _e3 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))), _prefix, _info);
          tmpMeta20 = mmc_mk_box5(8, &NFStatement_ASSERT__desc, _e1, _e2, _e3, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 5))));
          tmpMeta1 = tmpMeta20;
          goto tmp3_done;
        }
        case 9: {
          modelica_metatype tmpMeta21;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _prefix, _info);
          tmpMeta21 = mmc_mk_box3(9, &NFStatement_TERMINATE__desc, _e1, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))));
          tmpMeta1 = tmpMeta21;
          goto tmp3_done;
        }
        case 10: {
          modelica_metatype tmpMeta22;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _prefix, _info);

          _e2 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), _prefix, _info);
          tmpMeta22 = mmc_mk_box4(10, &NFStatement_REINIT__desc, _e1, _e2, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))));
          tmpMeta1 = tmpMeta22;
          goto tmp3_done;
        }
        case 11: {
          modelica_metatype tmpMeta23;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _prefix, _info);
          tmpMeta23 = mmc_mk_box3(11, &NFStatement_NORETCALL__desc, _e1, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))));
          tmpMeta1 = tmpMeta23;
          goto tmp3_done;
        }
        case 12: {
          modelica_metatype tmpMeta24;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _prefix, _info);

          _body = omc_NFFlatten_flattenStatements(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))), _prefix);
          tmpMeta24 = mmc_mk_box4(12, &NFStatement_WHILE__desc, _e1, _body, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 4))));
          tmpMeta1 = tmpMeta24;
          goto tmp3_done;
        }
        case 15: {
          modelica_metatype tmpMeta25;
          
          /* Pattern matching succeeded */
          _body = omc_NFFlatten_flattenStatements(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 2))), _prefix);
          tmpMeta25 = mmc_mk_box3(15, &NFStatement_FAILURE__desc, _body, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_stmt), 3))));
          tmpMeta1 = tmpMeta25;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _stmt;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _stmt = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _stmt;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenStatements(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fstmts, modelica_metatype _prefix)
{
  modelica_metatype _stmts = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _stmts = __omcQ_24in_5Fstmts;
  {
    modelica_metatype __omcQ_24tmpVar13;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype __omcQ_24tmpVar12;
    modelica_integer tmp4;
    modelica_metatype _s_loopVar = 0;
    modelica_metatype _s;
    _s_loopVar = _stmts;
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar13 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar13;
    while(1) {
      tmp4 = 1;
      if (!listEmpty(_s_loopVar)) {
        _s = MMC_CAR(_s_loopVar);
        _s_loopVar = MMC_CDR(_s_loopVar);
        tmp4--;
      }
      if (tmp4 == 0) {
        __omcQ_24tmpVar12 = omc_NFFlatten_flattenStatement(threadData, _s, _prefix);
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar12,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp4 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar13;
  }
  _stmts = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _stmts;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenAlgorithms(threadData_t *threadData, modelica_metatype _algorithms, modelica_metatype _prefix)
{
  modelica_metatype _outAlgorithms = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _outAlgorithms = tmpMeta1;
  {
    modelica_metatype _alg;
    for (tmpMeta2 = _algorithms; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _alg = MMC_CAR(tmpMeta2);
      tmpMeta3 = MMC_TAGPTR(mmc_alloc_words(7));
      memcpy(MMC_UNTAGPTR(tmpMeta3), MMC_UNTAGPTR(_alg), 7*sizeof(modelica_metatype));
      ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta3))[2] = omc_NFFlatten_flattenStatements(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 2))), _prefix);
      _alg = tmpMeta3;

      if(omc_NFComponentRef_hasSubscripts(threadData, omc_NFFlatten_Prefix_prefix(threadData, _prefix)))
      {
        tmpMeta4 = MMC_TAGPTR(mmc_alloc_words(7));
        memcpy(MMC_UNTAGPTR(tmpMeta4), MMC_UNTAGPTR(_alg), 7*sizeof(modelica_metatype));
        ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta4))[6] = omc_NFFlatten_addElementSourceArrayPrefix(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 6))), _prefix);
        _alg = tmpMeta4;
      }

      tmpMeta5 = mmc_mk_cons(_alg, _outAlgorithms);
      _outAlgorithms = tmpMeta5;
    }
  }
  _return: OMC_LABEL_UNUSED
  return _outAlgorithms;
}

PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_splitForLoop2_is__conn__operator(threadData_t *threadData, modelica_metatype _exp)
{
  modelica_boolean _res;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _res has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = ((omc_NFCall_isConnectionsOperator(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2)))) || omc_NFCall_isStreamOperator(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))))) || omc_NFCall_isCardinality(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2)))));
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _res = tmp1;
  _return: OMC_LABEL_UNUSED
  return _res;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_splitForLoop2_is__conn__operator(threadData_t *threadData, modelica_metatype _exp)
{
  modelica_boolean _res;
  modelica_metatype out_res;
  _res = omc_NFFlatten_splitForLoop2_is__conn__operator(threadData, _exp);
  out_res = mmc_mk_icon(_res);
  return out_res;
}

static modelica_metatype closure6_NFExpression_contains(threadData_t *thData, modelica_metatype closure, modelica_metatype exp)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpression_contains(thData, exp, func);
}
DLLDirection
modelica_metatype omc_NFFlatten_splitForLoop2(threadData_t *threadData, modelica_metatype _forBody, modelica_metatype *out_nonConnects)
{
  modelica_metatype _connects = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _nonConnects = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _conns = NULL;
  modelica_metatype _nconns = NULL;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta15;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _connects = tmpMeta1;
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _nonConnects = tmpMeta2;
  // _conns has no default value.
  // _nconns has no default value.
  {
    modelica_metatype _eq;
    for (tmpMeta3 = _forBody; !listEmpty(tmpMeta3); tmpMeta3=MMC_CDR(tmpMeta3))
    {
      _eq = MMC_CAR(tmpMeta3);
      { /* match expression */
        modelica_metatype tmp6_1;
        tmp6_1 = _eq;
        {
          int tmp6;
          {
            switch (MMC_SWITCH_CAST(valueConstructor(tmp6_1))) {
            case 5: {
              modelica_metatype tmpMeta7;
              
              /* Pattern matching succeeded */
              tmpMeta7 = mmc_mk_cons(_eq, _connects);
              _connects = tmpMeta7;
              goto tmp5_done;
            }
            case 6: {
              modelica_metatype tmpMeta8;
              modelica_metatype tmpMeta9;
              modelica_metatype tmpMeta10;
              modelica_metatype tmpMeta11;
              
              /* Pattern matching succeeded */
              _conns = omc_NFFlatten_splitForLoop2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))) ,&_nconns);

              if((!listEmpty(_conns)))
              {
                tmpMeta9 = mmc_mk_box6(6, &NFEquation_FOR__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _conns, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 6))));
                tmpMeta8 = mmc_mk_cons(tmpMeta9, _connects);
                _connects = tmpMeta8;
              }

              if((!listEmpty(_nconns)))
              {
                tmpMeta11 = mmc_mk_box6(6, &NFEquation_FOR__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _nconns, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 6))));
                tmpMeta10 = mmc_mk_cons(tmpMeta11, _nonConnects);
                _nonConnects = tmpMeta10;
              }
              goto tmp5_done;
            }
            default:
            tmp5_default: OMC_LABEL_UNUSED; {
              modelica_metatype tmpMeta12;
              modelica_metatype tmpMeta13;
              modelica_metatype tmpMeta14;
              
              /* Pattern matching succeeded */
              tmpMeta12 = mmc_mk_box1(0, boxvar_NFFlatten_splitForLoop2_is__conn__operator);
              if(omc_NFEquation_containsExp(threadData, _eq, (modelica_fnptr) mmc_mk_box2(0,closure6_NFExpression_contains,tmpMeta12)))
              {
                tmpMeta13 = mmc_mk_cons(_eq, _connects);
                _connects = tmpMeta13;
              }
              else
              {
                tmpMeta14 = mmc_mk_cons(_eq, _nonConnects);
                _nonConnects = tmpMeta14;
              }
              goto tmp5_done;
            }
            }
            goto tmp5_end;
            tmp5_end: ;
          }
          goto goto_4;
          goto_4:;
          MMC_THROW_INTERNAL();
          goto tmp5_done;
          tmp5_done:;
        }
      }
      ;
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_nonConnects) { *out_nonConnects = _nonConnects; }
  return _connects;
}

DLLDirection
modelica_metatype omc_NFFlatten_splitForLoop(threadData_t *threadData, modelica_metatype _forLoop, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype _settings)
{
  modelica_metatype _equations = NULL;
  modelica_metatype _iter = NULL;
  modelica_metatype _opt_range = NULL;
  modelica_metatype _range = NULL;
  modelica_metatype _body = NULL;
  modelica_metatype _connects = NULL;
  modelica_metatype _non_connects = NULL;
  modelica_metatype _src = NULL;
  modelica_metatype _eq = NULL;
  modelica_metatype _scope = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _equations = __omcQ_24in_5Fequations;
  // _iter has no default value.
  // _opt_range has no default value.
  // _range has no default value.
  // _body has no default value.
  // _connects has no default value.
  // _non_connects has no default value.
  // _src has no default value.
  // _eq has no default value.
  // _scope has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _forLoop;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,3,5) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 5));
  tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 6));
  _iter = tmpMeta2;
  _opt_range = tmpMeta3;
  _body = tmpMeta4;
  _scope = tmpMeta5;
  _src = tmpMeta6;

  _body = omc_NFFlatten_flattenEquations(threadData, _body, _OMC_LIT39, _settings);

  _connects = omc_NFFlatten_splitForLoop2(threadData, _body ,&_non_connects);

  if((!listEmpty(_connects)))
  {
    if(isSome(_opt_range))
    {
      /* Pattern-matching assignment */
      tmpMeta7 = _opt_range;
      if (optionNone(tmpMeta7)) MMC_THROW_INTERNAL();
      tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 1));
      _range = tmpMeta8;

      _range = omc_NFCeval_evalExp(threadData, _range, omc_NFCeval_EvalTarget_new(threadData, omc_NFEquation_info(threadData, _forLoop), ((modelica_integer) 131072), mmc_mk_none()));

      omc_NFStructural_markExp(threadData, _range);

      _opt_range = mmc_mk_some(_range);
    }

    tmpMeta9 = mmc_mk_box6(6, &NFEquation_FOR__desc, _iter, _opt_range, _connects, _scope, _src);
    _eq = tmpMeta9;

    if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 3)))))
    {
      tmpMeta10 = mmc_mk_cons(_eq, _equations);
      _equations = tmpMeta10;
    }
    else
    {
      _equations = omc_NFFlatten_unrollForLoop(threadData, _eq, _prefix, _equations, _settings);
    }
  }

  if((!listEmpty(_non_connects)))
  {
    tmpMeta12 = mmc_mk_box6(6, &NFEquation_FOR__desc, _iter, _opt_range, _non_connects, _scope, _src);
    tmpMeta11 = mmc_mk_cons(tmpMeta12, _equations);
    _equations = tmpMeta11;
  }
  _return: OMC_LABEL_UNUSED
  return _equations;
}

DLLDirection
modelica_metatype omc_NFFlatten_unrollForLoop(threadData_t *threadData, modelica_metatype _forLoop, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype _settings)
{
  modelica_metatype _equations = NULL;
  modelica_metatype _iter = NULL;
  modelica_metatype _body = NULL;
  modelica_metatype _unrolled_body = NULL;
  modelica_metatype _range = NULL;
  modelica_metatype _range_iter = NULL;
  modelica_metatype _val = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _equations = __omcQ_24in_5Fequations;
  // _iter has no default value.
  // _body has no default value.
  // _unrolled_body has no default value.
  // _range has no default value.
  // _range_iter has no default value.
  // _val has no default value.
  // _info has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _forLoop;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,3,5) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  if (optionNone(tmpMeta3)) MMC_THROW_INTERNAL();
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta3), 1));
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _iter = tmpMeta2;
  _range = tmpMeta4;
  _body = tmpMeta5;

  _info = omc_NFEquation_info(threadData, _forLoop);

  _range = omc_NFFlatten_flattenExp(threadData, _range, _prefix, _info);

  omc_NFStructural_markExp(threadData, _range);

  _range = omc_NFCeval_evalExp(threadData, _range, omc_NFCeval_EvalTarget_new(threadData, _info, ((modelica_integer) 131072), mmc_mk_none()));

  _range_iter = omc_NFRangeIterator_fromExp(threadData, _range);

  while(1)
  {
    if(!omc_NFRangeIterator_hasNext(threadData, _range_iter)) break;
    _range_iter = omc_NFRangeIterator_next(threadData, _range_iter ,&_val);

    _unrolled_body = omc_NFEquation_replaceIteratorList(threadData, _body, _iter, _val);

    _unrolled_body = omc_NFFlatten_flattenEquations(threadData, _unrolled_body, _prefix, _settings);

    _equations = listAppend(_unrolled_body, _equations);
  }
  _return: OMC_LABEL_UNUSED
  return _equations;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenEqBranch(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbranch, modelica_metatype _prefix, modelica_metatype _info, modelica_metatype _settings)
{
  modelica_metatype _branch = NULL;
  modelica_metatype _exp = NULL;
  modelica_metatype _eql = NULL;
  modelica_integer _var;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_integer tmp4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _branch = __omcQ_24in_5Fbranch;
  // _exp has no default value.
  // _eql has no default value.
  // _var has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _branch;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,0,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmp4 = mmc_unbox_integer(tmpMeta3);
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp = tmpMeta2;
  _var = tmp4  /* pattern as ty=enumeration(CONSTANT, STRUCTURAL_PARAMETER, PARAMETER, NON_STRUCTURAL_PARAMETER, DISCRETE, IMPLICITLY_DISCRETE, CONTINUOUS) */;
  _eql = tmpMeta5;

  _exp = omc_NFFlatten_flattenExp(threadData, _exp, _prefix, _info);

  _eql = omc_NFFlatten_flattenEquations(threadData, _eql, _prefix, _settings);

  _branch = omc_NFEquation_makeBranch(threadData, _exp, listReverseInPlace(_eql), (modelica_integer)_var);
  _return: OMC_LABEL_UNUSED
  return _branch;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenIfEquation(threadData_t *threadData, modelica_metatype _eq, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype _settings)
{
  modelica_metatype _equations = NULL;
  modelica_metatype _branch = NULL;
  modelica_metatype _branches = NULL;
  modelica_metatype _bl = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _cond = NULL;
  modelica_metatype _eql = NULL;
  modelica_integer _var;
  modelica_boolean _has_connect;
  modelica_boolean _should_eval;
  modelica_boolean _structural;
  modelica_metatype _src = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype _target = NULL;
  modelica_metatype _scope = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta28;
  modelica_metatype tmpMeta29;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _equations = __omcQ_24in_5Fequations;
  // _branch has no default value.
  // _branches has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _bl = tmpMeta1;
  // _cond has no default value.
  // _eql has no default value.
  // _var has no default value.
  // _has_connect has no default value.
  _should_eval = 0 /* false */;
  _structural = 1 /* true */;
  // _src has no default value.
  // _info has no default value.
  // _target has no default value.
  // _scope has no default value.
  /* Pattern-matching assignment */
  tmpMeta2 = _eq;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta2,4,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 2));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 3));
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 4));
  _branches = tmpMeta3;
  _scope = tmpMeta4;
  _src = tmpMeta5;

  _has_connect = omc_NFEquation_contains(threadData, _eq, boxvar_NFEquation_isConnection);

  _info = omc_NFEquation_info(threadData, _eq);

  _target = (_has_connect?omc_NFCeval_EvalTarget_new(threadData, _info, ((modelica_integer) 0), mmc_mk_none()):_OMC_LIT40);

  while(1)
  {
    if(!(!listEmpty(_branches))) break;
    /* Pattern-matching assignment */
    tmpMeta6 = _branches;
    if (listEmpty(tmpMeta6)) MMC_THROW_INTERNAL();
    tmpMeta7 = MMC_CAR(tmpMeta6);
    tmpMeta8 = MMC_CDR(tmpMeta6);
    _branch = tmpMeta7;
    _branches = tmpMeta8;

    { /* match expression */
      modelica_metatype tmp12_1;
      tmp12_1 = _branch;
      {
        volatile mmc_switch_type tmp12;
        int tmp13;
        tmp12 = 0;
        for (; tmp12 < 3; tmp12++) {
          switch (MMC_SWITCH_CAST(tmp12)) {
          case 0: {
            modelica_metatype tmpMeta14;
            modelica_metatype tmpMeta15;
            modelica_integer tmp16;
            modelica_metatype tmpMeta17;
            modelica_metatype tmpMeta18;
            modelica_metatype tmpMeta19;
            modelica_metatype tmpMeta20;
            modelica_metatype tmpMeta21;
            modelica_metatype tmpMeta22;
            if (mmc__uniontype__metarecord__typedef__equal(tmp12_1,0,3) == 0) goto tmp11_end;
            tmpMeta14 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp12_1), 2));
            tmpMeta15 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp12_1), 3));
            tmp16 = mmc_unbox_integer(tmpMeta15);
            tmpMeta17 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp12_1), 4));
            _cond = tmpMeta14;
            _var = tmp16  /* pattern as ty=enumeration(CONSTANT, STRUCTURAL_PARAMETER, PARAMETER, NON_STRUCTURAL_PARAMETER, DISCRETE, IMPLICITLY_DISCRETE, CONTINUOUS) */;
            _eql = tmpMeta17;
            /* Pattern matching succeeded */
            _cond = omc_NFFlatten_flattenExp(threadData, _cond, _prefix, _info);

            if(((modelica_integer)_var <= 2))
            {
              if(omc_NFExpression_isPure(threadData, _cond))
              {
                if(_has_connect)
                {
                  _should_eval = 1 /* true */;
                }
                else
                {
                  if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 9)))))
                  {
                    _should_eval = 0 /* false */;

                    _structural = 0 /* false */;
                  }
                  else
                  {
                    if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 2)))))
                    {
                      _should_eval = 1 /* true */;
                    }
                    else
                    {
                      if((mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 6)))) || omc_NFExpression_contains(threadData, _cond, boxvar_NFExpression_isIterator)))
                      {
                        _should_eval = 0 /* false */;

                        _structural = mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 6))));
                      }
                      else
                      {
                        _should_eval = 1 /* true */;
                      }
                    }
                  }
                }

                if((_structural || _should_eval))
                {
                  omc_NFStructural_markExp(threadData, _cond);
                }

                if(_should_eval)
                {
                  _cond = omc_NFCeval_evalExp(threadData, _cond, _target);

                  _cond = omc_NFFlatten_flattenExp(threadData, _cond, _prefix, _info);
                }
              }

              if(((!omc_NFExpression_isBoolean(threadData, _cond)) && _has_connect))
              {
                tmpMeta18 = stringAppend(_OMC_LIT41,omc_NFExpression_toString(threadData, _cond));
                tmpMeta19 = stringAppend(tmpMeta18,_OMC_LIT42);
                omc_Error_addInternalError(threadData, tmpMeta19, _info);

                goto goto_10;
              }
            }

            if(omc_NFExpression_isTrue(threadData, _cond))
            {
              tmpMeta20 = MMC_REFSTRUCTLIT(mmc_nil);
              _branches = tmpMeta20;

              _eql = omc_NFFlatten_flattenEquations(threadData, _eql, _prefix, _settings);

              if(listEmpty(_bl))
              {
                _equations = listAppend(_eql, _equations);
              }
              else
              {
                tmpMeta21 = mmc_mk_cons(omc_NFEquation_makeBranch(threadData, _cond, listReverseInPlace(_eql), (modelica_integer)_var), _bl);
                _bl = tmpMeta21;
              }
            }
            else
            {
              if((!omc_NFExpression_isFalse(threadData, _cond)))
              {
                _eql = omc_NFFlatten_flattenEquations(threadData, _eql, _prefix, _settings);

                tmpMeta22 = mmc_mk_cons(omc_NFEquation_makeBranch(threadData, _cond, listReverseInPlace(_eql), (modelica_integer)_var), _bl);
                _bl = tmpMeta22;
              }
            }
            tmpMeta9 = _bl;
            goto tmp11_done;
          }
          case 1: {
            modelica_metatype tmpMeta23;
            modelica_metatype tmpMeta24;
            modelica_metatype tmpMeta25;
            modelica_integer tmp26;
            if (mmc__uniontype__metarecord__typedef__equal(tmp12_1,1,2) == 0) goto tmp11_end;
            tmpMeta23 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp12_1), 2));
            if (mmc__uniontype__metarecord__typedef__equal(tmpMeta23,0,3) == 0) goto tmp11_end;
            tmpMeta24 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta23), 2));
            tmpMeta25 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta23), 3));
            tmp26 = mmc_unbox_integer(tmpMeta25);
            
            _cond = tmpMeta24;
            _var = tmp26  /* pattern as ty=enumeration(CONSTANT, STRUCTURAL_PARAMETER, PARAMETER, NON_STRUCTURAL_PARAMETER, DISCRETE, IMPLICITLY_DISCRETE, CONTINUOUS) */;
            /* Pattern matching succeeded */
            /* Check guard condition after assignments */
            if (!_has_connect) goto tmp11_end;
            if(((modelica_integer)_var <= 2))
            {
              omc_NFStructural_markExp(threadData, _cond);

              _cond = omc_NFCeval_evalExp(threadData, _cond, _target);

              _cond = omc_NFFlatten_flattenExp(threadData, _cond, _prefix, _info);
            }

            if((!omc_NFExpression_isFalse(threadData, _cond)))
            {
              omc_NFEquation_Branch_triggerErrors(threadData, _branch);
            }
            tmpMeta9 = _bl;
            goto tmp11_done;
          }
          case 2: {
            modelica_metatype tmpMeta27;
            
            /* Pattern matching succeeded */
            tmpMeta27 = mmc_mk_cons(_branch, _bl);
            tmpMeta9 = tmpMeta27;
            goto tmp11_done;
          }
          }
          goto tmp11_end;
          tmp11_end: ;
        }
        goto goto_10;
        goto_10:;
        MMC_THROW_INTERNAL();
        goto tmp11_done;
        tmp11_done:;
      }
    }
    _bl = tmpMeta9;
  }

  if((!listEmpty(_bl)))
  {
    tmpMeta29 = mmc_mk_box4(7, &NFEquation_IF__desc, listReverseInPlace(_bl), _scope, _src);
    tmpMeta28 = mmc_mk_cons(tmpMeta29, _equations);
    _equations = tmpMeta28;
  }
  _return: OMC_LABEL_UNUSED
  return _equations;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenEquation(threadData_t *threadData, modelica_metatype _eq, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fequations, modelica_metatype _settings)
{
  modelica_metatype _equations = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _equations = __omcQ_24in_5Fequations;
  _info = omc_NFEquation_info(threadData, _eq);
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _eq;
    {
      modelica_metatype _e1 = NULL;
      modelica_metatype _e2 = NULL;
      modelica_metatype _e3 = NULL;
      modelica_metatype _ty = NULL;
      modelica_metatype _eql = NULL;
      int tmp4;
      // _e1 has no default value.
      // _e2 has no default value.
      // _e3 has no default value.
      // _ty has no default value.
      // _eql has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _prefix, _info);

          _e2 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _prefix, _info);

          _ty = omc_NFFlatten_flattenType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), _prefix, _info);
          tmpMeta6 = mmc_mk_box6(3, &NFEquation_EQUALITY__desc, _e1, _e2, _ty, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 6))));
          tmpMeta5 = mmc_mk_cons(tmpMeta6, _equations);
          tmpMeta1 = tmpMeta5;
          goto tmp3_done;
        }
        case 6: {
          
          /* Pattern matching succeeded */
          if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 2)))))
          {
            _eql = omc_NFFlatten_unrollForLoop(threadData, _eq, _prefix, _equations, _settings);
          }
          else
          {
            _eql = omc_NFFlatten_splitForLoop(threadData, _eq, _prefix, _equations, _settings);
          }
          tmpMeta1 = _eql;
          goto tmp3_done;
        }
        case 5: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _prefix, _info);

          _e2 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _prefix, _info);
          tmpMeta8 = mmc_mk_box5(5, &NFEquation_CONNECT__desc, _e1, _e2, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 5))));
          tmpMeta7 = mmc_mk_cons(tmpMeta8, _equations);
          tmpMeta1 = tmpMeta7;
          goto tmp3_done;
        }
        case 7: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NFFlatten_flattenIfEquation(threadData, _eq, _prefix, _equations, _settings);
          goto tmp3_done;
        }
        case 8: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta14;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype __omcQ_24tmpVar15;
            modelica_metatype* tmp11;
            modelica_metatype tmpMeta12;
            modelica_metatype __omcQ_24tmpVar14;
            modelica_integer tmp13;
            modelica_metatype _b_loopVar = 0;
            modelica_metatype _b;
            _b_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2)));
            tmpMeta12 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar15 = tmpMeta12; /* defaultValue */
            tmp11 = &__omcQ_24tmpVar15;
            while(1) {
              tmp13 = 1;
              if (!listEmpty(_b_loopVar)) {
                _b = MMC_CAR(_b_loopVar);
                _b_loopVar = MMC_CDR(_b_loopVar);
                tmp13--;
              }
              if (tmp13 == 0) {
                __omcQ_24tmpVar14 = omc_NFFlatten_flattenEqBranch(threadData, _b, _prefix, _info, _settings);
                *tmp11 = mmc_mk_cons(__omcQ_24tmpVar14,0);
                tmp11 = &MMC_CDR(*tmp11);
              } else if (tmp13 == 1) {
                break;
              } else {
                goto goto_2;
              }
            }
            *tmp11 = mmc_mk_nil();
            tmpMeta10 = __omcQ_24tmpVar15;
          }
          tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_eq), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[2] = tmpMeta10;
          _eq = tmpMeta9;
          tmpMeta14 = mmc_mk_cons(_eq, _equations);
          tmpMeta1 = tmpMeta14;
          goto tmp3_done;
        }
        case 9: {
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _prefix, _info);

          _e2 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _prefix, _info);

          _e3 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), _prefix, _info);
          tmpMeta16 = mmc_mk_box6(9, &NFEquation_ASSERT__desc, _e1, _e2, _e3, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 6))));
          tmpMeta15 = mmc_mk_cons(tmpMeta16, _equations);
          tmpMeta1 = tmpMeta15;
          goto tmp3_done;
        }
        case 10: {
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _prefix, _info);
          tmpMeta18 = mmc_mk_box4(10, &NFEquation_TERMINATE__desc, _e1, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))));
          tmpMeta17 = mmc_mk_cons(tmpMeta18, _equations);
          tmpMeta1 = tmpMeta17;
          goto tmp3_done;
        }
        case 11: {
          modelica_metatype tmpMeta19;
          modelica_metatype tmpMeta20;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _prefix, _info);

          _e2 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), _prefix, _info);
          tmpMeta20 = mmc_mk_box5(11, &NFEquation_REINIT__desc, _e1, _e2, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 5))));
          tmpMeta19 = mmc_mk_cons(tmpMeta20, _equations);
          tmpMeta1 = tmpMeta19;
          goto tmp3_done;
        }
        case 12: {
          modelica_metatype tmpMeta21;
          modelica_metatype tmpMeta22;
          
          /* Pattern matching succeeded */
          _e1 = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 2))), _prefix, _info);
          tmpMeta22 = mmc_mk_box4(12, &NFEquation_NORETCALL__desc, _e1, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))));
          tmpMeta21 = mmc_mk_cons(tmpMeta22, _equations);
          tmpMeta1 = tmpMeta21;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          modelica_metatype tmpMeta23;
          
          /* Pattern matching succeeded */
          tmpMeta23 = mmc_mk_cons(_eq, _equations);
          tmpMeta1 = tmpMeta23;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _equations = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _equations;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenEquations(threadData_t *threadData, modelica_metatype _eql, modelica_metatype _prefix, modelica_metatype _settings)
{
  modelica_metatype _equations = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _equations = tmpMeta1;
  {
    modelica_metatype _eq;
    for (tmpMeta2 = _eql; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _eq = MMC_CAR(tmpMeta2);
      _equations = omc_NFFlatten_flattenEquation(threadData, _eq, _prefix, _equations, _settings);
    }
  }
  _return: OMC_LABEL_UNUSED
  return _equations;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenSections(threadData_t *threadData, modelica_metatype _sections, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5FaccumSections, modelica_metatype _settings)
{
  modelica_metatype _accumSections = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _accumSections = __omcQ_24in_5FaccumSections;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _sections;
    {
      modelica_metatype _eq = NULL;
      modelica_metatype _ieq = NULL;
      modelica_metatype _alg = NULL;
      modelica_metatype _ialg = NULL;
      volatile mmc_switch_type tmp3;
      int tmp4;
      // _eq has no default value.
      // _ieq has no default value.
      // _alg has no default value.
      // _ialg has no default value.
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,4) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          _eq = omc_NFFlatten_flattenEquations(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 2))), _prefix, _settings);

          _ieq = omc_NFFlatten_flattenEquations(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 3))), _prefix, _settings);

          _alg = omc_NFFlatten_flattenAlgorithms(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 4))), _prefix);

          _ialg = omc_NFFlatten_flattenAlgorithms(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 5))), _prefix);

          _accumSections = omc_NFSections_prepend(threadData, _eq, _ieq, _alg, _ialg, _accumSections);
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _accumSections;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenDimension(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fdim, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _dim = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _dim = __omcQ_24in_5Fdim;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _dim;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,5,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NFDimension_fromExp(threadData, omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_dim), 2))), _prefix, _info), mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_dim), 3)))));
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _dim;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _dim = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _dim;
}

static modelica_metatype closure7_NFFlatten_flattenDimension(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_dim)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype info = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_flattenDimension(thData, $in_dim, prefix, info);
}
DLLDirection
modelica_metatype omc_NFFlatten_flattenType(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fty, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _ty = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _ty = __omcQ_24in_5Fty;
  tmpMeta1 = mmc_mk_box2(0, _prefix, _info);
  _ty = omc_NFType_mapDims(threadData, _ty, (modelica_fnptr) mmc_mk_box2(0,closure7_NFFlatten_flattenDimension,tmpMeta1));
  _return: OMC_LABEL_UNUSED
  return _ty;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenExpType(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _ty = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  // _ty has no default value.
  _ty = omc_NFExpression_typeOf(threadData, _exp);

  if(omc_NFType_isArray(threadData, _ty))
  {
    _ty = omc_NFFlatten_flattenType(threadData, _ty, _prefix, _info);

    _exp = omc_NFExpression_setType(threadData, _ty, _exp);
  }
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenConditionalArrayIfExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _cond = NULL;
  modelica_metatype _tb = NULL;
  modelica_metatype _fb = NULL;
  modelica_integer _cond_var;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta13;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  // _ty has no default value.
  // _cond has no default value.
  // _tb has no default value.
  // _fb has no default value.
  // _cond_var has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,22,4) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 5));
  _ty = tmpMeta2;
  _cond = tmpMeta3;
  _tb = tmpMeta4;
  _fb = tmpMeta5;

  _cond = omc_NFFlatten_flattenExp(threadData, _cond, _prefix, _info);

  _cond_var = omc_NFExpression_variability(threadData, _cond);

  if(omc_NFType_isConditionalArray(threadData, _ty))
  {
    omc_NFStructural_markExp(threadData, _cond);

    _cond = omc_NFCeval_tryEvalExp(threadData, _cond);

    { /* match expression */
      modelica_metatype tmp9_1;
      tmp9_1 = _cond;
      {
        volatile mmc_switch_type tmp9;
        int tmp10;
        tmp9 = 0;
        for (; tmp9 < 2; tmp9++) {
          switch (MMC_SWITCH_CAST(tmp9)) {
          case 0: {
            modelica_metatype tmpMeta11;
            if (mmc__uniontype__metarecord__typedef__equal(tmp9_1,3,1) == 0) goto tmp8_end;
            
            /* Pattern matching succeeded */
            if((!omc_NFType_isMatchedBranch(threadData, mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cond), 2)))), _ty)))
            {
              _tb = omc_Util_swap(threadData, mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cond), 2)))), _fb, _tb ,&_fb);

              tmpMeta11 = mmc_mk_cons(omc_NFExpression_toString(threadData, _tb), mmc_mk_cons(omc_NFType_toString(threadData, omc_NFExpression_typeOf(threadData, _tb)), mmc_mk_cons(omc_NFDimension_toStringList(threadData, omc_NFType_arrayDims(threadData, omc_NFExpression_typeOf(threadData, _fb)), 0 /* false */), MMC_REFSTRUCTLIT(mmc_nil))));
              omc_Error_addSourceMessage(threadData, _OMC_LIT45, tmpMeta11, _info);

              goto goto_7;
            }
            tmpMeta6 = omc_NFFlatten_flattenExp(threadData, (mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cond), 2))))?_tb:_fb), _prefix, _info);
            goto tmp8_done;
          }
          case 1: {
            modelica_metatype tmpMeta12;
            
            /* Pattern matching succeeded */
            tmpMeta12 = mmc_mk_cons(_OMC_LIT19, mmc_mk_cons(omc_NFExpression_toString(threadData, _tb), mmc_mk_cons(omc_NFType_toString(threadData, omc_NFExpression_typeOf(threadData, _tb)), mmc_mk_cons(omc_NFExpression_toString(threadData, _fb), mmc_mk_cons(omc_NFType_toString(threadData, omc_NFExpression_typeOf(threadData, _fb)), MMC_REFSTRUCTLIT(mmc_nil))))));
            omc_Error_addSourceMessage(threadData, _OMC_LIT48, tmpMeta12, _info);
            goto goto_7;
            goto tmp8_done;
          }
          }
          goto tmp8_end;
          tmp8_end: ;
        }
        goto goto_7;
        goto_7:;
        MMC_THROW_INTERNAL();
        goto tmp8_done;
        tmp8_done:;
      }
    }
    _exp = tmpMeta6;
  }
  else
  {
    if((omc_NFExpression_variability(threadData, _cond) == 3))
    {
      omc_NFStructural_markExp(threadData, _cond);

      _tb = omc_NFFlatten_flattenExp(threadData, _tb, _prefix, _info);

      _fb = omc_NFFlatten_flattenExp(threadData, _fb, _prefix, _info);

      _ty = omc_NFFlatten_flattenType(threadData, _ty, _prefix, _info);

      tmpMeta13 = mmc_mk_box5(25, &NFExpression_IF__desc, _ty, _cond, _tb, _fb);
      _exp = tmpMeta13;
    }
  }
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenCrefSplitSubscripts2(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fsub, modelica_metatype _subMap)
{
  modelica_metatype _sub = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _sub = __omcQ_24in_5Fsub;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _sub;
    {
      modelica_metatype _subs = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _subs has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = MMC_REFSTRUCTLIT(mmc_nil);
          _subs = omc_UnorderedMap_getOrDefault(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sub), 2))), _subMap, tmpMeta6);
          tmpMeta1 = ((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sub), 3)))) > listLength(_subs))?_OMC_LIT49:listGet(_subs, mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sub), 3))))));
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _sub;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _sub = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _sub;
}

static modelica_metatype closure8_NFFlatten_flattenCrefSplitSubscripts2(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_sub)
{
  modelica_metatype subMap = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFFlatten_flattenCrefSplitSubscripts2(thData, $in_sub, subMap);
}
DLLDirection
modelica_metatype omc_NFFlatten_flattenCrefSplitSubscripts(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcref, modelica_metatype _prefix)
{
  modelica_metatype _cref = NULL;
  modelica_metatype _sub_map = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cref = __omcQ_24in_5Fcref;
  // _sub_map has no default value.
  _sub_map = omc_UnorderedMap_new(threadData, boxvar_NFInstNode_InstNode_hash, boxvar_NFInstNode_InstNode_refEqual, ((modelica_integer) 1));

  tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
  {
    modelica_metatype _cr;
    for (tmpMeta1 = omc_NFComponentRef_toListReverse(threadData, omc_NFFlatten_Prefix_indexedPrefix(threadData, _prefix), 1 /* true */, tmpMeta3); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _cr = MMC_CAR(tmpMeta1);
      if(omc_NFComponentRef_hasSubscripts(threadData, _cr))
      {
        omc_UnorderedMap_addUnique(threadData, omc_NFComponentRef_node(threadData, _cr), omc_NFComponentRef_getSubscripts(threadData, _cr), _sub_map);
      }
    }
  }

  tmpMeta4 = mmc_mk_box1(0, _sub_map);
  _cref = omc_NFComponentRef_mapSubscripts(threadData, _cref, (modelica_fnptr) mmc_mk_box2(0,closure8_NFFlatten_flattenCrefSplitSubscripts2,tmpMeta4), 0 /* false */);

  _cref = omc_NFComponentRef_simplifySubscripts(threadData, _cref, 1 /* true */);
  _return: OMC_LABEL_UNUSED
  return _cref;
}

static modelica_metatype closure9_NFFlatten_flattenType(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_ty)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype info = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_flattenType(thData, $in_ty, prefix, info);
}
DLLDirection
modelica_metatype omc_NFFlatten_flattenCref(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fcref, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _cref = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _ty2 = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cref = __omcQ_24in_5Fcref;
  // _ty has no default value.
  // _ty2 has no default value.
  _cref = omc_NFFlatten_Prefix_apply(threadData, _prefix, _cref);

  if(omc_NFComponentRef_hasSplitSubscripts(threadData, _cref))
  {
    _cref = omc_NFFlatten_flattenCrefSplitSubscripts(threadData, _cref, _prefix);
  }

  tmpMeta1 = mmc_mk_box2(0, _prefix, _info);
  _cref = omc_NFComponentRef_mapTypes(threadData, _cref, (modelica_fnptr) mmc_mk_box2(0,closure9_NFFlatten_flattenType,tmpMeta1));
  _return: OMC_LABEL_UNUSED
  return _cref;
}

DLLDirection
modelica_boolean omc_NFFlatten_replaceSplitIndices2(threadData_t *threadData, modelica_metatype _sub, modelica_metatype _node, modelica_integer _index)
{
  modelica_boolean _replace;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _replace has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _sub;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = ((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sub), 3)))) == _index) && omc_NFInstNode_InstNode_refEqual(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sub), 2))), _node));
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _replace = tmp1;
  _return: OMC_LABEL_UNUSED
  return _replace;
}
modelica_metatype boxptr_NFFlatten_replaceSplitIndices2(threadData_t *threadData, modelica_metatype _sub, modelica_metatype _node, modelica_metatype _index)
{
  modelica_integer tmp1;
  modelica_boolean _replace;
  modelica_metatype out_replace;
  tmp1 = mmc_unbox_integer(_index);
  _replace = omc_NFFlatten_replaceSplitIndices2(threadData, _sub, _node, tmp1);
  out_replace = mmc_mk_icon(_replace);
  return out_replace;
}

static modelica_metatype closure10_NFFlatten_replaceSplitIndices2(threadData_t *thData, modelica_metatype closure, modelica_metatype sub)
{
  modelica_metatype node = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype index = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_replaceSplitIndices2(thData, sub, node, index);
}
DLLDirection
modelica_metatype omc_NFFlatten_replaceSplitIndices(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _subscripts, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype _cr_subs = NULL;
  modelica_integer _index;
  modelica_metatype _cr_node = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  _subs = _subscripts;
  // _cr_subs has no default value.
  // _index has no default value.
  // _cr_node has no default value.
  tmpMeta6 = MMC_REFSTRUCTLIT(mmc_nil);
  {
    modelica_metatype _cr;
    for (tmpMeta1 = omc_NFComponentRef_toListReverse(threadData, omc_NFFlatten_Prefix_indexedPrefix(threadData, _prefix), 1 /* true */, tmpMeta6); !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _cr = MMC_CAR(tmpMeta1);
      _cr_subs = omc_NFComponentRef_getSubscripts(threadData, _cr);

      if((!listEmpty(_cr_subs)))
      {
        _index = ((modelica_integer) 1);

        _cr_node = omc_NFComponentRef_node(threadData, _cr);

        {
          modelica_metatype _s;
          for (tmpMeta2 = _cr_subs; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
          {
            _s = MMC_CAR(tmpMeta2);
            tmpMeta3 = mmc_mk_box2(0, _cr_node, mmc_mk_integer(_index));
            _subs = omc_List_replaceOnTrue(threadData, _s, _subs, (modelica_fnptr) mmc_mk_box2(0,closure10_NFFlatten_replaceSplitIndices2,tmpMeta3), NULL);

            _index = ((modelica_integer) 1) + _index;
          }
        }
      }
    }
  }

  tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
  _subs = omc_NFSubscript_expandSplitIndices(threadData, _subs, tmpMeta7);

  _exp = omc_NFExpression_applySubscripts(threadData, _subs, _exp, 0 /* false */);

  _exp = omc_NFFlatten_flattenExp(threadData, _exp, _prefix, _info);
  _return: OMC_LABEL_UNUSED
  return _exp;
}

static modelica_metatype closure11_NFFlatten_flattenExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype info = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_flattenExp(thData, $in_exp, prefix, info);
}static modelica_metatype closure12_NFFlatten_flattenExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype info = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_flattenExp(thData, $in_exp, prefix, info);
}static modelica_metatype closure13_NFFlatten_flattenExp(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype info = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_flattenExp(thData, $in_exp, prefix, info);
}
DLLDirection
modelica_metatype omc_NFFlatten_flattenExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _prefix, modelica_metatype _info)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 5; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,0,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta8 = mmc_mk_box2(0, _prefix, _info);
          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_exp), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[3] = omc_NFComponentRef_mapExpShallow(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), (modelica_fnptr) mmc_mk_box2(0,closure11_NFFlatten_flattenExp,tmpMeta8));
          _exp = tmpMeta7;

          tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_exp), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[3] = omc_NFFlatten_flattenCref(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _prefix, _info);
          _exp = tmpMeta9;

          tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_exp), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[2] = omc_NFFlatten_flattenType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), _prefix, _info);
          _exp = tmpMeta10;
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta11;
          modelica_integer tmp12;
          modelica_metatype tmpMeta13;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,26,4) == 0) goto tmp3_end;
          tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 5));
          tmp12 = mmc_unbox_integer(tmpMeta11);
          if (1 /* true */ != tmp12) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta13 = mmc_mk_box2(0, _prefix, _info);
          tmpMeta1 = omc_NFExpression_mapShallow(threadData, omc_NFFlatten_replaceSplitIndices(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _prefix, _info), (modelica_fnptr) mmc_mk_box2(0,closure12_NFFlatten_flattenExp,tmpMeta13));
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta14;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,22,4) == 0) goto tmp3_end;
          tmpMeta14 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta14,16,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NFFlatten_flattenConditionalArrayIfExp(threadData, _exp, _prefix, _info);
          goto tmp3_done;
        }
        case 3: {
          modelica_metatype tmpMeta15;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,34,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta15 = mmc_mk_box2(5, &NFExpression_STRING__desc, omc_NFFlatten_Prefix_instanceName(threadData, _prefix));
          tmpMeta1 = tmpMeta15;
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta16;
          
          /* Pattern matching succeeded */
          tmpMeta16 = mmc_mk_box2(0, _prefix, _info);
          tmpMeta1 = omc_NFExpression_mapShallow(threadData, _exp, (modelica_fnptr) mmc_mk_box2(0,closure13_NFFlatten_flattenExp,tmpMeta16));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;

  _exp = omc_NFFlatten_flattenExpType(threadData, _exp, _prefix, _info);
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFFlatten_flattenBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbinding, modelica_metatype _prefix, modelica_boolean _isTypeAttribute)
{
  modelica_metatype _binding = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype _accum_subs = NULL;
  modelica_integer _binding_level;
  modelica_metatype _bind_exp = NULL;
  modelica_metatype _pars = NULL;
  modelica_metatype _par = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _binding = __omcQ_24in_5Fbinding;
  // _subs has no default value.
  // _accum_subs has no default value.
  // _binding_level has no default value.
  // _bind_exp has no default value.
  // _pars has no default value.
  // _par has no default value.
  // _info has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _binding;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _binding;
          goto tmp3_done;
        }
        case 6: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          
          /* Pattern matching succeeded */
          if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding), 8)))))
          {
            goto _return;
          }

          _info = omc_NFBinding_getInfo(threadData, _binding);

          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(11));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_binding), 11*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[2] = omc_NFFlatten_flattenExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding), 2))), _prefix, _info);
          _binding = tmpMeta5;

          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(11));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_binding), 11*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[3] = omc_NFFlatten_flattenType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding), 3))), _prefix, _info);
          _binding = tmpMeta6;

          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(11));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_binding), 11*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[8] = mmc_mk_boolean(1 /* true */);
          _binding = tmpMeta7;
          tmpMeta1 = (omc_NFFlatten_Prefix_isIndexed(threadData, _prefix)?omc_NFFlatten_vectorizeBinding(threadData, _binding, _prefix):_binding);
          goto tmp3_done;
        }
        case 8: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _OMC_LIT14;
          goto tmp3_done;
        }
        case 7: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _binding;
          goto tmp3_done;
        }
        case 9: {
          
          /* Pattern matching succeeded */
          omc_Error_addTotalMessages(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding), 3))));
          goto goto_2;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          omc_Error_assertion(threadData, 0 /* false */, _OMC_LIT50, _OMC_LIT52);
          goto goto_2;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _binding = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _binding;
}
modelica_metatype boxptr_NFFlatten_flattenBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbinding, modelica_metatype _prefix, modelica_metatype _isTypeAttribute)
{
  modelica_integer tmp1;
  modelica_metatype _binding = NULL;
  tmp1 = mmc_unbox_integer(_isTypeAttribute);
  _binding = omc_NFFlatten_flattenBinding(threadData, __omcQ_24in_5Fbinding, _prefix, tmp1);
  /* skip box _binding; NFBinding */
  return _binding;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_subscriptBindingOpt(threadData_t *threadData, modelica_metatype _subscripts, modelica_metatype __omcQ_24in_5Fbinding)
{
  modelica_metatype _binding = NULL;
  modelica_metatype _b = NULL;
  modelica_metatype _exp = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _binding = __omcQ_24in_5Fbinding;
  // _b has no default value.
  // _exp has no default value.
  // _ty has no default value.
  if(isSome(_binding))
  {
    /* Pattern-matching assignment */
    tmpMeta1 = _binding;
    if (optionNone(tmpMeta1)) MMC_THROW_INTERNAL();
    tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
    _b = tmpMeta2;

    { /* match expression */
      modelica_metatype tmp6_1;
      tmp6_1 = _b;
      {
        int tmp6;
        {
          switch (MMC_SWITCH_CAST(valueConstructor(tmp6_1))) {
          case 6: {
            modelica_metatype tmpMeta7;
            modelica_metatype tmpMeta8;
            modelica_metatype tmpMeta9;
            modelica_metatype tmpMeta10;
            if (mmc__uniontype__metarecord__typedef__equal(tmp6_1,3,9) == 0) goto tmp5_end;
            tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp6_1), 2));
            tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp6_1), 3));
            
            _exp = tmpMeta7;
            _ty = tmpMeta8;
            /* Pattern matching succeeded */
            tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(11));
            memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_b), 11*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[2] = omc_NFExpression_applySubscripts(threadData, _subscripts, _exp, 0 /* false */);
            _b = tmpMeta9;

            tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(11));
            memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_b), 11*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[3] = omc_NFType_arrayElementType(threadData, _ty);
            _b = tmpMeta10;
            tmpMeta3 = mmc_mk_some(_b);
            goto tmp5_done;
          }
          case 7: {
            modelica_metatype tmpMeta11;
            modelica_metatype tmpMeta12;
            if (mmc__uniontype__metarecord__typedef__equal(tmp6_1,4,3) == 0) goto tmp5_end;
            tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp6_1), 2));
            
            _exp = tmpMeta11;
            /* Pattern matching succeeded */
            tmpMeta12 = MMC_TAGPTR(mmc_alloc_words(5));
            memcpy(MMC_UNTAGPTR(tmpMeta12), MMC_UNTAGPTR(_b), 5*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta12))[2] = omc_NFExpression_applySubscripts(threadData, _subscripts, _exp, 0 /* false */);
            _b = tmpMeta12;
            tmpMeta3 = mmc_mk_some(_b);
            goto tmp5_done;
          }
          default:
          tmp5_default: OMC_LABEL_UNUSED; {
            
            /* Pattern matching succeeded */
            tmpMeta3 = _binding;
            goto tmp5_done;
          }
          }
          goto tmp5_end;
          tmp5_end: ;
        }
        goto goto_4;
        goto_4:;
        MMC_THROW_INTERNAL();
        goto tmp5_done;
        tmp5_done:;
      }
    }
    _binding = tmpMeta3;
  }
  _return: OMC_LABEL_UNUSED
  return _binding;
}

PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_containsPrefix__traverse(threadData_t *threadData, modelica_metatype _exp, modelica_boolean __omcQ_24in_5Fcontains, modelica_metatype _prefix)
{
  modelica_boolean _contains;
  modelica_string _restString = NULL;
  modelica_string _prefixString = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _contains = __omcQ_24in_5Fcontains;
  // _restString has no default value.
  _prefixString = omc_NFComponentRef_toString(threadData, omc_NFFlatten_Prefix_prefix(threadData, _prefix));
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _exp;
    {
      modelica_metatype _restCref = NULL;
      volatile mmc_switch_type tmp3;
      int tmp4;
      // _restCref has no default value.
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,6,2) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,0,5) == 0) goto tmp2_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 6));
          _restCref = tmpMeta6;
          /* Pattern matching succeeded */
          _restString = omc_NFComponentRef_toString(threadData, _restCref);

          if(omc_StringUtil_startsWith(threadData, _restString, _prefixString))
          {
            _contains = 1 /* true */;
          }
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _contains;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_containsPrefix__traverse(threadData_t *threadData, modelica_metatype _exp, modelica_metatype __omcQ_24in_5Fcontains, modelica_metatype _prefix)
{
  modelica_integer tmp1;
  modelica_boolean _contains;
  modelica_metatype out_contains;
  tmp1 = mmc_unbox_integer(__omcQ_24in_5Fcontains);
  _contains = omc_NFFlatten_containsPrefix__traverse(threadData, _exp, tmp1, _prefix);
  out_contains = mmc_mk_icon(_contains);
  return out_contains;
}

static modelica_metatype closure14_NFFlatten_containsPrefix__traverse(threadData_t *thData, modelica_metatype closure, modelica_metatype exp, modelica_metatype $in_contains)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFFlatten_containsPrefix__traverse(thData, exp, $in_contains, prefix);
}
PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_containsPrefix(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _prefix)
{
  modelica_boolean _contains;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _contains has no default value.
  tmpMeta1 = mmc_mk_box1(0, _prefix);
  _contains = mmc_unbox_boolean(omc_NFExpression_fold(threadData, _exp, (modelica_fnptr) mmc_mk_box2(0,closure14_NFFlatten_containsPrefix__traverse,tmpMeta1), mmc_mk_boolean(0 /* false */)));
  _return: OMC_LABEL_UNUSED
  return _contains;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_containsPrefix(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _prefix)
{
  modelica_boolean _contains;
  modelica_metatype out_contains;
  _contains = omc_NFFlatten_containsPrefix(threadData, _exp, _prefix);
  out_contains = mmc_mk_icon(_contains);
  return out_contains;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_addIterator__traverse(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _prefix, modelica_metatype _subscripts)
{
  modelica_metatype _exp = NULL;
  modelica_string _restString = NULL;
  modelica_string _prefixString = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  // _restString has no default value.
  _prefixString = omc_NFComponentRef_toString(threadData, omc_NFFlatten_Prefix_prefix(threadData, _prefix));
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      modelica_metatype _restCref = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _restCref has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,0,5) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 6));
          _restCref = tmpMeta7;
          /* Pattern matching succeeded */
          _restString = omc_NFComponentRef_toString(threadData, _restCref);

          if(omc_StringUtil_startsWith(threadData, _restString, _prefixString))
          {
            tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(4));
            memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_exp), 4*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[3] = omc_NFComponentRef_mergeSubscripts(threadData, _subscripts, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), 1 /* true */, 0 /* false */);
            _exp = tmpMeta8;
          }
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

static modelica_metatype closure15_NFFlatten_addIterator__traverse(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype subscripts = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_addIterator__traverse(thData, $in_exp, prefix, subscripts);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_addIterator(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _prefix, modelica_metatype _subscripts)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  tmpMeta1 = mmc_mk_box2(0, _prefix, _subscripts);
  _exp = omc_NFExpression_map(threadData, _exp, (modelica_fnptr) mmc_mk_box2(0,closure15_NFFlatten_addIterator__traverse,tmpMeta1));
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFFlatten_makeIterators(threadData_t *threadData, modelica_metatype _prefix, modelica_metatype _dimensions, modelica_metatype *out_ranges, modelica_metatype *out_subscripts)
{
  modelica_metatype _iterators = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _ranges = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype _subscripts = NULL;
  modelica_metatype tmpMeta3;
  modelica_metatype _iter_comp = NULL;
  modelica_metatype _prefix_node = NULL;
  modelica_metatype _iter = NULL;
  modelica_metatype _range = NULL;
  modelica_metatype _sub = NULL;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _iterators = tmpMeta1;
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _ranges = tmpMeta2;
  tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
  _subscripts = tmpMeta3;
  // _iter_comp has no default value.
  // _prefix_node has no default value.
  // _iter has no default value.
  // _range has no default value.
  // _sub has no default value.
  _prefix_node = omc_NFComponentRef_node(threadData, _prefix);

  {
    modelica_metatype _dim;
    for (tmpMeta4 = _dimensions; !listEmpty(tmpMeta4); tmpMeta4=MMC_CDR(tmpMeta4))
    {
      _dim = MMC_CAR(tmpMeta4);
      _iter = omc_NFInstNode_InstNode_newUniqueIterator(threadData, omc_NFInstNode_InstNode_info(threadData, _prefix_node), _OMC_LIT53);

      tmpMeta5 = mmc_mk_cons(_iter, _iterators);
      _iterators = tmpMeta5;

      _range = omc_NFExpression_makeRange(threadData, _OMC_LIT54, mmc_mk_none(), omc_NFDimension_sizeExp(threadData, _dim));

      tmpMeta6 = mmc_mk_cons(_range, _ranges);
      _ranges = tmpMeta6;

      tmpMeta7 = mmc_mk_box3(9, &NFExpression_CREF__desc, _OMC_LIT53, omc_NFComponentRef_makeIterator(threadData, _iter, _OMC_LIT53));
      tmpMeta8 = mmc_mk_box2(5, &NFSubscript_INDEX__desc, tmpMeta7);
      _sub = tmpMeta8;

      tmpMeta9 = mmc_mk_cons(_sub, _subscripts);
      _subscripts = tmpMeta9;
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_ranges) { *out_ranges = _ranges; }
  if (out_subscripts) { *out_subscripts = _subscripts; }
  return _iterators;
}

static modelica_metatype closure16_NFFlatten_addIterator(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype subscripts = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_addIterator(thData, $in_exp, prefix, subscripts);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeAlgorithm(threadData_t *threadData, modelica_metatype __omcQ_24in_5Falg, modelica_metatype _dimensions, modelica_metatype _prefix)
{
  modelica_metatype _alg = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _alg = __omcQ_24in_5Falg;
  tmpMeta1 = MMC_TAGPTR(mmc_alloc_words(7));
  memcpy(MMC_UNTAGPTR(tmpMeta1), MMC_UNTAGPTR(_alg), 7*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta1))[2] = omc_NFFlatten_flattenStatements(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 2))), _OMC_LIT39);
  _alg = tmpMeta1;

  { /* match expression */
    modelica_metatype tmp5_1;
    tmp5_1 = _alg;
    {
      modelica_metatype _iter = NULL;
      modelica_metatype _iters = NULL;
      modelica_metatype _range = NULL;
      modelica_metatype _ranges = NULL;
      modelica_metatype _subs = NULL;
      modelica_metatype _body = NULL;
      volatile mmc_switch_type tmp5;
      int tmp6;
      // _iter has no default value.
      // _iters has no default value.
      // _range has no default value.
      // _ranges has no default value.
      // _subs has no default value.
      // _body has no default value.
      tmp5 = 0;
      for (; tmp5 < 2; tmp5++) {
        switch (MMC_SWITCH_CAST(tmp5)) {
        case 0: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          if (mmc__uniontype__metarecord__typedef__equal(tmp5_1,0,5) == 0) goto tmp4_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp5_1), 2));
          if (listEmpty(tmpMeta7)) goto tmp4_end;
          tmpMeta8 = MMC_CAR(tmpMeta7);
          tmpMeta9 = MMC_CDR(tmpMeta7);
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta8,0,4) == 0) goto tmp4_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta8), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta10,6,2) == 0) goto tmp4_end;
          tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta8), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta11,6,2) == 0) goto tmp4_end;
          if (!listEmpty(tmpMeta9)) goto tmp4_end;
          
          /* Pattern matching succeeded */
          tmpMeta2 = _alg;
          goto tmp4_done;
        }
        case 1: {
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          modelica_metatype tmpMeta19;
          modelica_metatype tmpMeta20;
          modelica_metatype tmpMeta21;
          
          /* Pattern matching succeeded */
          _iters = omc_NFFlatten_makeIterators(threadData, omc_NFFlatten_Prefix_prefix(threadData, _prefix), _dimensions ,&_ranges ,&_subs);

          _subs = listReverseInPlace(_subs);

          tmpMeta12 = mmc_mk_box2(0, _prefix, _subs);
          _body = omc_NFStatement_mapExpList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 2))), (modelica_fnptr) mmc_mk_box2(0,closure16_NFFlatten_addIterator,tmpMeta12));

          while(1)
          {
            if(!(!listEmpty(_iters))) break;
            /* Pattern-matching assignment */
            tmpMeta13 = _iters;
            if (listEmpty(tmpMeta13)) goto goto_3;
            tmpMeta14 = MMC_CAR(tmpMeta13);
            tmpMeta15 = MMC_CDR(tmpMeta13);
            _iter = tmpMeta14;
            _iters = tmpMeta15;

            /* Pattern-matching assignment */
            tmpMeta16 = _ranges;
            if (listEmpty(tmpMeta16)) goto goto_3;
            tmpMeta17 = MMC_CAR(tmpMeta16);
            tmpMeta18 = MMC_CDR(tmpMeta16);
            _range = tmpMeta17;
            _ranges = tmpMeta18;

            tmpMeta20 = mmc_mk_box6(5, &NFStatement_FOR__desc, _iter, mmc_mk_some(_range), _body, _OMC_LIT55, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 6))));
            tmpMeta19 = mmc_mk_cons(tmpMeta20, MMC_REFSTRUCTLIT(mmc_nil));
            _body = tmpMeta19;
          }
          tmpMeta21 = mmc_mk_box6(3, &NFAlgorithm_ALGORITHM__desc, _body, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 3))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_alg), 6))));
          tmpMeta2 = tmpMeta21;
          goto tmp4_done;
        }
        }
        goto tmp4_end;
        tmp4_end: ;
      }
      goto goto_3;
      goto_3:;
      MMC_THROW_INTERNAL();
      goto tmp4_done;
      tmp4_done:;
    }
  }
  _alg = tmpMeta2;
  _return: OMC_LABEL_UNUSED
  return _alg;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeAlgorithms(threadData_t *threadData, modelica_metatype _algs, modelica_metatype _dimensions, modelica_metatype _prefix)
{
  modelica_metatype _algorithms = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _algorithms = tmpMeta1;
  {
    modelica_metatype _alg;
    for (tmpMeta2 = _algs; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _alg = MMC_CAR(tmpMeta2);
      tmpMeta3 = mmc_mk_cons(omc_NFFlatten_vectorizeAlgorithm(threadData, _alg, _dimensions, _prefix), _algorithms);
      _algorithms = tmpMeta3;
    }
  }

  _algorithms = listReverseInPlace(_algorithms);
  _return: OMC_LABEL_UNUSED
  return _algorithms;
}

static modelica_metatype closure17_NFFlatten_addIterator(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype prefix = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype subscripts = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFFlatten_addIterator(thData, $in_exp, prefix, subscripts);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeEquation(threadData_t *threadData, modelica_metatype _eqn, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _settings, modelica_metatype __omcQ_24in_5Fequations)
{
  modelica_metatype _equations = NULL;
  modelica_metatype _eql = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta33;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _equations = __omcQ_24in_5Fequations;
  // _eql has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _eql = omc_NFFlatten_flattenEquation(threadData, _eqn, _OMC_LIT39, tmpMeta1, _settings);

  {
    modelica_metatype _eq;
    for (tmpMeta2 = _eql; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _eq = MMC_CAR(tmpMeta2);
      { /* match expression */
        modelica_metatype tmp6_1;
        tmp6_1 = _eq;
        {
          modelica_metatype _ty = NULL;
          modelica_metatype _iter = NULL;
          modelica_metatype _scope = NULL;
          modelica_metatype _iters = NULL;
          modelica_metatype _lhs = NULL;
          modelica_metatype _rhs = NULL;
          modelica_metatype _range = NULL;
          modelica_metatype _ranges = NULL;
          modelica_metatype _subs = NULL;
          modelica_metatype _src = NULL;
          volatile mmc_switch_type tmp6;
          int tmp7;
          // _ty has no default value.
          // _iter has no default value.
          // _scope has no default value.
          // _iters has no default value.
          // _lhs has no default value.
          // _rhs has no default value.
          // _range has no default value.
          // _ranges has no default value.
          // _subs has no default value.
          // _src has no default value.
          tmp6 = 0;
          for (; tmp6 < 3; tmp6++) {
            switch (MMC_SWITCH_CAST(tmp6)) {
            case 0: {
              modelica_metatype tmpMeta8;
              modelica_metatype tmpMeta9;
              modelica_metatype tmpMeta10;
              modelica_metatype tmpMeta11;
              modelica_metatype tmpMeta12;
              modelica_metatype tmpMeta13;
              if (mmc__uniontype__metarecord__typedef__equal(tmp6_1,0,5) == 0) goto tmp5_end;
              tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp6_1), 2));
              if (mmc__uniontype__metarecord__typedef__equal(tmpMeta8,6,2) == 0) goto tmp5_end;
              tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp6_1), 3));
              if (mmc__uniontype__metarecord__typedef__equal(tmpMeta9,6,2) == 0) goto tmp5_end;
              
              _lhs = tmpMeta8;
              _rhs = tmpMeta9;
              /* Pattern matching succeeded */
              /* Check guard condition after assignments */
              if (!((!omc_Flags_getConfigBool(threadData, _OMC_LIT60)) || (omc_List_all(threadData, omc_NFComponentRef_subscriptsAllWithWholeFlat(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_lhs), 3)))), boxvar_NFSubscript_isSimple) && omc_List_all(threadData, omc_NFComponentRef_subscriptsAllWithWholeFlat(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_rhs), 3)))), boxvar_NFSubscript_isSimple)))) goto tmp5_end;
              _ty = omc_NFType_liftArrayLeftList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 4))), _dimensions);

              tmpMeta10 = mmc_mk_box3(9, &NFExpression_CREF__desc, _ty, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_lhs), 3))));
              _lhs = tmpMeta10;

              tmpMeta11 = mmc_mk_box3(9, &NFExpression_CREF__desc, _ty, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_rhs), 3))));
              _rhs = tmpMeta11;
              tmpMeta13 = mmc_mk_box6(4, &NFEquation_ARRAY__EQUALITY__desc, _lhs, _rhs, _ty, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_eq), 6))));
              tmpMeta12 = mmc_mk_cons(tmpMeta13, _equations);
              tmpMeta3 = tmpMeta12;
              goto tmp5_done;
            }
            case 1: {
              modelica_metatype tmpMeta14;
              modelica_metatype tmpMeta15;
              if (mmc__uniontype__metarecord__typedef__equal(tmp6_1,9,3) == 0) goto tmp5_end;
              tmpMeta14 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp6_1), 2));
              if (mmc__uniontype__metarecord__typedef__equal(tmpMeta14,13,1) == 0) goto tmp5_end;
              
              _lhs = tmpMeta14;
              /* Pattern matching succeeded */
              /* Check guard condition after assignments */
              if (!omc_NFCall_isConnectionsOperator(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_lhs), 2))))) goto tmp5_end;
              tmpMeta15 = mmc_mk_cons(_eq, _equations);
              tmpMeta3 = tmpMeta15;
              goto tmp5_done;
            }
            case 2: {
              modelica_metatype tmpMeta16;
              modelica_metatype tmpMeta17;
              modelica_metatype tmpMeta18;
              modelica_metatype tmpMeta19;
              modelica_metatype tmpMeta20;
              modelica_metatype tmpMeta21;
              modelica_metatype tmpMeta22;
              modelica_metatype tmpMeta23;
              modelica_metatype tmpMeta24;
              modelica_metatype tmpMeta25;
              modelica_metatype tmpMeta26;
              modelica_metatype tmpMeta27;
              modelica_metatype tmpMeta28;
              modelica_metatype tmpMeta29;
              modelica_metatype tmpMeta30;
              modelica_metatype tmpMeta31;
              modelica_metatype tmpMeta32;
              
              /* Pattern matching succeeded */
              _iters = omc_NFFlatten_makeIterators(threadData, omc_NFFlatten_Prefix_prefix(threadData, _prefix), _dimensions ,&_ranges ,&_subs);

              _subs = listReverseInPlace(_subs);

              tmpMeta16 = mmc_mk_box2(0, _prefix, _subs);
              _eq = omc_NFEquation_mapExp(threadData, _eq, (modelica_fnptr) mmc_mk_box2(0,closure17_NFFlatten_addIterator,tmpMeta16));

              _scope = omc_NFEquation_scope(threadData, _eqn);

              _src = omc_NFEquation_source(threadData, _eqn);

              /* Pattern-matching assignment */
              tmpMeta17 = _iters;
              if (listEmpty(tmpMeta17)) goto goto_4;
              tmpMeta18 = MMC_CAR(tmpMeta17);
              tmpMeta19 = MMC_CDR(tmpMeta17);
              _iter = tmpMeta18;
              _iters = tmpMeta19;

              /* Pattern-matching assignment */
              tmpMeta20 = _ranges;
              if (listEmpty(tmpMeta20)) goto goto_4;
              tmpMeta21 = MMC_CAR(tmpMeta20);
              tmpMeta22 = MMC_CDR(tmpMeta20);
              _range = tmpMeta21;
              _ranges = tmpMeta22;

              tmpMeta23 = mmc_mk_cons(_eq, MMC_REFSTRUCTLIT(mmc_nil));
              tmpMeta24 = mmc_mk_box6(6, &NFEquation_FOR__desc, _iter, mmc_mk_some(_range), tmpMeta23, _scope, _src);
              _eq = tmpMeta24;

              while(1)
              {
                if(!(!listEmpty(_iters))) break;
                /* Pattern-matching assignment */
                tmpMeta25 = _iters;
                if (listEmpty(tmpMeta25)) goto goto_4;
                tmpMeta26 = MMC_CAR(tmpMeta25);
                tmpMeta27 = MMC_CDR(tmpMeta25);
                _iter = tmpMeta26;
                _iters = tmpMeta27;

                /* Pattern-matching assignment */
                tmpMeta28 = _ranges;
                if (listEmpty(tmpMeta28)) goto goto_4;
                tmpMeta29 = MMC_CAR(tmpMeta28);
                tmpMeta30 = MMC_CDR(tmpMeta28);
                _range = tmpMeta29;
                _ranges = tmpMeta30;

                tmpMeta31 = mmc_mk_cons(_eq, MMC_REFSTRUCTLIT(mmc_nil));
                tmpMeta32 = mmc_mk_box6(6, &NFEquation_FOR__desc, _iter, mmc_mk_some(_range), tmpMeta31, _scope, _src);
                _eq = tmpMeta32;
              }
              tmpMeta3 = omc_NFFlatten_splitForLoop(threadData, _eq, _OMC_LIT39, _equations, _settings);
              goto tmp5_done;
            }
            }
            goto tmp5_end;
            tmp5_end: ;
          }
          goto goto_4;
          goto_4:;
          MMC_THROW_INTERNAL();
          goto tmp5_done;
          tmp5_done:;
        }
      }
      _equations = tmpMeta3;
    }
  }
  _return: OMC_LABEL_UNUSED
  return _equations;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeEquations(threadData_t *threadData, modelica_metatype _eql, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _settings)
{
  modelica_metatype _equations = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _equations = tmpMeta1;
  {
    modelica_metatype _eq;
    for (tmpMeta2 = _eql; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _eq = MMC_CAR(tmpMeta2);
      _equations = omc_NFFlatten_vectorizeEquation(threadData, _eq, _dimensions, _prefix, _settings, _equations);
    }
  }

  _equations = listReverseInPlace(_equations);
  _return: OMC_LABEL_UNUSED
  return _equations;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_fillVectorizedBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbinding, modelica_metatype _varType)
{
  modelica_metatype _binding = NULL;
  modelica_metatype _bind_exp = NULL;
  modelica_metatype _bind_ty = NULL;
  modelica_integer _dim_diff;
  modelica_metatype _dims = NULL;
  modelica_metatype _dim_expl = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _binding = __omcQ_24in_5Fbinding;
  // _bind_exp has no default value.
  // _bind_ty has no default value.
  // _dim_diff has no default value.
  // _dims has no default value.
  // _dim_expl has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _binding;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          modelica_metatype tmpMeta19;
          modelica_metatype tmpMeta20;
          modelica_metatype tmpMeta21;
          modelica_metatype tmpMeta22;
          modelica_metatype tmpMeta23;
          modelica_metatype tmpMeta24;
          modelica_metatype tmpMeta25;
          modelica_metatype tmpMeta26;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,3,9) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
          
          _bind_exp = tmpMeta5;
          /* Pattern matching succeeded */
          { /* match expression */
            modelica_metatype tmp9_1;
            tmp9_1 = _bind_exp;
            {
              volatile mmc_switch_type tmp9;
              int tmp10;
              tmp9 = 0;
              for (; tmp9 < 2; tmp9++) {
                switch (MMC_SWITCH_CAST(tmp9)) {
                case 0: {
                  if (mmc__uniontype__metarecord__typedef__equal(tmp9_1,6,2) == 0) goto tmp8_end;
                  
                  /* Pattern matching succeeded */
                  tmpMeta6 = omc_NFComponentRef_getSubscriptedType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_bind_exp), 3))), 1 /* true */);
                  goto tmp8_done;
                }
                case 1: {
                  
                  /* Pattern matching succeeded */
                  tmpMeta6 = omc_NFExpression_typeOf(threadData, _bind_exp);
                  goto tmp8_done;
                }
                }
                goto tmp8_end;
                tmp8_end: ;
              }
              goto goto_7;
              goto_7:;
              goto goto_1;
              goto tmp8_done;
              tmp8_done:;
            }
          }
          _bind_ty = tmpMeta6;

          _dim_diff = omc_NFType_dimensionDiff(threadData, _varType, _bind_ty);

          if((_dim_diff > ((modelica_integer) 0)))
          {
            {
              modelica_metatype __omcQ_24tmpVar17;
              modelica_metatype* tmp12;
              modelica_metatype tmpMeta13;
              modelica_metatype __omcQ_24tmpVar16;
              modelica_integer tmp14;
              modelica_metatype _d_loopVar = 0;
              modelica_metatype _d;
              _d_loopVar = omc_List_firstN(threadData, omc_NFType_arrayDims(threadData, _varType), _dim_diff);
              tmpMeta13 = MMC_REFSTRUCTLIT(mmc_nil);
              __omcQ_24tmpVar17 = tmpMeta13; /* defaultValue */
              tmp12 = &__omcQ_24tmpVar17;
              while(1) {
                tmp14 = 1;
                if (!listEmpty(_d_loopVar)) {
                  _d = MMC_CAR(_d_loopVar);
                  _d_loopVar = MMC_CDR(_d_loopVar);
                  tmp14--;
                }
                if (tmp14 == 0) {
                  __omcQ_24tmpVar16 = omc_NFDimension_sizeExp(threadData, _d);
                  *tmp12 = mmc_mk_cons(__omcQ_24tmpVar16,0);
                  tmp12 = &MMC_CDR(*tmp12);
                } else if (tmp14 == 1) {
                  break;
                } else {
                  goto goto_1;
                }
              }
              *tmp12 = mmc_mk_nil();
              tmpMeta11 = __omcQ_24tmpVar17;
            }
            _dim_expl = tmpMeta11;

            tmpMeta16 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta17 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta18 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta19 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta20 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta21 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta22 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta23 = mmc_mk_box14(3, &NFFunction_Function_FUNCTION__desc, _OMC_LIT62, _OMC_LIT17, tmpMeta16, tmpMeta17, tmpMeta18, tmpMeta19, _OMC_LIT63, _OMC_LIT67, tmpMeta20, tmpMeta21, listArray(tmpMeta22), _OMC_LIT68, _OMC_LIT69);
            tmpMeta24 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding), 2))), _dim_expl);
            tmpMeta25 = mmc_mk_box2(16, &NFExpression_CALL__desc, omc_NFCall_makeTypedCall(threadData, tmpMeta23, tmpMeta24, mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding), 4)))), 1, _varType));
            tmpMeta15 = MMC_TAGPTR(mmc_alloc_words(11));
            memcpy(MMC_UNTAGPTR(tmpMeta15), MMC_UNTAGPTR(_binding), 11*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta15))[2] = tmpMeta25;
            _binding = tmpMeta15;

            tmpMeta26 = MMC_TAGPTR(mmc_alloc_words(11));
            memcpy(MMC_UNTAGPTR(tmpMeta26), MMC_UNTAGPTR(_binding), 11*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta26))[3] = omc_NFExpression_typeOf(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding), 2))));
            _binding = tmpMeta26;
          }
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _binding;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fbinding, modelica_metatype _prefix)
{
  modelica_metatype _binding = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype _nodes = NULL;
  modelica_metatype _dims = NULL;
  modelica_metatype _exp = NULL;
  modelica_metatype _array_call = NULL;
  modelica_metatype _binding_ty = NULL;
  modelica_metatype _iters = NULL;
  modelica_metatype _prefix_cr = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_metatype tmpMeta21;
  modelica_metatype tmpMeta22;
  modelica_metatype tmpMeta23;
  modelica_metatype tmpMeta27;
  modelica_metatype tmpMeta31;
  modelica_metatype tmpMeta32;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _binding = __omcQ_24in_5Fbinding;
  // _subs has no default value.
  // _nodes has no default value.
  // _dims has no default value.
  // _exp has no default value.
  // _array_call has no default value.
  // _binding_ty has no default value.
  // _iters has no default value.
  // _prefix_cr has no default value.
  if((!omc_NFBinding_isBound(threadData, _binding)))
  {
    goto _return;
  }

  _prefix_cr = omc_NFFlatten_Prefix_indexedPrefix(threadData, _prefix);

  {
    modelica_metatype __omcQ_24tmpVar19;
    modelica_metatype* tmp2;
    modelica_metatype tmpMeta3;
    modelica_metatype __omcQ_24tmpVar18;
    modelica_integer tmp4;
    modelica_metatype _s_loopVar = 0;
    modelica_metatype _s;
    _s_loopVar = omc_NFComponentRef_subscriptsAllFlat(threadData, _prefix_cr);
    tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar19 = tmpMeta3; /* defaultValue */
    tmp2 = &__omcQ_24tmpVar19;
    while(1) {
      tmp4 = 1;
      while (!listEmpty(_s_loopVar)) {
        _s = MMC_CAR(_s_loopVar);
        _s_loopVar = MMC_CDR(_s_loopVar);
        if (omc_NFSubscript_isIterator(threadData, _s)) {
          tmp4--;
          break;
        }
      }
      if (tmp4 == 0) {
        __omcQ_24tmpVar18 = _s;
        *tmp2 = mmc_mk_cons(__omcQ_24tmpVar18,0);
        tmp2 = &MMC_CDR(*tmp2);
      } else if (tmp4 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp2 = mmc_mk_nil();
    tmpMeta1 = __omcQ_24tmpVar19;
  }
  _subs = tmpMeta1;

  if(listEmpty(_subs))
  {
    goto _return;
  }

  _exp = omc_NFBinding_getExp(threadData, _binding);

  _binding_ty = omc_NFBinding_getType(threadData, _binding);

  { /* match expression */
    modelica_metatype tmp7_1;
    tmp7_1 = _exp;
    {
      volatile mmc_switch_type tmp7;
      int tmp8;
      tmp7 = 0;
      for (; tmp7 < 2; tmp7++) {
        switch (MMC_SWITCH_CAST(tmp7)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp7_1,26,4) == 0) goto tmp6_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!omc_NFSubscript_isEqualList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _subs)) goto tmp6_end;
          _binding = omc_NFBinding_makeFlat(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), omc_NFBinding_variability(threadData, _binding), omc_NFBinding_source(threadData, _binding));

          goto _return;
          goto tmp6_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp6_done;
        }
        }
        goto tmp6_end;
        tmp6_end: ;
      }
      goto goto_5;
      goto_5:;
      MMC_THROW_INTERNAL();
      goto tmp6_done;
      tmp6_done:;
    }
  }
  ;

  tmpMeta9 = MMC_REFSTRUCTLIT(mmc_nil);
  _nodes = omc_NFComponentRef_nodes(threadData, _prefix_cr, tmpMeta9);

  {
    modelica_metatype __omcQ_24tmpVar21;
    modelica_metatype* tmp11;
    modelica_metatype tmpMeta12;
    modelica_metatype __omcQ_24tmpVar20;
    modelica_integer tmp13;
    modelica_metatype _n_loopVar = 0;
    modelica_metatype _n;
    _n_loopVar = _nodes;
    tmpMeta12 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar21 = tmpMeta12; /* defaultValue */
    tmp11 = &__omcQ_24tmpVar21;
    while(1) {
      tmp13 = 1;
      if (!listEmpty(_n_loopVar)) {
        _n = MMC_CAR(_n_loopVar);
        _n_loopVar = MMC_CDR(_n_loopVar);
        tmp13--;
      }
      if (tmp13 == 0) {
        __omcQ_24tmpVar20 = omc_NFType_arrayDims(threadData, omc_NFInstNode_InstNode_getType(threadData, _n));
        *tmp11 = mmc_mk_cons(__omcQ_24tmpVar20,0);
        tmp11 = &MMC_CDR(*tmp11);
      } else if (tmp13 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp11 = mmc_mk_nil();
    tmpMeta10 = __omcQ_24tmpVar21;
  }
  _dims = omc_List_flatten(threadData, tmpMeta10);

  _dims = omc_List_lastN(threadData, _dims, listLength(_subs));

  _binding_ty = omc_NFType_liftArrayLeftList(threadData, _binding_ty, _dims);

  if((!listEmpty(_dims)))
  {
    if((omc_NFExpression_isLiteral(threadData, _exp) || (!omc_NFExpression_contains(threadData, _exp, boxvar_NFExpression_isIterator))))
    {
      tmpMeta14 = MMC_REFSTRUCTLIT(mmc_nil);
      tmpMeta15 = MMC_REFSTRUCTLIT(mmc_nil);
      tmpMeta16 = MMC_REFSTRUCTLIT(mmc_nil);
      tmpMeta17 = MMC_REFSTRUCTLIT(mmc_nil);
      tmpMeta18 = MMC_REFSTRUCTLIT(mmc_nil);
      tmpMeta19 = MMC_REFSTRUCTLIT(mmc_nil);
      tmpMeta20 = MMC_REFSTRUCTLIT(mmc_nil);
      tmpMeta21 = mmc_mk_box14(3, &NFFunction_Function_FUNCTION__desc, _OMC_LIT62, _OMC_LIT17, tmpMeta14, tmpMeta15, tmpMeta16, tmpMeta17, _OMC_LIT63, _OMC_LIT67, tmpMeta18, tmpMeta19, listArray(tmpMeta20), _OMC_LIT68, _OMC_LIT69);
      {
        modelica_metatype __omcQ_24tmpVar23;
        modelica_metatype* tmp24;
        modelica_metatype tmpMeta25;
        modelica_metatype __omcQ_24tmpVar22;
        modelica_integer tmp26;
        modelica_metatype _d_loopVar = 0;
        modelica_metatype _d;
        _d_loopVar = _dims;
        tmpMeta25 = MMC_REFSTRUCTLIT(mmc_nil);
        __omcQ_24tmpVar23 = tmpMeta25; /* defaultValue */
        tmp24 = &__omcQ_24tmpVar23;
        while(1) {
          tmp26 = 1;
          if (!listEmpty(_d_loopVar)) {
            _d = MMC_CAR(_d_loopVar);
            _d_loopVar = MMC_CDR(_d_loopVar);
            tmp26--;
          }
          if (tmp26 == 0) {
            __omcQ_24tmpVar22 = omc_NFDimension_sizeExp(threadData, _d);
            *tmp24 = mmc_mk_cons(__omcQ_24tmpVar22,0);
            tmp24 = &MMC_CDR(*tmp24);
          } else if (tmp26 == 1) {
            break;
          } else {
            MMC_THROW_INTERNAL();
          }
        }
        *tmp24 = mmc_mk_nil();
        tmpMeta23 = __omcQ_24tmpVar23;
      }
      tmpMeta22 = mmc_mk_cons(_exp, tmpMeta23);
      _array_call = omc_NFCall_makeTypedCall(threadData, tmpMeta21, tmpMeta22, omc_NFBinding_variability(threadData, _binding), 1, _binding_ty);
    }
    else
    {
      {
        modelica_metatype __omcQ_24tmpVar25;
        modelica_metatype tmpMeta28;
        modelica_metatype tmpMeta29;
        modelica_metatype __omcQ_24tmpVar24;
        modelica_integer tmp30;
        modelica_metatype _s_loopVar = 0;
        modelica_metatype _s;
        modelica_metatype _d_loopVar = 0;
        modelica_metatype _d;
        _s_loopVar = _subs;
        _d_loopVar = _dims;
        tmpMeta28 = MMC_REFSTRUCTLIT(mmc_nil);
        __omcQ_24tmpVar25 = tmpMeta28; /* defaultValue */
        while(1) {
          tmp30 = 2;
          if (!listEmpty(_s_loopVar)) {
            _s = MMC_CAR(_s_loopVar);
            _s_loopVar = MMC_CDR(_s_loopVar);
            tmp30--;
          }if (!listEmpty(_d_loopVar)) {
            _d = MMC_CAR(_d_loopVar);
            _d_loopVar = MMC_CDR(_d_loopVar);
            tmp30--;
          }
          if (tmp30 == 0) {
            tmpMeta29 = mmc_mk_box2(0, omc_NFSubscript_toIterator(threadData, _s), omc_NFDimension_toRange(threadData, _d));
            __omcQ_24tmpVar24 = tmpMeta29;
            __omcQ_24tmpVar25 = mmc_mk_cons(__omcQ_24tmpVar24,__omcQ_24tmpVar25);
          } else if (tmp30 == 2) {
            break;
          } else {
            MMC_THROW_INTERNAL();
          }
        }
        tmpMeta27 = __omcQ_24tmpVar25;
      }
      _iters = tmpMeta27;

      tmpMeta31 = mmc_mk_box6(7, &NFCall_TYPED__ARRAY__CONSTRUCTOR__desc, _binding_ty, mmc_mk_integer(omc_NFExpression_variability(threadData, _exp)), mmc_mk_integer(omc_NFExpression_purity(threadData, _exp)), _exp, _iters);
      _array_call = tmpMeta31;
    }

    tmpMeta32 = mmc_mk_box2(16, &NFExpression_CALL__desc, _array_call);
    _exp = tmpMeta32;
  }

  _binding = omc_NFBinding_makeFlat(threadData, _exp, omc_NFBinding_variability(threadData, _binding), omc_NFBinding_source(threadData, _binding));
  _return: OMC_LABEL_UNUSED
  return _binding;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_makeBindingIterators(threadData_t *threadData, modelica_metatype _prefix, modelica_metatype _dimensions)
{
  modelica_metatype _subs = NULL;
  modelica_metatype tmpMeta1;
  modelica_integer _index;
  modelica_metatype _iter = NULL;
  modelica_string _name = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_string tmp4;
  modelica_metatype tmpMeta5;
  modelica_string tmp6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _subs = tmpMeta1;
  _index = ((modelica_integer) 0);
  // _iter has no default value.
  // _name has no default value.
  tmpMeta2 = stringAppend(_OMC_LIT70,omc_NFInstNode_InstNode_name(threadData, omc_NFComponentRef_node(threadData, _prefix)));
  _name = tmpMeta2;

  {
    modelica_metatype _d;
    for (tmpMeta3 = _dimensions; !listEmpty(tmpMeta3); tmpMeta3=MMC_CDR(tmpMeta3))
    {
      _d = MMC_CAR(tmpMeta3);
      _index = ((modelica_integer) 1) + _index;

      tmp4 = modelica_integer_to_modelica_string(_index, ((modelica_integer) 0), 1 /* true */);
      tmpMeta5 = stringAppend(_name,tmp4);
      tmp6 = modelica_integer_to_modelica_string(_index, ((modelica_integer) 0), 1 /* true */);
      tmpMeta7 = stringAppend(_name,tmp6);
      _iter = omc_NFComponentRef_makeIterator(threadData, omc_NFInstNode_InstNode_newIterator(threadData, tmpMeta5, _OMC_LIT53, _OMC_LIT38), omc_NFInstNode_InstNode_getType(threadData, omc_NFInstNode_InstNode_newIterator(threadData, tmpMeta7, _OMC_LIT53, _OMC_LIT38)));

      tmpMeta8 = mmc_mk_cons(omc_NFSubscript_makeIndex(threadData, omc_NFExpression_fromCref(threadData, _iter, 0 /* false */)), _subs);
      _subs = tmpMeta8;
    }
  }

  _subs = listReverseInPlace(_subs);
  _return: OMC_LABEL_UNUSED
  return _subs;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_vectorizeArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _cls_ty, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _vrs = NULL;
  modelica_metatype _sects = NULL;
  modelica_metatype _eq = NULL;
  modelica_metatype _ieq = NULL;
  modelica_metatype _alg = NULL;
  modelica_metatype _ialg = NULL;
  modelica_metatype _indexed_prefix = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  _sections = __omcQ_24in_5Fsections;
  // _vrs has no default value.
  // _sects has no default value.
  // _eq has no default value.
  // _ieq has no default value.
  // _alg has no default value.
  // _ialg has no default value.
  // _indexed_prefix has no default value.
  if(omc_List_any(threadData, _dimensions, boxvar_NFDimension_isZero))
  {
    goto _return;
  }

  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _vrs = omc_NFFlatten_flattenClass(threadData, _cls, _prefix, (modelica_integer)_visibility, _binding, tmpMeta1, _OMC_LIT71, _deletedVars, _settings ,&_sects);

  {
    modelica_metatype _v;
    for (tmpMeta2 = listReverse(_vrs); !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _v = MMC_CAR(tmpMeta2);
      if((!(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 6)))) && omc_NFType_isRecord(threadData, omc_NFType_arrayElementType(threadData, _cls_ty)))))
      {
        tmpMeta3 = MMC_TAGPTR(mmc_alloc_words(12));
        memcpy(MMC_UNTAGPTR(tmpMeta3), MMC_UNTAGPTR(_v), 12*sizeof(modelica_metatype));
        ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta3))[3] = omc_NFType_liftArrayLeftList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_v), 3))), _dimensions);
        _v = tmpMeta3;
      }

      tmpMeta4 = mmc_mk_cons(_v, _vars);
      _vars = tmpMeta4;
    }
  }

  { /* match expression */
    modelica_metatype tmp8_1;
    tmp8_1 = _sects;
    {
      volatile mmc_switch_type tmp8;
      int tmp9;
      tmp8 = 0;
      for (; tmp8 < 1; tmp8++) {
        switch (MMC_SWITCH_CAST(tmp8)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_1,0,4) == 0) goto tmp7_end;
          
          /* Pattern matching succeeded */
          _eq = omc_NFFlatten_vectorizeEquations(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sects), 2))), _dimensions, _prefix, _settings);

          _ieq = omc_NFFlatten_vectorizeEquations(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sects), 3))), _dimensions, _prefix, _settings);

          _alg = omc_NFFlatten_vectorizeAlgorithms(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sects), 4))), _dimensions, _prefix);

          _ialg = omc_NFFlatten_vectorizeAlgorithms(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sects), 5))), _dimensions, _prefix);

          _sections = omc_NFSections_prepend(threadData, _eq, _ieq, _alg, _ialg, _sections);
          goto tmp7_done;
        }
        }
        goto tmp7_end;
        tmp7_end: ;
      }
      goto goto_6;
      goto_6:;
      MMC_THROW_INTERNAL();
      goto tmp7_done;
      tmp7_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  if (out_sections) { *out_sections = _sections; }
  return _vars;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_vectorizeArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _cls_ty, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_integer tmp1;
  modelica_metatype _vars = NULL;
  tmp1 = mmc_unbox_integer(_visibility);
  _vars = omc_NFFlatten_vectorizeArray(threadData, _cls, _cls_ty, _dimensions, _prefix, tmp1, _binding, __omcQ_24in_5Fvars, __omcQ_24in_5Fsections, _subscripts, _deletedVars, _settings, out_sections);
  /* skip box _vars; list<NFVariable> */
  /* skip box _sections; NFSections */
  return _vars;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _info, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _dim = NULL;
  modelica_metatype _rest_dims = NULL;
  modelica_metatype _sub_pre = NULL;
  modelica_metatype _range_iter = NULL;
  modelica_metatype _sub_exp = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  _sections = __omcQ_24in_5Fsections;
  // _dim has no default value.
  // _rest_dims has no default value.
  // _sub_pre has no default value.
  // _range_iter has no default value.
  // _sub_exp has no default value.
  // _subs has no default value.
  if(listEmpty(_dimensions))
  {
    _subs = listReverse(_subscripts);

    _sub_pre = omc_NFFlatten_Prefix_subscript(threadData, _subs, _prefix);

    _vars = omc_NFFlatten_flattenClass(threadData, _cls, _sub_pre, (modelica_integer)_visibility, omc_NFFlatten_subscriptBindingOpt(threadData, _subs, _binding), _vars, _sections, _deletedVars, _settings ,&_sections);
  }
  else
  {
    /* Pattern-matching assignment */
    tmpMeta1 = _dimensions;
    if (listEmpty(tmpMeta1)) MMC_THROW_INTERNAL();
    tmpMeta2 = MMC_CAR(tmpMeta1);
    tmpMeta3 = MMC_CDR(tmpMeta1);
    _dim = tmpMeta2;
    _rest_dims = tmpMeta3;

    _dim = omc_NFFlatten_flattenDimension(threadData, _dim, _prefix, _info);

    _range_iter = omc_NFRangeIterator_fromDim(threadData, _dim, 0 /* false */);

    while(1)
    {
      if(!omc_NFRangeIterator_hasNext(threadData, _range_iter)) break;
      _range_iter = omc_NFRangeIterator_next(threadData, _range_iter ,&_sub_exp);

      tmpMeta5 = mmc_mk_box2(5, &NFSubscript_INDEX__desc, _sub_exp);
      tmpMeta4 = mmc_mk_cons(tmpMeta5, _subscripts);
      _vars = omc_NFFlatten_flattenArray(threadData, _cls, _rest_dims, _prefix, (modelica_integer)_visibility, _binding, _vars, _sections, tmpMeta4, _deletedVars, _info, _settings ,&_sections);
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_sections) { *out_sections = _sections; }
  return _vars;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenArray(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _dimensions, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _subscripts, modelica_metatype _deletedVars, modelica_metatype _info, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_integer tmp1;
  modelica_metatype _vars = NULL;
  tmp1 = mmc_unbox_integer(_visibility);
  _vars = omc_NFFlatten_flattenArray(threadData, _cls, _dimensions, _prefix, tmp1, _binding, __omcQ_24in_5Fvars, __omcQ_24in_5Fsections, _subscripts, _deletedVars, _info, _settings, out_sections);
  /* skip box _vars; list<NFVariable> */
  /* skip box _sections; NFSections */
  return _vars;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_splitRecordCref(threadData_t *threadData, modelica_metatype _exp)
{
  modelica_metatype _outExp = NULL;
  modelica_metatype _cls = NULL;
  modelica_metatype _comps = NULL;
  modelica_metatype _cr = NULL;
  modelica_metatype _field_cr = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _fields = NULL;
  modelica_metatype _cond = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _cls has no default value.
  // _comps has no default value.
  // _cr has no default value.
  // _field_cr has no default value.
  // _ty has no default value.
  // _fields has no default value.
  // _cond has no default value.
  _outExp = omc_NFExpandExp_expand(threadData, _exp, 0 /* false */, NULL);

  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _outExp;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 4; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_integer tmp13;
          modelica_integer tmp14;
          modelica_integer tmp15;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,11,2) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 2));
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _cls = tmpMeta7;
          _cr = tmpMeta8;
          /* Pattern matching succeeded */
          _comps = omc_NFClassTree_ClassTree_getComponents(threadData, omc_NFClass_classTree(threadData, omc_NFInstNode_InstNode_getClass(threadData, _cls)));

          tmpMeta9 = MMC_REFSTRUCTLIT(mmc_nil);
          _fields = tmpMeta9;

          tmp13 = arrayLength(_comps); tmp14 = ((modelica_integer) -1); tmp15 = ((modelica_integer) 1);
          if(!(((tmp14 > 0) && (tmp13 > tmp15)) || ((tmp14 < 0) && (tmp13 < tmp15))))
          {
            modelica_integer _i;
            for(_i = arrayLength(_comps); in_range_integer(_i, tmp13, tmp15); _i += tmp14)
            {
              _ty = omc_NFInstNode_InstNode_getType(threadData, arrayGet(_comps,_i) /* DAE.ASUB */);

              tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
              _field_cr = omc_NFComponentRef_prefixCref(threadData, arrayGet(_comps,_i) /* DAE.ASUB */, _ty, tmpMeta10, _cr);

              tmpMeta11 = mmc_mk_box3(3, &NFFlatten_Prefix_PREFIX__desc, _OMC_LIT17, _cr);
              _field_cr = omc_NFFlatten_flattenCref(threadData, _field_cr, tmpMeta11, _OMC_LIT38);

              tmpMeta12 = mmc_mk_cons(omc_NFExpression_fromCref(threadData, _field_cr, 0 /* false */), _fields);
              _fields = tmpMeta12;
            }
          }
          tmpMeta1 = omc_NFExpression_makeRecord(threadData, omc_NFInstNode_InstNode_scopePath(threadData, _cls, 1, 0 /* false */), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 2))), _fields);
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta16;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta16 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta16), MMC_UNTAGPTR(_outExp), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta16))[3] = omc_Array_map(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 3))), boxvar_NFFlatten_splitRecordCref);
          _outExp = tmpMeta16;
          tmpMeta1 = _outExp;
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta17;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,22,4) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(omc_NFExpression_variability(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 3)))) <= 3)) goto tmp3_end;
          _cond = omc_NFCeval_tryEvalExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 3))));

          if((!referenceEq(_cond, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 3))))))
          {
            omc_NFStructural_markExp(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 3))));
          }
          { /* match expression */
            modelica_metatype tmp20_1;
            tmp20_1 = _cond;
            {
              volatile mmc_switch_type tmp20;
              int tmp21;
              tmp20 = 0;
              for (; tmp20 < 2; tmp20++) {
                switch (MMC_SWITCH_CAST(tmp20)) {
                case 0: {
                  if (mmc__uniontype__metarecord__typedef__equal(tmp20_1,3,1) == 0) goto tmp19_end;
                  
                  /* Pattern matching succeeded */
                  /* Tail recursive call */
                  _exp = (mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cond), 2))))?(MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 4))):(MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outExp), 5))));
                  goto _tailrecursive;
                  /* TODO: Make sure any eventual dead code below is never generated */
                  goto tmp19_done;
                }
                case 1: {
                  
                  /* Pattern matching succeeded */
                  tmpMeta17 = _outExp;
                  goto tmp19_done;
                }
                }
                goto tmp19_end;
                tmp19_end: ;
              }
              goto goto_18;
              goto_18:;
              goto goto_2;
              goto tmp19_done;
              tmp19_done:;
            }
          }tmpMeta1 = tmpMeta17;
          goto tmp3_done;
        }
        case 3: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outExp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outExp;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenComplexComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_metatype _cls, modelica_metatype _nodeTy, modelica_integer _visibility, modelica_metatype _outerBinding, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _dims = NULL;
  modelica_metatype _name = NULL;
  modelica_metatype _binding = NULL;
  modelica_metatype _opt_binding = NULL;
  modelica_metatype _binding_exp = NULL;
  modelica_metatype _binding_exp_eval = NULL;
  modelica_metatype _eq = NULL;
  modelica_integer _comp_var;
  modelica_integer _binding_var;
  modelica_metatype _ty = NULL;
  modelica_metatype _pre = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  _sections = __omcQ_24in_5Fsections;
  // _dims has no default value.
  // _name has no default value.
  // _binding has no default value.
  // _opt_binding has no default value.
  // _binding_exp has no default value.
  // _binding_exp_eval has no default value.
  // _eq has no default value.
  // _comp_var has no default value.
  // _binding_var has no default value.
  // _ty has no default value.
  // _pre has no default value.
  // _info has no default value.
  _info = omc_NFInstNode_InstNode_info(threadData, _node);

  _ty = omc_NFFlatten_flattenType(threadData, _nodeTy, _prefix, _info);

  _dims = omc_NFType_arrayDims(threadData, _ty);

  _binding = (isSome(_outerBinding)?omc_Util_getOption(threadData, _outerBinding):omc_NFComponent_getBinding(threadData, _comp));

  if(omc_NFBinding_isExplicitlyBound(threadData, _binding))
  {
    _binding = omc_NFFlatten_flattenBinding(threadData, _binding, _prefix, 0 /* false */);

    _binding_exp = omc_NFBinding_getTypedExp(threadData, _binding);

    _binding_var = omc_NFBinding_variability(threadData, _binding);

    _comp_var = omc_NFComponent_variability(threadData, _comp);

    if((((modelica_integer)_comp_var <= 2) || ((modelica_integer)_binding_var <= 2)))
    {
      _binding_exp = omc_NFCeval_evalExp(threadData, _binding_exp, _OMC_LIT40);

      _binding_exp = omc_NFFlatten_flattenExp(threadData, _binding_exp, _prefix, omc_NFBinding_getInfo(threadData, _binding));
    }
    else
    {
      if((((modelica_integer)_binding_var == 3) && omc_NFComponent_isFinal(threadData, _comp)))
      {
        { /* matchcontinue expression */
          {
            volatile mmc_switch_type tmp3;
            int tmp4;
            tmp3 = 0;
            MMC_TRY_INTERNAL(mmc_jumper)
            tmp2_top:
            threadData->mmc_jumper = &new_mmc_jumper;
            for (; tmp3 < 2; tmp3++) {
              switch (MMC_SWITCH_CAST(tmp3)) {
              case 0: {
                /* Pattern matching succeeded */
                _binding_exp = omc_NFInline_inlineCallExp(threadData, _binding_exp, 1 /* true */);
                goto tmp2_done;
              }
              case 1: {
                /* Pattern matching succeeded */
                goto tmp2_done;
              }
              }
              goto tmp2_end;
              tmp2_end: ;
            }
            goto goto_1;
            tmp2_done:
            (void)tmp3;
            MMC_RESTORE_INTERNAL(mmc_jumper);
            goto tmp2_done2;
            goto_1:;
            MMC_CATCH_INTERNAL(mmc_jumper);
            if (++tmp3 < 2) {
              goto tmp2_top;
            }
            MMC_THROW_INTERNAL();
            tmp2_done2:;
          }
        }
        ;

        if((!(omc_NFExpression_isRecord(threadData, _binding_exp) || omc_NFExpression_isCref(threadData, _binding_exp))))
        {
          { /* matchcontinue expression */
            {
              volatile mmc_switch_type tmp7;
              int tmp8;
              tmp7 = 0;
              MMC_TRY_INTERNAL(mmc_jumper)
              tmp6_top:
              threadData->mmc_jumper = &new_mmc_jumper;
              for (; tmp7 < 2; tmp7++) {
                switch (MMC_SWITCH_CAST(tmp7)) {
                case 0: {
                  modelica_integer tmp9;
                  /* Pattern matching succeeded */
                  _binding_exp_eval = omc_NFCeval_tryEvalExp(threadData, _binding_exp);

                  _binding_exp_eval = omc_NFFlatten_flattenExp(threadData, _binding_exp_eval, _prefix, omc_NFBinding_getInfo(threadData, _binding));

                  /* Pattern-matching assignment */
                  tmp9 = omc_NFType_dimensionDiff(threadData, _ty, omc_NFExpression_typeOf(threadData, _binding_exp_eval));
                  if (0 != tmp9) goto goto_5;

                  _binding_exp = _binding_exp_eval;
                  goto tmp6_done;
                }
                case 1: {
                  /* Pattern matching succeeded */
                  goto tmp6_done;
                }
                }
                goto tmp6_end;
                tmp6_end: ;
              }
              goto goto_5;
              tmp6_done:
              (void)tmp7;
              MMC_RESTORE_INTERNAL(mmc_jumper);
              goto tmp6_done2;
              goto_5:;
              MMC_CATCH_INTERNAL(mmc_jumper);
              if (++tmp7 < 2) {
                goto tmp6_top;
              }
              MMC_THROW_INTERNAL();
              tmp6_done2:;
            }
          }
          ;
        }
      }
      else
      {
        _binding_exp = omc_NFSimplifyExp_simplify(threadData, _binding_exp, 0 /* false */);
      }
    }

    _binding_exp = omc_NFFlatten_splitRecordCref(threadData, _binding_exp);

    if((!omc_NFExpression_isRecordOrRecordArray(threadData, _binding_exp)))
    {
      if((!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 6))))))
      {
        tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
        _name = omc_NFComponentRef_prefixCref(threadData, _node, _ty, tmpMeta10, omc_NFFlatten_Prefix_prefix(threadData, _prefix));

        tmpMeta11 = mmc_mk_box3(9, &NFExpression_CREF__desc, _ty, _name);
        tmpMeta12 = mmc_mk_box6(3, &NFEquation_EQUALITY__desc, tmpMeta11, _binding_exp, _ty, _OMC_LIT17, omc_ElementSource_createElementSource(threadData, _info, mmc_mk_none(), _OMC_LIT18, _OMC_LIT22));
        _eq = tmpMeta12;

        _sections = omc_NFSections_prependEquation(threadData, _eq, _sections, ((modelica_integer)_comp_var <= 3));
      }

      _opt_binding = _OMC_LIT72;
    }
    else
    {
      _binding = omc_NFBinding_setTypedExp(threadData, _binding_exp, _binding);

      _opt_binding = mmc_mk_some(_binding);
    }
  }
  else
  {
    _opt_binding = mmc_mk_none();
  }

  _pre = omc_NFFlatten_Prefix_push(threadData, _node, _ty, _dims, _prefix);

  if(listEmpty(_dims))
  {
    _vars = omc_NFFlatten_flattenClass(threadData, _cls, _pre, (modelica_integer)_visibility, _opt_binding, _vars, _sections, _deletedVars, _settings ,&_sections);
  }
  else
  {
    if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 2)))))
    {
      {
        modelica_metatype __omcQ_24tmpVar27;
        modelica_metatype* tmp14;
        modelica_metatype tmpMeta15;
        modelica_metatype __omcQ_24tmpVar26;
        modelica_integer tmp16;
        modelica_metatype _d_loopVar = 0;
        modelica_metatype _d;
        _d_loopVar = _dims;
        tmpMeta15 = MMC_REFSTRUCTLIT(mmc_nil);
        __omcQ_24tmpVar27 = tmpMeta15; /* defaultValue */
        tmp14 = &__omcQ_24tmpVar27;
        while(1) {
          tmp16 = 1;
          if (!listEmpty(_d_loopVar)) {
            _d = MMC_CAR(_d_loopVar);
            _d_loopVar = MMC_CDR(_d_loopVar);
            tmp16--;
          }
          if (tmp16 == 0) {
            __omcQ_24tmpVar26 = omc_NFFlatten_flattenDimension(threadData, _d, _pre, _info);
            *tmp14 = mmc_mk_cons(__omcQ_24tmpVar26,0);
            tmp14 = &MMC_CDR(*tmp14);
          } else if (tmp16 == 1) {
            break;
          } else {
            MMC_THROW_INTERNAL();
          }
        }
        *tmp14 = mmc_mk_nil();
        tmpMeta13 = __omcQ_24tmpVar27;
      }
      _dims = tmpMeta13;

      omc_NFFlatten_verifyDimensions(threadData, _dims, _node);

      tmpMeta17 = MMC_REFSTRUCTLIT(mmc_nil);
      _vars = omc_NFFlatten_flattenArray(threadData, _cls, _dims, _pre, (modelica_integer)_visibility, _opt_binding, _vars, _sections, tmpMeta17, _deletedVars, _info, _settings ,&_sections);
    }
    else
    {
      tmpMeta18 = MMC_REFSTRUCTLIT(mmc_nil);
      _vars = omc_NFFlatten_vectorizeArray(threadData, _cls, _ty, _dims, _pre, (modelica_integer)_visibility, _opt_binding, _vars, _sections, tmpMeta18, _deletedVars, _settings ,&_sections);
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_sections) { *out_sections = _sections; }
  return _vars;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenComplexComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_metatype _cls, modelica_metatype _nodeTy, modelica_metatype _visibility, modelica_metatype _outerBinding, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_integer tmp1;
  modelica_metatype _vars = NULL;
  tmp1 = mmc_unbox_integer(_visibility);
  _vars = omc_NFFlatten_flattenComplexComponent(threadData, _node, _comp, _cls, _nodeTy, tmp1, _outerBinding, _prefix, __omcQ_24in_5Fvars, __omcQ_24in_5Fsections, _deletedVars, _settings, out_sections);
  /* skip box _vars; list<NFVariable> */
  /* skip box _sections; NFSections */
  return _vars;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_getRecordBindings(threadData_t *threadData, modelica_metatype _binding, modelica_metatype _comps, modelica_metatype _prefix)
{
  modelica_metatype _recordBindings = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _binding_exp = NULL;
  modelica_integer _var;
  modelica_integer _bind_src;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta18;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _recordBindings = tmpMeta1;
  // _binding_exp has no default value.
  // _var has no default value.
  // _bind_src has no default value.
  _binding_exp = omc_NFBinding_getTypedExp(threadData, _binding);

  _var = omc_NFBinding_variability(threadData, _binding);

  _bind_src = 4;

  { /* match expression */
    modelica_metatype tmp5_1;
    tmp5_1 = _binding_exp;
    {
      volatile mmc_switch_type tmp5;
      int tmp6;
      tmp5 = 0;
      for (; tmp5 < 3; tmp5++) {
        switch (MMC_SWITCH_CAST(tmp5)) {
        case 0: {
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp5_1,12,3) == 0) goto tmp4_end;
          
          /* Pattern matching succeeded */
          {
            modelica_metatype __omcQ_24tmpVar29;
            modelica_metatype* tmp8;
            modelica_metatype tmpMeta9;
            modelica_metatype __omcQ_24tmpVar28;
            modelica_integer tmp10;
            modelica_metatype _e_loopVar = 0;
            modelica_metatype _e;
            _e_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_binding_exp), 4)));
            tmpMeta9 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar29 = tmpMeta9; /* defaultValue */
            tmp8 = &__omcQ_24tmpVar29;
            while(1) {
              tmp10 = 1;
              if (!listEmpty(_e_loopVar)) {
                _e = MMC_CAR(_e_loopVar);
                _e_loopVar = MMC_CDR(_e_loopVar);
                tmp10--;
              }
              if (tmp10 == 0) {
                __omcQ_24tmpVar28 = (omc_NFExpression_isEmpty(threadData, _e)?_OMC_LIT14:omc_NFBinding_makeFlat(threadData, _e, (modelica_integer)_var, (modelica_integer)_bind_src));
                *tmp8 = mmc_mk_cons(__omcQ_24tmpVar28,0);
                tmp8 = &MMC_CDR(*tmp8);
              } else if (tmp10 == 1) {
                break;
              } else {
                goto goto_3;
              }
            }
            *tmp8 = mmc_mk_nil();
            tmpMeta7 = __omcQ_24tmpVar29;
          }
          tmpMeta2 = tmpMeta7;
          goto tmp4_done;
        }
        case 1: {
          modelica_metatype tmpMeta11;
          if (mmc__uniontype__metarecord__typedef__equal(tmp5_1,8,3) == 0) goto tmp4_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!omc_NFType_isRecord(threadData, omc_NFType_arrayElementType(threadData, omc_NFExpression_typeOf(threadData, _binding_exp)))) goto tmp4_end;
          {
            modelica_metatype __omcQ_24tmpVar31;
            modelica_metatype* tmp12;
            modelica_metatype tmpMeta13;
            modelica_metatype __omcQ_24tmpVar30;
            modelica_integer tmp14;
            modelica_integer tmp15;
            modelica_integer tmp16;
            modelica_integer _i;
            tmp15 = 1 /* Range step-value */;
            tmp16 = arrayLength(_comps) /* Range stop-value */;
            _i = ((modelica_integer) 1) /* Range start-value */;
            _i = (((modelica_integer) 1) /* Range start-value */)-tmp15;
            tmpMeta13 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar31 = tmpMeta13; /* defaultValue */
            tmp12 = &__omcQ_24tmpVar31;
            while(1) {
              tmp14 = 1;
              if (tmp15 > 0 ? _i+tmp15 <= tmp16 : _i+tmp15 >= tmp16) {
                _i += tmp15;
                tmp14--;
              }
              if (tmp14 == 0) {
                __omcQ_24tmpVar30 = omc_NFBinding_makeFlat(threadData, omc_NFExpression_nthRecordElement(threadData, _i, _binding_exp), (modelica_integer)_var, (modelica_integer)_bind_src);
                *tmp12 = mmc_mk_cons(__omcQ_24tmpVar30,0);
                tmp12 = &MMC_CDR(*tmp12);
              } else if (tmp14 == 1) {
                break;
              } else {
                goto goto_3;
              }
            }
            *tmp12 = mmc_mk_nil();
            tmpMeta11 = __omcQ_24tmpVar31;
          }
          tmpMeta2 = tmpMeta11;
          goto tmp4_done;
        }
        case 2: {
          modelica_metatype tmpMeta17;
          
          /* Pattern matching succeeded */
          tmpMeta17 = stringAppend(_OMC_LIT73,omc_NFExpression_toString(threadData, _binding_exp));
          omc_Error_assertion(threadData, 0 /* false */, tmpMeta17, _OMC_LIT74);
          goto goto_3;
          goto tmp4_done;
        }
        }
        goto tmp4_end;
        tmp4_end: ;
      }
      goto goto_3;
      goto_3:;
      MMC_THROW_INTERNAL();
      goto tmp4_done;
      tmp4_done:;
    }
  }
  _recordBindings = tmpMeta2;

  tmpMeta18 = stringAppend(_OMC_LIT75,omc_NFFlatten_Prefix_toString(threadData, _prefix));
  omc_Error_assertion(threadData, (listLength(_recordBindings) == arrayLength(_comps)), tmpMeta18, _OMC_LIT76);
  _return: OMC_LABEL_UNUSED
  return _recordBindings;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_verifyBinding_eval__binding(threadData_t *threadData, modelica_metatype _binding)
{
  modelica_metatype _result = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _result has no default value.
  if(omc_NFBinding_isBound(threadData, _binding))
  {
    _result = mmc_mk_some(omc_NFCeval_tryEvalExp(threadData, omc_NFBinding_getExp(threadData, _binding)));
  }
  else
  {
    _result = mmc_mk_none();
  }
  _return: OMC_LABEL_UNUSED
  return _result;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_verifyBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_integer _variability, modelica_metatype _binding, modelica_metatype _settings)
{
  modelica_metatype _var = NULL;
  modelica_metatype _fixed_binding = NULL;
  modelica_metatype _start_binding = NULL;
  modelica_metatype _fixed_exp_opt = NULL;
  modelica_metatype _fixed_exp = NULL;
  modelica_metatype _start_exp = NULL;
  modelica_boolean _fixed;
  modelica_metatype _min_exp_opt = NULL;
  modelica_metatype _max_exp_opt = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  // _fixed_binding has no default value.
  // _start_binding has no default value.
  // _fixed_exp_opt has no default value.
  // _fixed_exp has no default value.
  // _start_exp has no default value.
  // _fixed has no default value.
  // _min_exp_opt has no default value.
  // _max_exp_opt has no default value.
  if((((modelica_integer)_variability > 1) && omc_NFBinding_isBound(threadData, _binding)))
  {
    goto _return;
  }

  _fixed_binding = omc_NFVariable_lookupTypeAttribute(threadData, _OMC_LIT77, _var);

  _fixed_exp_opt = omc_NFFlatten_verifyBinding_eval__binding(threadData, _fixed_binding);

  if(isSome(_fixed_exp_opt))
  {
    /* Pattern-matching assignment */
    tmpMeta1 = _fixed_exp_opt;
    if (optionNone(tmpMeta1)) MMC_THROW_INTERNAL();
    tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
    _fixed_exp = tmpMeta2;

    if((!omc_NFExpression_isBoolean(threadData, _fixed_exp)))
    {
      goto _return;
    }

    _fixed = omc_NFExpression_isTrue(threadData, _fixed_exp);
  }
  else
  {
    _fixed = 1 /* true */;
  }

  if(((modelica_integer)_variability == 1))
  {
    if((!_fixed))
    {
      tmpMeta3 = mmc_mk_cons(omc_NFComponentRef_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))), MMC_REFSTRUCTLIT(mmc_nil));
      omc_Error_addSourceMessage(threadData, _OMC_LIT90, tmpMeta3, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 10))));

      if((!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 5))))))
      {
        MMC_THROW_INTERNAL();
      }
    }

    if(omc_NFBinding_isUnbound(threadData, _binding))
    {
      tmpMeta4 = mmc_mk_cons(omc_NFComponentRef_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))), MMC_REFSTRUCTLIT(mmc_nil));
      omc_Error_addSourceMessage(threadData, _OMC_LIT93, tmpMeta4, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 10))));

      MMC_THROW_INTERNAL();
    }
  }
  else
  {
    if((_fixed && omc_NFBinding_isUnbound(threadData, _binding)))
    {
      _start_binding = omc_NFVariable_lookupTypeAttribute(threadData, _OMC_LIT78, _var);

      if(omc_NFBinding_isUnbound(threadData, _start_binding))
      {
        tmpMeta5 = mmc_mk_cons(omc_NFComponentRef_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))), MMC_REFSTRUCTLIT(mmc_nil));
        omc_Error_addSourceMessage(threadData, _OMC_LIT85, tmpMeta5, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 10))));

        if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 8)))))
        {
          _min_exp_opt = omc_NFFlatten_verifyBinding_eval__binding(threadData, omc_NFVariable_lookupTypeAttribute(threadData, _OMC_LIT86, _var));

          _max_exp_opt = omc_NFFlatten_verifyBinding_eval__binding(threadData, omc_NFVariable_lookupTypeAttribute(threadData, _OMC_LIT87, _var));

          _start_exp = omc_NFExpression_makeDefaultValue(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), _min_exp_opt, _max_exp_opt);

          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(12));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[4] = omc_NFBinding_makeFlat(threadData, _start_exp, omc_NFExpression_variability(threadData, _start_exp), 4);
          _var = tmpMeta6;
        }
        else
        {
          if((!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 5))))))
          {
            MMC_THROW_INTERNAL();
          }
        }
      }
      else
      {
        tmpMeta7 = mmc_mk_cons(omc_NFComponentRef_toString(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 2)))), mmc_mk_cons(omc_NFBinding_toString(threadData, _start_binding, _OMC_LIT19), MMC_REFSTRUCTLIT(mmc_nil)));
        omc_Error_addSourceMessage(threadData, _OMC_LIT82, tmpMeta7, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 10))));
      }
    }
  }
  _return: OMC_LABEL_UNUSED
  return _var;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_verifyBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar, modelica_metatype _variability, modelica_metatype _binding, modelica_metatype _settings)
{
  modelica_integer tmp1;
  modelica_metatype _var = NULL;
  tmp1 = mmc_unbox_integer(_variability);
  _var = omc_NFFlatten_verifyBinding(threadData, __omcQ_24in_5Fvar, tmp1, _binding, _settings);
  /* skip box _var; NFVariable */
  return _var;
}

PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_isTypeAttributeNamed(threadData_t *threadData, modelica_string _name, modelica_metatype _attr)
{
  modelica_boolean _isNamed;
  modelica_string _attr_name = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _isNamed has no default value.
  // _attr_name has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _attr;
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 1));
  _attr_name = tmpMeta2;

  _isNamed = (stringEqual(_name, _attr_name));
  _return: OMC_LABEL_UNUSED
  return _isNamed;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_isTypeAttributeNamed(threadData_t *threadData, modelica_metatype _name, modelica_metatype _attr)
{
  modelica_boolean _isNamed;
  modelica_metatype out_isNamed;
  _isNamed = omc_NFFlatten_isTypeAttributeNamed(threadData, _name, _attr);
  out_isNamed = mmc_mk_icon(_isNamed);
  return out_isNamed;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenTypeAttribute(threadData_t *threadData, modelica_metatype _attr, modelica_metatype _prefix)
{
  modelica_metatype _outAttr = NULL;
  modelica_metatype _binding = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outAttr has no default value.
  // _binding has no default value.
  _binding = omc_NFFlatten_flattenBinding(threadData, omc_NFModifier_Modifier_binding(threadData, _attr), _prefix, 1 /* true */);

  tmpMeta1 = mmc_mk_box2(0, omc_NFModifier_Modifier_name(threadData, _attr), _binding);
  _outAttr = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outAttr;
}

PROTECTED_FUNCTION_STATIC void omc_NFFlatten_checkUnspecifiedEnumType(threadData_t *threadData, modelica_metatype _ty, modelica_metatype _node, modelica_metatype _info)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _ty;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,5,2) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          if (!listEmpty(tmpMeta5)) goto tmp2_end;
          /* Pattern matching succeeded */
          tmpMeta6 = mmc_mk_cons(omc_NFInstNode_InstNode_name(threadData, _node), MMC_REFSTRUCTLIT(mmc_nil));
          omc_Error_addSourceMessage(threadData, _OMC_LIT96, tmpMeta6, _info);
          goto goto_1;
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenSimpleComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_integer _visibility, modelica_metatype _outerBinding, modelica_metatype _typeAttrs, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _settings, modelica_metatype _children, modelica_metatype *out_sections)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _comp_node = NULL;
  modelica_metatype _name = NULL;
  modelica_metatype _binding = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _cmt = NULL;
  modelica_metatype _info = NULL;
  modelica_metatype _comp_attr = NULL;
  modelica_integer _vis;
  modelica_metatype _eq = NULL;
  modelica_metatype _ty_attrs = NULL;
  modelica_integer _var;
  modelica_boolean _unfix;
  modelica_metatype _pre = NULL;
  modelica_metatype _v = NULL;
  modelica_boolean _fillVectorizedBindingFails;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  _sections = __omcQ_24in_5Fsections;
  _comp_node = _node;
  // _name has no default value.
  // _binding has no default value.
  // _ty has no default value.
  // _cmt has no default value.
  // _info has no default value.
  // _comp_attr has no default value.
  // _vis has no default value.
  // _eq has no default value.
  // _ty_attrs has no default value.
  // _var has no default value.
  // _unfix has no default value.
  // _pre has no default value.
  // _v has no default value.
  _fillVectorizedBindingFails = 0 /* false */;
  /* Pattern-matching assignment */
  tmpMeta1 = _comp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,1,8) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 6));
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 7));
  tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 9));
  _ty = tmpMeta2;
  _binding = tmpMeta3;
  _comp_attr = tmpMeta4;
  _cmt = tmpMeta5;
  _info = tmpMeta6;

  omc_NFFlatten_checkUnspecifiedEnumType(threadData, _ty, _node, _info);

  _var = mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_comp_attr), 4))));

  if(isSome(_outerBinding))
  {
    /* Pattern-matching assignment */
    tmpMeta7 = _outerBinding;
    if (optionNone(tmpMeta7)) MMC_THROW_INTERNAL();
    tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 1));
    _binding = tmpMeta8;

    _unfix = (omc_NFBinding_isUnbound(threadData, _binding) && ((modelica_integer)_var == 3));
  }
  else
  {
    _binding = omc_NFFlatten_flattenBinding(threadData, _binding, _prefix, 0 /* false */);

    _unfix = 0 /* false */;
  }

  if((((((!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 2))))) && (!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 7)))))) && omc_NFBinding_isBound(threadData, _binding)) && (!omc_NFFlatten_Prefix_isEmpty(threadData, _prefix))) && omc_NFType_isArray(threadData, omc_NFComponentRef_nodeType(threadData, omc_NFFlatten_Prefix_prefix(threadData, _prefix)))))
  {
    _fillVectorizedBindingFails = omc_NFFlatten_containsPrefix(threadData, omc_NFBinding_getExp(threadData, _binding), _prefix);
  }

  if((((!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 4))))) && mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 2))))) || _fillVectorizedBindingFails))
  {
    if(((((((modelica_integer)_var >= 5) && omc_NFType_isArray(threadData, _ty)) && (!omc_NFType_isExternalObject(threadData, omc_NFType_arrayElementType(threadData, _ty)))) && omc_NFBinding_isBound(threadData, _binding)) || _fillVectorizedBindingFails))
    {
      tmpMeta9 = MMC_REFSTRUCTLIT(mmc_nil);
      _name = omc_NFComponentRef_prefixCref(threadData, _comp_node, _ty, tmpMeta9, omc_NFFlatten_Prefix_prefix(threadData, _prefix));

      tmpMeta10 = mmc_mk_box3(9, &NFExpression_CREF__desc, _ty, _name);
      tmpMeta11 = mmc_mk_box6(4, &NFEquation_ARRAY__EQUALITY__desc, tmpMeta10, omc_NFBinding_getTypedExp(threadData, _binding), _ty, _OMC_LIT17, omc_ElementSource_createElementSource(threadData, _info, mmc_mk_none(), _OMC_LIT18, _OMC_LIT22));
      _eq = tmpMeta11;

      _sections = omc_NFSections_prependEquation(threadData, _eq, _sections, 0 /* false */);

      _binding = _OMC_LIT14;

      if(((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_comp_attr), 5)))) == 2) && omc_NFFlatten_Prefix_isEmpty(threadData, _prefix)))
      {
        tmpMeta12 = MMC_TAGPTR(mmc_alloc_words(11));
        memcpy(MMC_UNTAGPTR(tmpMeta12), MMC_UNTAGPTR(_comp_attr), 11*sizeof(modelica_metatype));
        ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta12))[5] = mmc_mk_integer(1);
        _comp_attr = tmpMeta12;

        tmpMeta13 = mmc_mk_cons(omc_NFComponentRef_toString(threadData, _name), MMC_REFSTRUCTLIT(mmc_nil));
        omc_Error_addSourceMessage(threadData, _OMC_LIT100, tmpMeta13, _info);
      }
    }
  }

  _ty = omc_NFFlatten_flattenType(threadData, _ty, _prefix, _info);

  omc_NFFlatten_verifyDimensions(threadData, omc_NFType_arrayDims(threadData, _ty), _comp_node);

  _pre = omc_NFFlatten_Prefix_push(threadData, _comp_node, _ty, omc_NFType_arrayDims(threadData, _ty), _prefix);

  {
    modelica_metatype __omcQ_24tmpVar33;
    modelica_metatype* tmp15;
    modelica_metatype tmpMeta16;
    modelica_metatype __omcQ_24tmpVar32;
    modelica_integer tmp17;
    modelica_metatype _m_loopVar = 0;
    modelica_metatype _m;
    _m_loopVar = _typeAttrs;
    tmpMeta16 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar33 = tmpMeta16; /* defaultValue */
    tmp15 = &__omcQ_24tmpVar33;
    while(1) {
      tmp17 = 1;
      if (!listEmpty(_m_loopVar)) {
        _m = MMC_CAR(_m_loopVar);
        _m_loopVar = MMC_CDR(_m_loopVar);
        tmp17--;
      }
      if (tmp17 == 0) {
        __omcQ_24tmpVar32 = omc_NFFlatten_flattenTypeAttribute(threadData, _m, _prefix);
        *tmp15 = mmc_mk_cons(__omcQ_24tmpVar32,0);
        tmp15 = &MMC_CDR(*tmp15);
      } else if (tmp17 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp15 = mmc_mk_nil();
    tmpMeta14 = __omcQ_24tmpVar33;
  }
  _ty_attrs = tmpMeta14;

  if(_unfix)
  {
    _ty_attrs = omc_NFBinding_setAttr(threadData, _ty_attrs, _OMC_LIT77, omc_NFBinding_makeFlat(threadData, _OMC_LIT101, 1, 4));
  }

  _name = omc_NFFlatten_Prefix_prefix(threadData, _pre);

  tmpMeta18 = mmc_mk_box11(3, &NFVariable_VARIABLE__desc, _name, _ty, _binding, mmc_mk_integer((modelica_integer)_visibility), _comp_attr, _ty_attrs, _children, _cmt, _info, _OMC_LIT105);
  _v = tmpMeta18;

  if(((((!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 5))))) && ((modelica_integer)_var < 5)) && (!_unfix)) && (!omc_NFType_isComplex(threadData, omc_NFType_arrayElementType(threadData, _ty)))))
  {
    _v = omc_NFFlatten_verifyBinding(threadData, _v, (modelica_integer)_var, _binding, _settings);
  }

  tmpMeta19 = mmc_mk_cons(_v, _vars);
  _vars = tmpMeta19;
  _return: OMC_LABEL_UNUSED
  if (out_sections) { *out_sections = _sections; }
  return _vars;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenSimpleComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _comp, modelica_metatype _visibility, modelica_metatype _outerBinding, modelica_metatype _typeAttrs, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _settings, modelica_metatype _children, modelica_metatype *out_sections)
{
  modelica_integer tmp1;
  modelica_metatype _vars = NULL;
  tmp1 = mmc_unbox_integer(_visibility);
  _vars = omc_NFFlatten_flattenSimpleComponent(threadData, _node, _comp, tmp1, _outerBinding, _typeAttrs, _prefix, __omcQ_24in_5Fvars, __omcQ_24in_5Fsections, _settings, _children, out_sections);
  /* skip box _vars; list<NFVariable> */
  /* skip box _sections; NFSections */
  return _vars;
}

PROTECTED_FUNCTION_STATIC modelica_integer omc_NFFlatten_getComponentType(threadData_t *threadData, modelica_metatype _ty, modelica_metatype _settings)
{
  modelica_integer _compTy;
  modelica_integer tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _compTy has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _ty;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 5; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,11,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,5,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = 1;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,11,2) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,4,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 6))))) goto tmp3_end;
          tmp1 = 3;
          goto tmp3_done;
        }
        case 2: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,11,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = 2;
          goto tmp3_done;
        }
        case 3: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _ty = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 2)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmp1 = 1;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _compTy = tmp1;
  _return: OMC_LABEL_UNUSED
  return _compTy;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_getComponentType(threadData_t *threadData, modelica_metatype _ty, modelica_metatype _settings)
{
  modelica_integer _compTy;
  modelica_metatype out_compTy;
  _compTy = omc_NFFlatten_getComponentType(threadData, _ty, _settings);
  out_compTy = mmc_mk_icon(_compTy);
  return out_compTy;
}

PROTECTED_FUNCTION_STATIC void omc_NFFlatten_deleteComponent(threadData_t *threadData, modelica_metatype _node, modelica_metatype _prefix, modelica_metatype _deletedVars)
{
  modelica_metatype _cref = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _cref has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _cref = omc_NFComponentRef_prefixCref(threadData, _node, _OMC_LIT63, tmpMeta1, omc_NFFlatten_Prefix_prefix(threadData, _prefix));

  omc_UnorderedSet_add(threadData, _cref, _deletedVars);
  _return: OMC_LABEL_UNUSED
  return;
}

PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_isDeletedComponent(threadData_t *threadData, modelica_metatype _condition, modelica_metatype _prefix)
{
  modelica_boolean _isDeleted;
  modelica_metatype _exp = NULL;
  modelica_metatype _cond = NULL;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _isDeleted has no default value.
  // _exp has no default value.
  // _cond has no default value.
  if(omc_NFBinding_isBound(threadData, _condition))
  {
    _cond = omc_NFFlatten_flattenBinding(threadData, _condition, _prefix, 0 /* false */);

    _exp = omc_NFBinding_getTypedExp(threadData, _cond);

    _exp = omc_NFCeval_evalExp(threadData, _exp, omc_NFCeval_EvalTarget_new(threadData, omc_NFBinding_getInfo(threadData, _cond), ((modelica_integer) 1048576), mmc_mk_none()));

    _exp = omc_NFExpression_expandSplitIndices(threadData, _exp);

    if(omc_NFExpression_arrayAllEqual(threadData, _exp))
    {
      _exp = omc_NFExpression_arrayFirstScalar(threadData, _exp);
    }

    { /* match expression */
      modelica_metatype tmp4_1;
      tmp4_1 = _exp;
      {
        volatile mmc_switch_type tmp4;
        int tmp5;
        tmp4 = 0;
        for (; tmp4 < 2; tmp4++) {
          switch (MMC_SWITCH_CAST(tmp4)) {
          case 0: {
            if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,3,1) == 0) goto tmp3_end;
            
            /* Pattern matching succeeded */
            tmp1 = (!mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2)))));
            goto tmp3_done;
          }
          case 1: {
            modelica_metatype tmpMeta6;
            
            /* Pattern matching succeeded */
            tmpMeta6 = mmc_mk_cons(omc_NFExpression_toString(threadData, _exp), MMC_REFSTRUCTLIT(mmc_nil));
            omc_Error_addSourceMessage(threadData, _OMC_LIT108, tmpMeta6, omc_NFBinding_getInfo(threadData, _cond));
            goto goto_2;
            goto tmp3_done;
          }
          }
          goto tmp3_end;
          tmp3_end: ;
        }
        goto goto_2;
        goto_2:;
        MMC_THROW_INTERNAL();
        goto tmp3_done;
        tmp3_done:;
      }
    }
    _isDeleted = tmp1;
  }
  else
  {
    _isDeleted = 0 /* false */;
  }
  _return: OMC_LABEL_UNUSED
  return _isDeleted;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_isDeletedComponent(threadData_t *threadData, modelica_metatype _condition, modelica_metatype _prefix)
{
  modelica_boolean _isDeleted;
  modelica_metatype out_isDeleted;
  _isDeleted = omc_NFFlatten_isDeletedComponent(threadData, _condition, _prefix);
  out_isDeleted = mmc_mk_icon(_isDeleted);
  return out_isDeleted;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenComponent(threadData_t *threadData, modelica_metatype _component, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _outerBinding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _comp_node = NULL;
  modelica_metatype _c = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _condition = NULL;
  modelica_metatype _cls = NULL;
  modelica_integer _vis;
  modelica_metatype _children = NULL;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  _sections = __omcQ_24in_5Fsections;
  // _comp_node has no default value.
  // _c has no default value.
  // _ty has no default value.
  // _condition has no default value.
  // _cls has no default value.
  // _vis has no default value.
  // _children has no default value.
  if(omc_NFInstNode_InstNode_isOnlyOuter(threadData, _component))
  {
    goto _return;
  }

  _comp_node = omc_NFInstNode_InstNode_resolveOuter(threadData, _component);

  _c = omc_NFInstNode_InstNode_component(threadData, _comp_node);

  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _c;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 3; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,8) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 5));
          
          _ty = tmpMeta5;
          _condition = tmpMeta6;
          /* Pattern matching succeeded */
          if(omc_NFFlatten_isDeletedComponent(threadData, _condition, _prefix))
          {
            omc_NFFlatten_deleteComponent(threadData, _component, _prefix, _deletedVars);

            goto _return;
          }

          _cls = omc_NFInstNode_InstNode_getClass(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_c), 2))));

          _vis = (omc_NFInstNode_InstNode_isProtected(threadData, _component)?2:(modelica_integer)_visibility);

          
          
          { /* match expression */
            modelica_integer tmp10_1;
            tmp10_1 = omc_NFFlatten_getComponentType(threadData, _ty, _settings);
            {
              volatile mmc_switch_type tmp10;
              int tmp11;
              tmp10 = 0;
              for (; tmp10 < 4; tmp10++) {
                switch (MMC_SWITCH_CAST(tmp10)) {
                case 0: {
                  if (2 != tmp10_1) goto tmp9_end;
                  /* Pattern matching succeeded */
                  tmpMeta[0+0] = omc_NFFlatten_flattenComplexComponent(threadData, _comp_node, _c, _cls, _ty, (modelica_integer)_vis, _outerBinding, _prefix, _vars, _sections, _deletedVars, _settings, &tmpMeta[0+1]);
                  goto tmp9_done;
                }
                case 1: {
                  modelica_metatype tmpMeta12;
                  if (1 != tmp10_1) goto tmp9_end;
                  /* Pattern matching succeeded */
                  tmpMeta12 = MMC_REFSTRUCTLIT(mmc_nil);
                  tmpMeta[0+0] = omc_NFFlatten_flattenSimpleComponent(threadData, _comp_node, _c, (modelica_integer)_vis, _outerBinding, omc_NFClass_getTypeAttributes(threadData, _cls), _prefix, _vars, _sections, _settings, tmpMeta12, &tmpMeta[0+1]);
                  goto tmp9_done;
                }
                case 2: {
                  modelica_metatype tmpMeta13;
                  if (3 != tmp10_1) goto tmp9_end;
                  /* Pattern matching succeeded */
                  tmpMeta13 = MMC_REFSTRUCTLIT(mmc_nil);
                  _children = omc_NFFlatten_flattenComplexComponent(threadData, _comp_node, _c, _cls, _ty, (modelica_integer)_vis, _outerBinding, _prefix, tmpMeta13, _sections, _deletedVars, _settings ,&_sections);
                  tmpMeta[0+0] = omc_NFFlatten_flattenSimpleComponent(threadData, _comp_node, _c, (modelica_integer)_vis, _outerBinding, omc_NFClass_getTypeAttributes(threadData, _cls), _prefix, _vars, _sections, _settings, listReverse(_children), &tmpMeta[0+1]);
                  goto tmp9_done;
                }
                case 3: {
                  
                  /* Pattern matching succeeded */
                  omc_Error_assertion(threadData, 0 /* false */, _OMC_LIT109, _OMC_LIT110);
                  goto goto_8;
                  goto tmp9_done;
                }
                }
                goto tmp9_end;
                tmp9_end: ;
              }
              goto goto_8;
              goto_8:;
              goto goto_1;
              goto tmp9_done;
              tmp9_done:;
            }
          }
          _vars = tmpMeta[0+0];
          _sections = tmpMeta[0+1];
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!omc_NFComponent_isDeleted(threadData, _c)) goto tmp2_end;
          omc_NFFlatten_deleteComponent(threadData, _component, _prefix, _deletedVars);
          goto tmp2_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          omc_Error_assertion(threadData, 0 /* false */, _OMC_LIT109, _OMC_LIT111);
          goto goto_1;
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  if (out_sections) { *out_sections = _sections; }
  return _vars;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenComponent(threadData_t *threadData, modelica_metatype _component, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _outerBinding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_integer tmp1;
  modelica_metatype _vars = NULL;
  tmp1 = mmc_unbox_integer(_visibility);
  _vars = omc_NFFlatten_flattenComponent(threadData, _component, _prefix, tmp1, _outerBinding, __omcQ_24in_5Fvars, __omcQ_24in_5Fsections, _deletedVars, _settings, out_sections);
  /* skip box _vars; list<NFVariable> */
  /* skip box _sections; NFSections */
  return _vars;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_flattenClass(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _prefix, modelica_integer _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_metatype _vars = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _comps = NULL;
  modelica_metatype _bindings = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _b = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _vars = __omcQ_24in_5Fvars;
  _sections = __omcQ_24in_5Fsections;
  // _comps has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _bindings = tmpMeta1;
  // _b has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _cls;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 5; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,5,5) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 6));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,12,0) == 0) goto tmp3_end;
          /* Pattern matching succeeded */
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_integer tmp13;
          modelica_integer tmp14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          modelica_metatype tmpMeta18;
          modelica_metatype tmpMeta19;
          modelica_integer tmp20;
          modelica_integer tmp21;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,5,5) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,3,5) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 4));
          
          _comps = tmpMeta8;
          /* Pattern matching succeeded */
          if(isSome(_binding))
          {
            /* Pattern-matching assignment */
            tmpMeta9 = _binding;
            if (optionNone(tmpMeta9)) goto goto_2;
            tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta9), 1));
            _b = tmpMeta10;

            if(omc_NFBinding_isBound(threadData, _b))
            {
              _b = omc_NFFlatten_flattenBinding(threadData, _b, omc_NFFlatten_Prefix_pop(threadData, _prefix), 0 /* false */);

              _bindings = omc_NFFlatten_getRecordBindings(threadData, _b, _comps, _prefix);
            }
          }

          if(listEmpty(_bindings))
          {
            {
              modelica_metatype _c;
              for (tmpMeta11 = _comps, tmp14 = arrayLength(tmpMeta11), tmp13 = 1; tmp13 <= tmp14; tmp13++)
              {
                _c = arrayGet(tmpMeta11,tmp13);
                _vars = omc_NFFlatten_flattenComponent(threadData, _c, _prefix, (modelica_integer)_visibility, _binding, _vars, _sections, _deletedVars, _settings ,&_sections);
              }
            }
          }
          else
          {
            {
              modelica_metatype _c;
              for (tmpMeta15 = _comps, tmp21 = arrayLength(tmpMeta15), tmp20 = 1; tmp20 <= tmp21; tmp20++)
              {
                _c = arrayGet(tmpMeta15,tmp20);
                /* Pattern-matching assignment */
                tmpMeta16 = _bindings;
                if (listEmpty(tmpMeta16)) goto goto_2;
                tmpMeta17 = MMC_CAR(tmpMeta16);
                tmpMeta18 = MMC_CDR(tmpMeta16);
                _b = tmpMeta17;
                _bindings = tmpMeta18;

                _vars = omc_NFFlatten_flattenComponent(threadData, _c, _prefix, (modelica_integer)_visibility, mmc_mk_some(_b), _vars, _sections, _deletedVars, _settings ,&_sections);
              }
            }
          }

          _sections = omc_NFFlatten_flattenSections(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cls), 4))), omc_NFFlatten_Prefix_toNonIndexedPrefix(threadData, _prefix), _sections, _settings);
          goto tmp3_done;
        }
        case 2: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          _vars = omc_NFFlatten_flattenClass(threadData, omc_NFInstNode_InstNode_getClass(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cls), 3)))), _prefix, (modelica_integer)_visibility, _binding, _vars, _sections, _deletedVars, _settings ,&_sections);
          goto tmp3_done;
        }
        case 3: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta22;
          modelica_metatype tmpMeta23;
          
          /* Pattern matching succeeded */
          tmpMeta22 = stringAppend(_OMC_LIT112,omc_NFFlatten_Prefix_toString(threadData, _prefix));
          tmpMeta23 = stringAppend(tmpMeta22,_OMC_LIT8);
          omc_Error_assertion(threadData, 0 /* false */, tmpMeta23, _OMC_LIT113);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  if (out_sections) { *out_sections = _sections; }
  return _vars;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_flattenClass(threadData_t *threadData, modelica_metatype _cls, modelica_metatype _prefix, modelica_metatype _visibility, modelica_metatype _binding, modelica_metatype __omcQ_24in_5Fvars, modelica_metatype __omcQ_24in_5Fsections, modelica_metatype _deletedVars, modelica_metatype _settings, modelica_metatype *out_sections)
{
  modelica_integer tmp1;
  modelica_metatype _vars = NULL;
  tmp1 = mmc_unbox_integer(_visibility);
  _vars = omc_NFFlatten_flattenClass(threadData, _cls, _prefix, tmp1, _binding, __omcQ_24in_5Fvars, __omcQ_24in_5Fsections, _deletedVars, _settings, out_sections);
  /* skip box _vars; list<NFVariable> */
  /* skip box _sections; NFSections */
  return _vars;
}

DLLDirection
modelica_metatype omc_NFFlatten_fillVectorizedVariableBinding(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fvar)
{
  modelica_metatype _var = NULL;
  modelica_metatype _ty_attrs = NULL;
  modelica_metatype tmpMeta1;
  modelica_string _attr_name = NULL;
  modelica_metatype _attr_binding = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _var = __omcQ_24in_5Fvar;
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _ty_attrs = tmpMeta1;
  // _attr_name has no default value.
  // _attr_binding has no default value.
  tmpMeta2 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta2), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta2))[4] = omc_NFFlatten_fillVectorizedBinding(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 4))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))));
  _var = tmpMeta2;

  {
    modelica_metatype _ty_attr;
    for (tmpMeta3 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 7))); !listEmpty(tmpMeta3); tmpMeta3=MMC_CDR(tmpMeta3))
    {
      _ty_attr = MMC_CAR(tmpMeta3);
      /* Pattern-matching assignment */
      tmpMeta4 = _ty_attr;
      tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 1));
      tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 2));
      _attr_name = tmpMeta5;
      _attr_binding = tmpMeta6;

      _attr_binding = omc_NFFlatten_fillVectorizedBinding(threadData, _attr_binding, omc_NFType_copyDims(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_var), 3))), omc_NFBinding_getType(threadData, _attr_binding)));

      tmpMeta8 = mmc_mk_box2(0, _attr_name, _attr_binding);
      tmpMeta7 = mmc_mk_cons(tmpMeta8, _ty_attrs);
      _ty_attrs = tmpMeta7;
    }
  }

  tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(12));
  memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_var), 12*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[7] = listReverseInPlace(_ty_attrs);
  _var = tmpMeta10;
  _return: OMC_LABEL_UNUSED
  return _var;
}

DLLDirection
modelica_metatype omc_NFFlatten_collectFunctions(threadData_t *threadData, modelica_metatype _flatModel)
{
  modelica_metatype _funcs = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _funcs has no default value.
  _funcs = omc_NFFlatten_FunctionTreeImpl_new(threadData);

  _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3))), boxvar_NFFlatten_collectComponentFuncs, _funcs);

  _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 4))), boxvar_NFFlatten_collectEquationFuncs, _funcs);

  _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 5))), boxvar_NFFlatten_collectEquationFuncs, _funcs);

  _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 6))), boxvar_NFFlatten_collectAlgorithmFuncs, _funcs);

  _funcs = omc_List_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 7))), boxvar_NFFlatten_collectAlgorithmFuncs, _funcs);

  omc_ExecStat_execStat(threadData, _OMC_LIT114);
  _return: OMC_LABEL_UNUSED
  return _funcs;
}

static modelica_metatype closure18_NFFlatten_isDeletedConnector(threadData_t *thData, modelica_metatype closure, modelica_metatype cref)
{
  modelica_metatype deletedVars = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFFlatten_isDeletedConnector(thData, cref, deletedVars);
}
DLLDirection
modelica_metatype omc_NFFlatten_flattenConnection(threadData_t *threadData, modelica_metatype _classInst, modelica_metatype _classPath)
{
  modelica_metatype _conns = NULL;
  modelica_metatype _flatModel = NULL;
  modelica_metatype _deleted_vars = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _conns has no default value.
  // _flatModel has no default value.
  // _deleted_vars has no default value.
  _flatModel = omc_NFFlatten_flatten(threadData, _classInst, _classPath, 0 /* false */);

  _deleted_vars = omc_UnorderedSet_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 13));

  tmpMeta1 = mmc_mk_box1(0, _deleted_vars);
  _flatModel = omc_NFConnections_collectConnections(threadData, _flatModel, (modelica_fnptr) mmc_mk_box2(0,closure18_NFFlatten_isDeletedConnector,tmpMeta1) ,&_conns);

  omc_NFExpandableConnectors_elaborate(threadData, _flatModel, _conns ,&_conns);

  _conns = omc_NFConnections_collectFlows(threadData, _flatModel, _conns);
  _return: OMC_LABEL_UNUSED
  return _conns;
}

DLLDirection
modelica_metatype omc_NFFlatten_flatten(threadData_t *threadData, modelica_metatype _classInst, modelica_metatype _classPath, modelica_boolean _getConnectionResolved)
{
  modelica_metatype _flatModel = NULL;
  modelica_metatype _sections = NULL;
  modelica_metatype _vars = NULL;
  modelica_metatype _eql = NULL;
  modelica_metatype _ieql = NULL;
  modelica_metatype _alg = NULL;
  modelica_metatype _ialg = NULL;
  modelica_metatype _src = NULL;
  modelica_metatype _cmt = NULL;
  modelica_metatype _settings = NULL;
  modelica_metatype _deleted_vars = NULL;
  modelica_metatype _prefix = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_metatype tmpMeta24;
  modelica_metatype tmpMeta25;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _flatModel has no default value.
  // _sections has no default value.
  // _vars has no default value.
  // _eql has no default value.
  // _ieql has no default value.
  // _alg has no default value.
  // _ialg has no default value.
  // _src has no default value.
  // _cmt has no default value.
  // _settings has no default value.
  // _deleted_vars has no default value.
  // _prefix has no default value.
  tmpMeta1 = mmc_mk_box9(3, &NFFlatten_FlattenSettings_SETTINGS__desc, mmc_mk_boolean(omc_Flags_isSet(threadData, _OMC_LIT118)), mmc_mk_boolean(omc_Flags_isSet(threadData, _OMC_LIT122)), mmc_mk_boolean(omc_Flags_isSet(threadData, _OMC_LIT126)), mmc_mk_boolean((omc_Flags_isSet(threadData, _OMC_LIT126) || omc_Flags_getConfigBool(threadData, _OMC_LIT131))), mmc_mk_boolean(omc_Flags_getConfigBool(threadData, _OMC_LIT60)), mmc_mk_boolean(omc_Flags_isSet(threadData, _OMC_LIT135)), mmc_mk_boolean(omc_Flags_isConfigFlagSet(threadData, _OMC_LIT187, _OMC_LIT170)), mmc_mk_boolean((!stringEqual(omc_Flags_getConfigString(threadData, _OMC_LIT204), _OMC_LIT189))));
  _settings = tmpMeta1;

  _prefix = omc_NFFlatten_Prefix_new(threadData, _classInst, mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 7)))));

  _sections = _OMC_LIT205;

  _src = omc_ElementSource_createElementSource(threadData, omc_NFInstNode_InstNode_info(threadData, _classInst), mmc_mk_none(), _OMC_LIT18, _OMC_LIT22);

  _src = omc_ElementSource_addCommentToSource(threadData, _src, omc_SCodeUtil_getElementComment(threadData, omc_NFInstNode_InstNode_definition(threadData, _classInst)));

  _deleted_vars = omc_UnorderedSet_new(threadData, boxvar_NFComponentRef_hash, boxvar_NFComponentRef_isEqual, ((modelica_integer) 13));

  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _vars = omc_NFFlatten_flattenClass(threadData, omc_NFInstNode_InstNode_getClass(threadData, _classInst), _prefix, 1, mmc_mk_none(), tmpMeta2, _sections, _deleted_vars, _settings ,&_sections);

  _vars = listReverseInPlace(_vars);

  { /* match expression */
    modelica_metatype tmp6_1;
    tmp6_1 = _sections;
    {
      volatile mmc_switch_type tmp6;
      int tmp7;
      tmp6 = 0;
      for (; tmp6 < 2; tmp6++) {
        switch (MMC_SWITCH_CAST(tmp6)) {
        case 0: {
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp6_1,0,4) == 0) goto tmp5_end;
          
          /* Pattern matching succeeded */
          _eql = listReverseInPlace((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 2))));

          _ieql = listReverseInPlace((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 3))));

          _alg = listReverseInPlace((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 4))));

          _ialg = listReverseInPlace((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sections), 5))));
          tmpMeta8 = mmc_mk_box8(3, &NFFlatModel_FLAT__MODEL__desc, _classPath, _vars, _eql, _ieql, _alg, _ialg, _src);
          tmpMeta3 = tmpMeta8;
          goto tmp5_done;
        }
        case 1: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          
          /* Pattern matching succeeded */
          tmpMeta9 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta11 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta12 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta13 = mmc_mk_box8(3, &NFFlatModel_FLAT__MODEL__desc, _classPath, _vars, tmpMeta9, tmpMeta10, tmpMeta11, tmpMeta12, _src);
          tmpMeta3 = tmpMeta13;
          goto tmp5_done;
        }
        }
        goto tmp5_end;
        tmp5_end: ;
      }
      goto goto_4;
      goto_4:;
      MMC_THROW_INTERNAL();
      goto tmp5_done;
      tmp5_done:;
    }
  }
  _flatModel = tmpMeta3;

  {
    modelica_metatype __omcQ_24tmpVar35;
    modelica_metatype* tmp16;
    modelica_metatype tmpMeta17;
    modelica_metatype __omcQ_24tmpVar34;
    modelica_integer tmp18;
    modelica_metatype _al_loopVar = 0;
    modelica_metatype _al;
    _al_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 6)));
    tmpMeta17 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar35 = tmpMeta17; /* defaultValue */
    tmp16 = &__omcQ_24tmpVar35;
    while(1) {
      tmp18 = 1;
      if (!listEmpty(_al_loopVar)) {
        _al = MMC_CAR(_al_loopVar);
        _al_loopVar = MMC_CDR(_al_loopVar);
        tmp18--;
      }
      if (tmp18 == 0) {
        __omcQ_24tmpVar34 = omc_NFAlgorithm_setInputsOutputs(threadData, _al);
        *tmp16 = mmc_mk_cons(__omcQ_24tmpVar34,0);
        tmp16 = &MMC_CDR(*tmp16);
      } else if (tmp18 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp16 = mmc_mk_nil();
    tmpMeta15 = __omcQ_24tmpVar35;
  }
  tmpMeta14 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta14), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta14))[6] = tmpMeta15;
  _flatModel = tmpMeta14;

  {
    modelica_metatype __omcQ_24tmpVar37;
    modelica_metatype* tmp21;
    modelica_metatype tmpMeta22;
    modelica_metatype __omcQ_24tmpVar36;
    modelica_integer tmp23;
    modelica_metatype _al_loopVar = 0;
    modelica_metatype _al;
    _al_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 7)));
    tmpMeta22 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar37 = tmpMeta22; /* defaultValue */
    tmp21 = &__omcQ_24tmpVar37;
    while(1) {
      tmp23 = 1;
      if (!listEmpty(_al_loopVar)) {
        _al = MMC_CAR(_al_loopVar);
        _al_loopVar = MMC_CDR(_al_loopVar);
        tmp23--;
      }
      if (tmp23 == 0) {
        __omcQ_24tmpVar36 = omc_NFAlgorithm_setInputsOutputs(threadData, _al);
        *tmp21 = mmc_mk_cons(__omcQ_24tmpVar36,0);
        tmp21 = &MMC_CDR(*tmp21);
      } else if (tmp23 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp21 = mmc_mk_nil();
    tmpMeta20 = __omcQ_24tmpVar37;
  }
  tmpMeta19 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta19), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta19))[7] = tmpMeta20;
  _flatModel = tmpMeta19;

  omc_ExecStat_execStat(threadData, _OMC_LIT206);

  omc_NFInstUtil_dumpFlatModelDebug(threadData, _OMC_LIT207, _flatModel, omc_NFFlatten_FunctionTreeImpl_new(threadData));

  if(_getConnectionResolved)
  {
    if(mmc_unbox_boolean((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_settings), 3)))))
    {
      _flatModel = omc_NFFlatten_resolveArrayConnections(threadData, _flatModel);
    }
    else
    {
      _flatModel = omc_NFFlatten_resolveConnections(threadData, _flatModel, _deleted_vars, _settings);
    }

    omc_NFInstUtil_dumpFlatModelDebug(threadData, _OMC_LIT208, _flatModel, omc_NFFlatten_FunctionTreeImpl_new(threadData));
  }

  {
    modelica_metatype __omcQ_24tmpVar39;
    modelica_metatype* tmp26;
    modelica_metatype tmpMeta27;
    modelica_metatype __omcQ_24tmpVar38;
    modelica_integer tmp28;
    modelica_metatype _var_loopVar = 0;
    modelica_metatype _var;
    _var_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_flatModel), 3)));
    tmpMeta27 = MMC_REFSTRUCTLIT(mmc_nil);
    __omcQ_24tmpVar39 = tmpMeta27; /* defaultValue */
    tmp26 = &__omcQ_24tmpVar39;
    while(1) {
      tmp28 = 1;
      if (!listEmpty(_var_loopVar)) {
        _var = MMC_CAR(_var_loopVar);
        _var_loopVar = MMC_CDR(_var_loopVar);
        tmp28--;
      }
      if (tmp28 == 0) {
        __omcQ_24tmpVar38 = omc_NFFlatten_updateVariability(threadData, _var);
        *tmp26 = mmc_mk_cons(__omcQ_24tmpVar38,0);
        tmp26 = &MMC_CDR(*tmp26);
      } else if (tmp28 == 1) {
        break;
      } else {
        MMC_THROW_INTERNAL();
      }
    }
    *tmp26 = mmc_mk_nil();
    tmpMeta25 = __omcQ_24tmpVar39;
  }
  tmpMeta24 = MMC_TAGPTR(mmc_alloc_words(9));
  memcpy(MMC_UNTAGPTR(tmpMeta24), MMC_UNTAGPTR(_flatModel), 9*sizeof(modelica_metatype));
  ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta24))[3] = tmpMeta25;
  _flatModel = tmpMeta24;
  _return: OMC_LABEL_UNUSED
  return _flatModel;
}
modelica_metatype boxptr_NFFlatten_flatten(threadData_t *threadData, modelica_metatype _classInst, modelica_metatype _classPath, modelica_metatype _getConnectionResolved)
{
  modelica_integer tmp1;
  modelica_metatype _flatModel = NULL;
  tmp1 = mmc_unbox_integer(_getConnectionResolved);
  _flatModel = omc_NFFlatten_flatten(threadData, _classInst, _classPath, tmp1);
  /* skip box _flatModel; NFFlatModel */
  return _flatModel;
}

DLLDirection
modelica_string omc_NFFlatten_Prefix_instanceName(threadData_t *threadData, modelica_metatype _pre)
{
  modelica_string _str = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _str has no default value.
  _str = omc_NFInstNode_InstNode_name(threadData, omc_NFFlatten_Prefix_rootNode(threadData, _pre));

  if((!omc_NFComponentRef_isEmpty(threadData, omc_NFFlatten_Prefix_indexedPrefix(threadData, _pre))))
  {
    tmpMeta1 = stringAppend(_str,_OMC_LIT6);
    tmpMeta2 = stringAppend(tmpMeta1,omc_NFFlatten_Prefix_toString(threadData, _pre));
    _str = tmpMeta2;
  }
  _return: OMC_LABEL_UNUSED
  return _str;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_rootNode(threadData_t *threadData, modelica_metatype _pre)
{
  modelica_metatype _node = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _node has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _pre;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_pre), 2)));
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_pre), 2)));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _node = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _node;
}

DLLDirection
modelica_string omc_NFFlatten_Prefix_toString(threadData_t *threadData, modelica_metatype _pre)
{
  modelica_string _str = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _str = omc_NFComponentRef_toString(threadData, omc_NFFlatten_Prefix_prefix(threadData, _pre));
  _return: OMC_LABEL_UNUSED
  return _str;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_subscript(threadData_t *threadData, modelica_metatype _subs, modelica_metatype __omcQ_24in_5Fprefix)
{
  modelica_metatype _prefix = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _prefix = __omcQ_24in_5Fprefix;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _prefix;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_prefix), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[3] = omc_NFComponentRef_setSubscripts(threadData, _subs, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          _prefix = tmpMeta5;
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,3) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_prefix), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[3] = omc_NFComponentRef_setSubscripts(threadData, _subs, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          _prefix = tmpMeta6;
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _prefix;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_apply(threadData_t *threadData, modelica_metatype _prefix, modelica_metatype __omcQ_24in_5Fcref)
{
  modelica_metatype _cref = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _cref = __omcQ_24in_5Fcref;
  _cref = omc_NFComponentRef_transferSubscripts(threadData, omc_NFFlatten_Prefix_indexedPrefix(threadData, _prefix), _cref);
  _return: OMC_LABEL_UNUSED
  return _cref;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_toNonIndexedPrefix(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fprefix)
{
  modelica_metatype _prefix = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _prefix = __omcQ_24in_5Fprefix;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _prefix;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = _prefix;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = mmc_mk_box3(3, &NFFlatten_Prefix_PREFIX__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          tmpMeta1 = tmpMeta6;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _prefix = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _prefix;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_indexedPrefix(threadData_t *threadData, modelica_metatype _prefix)
{
  modelica_metatype _cref = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _cref has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _prefix;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3)));
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 4)));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _cref = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _cref;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_prefix(threadData_t *threadData, modelica_metatype _prefix)
{
  modelica_metatype _cref = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _cref has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _prefix;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3)));
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3)));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _cref = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _cref;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_pop(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fprefix)
{
  modelica_metatype _prefix = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _prefix = __omcQ_24in_5Fprefix;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _prefix;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_prefix), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[3] = omc_NFComponentRef_rest(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          _prefix = tmpMeta5;
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,3) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_prefix), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[3] = omc_NFComponentRef_rest(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          _prefix = tmpMeta6;

          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_prefix), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[4] = omc_NFComponentRef_rest(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 4))));
          _prefix = tmpMeta7;
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _prefix;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_push(threadData_t *threadData, modelica_metatype _node, modelica_metatype _ty, modelica_metatype _dims, modelica_metatype __omcQ_24in_5Fprefix)
{
  modelica_metatype _prefix = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _prefix = __omcQ_24in_5Fprefix;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _prefix;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,2) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta5 = MMC_TAGPTR(mmc_alloc_words(4));
          memcpy(MMC_UNTAGPTR(tmpMeta5), MMC_UNTAGPTR(_prefix), 4*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta5))[3] = omc_NFComponentRef_prefixCref(threadData, _node, _ty, tmpMeta6, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          _prefix = tmpMeta5;
          goto tmp2_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,3) == 0) goto tmp2_end;
          
          /* Pattern matching succeeded */
          tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_prefix), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[3] = omc_NFComponentRef_prefixCref(threadData, _node, _ty, tmpMeta8, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          _prefix = tmpMeta7;

          tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_prefix), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[4] = omc_NFComponentRef_prefixCref(threadData, _node, _ty, tmpMeta10, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 4))));
          _prefix = tmpMeta9;

          tmpMeta11 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta11), MMC_UNTAGPTR(_prefix), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta11))[4] = omc_NFComponentRef_setSubscripts(threadData, omc_NFFlatten_makeBindingIterators(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 4))), _dims), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 4))));
          _prefix = tmpMeta11;
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _prefix;
}

DLLDirection
modelica_boolean omc_NFFlatten_Prefix_isIndexed(threadData_t *threadData, modelica_metatype _prefix)
{
  modelica_boolean _indexed;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _indexed has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _prefix;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = 1 /* true */;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _indexed = tmp1;
  _return: OMC_LABEL_UNUSED
  return _indexed;
}
modelica_metatype boxptr_NFFlatten_Prefix_isIndexed(threadData_t *threadData, modelica_metatype _prefix)
{
  modelica_boolean _indexed;
  modelica_metatype out_indexed;
  _indexed = omc_NFFlatten_Prefix_isIndexed(threadData, _prefix);
  out_indexed = mmc_mk_icon(_indexed);
  return out_indexed;
}

DLLDirection
modelica_boolean omc_NFFlatten_Prefix_isEmpty(threadData_t *threadData, modelica_metatype _prefix)
{
  modelica_boolean _empty;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _empty has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _prefix;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = omc_NFComponentRef_isEmpty(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 3))));
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp1 = omc_NFComponentRef_isEmpty(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_prefix), 4))));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _empty = tmp1;
  _return: OMC_LABEL_UNUSED
  return _empty;
}
modelica_metatype boxptr_NFFlatten_Prefix_isEmpty(threadData_t *threadData, modelica_metatype _prefix)
{
  modelica_boolean _empty;
  modelica_metatype out_empty;
  _empty = omc_NFFlatten_Prefix_isEmpty(threadData, _prefix);
  out_empty = mmc_mk_icon(_empty);
  return out_empty;
}

DLLDirection
modelica_metatype omc_NFFlatten_Prefix_new(threadData_t *threadData, modelica_metatype _root, modelica_boolean _indexed)
{
  modelica_metatype _prefix = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_boolean tmp3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _prefix has no default value.
  tmp3 = (modelica_boolean)_indexed;
  if(tmp3)
  {
    tmpMeta1 = mmc_mk_box4(4, &NFFlatten_Prefix_INDEXED__PREFIX__desc, _root, _OMC_LIT15, _OMC_LIT15);
    tmpMeta4 = tmpMeta1;
  }
  else
  {
    tmpMeta2 = mmc_mk_box3(3, &NFFlatten_Prefix_PREFIX__desc, _root, _OMC_LIT15);
    tmpMeta4 = tmpMeta2;
  }
  _prefix = tmpMeta4;
  _return: OMC_LABEL_UNUSED
  return _prefix;
}
modelica_metatype boxptr_NFFlatten_Prefix_new(threadData_t *threadData, modelica_metatype _root, modelica_metatype _indexed)
{
  modelica_integer tmp1;
  modelica_metatype _prefix = NULL;
  tmp1 = mmc_unbox_integer(_indexed);
  _prefix = omc_NFFlatten_Prefix_new(threadData, _root, tmp1);
  /* skip box _prefix; NFFlatten.Prefix */
  return _prefix;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_add(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype _inKey, modelica_metatype _inValue, modelica_fnptr _conflictFunc)
{
  modelica_metatype _tree = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _tree = _inTree;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _tree;
    {
      modelica_metatype _key = NULL;
      modelica_metatype _value = NULL;
      modelica_integer _key_comp;
      modelica_metatype _outTree = NULL;
      int tmp4;
      // _key has no default value.
      // _value has no default value.
      // _key_comp has no default value.
      // _outTree has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 5: {
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_box3(4, &NFFlatten_FunctionTreeImpl_Tree_LEAF__desc, _inKey, _inValue);
          tmpMeta1 = tmpMeta5;
          goto tmp3_done;
        }
        case 3: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          
          _key = tmpMeta6;
          /* Pattern matching succeeded */
          _key_comp = omc_NFFlatten_FunctionTreeImpl_keyCompare(threadData, _inKey, _key);

          if((_key_comp == ((modelica_integer) -1)))
          {
            tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(7));
            memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_tree), 7*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[5] = omc_NFFlatten_FunctionTreeImpl_add(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 5))), _inKey, _inValue, ((modelica_fnptr) _conflictFunc));
            _tree = tmpMeta7;
          }
          else
          {
            if((_key_comp == ((modelica_integer) 1)))
            {
              tmpMeta8 = MMC_TAGPTR(mmc_alloc_words(7));
              memcpy(MMC_UNTAGPTR(tmpMeta8), MMC_UNTAGPTR(_tree), 7*sizeof(modelica_metatype));
              ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta8))[6] = omc_NFFlatten_FunctionTreeImpl_add(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6))), _inKey, _inValue, ((modelica_fnptr) _conflictFunc));
              _tree = tmpMeta8;
            }
            else
            {
              _value = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 2))), _inValue, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _key) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 1)))) (threadData, _inValue, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _key);

              if((!referenceEq((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _value)))
              {
                tmpMeta9 = MMC_TAGPTR(mmc_alloc_words(7));
                memcpy(MMC_UNTAGPTR(tmpMeta9), MMC_UNTAGPTR(_tree), 7*sizeof(modelica_metatype));
                ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta9))[3] = _value;
                _tree = tmpMeta9;
              }
            }
          }
          tmpMeta1 = ((_key_comp == ((modelica_integer) 0))?_tree:omc_NFFlatten_FunctionTreeImpl_balance(threadData, _tree));
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          
          _key = tmpMeta10;
          /* Pattern matching succeeded */
          _key_comp = omc_NFFlatten_FunctionTreeImpl_keyCompare(threadData, _inKey, _key);

          if((_key_comp == ((modelica_integer) -1)))
          {
            tmpMeta11 = mmc_mk_box3(4, &NFFlatten_FunctionTreeImpl_Tree_LEAF__desc, _inKey, _inValue);
            tmpMeta12 = mmc_mk_box6(3, &NFFlatten_FunctionTreeImpl_Tree_NODE__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), mmc_mk_integer(((modelica_integer) 2)), tmpMeta11, _OMC_LIT209);
            _outTree = tmpMeta12;
          }
          else
          {
            if((_key_comp == ((modelica_integer) 1)))
            {
              tmpMeta13 = mmc_mk_box3(4, &NFFlatten_FunctionTreeImpl_Tree_LEAF__desc, _inKey, _inValue);
              tmpMeta14 = mmc_mk_box6(3, &NFFlatten_FunctionTreeImpl_Tree_NODE__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), mmc_mk_integer(((modelica_integer) 2)), _OMC_LIT209, tmpMeta13);
              _outTree = tmpMeta14;
            }
            else
            {
              _value = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 2))), _inValue, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _key) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_conflictFunc), 1)))) (threadData, _inValue, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _key);

              if((!referenceEq((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _value)))
              {
                tmpMeta15 = MMC_TAGPTR(mmc_alloc_words(4));
                memcpy(MMC_UNTAGPTR(tmpMeta15), MMC_UNTAGPTR(_tree), 4*sizeof(modelica_metatype));
                ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta15))[3] = _value;
                _tree = tmpMeta15;
              }

              _outTree = _tree;
            }
          }
          tmpMeta1 = ((_key_comp == ((modelica_integer) 0))?_outTree:omc_NFFlatten_FunctionTreeImpl_balance(threadData, _outTree));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _tree = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _tree;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_addConflictDefault(threadData_t *threadData, modelica_metatype _newValue, modelica_metatype _oldValue, modelica_metatype _key)
{
  modelica_metatype _value = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _value = _oldValue;
  _return: OMC_LABEL_UNUSED
  return _value;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_addConflictFail(threadData_t *threadData, modelica_metatype _newValue, modelica_metatype _oldValue, modelica_metatype _key)
{
  modelica_metatype _value = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _value has no default value.
  MMC_THROW_INTERNAL();
  _return: OMC_LABEL_UNUSED
  return _value;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_addConflictKeep(threadData_t *threadData, modelica_metatype _newValue, modelica_metatype _oldValue, modelica_metatype _key)
{
  modelica_metatype _value = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _value = _oldValue;
  _return: OMC_LABEL_UNUSED
  return _value;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_addConflictReplace(threadData_t *threadData, modelica_metatype _newValue, modelica_metatype _oldValue, modelica_metatype _key)
{
  modelica_metatype _value = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _value = _newValue;
  _return: OMC_LABEL_UNUSED
  return _value;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_addList(threadData_t *threadData, modelica_metatype __omcQ_24in_5Ftree, modelica_metatype _inValues, modelica_fnptr _conflictFunc)
{
  modelica_metatype _tree = NULL;
  modelica_metatype _key = NULL;
  modelica_metatype _value = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _tree = __omcQ_24in_5Ftree;
  // _key has no default value.
  // _value has no default value.
  {
    modelica_metatype _t;
    for (tmpMeta1 = _inValues; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _t = MMC_CAR(tmpMeta1);
      /* Pattern-matching assignment */
      tmpMeta2 = _t;
      tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 1));
      tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 2));
      _key = tmpMeta3;
      _value = tmpMeta4;

      _tree = omc_NFFlatten_FunctionTreeImpl_add(threadData, _tree, _key, _value, ((modelica_fnptr) _conflictFunc));
    }
  }
  _return: OMC_LABEL_UNUSED
  return _tree;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_FunctionTreeImpl_balance(threadData_t *threadData, modelica_metatype _inTree)
{
  modelica_metatype _outTree = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outTree = _inTree;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _outTree;
    {
      modelica_integer _lh;
      modelica_integer _rh;
      modelica_integer _diff;
      modelica_metatype _balanced_tree = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _lh has no default value.
      // _rh has no default value.
      // _diff has no default value.
      // _balanced_tree has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = _inTree;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          _lh = omc_NFFlatten_FunctionTreeImpl_height(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5))));

          _rh = omc_NFFlatten_FunctionTreeImpl_height(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6))));

          _diff = _lh - _rh;

          if((_diff < ((modelica_integer) -1)))
          {
            _balanced_tree = ((omc_NFFlatten_FunctionTreeImpl_calculateBalance(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6)))) > ((modelica_integer) 0))?omc_NFFlatten_FunctionTreeImpl_rotateLeft(threadData, omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _outTree, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5))), omc_NFFlatten_FunctionTreeImpl_rotateRight(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6)))))):omc_NFFlatten_FunctionTreeImpl_rotateLeft(threadData, _outTree));
          }
          else
          {
            if((_diff > ((modelica_integer) 1)))
            {
              _balanced_tree = ((omc_NFFlatten_FunctionTreeImpl_calculateBalance(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5)))) < ((modelica_integer) 0))?omc_NFFlatten_FunctionTreeImpl_rotateRight(threadData, omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _outTree, omc_NFFlatten_FunctionTreeImpl_rotateLeft(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5)))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6))))):omc_NFFlatten_FunctionTreeImpl_rotateRight(threadData, _outTree));
            }
            else
            {
              if((mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 4)))) != ((modelica_integer) 1) + modelica_integer_max((modelica_integer)(_lh),(modelica_integer)(_rh))))
              {
                tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(7));
                memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_outTree), 7*sizeof(modelica_metatype));
                ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[4] = mmc_mk_integer(((modelica_integer) 1) + modelica_integer_max((modelica_integer)(_lh),(modelica_integer)(_rh)));
                _outTree = tmpMeta6;

                _balanced_tree = _outTree;
              }
              else
              {
                _balanced_tree = _outTree;
              }
            }
          }
          tmpMeta1 = _balanced_tree;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outTree = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outTree;
}

PROTECTED_FUNCTION_STATIC modelica_integer omc_NFFlatten_FunctionTreeImpl_calculateBalance(threadData_t *threadData, modelica_metatype _inNode)
{
  modelica_integer _outBalance;
  modelica_integer tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outBalance has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inNode;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          tmp1 = omc_NFFlatten_FunctionTreeImpl_height(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inNode), 5)))) - omc_NFFlatten_FunctionTreeImpl_height(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inNode), 6))));
          goto tmp3_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmp1 = ((modelica_integer) 0);
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmp1 = ((modelica_integer) 0);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outBalance = tmp1;
  _return: OMC_LABEL_UNUSED
  return _outBalance;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_calculateBalance(threadData_t *threadData, modelica_metatype _inNode)
{
  modelica_integer _outBalance;
  modelica_metatype out_outBalance;
  _outBalance = omc_NFFlatten_FunctionTreeImpl_calculateBalance(threadData, _inNode);
  out_outBalance = mmc_mk_icon(_outBalance);
  return out_outBalance;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_fold(threadData_t *threadData, modelica_metatype _inTree, modelica_fnptr _inFunc, modelica_metatype _inStartValue)
{
  modelica_metatype _outResult = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outResult = _inStartValue;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inTree;
    {
      modelica_metatype _key = NULL;
      modelica_metatype _value = NULL;
      int tmp4;
      // _key has no default value.
      // _value has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _key = tmpMeta5;
          _value = tmpMeta6;
          /* Pattern matching succeeded */
          _outResult = omc_NFFlatten_FunctionTreeImpl_fold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 5))), ((modelica_fnptr) _inFunc), _outResult);

          _outResult = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))), _key, _value, _outResult) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, _key, _value, _outResult);
          /* Tail recursive call */
          _inTree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 6)));
          _inStartValue = _outResult;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _key = tmpMeta7;
          _value = tmpMeta8;
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))), _key, _value, _outResult) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, _key, _value, _outResult);
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _outResult;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outResult = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outResult;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_foldCond(threadData_t *threadData, modelica_metatype _tree, modelica_fnptr _foldFunc, modelica_metatype __omcQ_24in_5Fvalue)
{
  modelica_metatype _value = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _value = __omcQ_24in_5Fvalue;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _tree;
    {
      modelica_boolean _c;
      int tmp4;
      // _c has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_integer tmp6;
          modelica_metatype tmpMeta7;
          
          /* Pattern matching succeeded */
          /* Pattern-matching tuple assignment */
          tmpMeta7 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _value, &tmpMeta5) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _value, &tmpMeta5);
          _value = tmpMeta7;
          tmp6 = mmc_unbox_integer(tmpMeta5);
          _c = tmp6  /* pattern as ty=Boolean */;

          if(_c)
          {
            _value = omc_NFFlatten_FunctionTreeImpl_foldCond(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 5))), ((modelica_fnptr) _foldFunc), _value);

            _value = omc_NFFlatten_FunctionTreeImpl_foldCond(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6))), ((modelica_fnptr) _foldFunc), _value);
          }
          tmpMeta1 = _value;
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta8;
          
          /* Pattern matching succeeded */
          /* Pattern-matching tuple assignment */
          tmpMeta8 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _value, NULL) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _value, NULL);
          _value = tmpMeta8;
          tmpMeta1 = _value;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _value;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _value = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _value;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_fold__2(threadData_t *threadData, modelica_metatype _tree, modelica_fnptr _foldFunc, modelica_metatype __omcQ_24in_5FfoldArg1, modelica_metatype __omcQ_24in_5FfoldArg2, modelica_metatype *out_foldArg2)
{
  modelica_metatype _foldArg1 = NULL;
  modelica_metatype _foldArg2 = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _foldArg1 = __omcQ_24in_5FfoldArg1;
  _foldArg2 = __omcQ_24in_5FfoldArg2;
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _tree;
    {
      int tmp3;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          _foldArg1 = omc_NFFlatten_FunctionTreeImpl_fold__2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 5))), ((modelica_fnptr) _foldFunc), _foldArg1, _foldArg2 ,&_foldArg2);

          _foldArg1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _foldArg1, _foldArg2 ,&_foldArg2) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _foldArg1, _foldArg2 ,&_foldArg2);

          _foldArg1 = omc_NFFlatten_FunctionTreeImpl_fold__2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6))), ((modelica_fnptr) _foldFunc), _foldArg1, _foldArg2 ,&_foldArg2);
          goto tmp2_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          _foldArg1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _foldArg1, _foldArg2 ,&_foldArg2) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_foldFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))), _foldArg1, _foldArg2 ,&_foldArg2);
          goto tmp2_done;
        }
        default:
        tmp2_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  if (out_foldArg2) { *out_foldArg2 = _foldArg2; }
  return _foldArg1;
}

DLLDirection
void omc_NFFlatten_FunctionTreeImpl_forEach(threadData_t *threadData, modelica_metatype _tree, modelica_fnptr _func)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _tree;
    {
      int tmp3;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          omc_NFFlatten_FunctionTreeImpl_forEach(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 5))), ((modelica_fnptr) _func));

          (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((void(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3)))) : ((void(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))));

          /* Tail recursive call */
          _tree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          ;
          goto tmp2_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))) ? ((void(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3)))) : ((void(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))));
          goto tmp2_done;
        }
        case 5: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_fromList(threadData_t *threadData, modelica_metatype _inValues, modelica_fnptr _conflictFunc)
{
  modelica_metatype _tree = NULL;
  modelica_metatype _key = NULL;
  modelica_metatype _value = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _tree = _OMC_LIT209;
  // _key has no default value.
  // _value has no default value.
  {
    modelica_metatype _t;
    for (tmpMeta1 = _inValues; !listEmpty(tmpMeta1); tmpMeta1=MMC_CDR(tmpMeta1))
    {
      _t = MMC_CAR(tmpMeta1);
      /* Pattern-matching assignment */
      tmpMeta2 = _t;
      tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 1));
      tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 2));
      _key = tmpMeta3;
      _value = tmpMeta4;

      _tree = omc_NFFlatten_FunctionTreeImpl_add(threadData, _tree, _key, _value, ((modelica_fnptr) _conflictFunc));
    }
  }
  _return: OMC_LABEL_UNUSED
  return _tree;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_get(threadData_t *threadData, modelica_metatype _tree, modelica_metatype _key)
{
  modelica_metatype _value = NULL;
  modelica_metatype _k = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _value has no default value.
  // _k has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _tree;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2)));
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2)));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _k = tmpMeta1;

  { /* match expression */
    modelica_integer tmp9_1;modelica_metatype tmp9_2;
    tmp9_1 = omc_NFFlatten_FunctionTreeImpl_keyCompare(threadData, _key, _k);
    tmp9_2 = _tree;
    {
      volatile mmc_switch_type tmp9;
      int tmp10;
      tmp9 = 0;
      for (; tmp9 < 4; tmp9++) {
        switch (MMC_SWITCH_CAST(tmp9)) {
        case 0: {
          if (0 != tmp9_1) goto tmp8_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp9_2,1,2) == 0) goto tmp8_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3)));
          goto tmp8_done;
        }
        case 1: {
          if (0 != tmp9_1) goto tmp8_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp9_2,0,5) == 0) goto tmp8_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3)));
          goto tmp8_done;
        }
        case 2: {
          if (1 != tmp9_1) goto tmp8_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp9_2,0,5) == 0) goto tmp8_end;
          
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _tree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp8_done;
        }
        case 3: {
          if (-1 != tmp9_1) goto tmp8_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp9_2,0,5) == 0) goto tmp8_end;
          
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _tree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 5)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp8_done;
        }
        }
        goto tmp8_end;
        tmp8_end: ;
      }
      goto goto_7;
      goto_7:;
      MMC_THROW_INTERNAL();
      goto tmp8_done;
      tmp8_done:;
    }
  }
  _value = tmpMeta6;
  _return: OMC_LABEL_UNUSED
  return _value;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_getOpt(threadData_t *threadData, modelica_metatype _tree, modelica_metatype _key)
{
  modelica_metatype _value = NULL;
  modelica_metatype _k = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta5;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _value has no default value.
  // _k has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _tree;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2)));
          goto tmp3_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2)));
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _key;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _k = tmpMeta1;

  { /* match expression */
    modelica_integer tmp8_1;modelica_metatype tmp8_2;
    tmp8_1 = omc_NFFlatten_FunctionTreeImpl_keyCompare(threadData, _key, _k);
    tmp8_2 = _tree;
    {
      volatile mmc_switch_type tmp8;
      int tmp9;
      tmp8 = 0;
      for (; tmp8 < 5; tmp8++) {
        switch (MMC_SWITCH_CAST(tmp8)) {
        case 0: {
          if (0 != tmp8_1) goto tmp7_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_2,1,2) == 0) goto tmp7_end;
          
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_some((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))));
          goto tmp7_done;
        }
        case 1: {
          if (0 != tmp8_1) goto tmp7_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_2,0,5) == 0) goto tmp7_end;
          
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_some((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 3))));
          goto tmp7_done;
        }
        case 2: {
          if (1 != tmp8_1) goto tmp7_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_2,0,5) == 0) goto tmp7_end;
          
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _tree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp7_done;
        }
        case 3: {
          if (-1 != tmp8_1) goto tmp7_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_2,0,5) == 0) goto tmp7_end;
          
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _tree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 5)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp7_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_none();
          goto tmp7_done;
        }
        }
        goto tmp7_end;
        tmp7_end: ;
      }
      goto goto_6;
      goto_6:;
      MMC_THROW_INTERNAL();
      goto tmp7_done;
      tmp7_done:;
    }
  }
  _value = tmpMeta5;
  _return: OMC_LABEL_UNUSED
  return _value;
}

DLLDirection
modelica_boolean omc_NFFlatten_FunctionTreeImpl_hasKey(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype _inKey)
{
  modelica_boolean _comp;
  modelica_metatype _key = NULL;
  modelica_integer _key_comp;
  modelica_metatype _tree = NULL;
  modelica_metatype tmpMeta1;
  modelica_boolean tmp5 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _comp = 0 /* false */;
  // _key has no default value.
  // _key_comp has no default value.
  // _tree has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inTree;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 2)));
          goto tmp3_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 2)));
          goto tmp3_done;
        }
        case 5: {
          
          /* Pattern matching succeeded */
          goto _return;
          goto goto_2;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _key = tmpMeta1;

  _key_comp = omc_NFFlatten_FunctionTreeImpl_keyCompare(threadData, _inKey, _key);

  { /* match expression */
    modelica_integer tmp8_1;modelica_metatype tmp8_2;
    tmp8_1 = _key_comp;
    tmp8_2 = _inTree;
    {
      volatile mmc_switch_type tmp8;
      int tmp9;
      tmp8 = 0;
      for (; tmp8 < 4; tmp8++) {
        switch (MMC_SWITCH_CAST(tmp8)) {
        case 0: {
          if (0 != tmp8_1) goto tmp7_end;
          
          /* Pattern matching succeeded */
          tmp5 = 1 /* true */;
          goto tmp7_done;
        }
        case 1: {
          modelica_metatype tmpMeta10;
          if (1 != tmp8_1) goto tmp7_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_2,0,5) == 0) goto tmp7_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp8_2), 6));
          _tree = tmpMeta10;
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _inTree = _tree;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp7_done;
        }
        case 2: {
          modelica_metatype tmpMeta11;
          if (-1 != tmp8_1) goto tmp7_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_2,0,5) == 0) goto tmp7_end;
          tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp8_2), 5));
          
          _tree = tmpMeta11;
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _inTree = _tree;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp7_done;
        }
        case 3: {
          
          /* Pattern matching succeeded */
          tmp5 = 0 /* false */;
          goto tmp7_done;
        }
        }
        goto tmp7_end;
        tmp7_end: ;
      }
      goto goto_6;
      goto_6:;
      MMC_THROW_INTERNAL();
      goto tmp7_done;
      tmp7_done:;
    }
  }
  _comp = tmp5;
  _return: OMC_LABEL_UNUSED
  return _comp;
}
modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_hasKey(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype _inKey)
{
  modelica_boolean _comp;
  modelica_metatype out_comp;
  _comp = omc_NFFlatten_FunctionTreeImpl_hasKey(threadData, _inTree, _inKey);
  out_comp = mmc_mk_icon(_comp);
  return out_comp;
}

PROTECTED_FUNCTION_STATIC modelica_integer omc_NFFlatten_FunctionTreeImpl_height(threadData_t *threadData, modelica_metatype _inNode)
{
  modelica_integer _outHeight;
  modelica_integer tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outHeight has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inNode;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          
          /* Pattern matching succeeded */
          tmp1 = mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inNode), 4))));
          goto tmp3_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmp1 = ((modelica_integer) 1);
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmp1 = ((modelica_integer) 0);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outHeight = tmp1;
  _return: OMC_LABEL_UNUSED
  return _outHeight;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_height(threadData_t *threadData, modelica_metatype _inNode)
{
  modelica_integer _outHeight;
  modelica_metatype out_outHeight;
  _outHeight = omc_NFFlatten_FunctionTreeImpl_height(threadData, _inNode);
  out_outHeight = mmc_mk_icon(_outHeight);
  return out_outHeight;
}

DLLDirection
void omc_NFFlatten_FunctionTreeImpl_intersection(threadData_t *threadData)
{
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  MMC_THROW_INTERNAL();
  _return: OMC_LABEL_UNUSED
  return;
}

DLLDirection
modelica_boolean omc_NFFlatten_FunctionTreeImpl_isEmpty(threadData_t *threadData, modelica_metatype _tree)
{
  modelica_boolean _isEmpty;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _isEmpty has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _tree;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,0) == 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmp1 = 1 /* true */;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _isEmpty = tmp1;
  _return: OMC_LABEL_UNUSED
  return _isEmpty;
}
modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_isEmpty(threadData_t *threadData, modelica_metatype _tree)
{
  modelica_boolean _isEmpty;
  modelica_metatype out_isEmpty;
  _isEmpty = omc_NFFlatten_FunctionTreeImpl_isEmpty(threadData, _tree);
  out_isEmpty = mmc_mk_icon(_isEmpty);
  return out_isEmpty;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_join(threadData_t *threadData, modelica_metatype __omcQ_24in_5Ftree, modelica_metatype _treeToJoin, modelica_fnptr _conflictFunc)
{
  modelica_metatype _tree = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _tree = __omcQ_24in_5Ftree;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _treeToJoin;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 5: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _tree;
          goto tmp3_done;
        }
        case 3: {
          
          /* Pattern matching succeeded */
          _tree = omc_NFFlatten_FunctionTreeImpl_add(threadData, _tree, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_treeToJoin), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_treeToJoin), 3))), ((modelica_fnptr) _conflictFunc));

          _tree = omc_NFFlatten_FunctionTreeImpl_join(threadData, _tree, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_treeToJoin), 5))), ((modelica_fnptr) _conflictFunc));
          /* Tail recursive call */
          __omcQ_24in_5Ftree = _tree;
          _treeToJoin = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_treeToJoin), 6)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NFFlatten_FunctionTreeImpl_add(threadData, _tree, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_treeToJoin), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_treeToJoin), 3))), ((modelica_fnptr) _conflictFunc));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _tree = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _tree;
}

DLLDirection
modelica_integer omc_NFFlatten_FunctionTreeImpl_keyCompare(threadData_t *threadData, modelica_metatype _inKey1, modelica_metatype _inKey2)
{
  modelica_integer _outResult;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outResult has no default value.
  _outResult = omc_AbsynUtil_pathCompareNoQual(threadData, _inKey1, _inKey2);
  _return: OMC_LABEL_UNUSED
  return _outResult;
}
modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_keyCompare(threadData_t *threadData, modelica_metatype _inKey1, modelica_metatype _inKey2)
{
  modelica_integer _outResult;
  modelica_metatype out_outResult;
  _outResult = omc_NFFlatten_FunctionTreeImpl_keyCompare(threadData, _inKey1, _inKey2);
  out_outResult = mmc_mk_icon(_outResult);
  return out_outResult;
}

DLLDirection
modelica_string omc_NFFlatten_FunctionTreeImpl_keyStr(threadData_t *threadData, modelica_metatype _inKey)
{
  modelica_string _outString = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outString has no default value.
  _outString = omc_AbsynUtil_pathString(threadData, _inKey, _OMC_LIT6, 1 /* true */, 0 /* false */);
  _return: OMC_LABEL_UNUSED
  return _outString;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_listKeys(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype __omcQ_24in_5Flst)
{
  modelica_metatype _lst = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _lst = __omcQ_24in_5Flst;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inTree;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 4: {
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 2))), _lst);
          tmpMeta1 = tmpMeta5;
          goto tmp3_done;
        }
        case 3: {
          modelica_metatype tmpMeta6;
          
          /* Pattern matching succeeded */
          _lst = omc_NFFlatten_FunctionTreeImpl_listKeys(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 6))), _lst);

          tmpMeta6 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 2))), _lst);
          _lst = tmpMeta6;
          /* Tail recursive call */
          _inTree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 5)));
          __omcQ_24in_5Flst = _lst;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _lst;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _lst = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _lst;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_listKeysReverse(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype __omcQ_24in_5Flst)
{
  modelica_metatype _lst = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _lst = __omcQ_24in_5Flst;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inTree;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 4: {
          modelica_metatype tmpMeta5;
          
          /* Pattern matching succeeded */
          tmpMeta5 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 2))), _lst);
          tmpMeta1 = tmpMeta5;
          goto tmp3_done;
        }
        case 3: {
          modelica_metatype tmpMeta6;
          
          /* Pattern matching succeeded */
          _lst = omc_NFFlatten_FunctionTreeImpl_listKeysReverse(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 5))), _lst);

          tmpMeta6 = mmc_mk_cons((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 2))), _lst);
          _lst = tmpMeta6;
          /* Tail recursive call */
          _inTree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 6)));
          __omcQ_24in_5Flst = _lst;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _lst;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _lst = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _lst;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_listValues(threadData_t *threadData, modelica_metatype _tree, modelica_metatype __omcQ_24in_5Flst)
{
  modelica_metatype _lst = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _lst = __omcQ_24in_5Flst;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _tree;
    {
      modelica_metatype _value = NULL;
      int tmp4;
      // _value has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _value = tmpMeta5;
          /* Pattern matching succeeded */
          _lst = omc_NFFlatten_FunctionTreeImpl_listValues(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6))), _lst);

          tmpMeta6 = mmc_mk_cons(_value, _lst);
          _lst = tmpMeta6;
          /* Tail recursive call */
          _tree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 5)));
          __omcQ_24in_5Flst = _lst;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _value = tmpMeta7;
          /* Pattern matching succeeded */
          tmpMeta8 = mmc_mk_cons(_value, _lst);
          tmpMeta1 = tmpMeta8;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _lst;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _lst = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _lst;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_map(threadData_t *threadData, modelica_metatype _inTree, modelica_fnptr _inFunc)
{
  modelica_metatype _outTree = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outTree = _inTree;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _outTree;
    {
      modelica_metatype _key = NULL;
      modelica_metatype _value = NULL;
      modelica_metatype _new_value = NULL;
      modelica_metatype _new_left = NULL;
      modelica_metatype _new_right = NULL;
      int tmp4;
      // _key has no default value.
      // _value has no default value.
      // _new_value has no default value.
      // _new_left has no default value.
      // _new_right has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _key = tmpMeta5;
          _value = tmpMeta6;
          /* Pattern matching succeeded */
          _new_left = omc_NFFlatten_FunctionTreeImpl_map(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5))), ((modelica_fnptr) _inFunc));

          _new_value = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))), _key, _value) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, _key, _value);

          _new_right = omc_NFFlatten_FunctionTreeImpl_map(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6))), ((modelica_fnptr) _inFunc));

          if((((!referenceEq(_new_left, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5))))) || (!referenceEq(_value, _new_value))) || (!referenceEq(_new_right, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6)))))))
          {
            tmpMeta7 = mmc_mk_box6(3, &NFFlatten_FunctionTreeImpl_Tree_NODE__desc, _key, _new_value, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 4))), _new_left, _new_right);
            _outTree = tmpMeta7;
          }
          tmpMeta1 = _outTree;
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _key = tmpMeta8;
          _value = tmpMeta9;
          /* Pattern matching succeeded */
          _new_value = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))), _key, _value) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, _key, _value);

          if((!referenceEq(_value, _new_value)))
          {
            tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(4));
            memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_outTree), 4*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[3] = _new_value;
            _outTree = tmpMeta10;
          }
          tmpMeta1 = _outTree;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _inTree;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outTree = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outTree;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_mapExp_mapBody(threadData_t *threadData, modelica_metatype _key, modelica_metatype __omcQ_24in_5Fval, modelica_fnptr _func)
{
  modelica_metatype _val = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _val = __omcQ_24in_5Fval;
  _val = omc_NFFunction_Function_mapExp(threadData, _val, ((modelica_fnptr) _func), ((modelica_fnptr) _func), 1 /* true */, 1 /* true */);
  _return: OMC_LABEL_UNUSED
  return _val;
}

static modelica_metatype closure19_NFFlatten_FunctionTreeImpl_mapExp_mapBody(threadData_t *thData, modelica_metatype closure, modelica_metatype key, modelica_metatype $in_val)
{
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFFlatten_FunctionTreeImpl_mapExp_mapBody(thData, key, $in_val, func);
}
DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_mapExp(threadData_t *threadData, modelica_metatype __omcQ_24in_5Ftree, modelica_fnptr _func)
{
  modelica_metatype _tree = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _tree = __omcQ_24in_5Ftree;
  tmpMeta1 = mmc_mk_box1(0, ((modelica_fnptr) _func));
  _tree = omc_NFFlatten_FunctionTreeImpl_map(threadData, _tree, (modelica_fnptr) mmc_mk_box2(0,closure19_NFFlatten_FunctionTreeImpl_mapExp_mapBody,tmpMeta1));
  _return: OMC_LABEL_UNUSED
  return _tree;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_mapFold(threadData_t *threadData, modelica_metatype _inTree, modelica_fnptr _inFunc, modelica_metatype _inStartValue, modelica_metatype *out_outResult)
{
  modelica_metatype _outTree = NULL;
  modelica_metatype _outResult = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outTree = _inTree;
  _outResult = _inStartValue;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _outTree;
    {
      modelica_metatype _key = NULL;
      modelica_metatype _value = NULL;
      modelica_metatype _new_value = NULL;
      modelica_metatype _new_left = NULL;
      modelica_metatype _new_right = NULL;
      int tmp4;
      // _key has no default value.
      // _value has no default value.
      // _new_value has no default value.
      // _new_left has no default value.
      // _new_right has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _key = tmpMeta5;
          _value = tmpMeta6;
          /* Pattern matching succeeded */
          _new_left = omc_NFFlatten_FunctionTreeImpl_mapFold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5))), ((modelica_fnptr) _inFunc), _outResult ,&_outResult);

          _new_value = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))), _key, _value, _outResult ,&_outResult) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, _key, _value, _outResult ,&_outResult);

          _new_right = omc_NFFlatten_FunctionTreeImpl_mapFold(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6))), ((modelica_fnptr) _inFunc), _outResult ,&_outResult);

          if((((!referenceEq(_new_left, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 5))))) || (!referenceEq(_value, _new_value))) || (!referenceEq(_new_right, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 6)))))))
          {
            tmpMeta7 = mmc_mk_box6(3, &NFFlatten_FunctionTreeImpl_Tree_NODE__desc, _key, _new_value, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outTree), 4))), _new_left, _new_right);
            _outTree = tmpMeta7;
          }
          tmpMeta1 = _outTree;
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _key = tmpMeta8;
          _value = tmpMeta9;
          /* Pattern matching succeeded */
          _new_value = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))) ? ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 2))), _key, _value, _outResult ,&_outResult) : ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inFunc), 1)))) (threadData, _key, _value, _outResult ,&_outResult);

          if((!referenceEq(_value, _new_value)))
          {
            tmpMeta10 = MMC_TAGPTR(mmc_alloc_words(4));
            memcpy(MMC_UNTAGPTR(tmpMeta10), MMC_UNTAGPTR(_outTree), 4*sizeof(modelica_metatype));
            ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta10))[3] = _new_value;
            _outTree = tmpMeta10;
          }
          tmpMeta1 = _outTree;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _inTree;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outTree = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  if (out_outResult) { *out_outResult = _outResult; }
  return _outTree;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_new(threadData_t *threadData)
{
  modelica_metatype _outTree = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outTree = _OMC_LIT209;
  _return: OMC_LABEL_UNUSED
  return _outTree;
}

DLLDirection
modelica_string omc_NFFlatten_FunctionTreeImpl_printNodeStr(threadData_t *threadData, modelica_metatype _inNode)
{
  modelica_string _outString = NULL;
  modelica_string tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outString has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inNode;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta6 = stringAppend(_OMC_LIT210,omc_NFFlatten_FunctionTreeImpl_keyStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inNode), 2)))));
          tmpMeta7 = stringAppend(tmpMeta6,_OMC_LIT211);
          tmpMeta8 = stringAppend(tmpMeta7,omc_NFFlatten_FunctionTreeImpl_valueStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inNode), 3)))));
          tmpMeta9 = stringAppend(tmpMeta8,_OMC_LIT212);
          tmp1 = tmpMeta9;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta10 = stringAppend(_OMC_LIT210,omc_NFFlatten_FunctionTreeImpl_keyStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inNode), 2)))));
          tmpMeta11 = stringAppend(tmpMeta10,_OMC_LIT211);
          tmpMeta12 = stringAppend(tmpMeta11,omc_NFFlatten_FunctionTreeImpl_valueStr(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inNode), 3)))));
          tmpMeta13 = stringAppend(tmpMeta12,_OMC_LIT212);
          tmp1 = tmpMeta13;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outString = tmp1;
  _return: OMC_LABEL_UNUSED
  return _outString;
}

DLLDirection
modelica_string omc_NFFlatten_FunctionTreeImpl_printTreeStr(threadData_t *threadData, modelica_metatype _inTree)
{
  modelica_string _outString = NULL;
  modelica_metatype _left = NULL;
  modelica_metatype _right = NULL;
  modelica_string tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outString has no default value.
  // _left has no default value.
  // _right has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inTree;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 5: {
          
          /* Pattern matching succeeded */
          tmp1 = _OMC_LIT213;
          goto tmp3_done;
        }
        case 4: {
          
          /* Pattern matching succeeded */
          tmp1 = omc_NFFlatten_FunctionTreeImpl_printNodeStr(threadData, _inTree);
          goto tmp3_done;
        }
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 5));
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 6));
          _left = tmpMeta5;
          _right = tmpMeta6;
          /* Pattern matching succeeded */
          tmpMeta7 = stringAppend(omc_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData, _left, 1 /* true */, _OMC_LIT19),omc_NFFlatten_FunctionTreeImpl_printNodeStr(threadData, _inTree));
          tmpMeta8 = stringAppend(tmpMeta7,_OMC_LIT8);
          tmpMeta9 = stringAppend(tmpMeta8,omc_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData, _right, 0 /* false */, _OMC_LIT19));
          tmp1 = tmpMeta9;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outString = tmp1;
  _return: OMC_LABEL_UNUSED
  return _outString;
}

PROTECTED_FUNCTION_STATIC modelica_string omc_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData_t *threadData, modelica_metatype _inTree, modelica_boolean _isLeft, modelica_string _inIndent)
{
  modelica_string _outString = NULL;
  modelica_metatype _val_node = NULL;
  modelica_metatype _left = NULL;
  modelica_metatype _right = NULL;
  modelica_string _left_str = NULL;
  modelica_string _right_str = NULL;
  modelica_string tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outString has no default value.
  // _val_node has no default value.
  // _left has no default value.
  // _right has no default value.
  // _left_str has no default value.
  // _right_str has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inTree;
    {
      int tmp4;
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          
          /* Pattern matching succeeded */
          tmpMeta5 = stringAppend(_inIndent,(_isLeft?_OMC_LIT214:_OMC_LIT215));
          tmpMeta6 = stringAppend(omc_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 5))), 1 /* true */, tmpMeta5),_inIndent);
          tmpMeta7 = stringAppend(tmpMeta6,(_isLeft?_OMC_LIT216:_OMC_LIT217));
          tmpMeta8 = stringAppend(tmpMeta7,_OMC_LIT218);
          tmpMeta9 = stringAppend(tmpMeta8,omc_NFFlatten_FunctionTreeImpl_printNodeStr(threadData, _inTree));
          tmpMeta10 = stringAppend(tmpMeta9,_OMC_LIT8);
          tmpMeta11 = stringAppend(_inIndent,(_isLeft?_OMC_LIT215:_OMC_LIT214));
          tmpMeta12 = stringAppend(tmpMeta10,omc_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 6))), 0 /* false */, tmpMeta11));
          tmp1 = tmpMeta12;
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          modelica_metatype tmpMeta15;
          modelica_metatype tmpMeta16;
          
          /* Pattern matching succeeded */
          tmpMeta13 = stringAppend(_inIndent,(_isLeft?_OMC_LIT216:_OMC_LIT217));
          tmpMeta14 = stringAppend(tmpMeta13,_OMC_LIT218);
          tmpMeta15 = stringAppend(tmpMeta14,omc_NFFlatten_FunctionTreeImpl_printNodeStr(threadData, _inTree));
          tmpMeta16 = stringAppend(tmpMeta15,_OMC_LIT8);
          tmp1 = tmpMeta16;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmp1 = _OMC_LIT19;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outString = tmp1;
  _return: OMC_LABEL_UNUSED
  return _outString;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype _isLeft, modelica_metatype _inIndent)
{
  modelica_integer tmp1;
  modelica_string _outString = NULL;
  tmp1 = mmc_unbox_integer(_isLeft);
  _outString = omc_NFFlatten_FunctionTreeImpl_printTreeStr2(threadData, _inTree, tmp1, _inIndent);
  /* skip box _outString; String */
  return _outString;
}

PROTECTED_FUNCTION_STATIC modelica_boolean omc_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty(threadData_t *threadData, modelica_metatype _t1, modelica_metatype _t2)
{
  modelica_boolean _b;
  modelica_boolean tmp1 = 0;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _b has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;modelica_metatype tmp4_2;
    tmp4_1 = _t1;
    tmp4_2 = _t2;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,0) == 0) goto tmp3_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,2,0) == 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmp1 = 1 /* true */;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmp1 = referenceEq(_t1, _t2);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _b = tmp1;
  _return: OMC_LABEL_UNUSED
  return _b;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty(threadData_t *threadData, modelica_metatype _t1, modelica_metatype _t2)
{
  modelica_boolean _b;
  modelica_metatype out_b;
  _b = omc_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty(threadData, _t1, _t2);
  out_b = mmc_mk_icon(_b);
  return out_b;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_FunctionTreeImpl_rotateLeft(threadData_t *threadData, modelica_metatype _inNode)
{
  modelica_metatype _outNode = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outNode = _inNode;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _outNode;
    {
      modelica_metatype _node = NULL;
      modelica_metatype _child = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _node has no default value.
      // _child has no default value.
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 6));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,0,5) == 0) goto tmp3_end;
          
          _child = tmpMeta6;
          /* Pattern matching succeeded */
          _node = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _outNode, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outNode), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 5))));
          tmpMeta1 = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _child, _node, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 6))));
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 6));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,1,2) == 0) goto tmp3_end;
          
          _child = tmpMeta7;
          /* Pattern matching succeeded */
          _node = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _outNode, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outNode), 5))), _OMC_LIT209);
          tmpMeta1 = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _child, _node, _OMC_LIT209);
          goto tmp3_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _inNode;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outNode = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outNode;
}

PROTECTED_FUNCTION_STATIC modelica_metatype omc_NFFlatten_FunctionTreeImpl_rotateRight(threadData_t *threadData, modelica_metatype _inNode)
{
  modelica_metatype _outNode = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outNode = _inNode;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _outNode;
    {
      modelica_metatype _node = NULL;
      modelica_metatype _child = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _node has no default value.
      // _child has no default value.
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 5));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,0,5) == 0) goto tmp3_end;
          
          _child = tmpMeta6;
          /* Pattern matching succeeded */
          _node = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _outNode, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 6))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outNode), 6))));
          tmpMeta1 = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _child, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_child), 5))), _node);
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 5));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,1,2) == 0) goto tmp3_end;
          
          _child = tmpMeta7;
          /* Pattern matching succeeded */
          _node = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _outNode, _OMC_LIT209, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outNode), 6))));
          tmpMeta1 = omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData, _child, _OMC_LIT209, _node);
          goto tmp3_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _inNode;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outNode = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outNode;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_setTreeLeftRight(threadData_t *threadData, modelica_metatype _orig, modelica_metatype _left, modelica_metatype _right)
{
  modelica_metatype _res = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _res has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;modelica_metatype tmp4_2;modelica_metatype tmp4_3;
    tmp4_1 = _orig;
    tmp4_2 = _left;
    tmp4_3 = _right;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 4; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,2,0) == 0) goto tmp3_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_3,2,0) == 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta6 = mmc_mk_box3(4, &NFFlatten_FunctionTreeImpl_Tree_LEAF__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 3))));
          tmpMeta1 = tmpMeta6;
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,2,0) == 0) goto tmp3_end;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_3,2,0) == 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta1 = _orig;
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta7;
          modelica_boolean tmp8;
          modelica_metatype tmpMeta9;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmp8 = (modelica_boolean)(omc_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 5))), _left) && omc_NFFlatten_FunctionTreeImpl_referenceEqOrEmpty(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 6))), _right));
          if(tmp8)
          {
            tmpMeta9 = _orig;
          }
          else
          {
            tmpMeta7 = mmc_mk_box6(3, &NFFlatten_FunctionTreeImpl_Tree_NODE__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 3))), mmc_mk_integer(((modelica_integer) 1) + modelica_integer_max((modelica_integer)(omc_NFFlatten_FunctionTreeImpl_height(threadData, _left)),(modelica_integer)(omc_NFFlatten_FunctionTreeImpl_height(threadData, _right)))), _left, _right);
            tmpMeta9 = tmpMeta7;
          }
          tmpMeta1 = tmpMeta9;
          goto tmp3_done;
        }
        case 3: {
          modelica_metatype tmpMeta10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta10 = mmc_mk_box6(3, &NFFlatten_FunctionTreeImpl_Tree_NODE__desc, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_orig), 3))), mmc_mk_integer(((modelica_integer) 1) + modelica_integer_max((modelica_integer)(omc_NFFlatten_FunctionTreeImpl_height(threadData, _left)),(modelica_integer)(omc_NFFlatten_FunctionTreeImpl_height(threadData, _right)))), _left, _right);
          tmpMeta1 = tmpMeta10;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _res = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _res;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_smallestKey(threadData_t *threadData, modelica_metatype _tree)
{
  modelica_metatype _key = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _key has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _tree;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 6));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,2,0) == 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2)));
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Tail recursive call */
          _tree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 6)));
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 2: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_tree), 2)));
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _key = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _key;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_toList(threadData_t *threadData, modelica_metatype _inTree, modelica_metatype __omcQ_24in_5Flst)
{
  modelica_metatype _lst = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _lst = __omcQ_24in_5Flst;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _inTree;
    {
      modelica_metatype _key = NULL;
      modelica_metatype _value = NULL;
      int tmp4;
      // _key has no default value.
      // _value has no default value.
      {
        switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
        case 3: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          
          _key = tmpMeta5;
          _value = tmpMeta6;
          /* Pattern matching succeeded */
          _lst = omc_NFFlatten_FunctionTreeImpl_toList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 6))), _lst);

          tmpMeta8 = mmc_mk_box2(0, _key, _value);
          tmpMeta7 = mmc_mk_cons(tmpMeta8, _lst);
          _lst = tmpMeta7;
          /* Tail recursive call */
          _inTree = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_inTree), 5)));
          __omcQ_24in_5Flst = _lst;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 4: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,2) == 0) goto tmp3_end;
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          _key = tmpMeta9;
          _value = tmpMeta10;
          /* Pattern matching succeeded */
          tmpMeta12 = mmc_mk_box2(0, _key, _value);
          tmpMeta11 = mmc_mk_cons(tmpMeta12, _lst);
          tmpMeta1 = tmpMeta11;
          goto tmp3_done;
        }
        default:
        tmp3_default: OMC_LABEL_UNUSED; {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _lst;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _lst = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _lst;
}

DLLDirection
modelica_metatype omc_NFFlatten_FunctionTreeImpl_update(threadData_t *threadData, modelica_metatype _tree, modelica_metatype _key, modelica_metatype _value)
{
  modelica_metatype _outTree = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _outTree = omc_NFFlatten_FunctionTreeImpl_add(threadData, _tree, _key, _value, boxvar_NFFlatten_FunctionTreeImpl_addConflictReplace);
  _return: OMC_LABEL_UNUSED
  return _outTree;
}

DLLDirection
modelica_string omc_NFFlatten_FunctionTreeImpl_valueStr(threadData_t *threadData, modelica_metatype _inValue)
{
  modelica_string _outString = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outString has no default value.
  _outString = _OMC_LIT19;
  _return: OMC_LABEL_UNUSED
  return _outString;
}

