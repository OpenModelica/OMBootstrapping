#include "omc_simulation_settings.h"
#include "NFExpandExp.h"
#define _OMC_LIT0_data ""
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT0,0,_OMC_LIT0_data);
#define _OMC_LIT0 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT0)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT1,0.0);
#define _OMC_LIT1 MMC_REFREALLIT(_OMC_LIT_STRUCT1)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT2,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT0,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),_OMC_LIT1}};
#define _OMC_LIT2 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT2)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT3,4,3) {&NFCeval_EvalTarget_EVAL__TARGET__desc,_OMC_LIT2,MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT3 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT3)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT4,1,4) {&NFType_REAL__desc,}};
#define _OMC_LIT4 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT4)
#define _OMC_LIT5_data "cat"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT5,3,_OMC_LIT5_data);
#define _OMC_LIT5 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT5)
#define _OMC_LIT6_data "der"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT6,3,_OMC_LIT6_data);
#define _OMC_LIT6 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data "diagonal"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,8,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
#define _OMC_LIT8_data "fill"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT8,4,_OMC_LIT8_data);
#define _OMC_LIT8 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT8)
#define _OMC_LIT9_data "pre"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT9,3,_OMC_LIT9_data);
#define _OMC_LIT9 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "previous"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,8,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
#define _OMC_LIT11_data "promote"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT11,7,_OMC_LIT11_data);
#define _OMC_LIT11 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT11)
#define _OMC_LIT12_data "transpose"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT12,9,_OMC_LIT12_data);
#define _OMC_LIT12 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT12)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT13,2,6) {&NFExpression_BOOLEAN__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */))}};
#define _OMC_LIT13 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT13)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT14,2,6) {&NFExpression_BOOLEAN__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(1 /* true */))}};
#define _OMC_LIT14 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT14)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT15,2,1) {_OMC_LIT14,MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT15 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT15)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT16,2,1) {_OMC_LIT13,_OMC_LIT15}};
#define _OMC_LIT16 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT16)
#define _OMC_LIT17_data "NFExpandExp.expandTypename got invalid typename"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT17,47,_OMC_LIT17_data);
#define _OMC_LIT17 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT17)
#define _OMC_LIT18_data "/home/adrpo33/OpenModelica/OMCompiler/Compiler/NFFrontEnd/NFExpandExp.mo"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT18,72,_OMC_LIT18_data);
#define _OMC_LIT18 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT18)
static const MMC_DEFREALLIT(_OMC_LIT_STRUCT19_6,1.758197185e9);
#define _OMC_LIT19_6 MMC_REFREALLIT(_OMC_LIT_STRUCT19_6)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT19,8,3) {&SourceInfo_SOURCEINFO__desc,_OMC_LIT18,MMC_IMMEDIATE(MMC_TAGFIXNUM(0 /* false */)),MMC_IMMEDIATE(MMC_TAGFIXNUM(269)),MMC_IMMEDIATE(MMC_TAGFIXNUM(11)),MMC_IMMEDIATE(MMC_TAGFIXNUM(269)),MMC_IMMEDIATE(MMC_TAGFIXNUM(92)),_OMC_LIT19_6}};
#define _OMC_LIT19 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT19)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT20,2,3) {&NFExpression_INTEGER__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0))}};
#define _OMC_LIT20 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT20)
#include "util/modelica.h"

#include "NFExpandExp_includes.h"



DLLDirection
modelica_metatype omc_NFExpandExp_expandCallArgs(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _call = NULL;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  // _call has no default value.
  { /* match expression */
    modelica_metatype tmp3_1;
    tmp3_1 = _exp;
    {
      volatile mmc_switch_type tmp3;
      int tmp4;
      tmp3 = 0;
      for (; tmp3 < 2; tmp3++) {
        switch (MMC_SWITCH_CAST(tmp3)) {
        case 0: {
          modelica_metatype tmpMeta5;
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta11;
          if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,13,1) == 0) goto tmp2_end;
          tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,2,6) == 0) goto tmp2_end;
          
          _call = tmpMeta5;
          /* Pattern matching succeeded */
          {
            modelica_metatype __omcQ_24tmpVar1;
            modelica_metatype* tmp8;
            modelica_metatype tmpMeta9;
            modelica_metatype __omcQ_24tmpVar0;
            modelica_integer tmp10;
            modelica_metatype _arg_loopVar = 0;
            modelica_metatype _arg;
            _arg_loopVar = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 6)));
            tmpMeta9 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar1 = tmpMeta9; /* defaultValue */
            tmp8 = &__omcQ_24tmpVar1;
            while(1) {
              tmp10 = 1;
              if (!listEmpty(_arg_loopVar)) {
                _arg = MMC_CAR(_arg_loopVar);
                _arg_loopVar = MMC_CDR(_arg_loopVar);
                tmp10--;
              }
              if (tmp10 == 0) {
                __omcQ_24tmpVar0 = omc_NFExpandExp_expand(threadData, _arg, 0 /* false */, NULL);
                *tmp8 = mmc_mk_cons(__omcQ_24tmpVar0,0);
                tmp8 = &MMC_CDR(*tmp8);
              } else if (tmp10 == 1) {
                break;
              } else {
                goto goto_1;
              }
            }
            *tmp8 = mmc_mk_nil();
            tmpMeta7 = __omcQ_24tmpVar1;
          }
          tmpMeta6 = MMC_TAGPTR(mmc_alloc_words(8));
          memcpy(MMC_UNTAGPTR(tmpMeta6), MMC_UNTAGPTR(_call), 8*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta6))[6] = tmpMeta7;
          _call = tmpMeta6;

          tmpMeta11 = MMC_TAGPTR(mmc_alloc_words(3));
          memcpy(MMC_UNTAGPTR(tmpMeta11), MMC_UNTAGPTR(_exp), 3*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta11))[2] = _call;
          _exp = tmpMeta11;
          goto tmp2_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          goto tmp2_done;
        }
        }
        goto tmp2_end;
        tmp2_end: ;
      }
      goto goto_1;
      goto_1:;
      MMC_THROW_INTERNAL();
      goto tmp2_done;
      tmp2_done:;
    }
  }
  ;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandGeneric2(threadData_t *threadData, modelica_metatype _subs, modelica_metatype _exp, modelica_metatype _ty, modelica_metatype _accum)
{
  modelica_metatype _outExp = NULL;
  modelica_metatype _t = NULL;
  modelica_metatype _sub = NULL;
  modelica_metatype _expl = NULL;
  modelica_metatype _rest_subs = NULL;
  modelica_integer _i;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _t has no default value.
  // _sub has no default value.
  // _expl has no default value.
  // _rest_subs has no default value.
  // _i has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _subs;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          if (listEmpty(tmp4_1)) goto tmp3_end;
          tmpMeta6 = MMC_CAR(tmp4_1);
          tmpMeta7 = MMC_CDR(tmp4_1);
          _sub = tmpMeta6;
          _rest_subs = tmpMeta7;
          /* Pattern matching succeeded */
          _t = omc_NFType_unliftArray(threadData, _ty);

          _expl = arrayCreateNoInit(listLength(_sub), _exp);

          _i = ((modelica_integer) 1);

          {
            modelica_metatype _s;
            for (tmpMeta8 = _sub; !listEmpty(tmpMeta8); tmpMeta8=MMC_CDR(tmpMeta8))
            {
              _s = MMC_CAR(tmpMeta8);
              tmpMeta9 = mmc_mk_cons(_s, _accum);
              arrayUpdateNoBoundsChecking(_expl, _i, omc_NFExpandExp_expandGeneric2(threadData, _rest_subs, _exp, _t, tmpMeta9));

              _i = ((modelica_integer) 1) + _i;
            }
          }
          tmpMeta1 = omc_NFExpression_makeArray(threadData, _ty, _expl, 0 /* false */);
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          modelica_metatype tmpMeta13;
          if (!listEmpty(tmp4_1)) goto tmp3_end;
          /* Pattern matching succeeded */
          _outExp = _exp;

          {
            modelica_metatype _s;
            for (tmpMeta11 = listReverse(_accum); !listEmpty(tmpMeta11); tmpMeta11=MMC_CDR(tmpMeta11))
            {
              _s = MMC_CAR(tmpMeta11);
              tmpMeta12 = MMC_REFSTRUCTLIT(mmc_nil);
              _outExp = omc_NFExpression_applySubscript(threadData, _s, _outExp, tmpMeta12, 0 /* false */);
            }
          }
          tmpMeta1 = _outExp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outExp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandGeneric(threadData_t *threadData, modelica_metatype _exp, modelica_boolean _resize, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _ty = NULL;
  modelica_metatype _dims = NULL;
  modelica_metatype _subs = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta10;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _ty has no default value.
  // _dims has no default value.
  // _subs has no default value.
  _ty = omc_NFExpression_typeOf(threadData, _exp);

  if(omc_NFType_isArray(threadData, _ty))
  {
    _expanded = omc_NFType_hasKnownSize(threadData, _ty);

    if(_expanded)
    {
      _dims = omc_NFType_arrayDims(threadData, _ty);

      {
        modelica_metatype __omcQ_24tmpVar5;
        modelica_metatype* tmp2;
        modelica_metatype tmpMeta3;
        modelica_metatype tmpMeta4;
        modelica_metatype __omcQ_24tmpVar4;
        modelica_integer tmp9;
        modelica_metatype _d_loopVar = 0;
        modelica_metatype _d;
        _d_loopVar = _dims;
        tmpMeta3 = MMC_REFSTRUCTLIT(mmc_nil);
        __omcQ_24tmpVar5 = tmpMeta3; /* defaultValue */
        tmp2 = &__omcQ_24tmpVar5;
        while(1) {
          tmp9 = 1;
          if (!listEmpty(_d_loopVar)) {
            _d = MMC_CAR(_d_loopVar);
            _d_loopVar = MMC_CDR(_d_loopVar);
            tmp9--;
          }
          if (tmp9 == 0) {
            {
              modelica_metatype __omcQ_24tmpVar3;
              modelica_metatype* tmp5;
              modelica_metatype tmpMeta6;
              modelica_metatype tmpMeta7;
              modelica_metatype __omcQ_24tmpVar2;
              modelica_integer tmp8;
              modelica_metatype _e_loopVar = 0;
              modelica_metatype _e;
              _e_loopVar = omc_NFRangeIterator_toList(threadData, omc_NFRangeIterator_fromDim(threadData, _d, _resize));
              tmpMeta6 = MMC_REFSTRUCTLIT(mmc_nil);
              __omcQ_24tmpVar3 = tmpMeta6; /* defaultValue */
              tmp5 = &__omcQ_24tmpVar3;
              while(1) {
                tmp8 = 1;
                if (!listEmpty(_e_loopVar)) {
                  _e = MMC_CAR(_e_loopVar);
                  _e_loopVar = MMC_CDR(_e_loopVar);
                  tmp8--;
                }
                if (tmp8 == 0) {
                  tmpMeta7 = mmc_mk_box2(5, &NFSubscript_INDEX__desc, _e);
                  __omcQ_24tmpVar2 = tmpMeta7;
                  *tmp5 = mmc_mk_cons(__omcQ_24tmpVar2,0);
                  tmp5 = &MMC_CDR(*tmp5);
                } else if (tmp8 == 1) {
                  break;
                } else {
                  MMC_THROW_INTERNAL();
                }
              }
              *tmp5 = mmc_mk_nil();
              tmpMeta4 = __omcQ_24tmpVar3;
            }
            __omcQ_24tmpVar4 = tmpMeta4;
            *tmp2 = mmc_mk_cons(__omcQ_24tmpVar4,0);
            tmp2 = &MMC_CDR(*tmp2);
          } else if (tmp9 == 1) {
            break;
          } else {
            MMC_THROW_INTERNAL();
          }
        }
        *tmp2 = mmc_mk_nil();
        tmpMeta1 = __omcQ_24tmpVar5;
      }
      _subs = tmpMeta1;

      tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
      _outExp = omc_NFExpandExp_expandGeneric2(threadData, _subs, _exp, _ty, tmpMeta10);
    }
    else
    {
      _outExp = _exp;
    }
  }
  else
  {
    _outExp = _exp;

    _expanded = 1 /* true */;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandGeneric(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _resize, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  tmp1 = mmc_unbox_integer(_resize);
  _outExp = omc_NFExpandExp_expandGeneric(threadData, _exp, tmp1, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandCast(threadData_t *threadData, modelica_metatype _castExp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp has no default value.
  // _ty has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _castExp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,23,2) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  _ty = tmpMeta2;
  _exp = tmpMeta3;

  _outExp = omc_NFExpandExp_expand(threadData, _exp, 0 /* false */ ,&_expanded);

  if((_expanded && (!referenceEq(_exp, _outExp))))
  {
    _outExp = omc_NFExpression_typeCast(threadData, _outExp, _ty);
  }
  else
  {
    _outExp = _castExp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandCast(threadData_t *threadData, modelica_metatype _castExp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandCast(threadData, _castExp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_makeLogicalUnaryOp(threadData_t *threadData, modelica_metatype _exp1, modelica_metatype _op)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = mmc_mk_box3(22, &NFExpression_LUNARY__desc, _op, _exp1);
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

static modelica_metatype closure0_NFExpandExp_makeLogicalUnaryOp(threadData_t *thData, modelica_metatype closure, modelica_metatype exp1)
{
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpandExp_makeLogicalUnaryOp(thData, exp1, op);
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandLogicalUnary(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _operand = NULL;
  modelica_metatype _op = NULL;
  modelica_metatype _scalar_op = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _operand has no default value.
  // _op has no default value.
  // _scalar_op has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,19,2) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  _op = tmpMeta2;
  _operand = tmpMeta3;

  _operand = omc_NFExpandExp_expand(threadData, _operand, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    _scalar_op = omc_NFOperator_scalarize(threadData, _op);

    tmpMeta4 = mmc_mk_box1(0, _scalar_op);
    _outExp = omc_NFExpression_mapArrayElements(threadData, _operand, (modelica_fnptr) mmc_mk_box2(0,closure0_NFExpandExp_makeLogicalUnaryOp,tmpMeta4));
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandLogicalUnary(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandLogicalUnary(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_makeLBinaryOp(threadData_t *threadData, modelica_metatype _exp1, modelica_metatype _op, modelica_metatype _exp2)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  if((omc_NFExpression_isScalarLiteral(threadData, _exp1) && omc_NFExpression_isScalarLiteral(threadData, _exp2)))
  {
    _exp = omc_NFCeval_evalLogicBinaryOp(threadData, _exp1, _op, _exp2, _OMC_LIT3);
  }
  else
  {
    tmpMeta1 = mmc_mk_box4(21, &NFExpression_LBINARY__desc, _exp1, _op, _exp2);
    _exp = tmpMeta1;
  }
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandLogicalBinary(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype _op = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  // _op has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,18,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _op = tmpMeta3;
  _exp2 = tmpMeta4;

  if(omc_NFType_isArray(threadData, omc_NFOperator_typeOf(threadData, _op)))
  {
    _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

    if(_expanded)
    {
      _exp2 = omc_NFExpandExp_expand(threadData, _exp2, 0 /* false */ ,&_expanded);
    }

    if(_expanded)
    {
      _outExp = omc_NFExpandExp_expandBinaryElementWise2(threadData, _exp1, _op, _exp2, boxvar_NFExpandExp_makeLBinaryOp);
    }
    else
    {
      _outExp = _exp;
    }
  }
  else
  {
    _outExp = _exp;

    _expanded = 1 /* true */;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandLogicalBinary(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandLogicalBinary(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

static modelica_metatype closure1_NFSimplifyExp_simplifyUnaryOp(threadData_t *thData, modelica_metatype closure, modelica_metatype exp)
{
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFSimplifyExp_simplifyUnaryOp(thData, exp, op);
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandUnary(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _operand = NULL;
  modelica_metatype _op = NULL;
  modelica_metatype _scalar_op = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _operand has no default value.
  // _op has no default value.
  // _scalar_op has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,17,2) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  _op = tmpMeta2;
  _operand = tmpMeta3;

  _operand = omc_NFExpandExp_expand(threadData, _operand, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    _scalar_op = omc_NFOperator_scalarize(threadData, _op);

    tmpMeta4 = mmc_mk_box1(0, _scalar_op);
    _outExp = omc_NFExpression_mapArrayElements(threadData, _operand, (modelica_fnptr) mmc_mk_box2(0,closure1_NFSimplifyExp_simplifyUnaryOp,tmpMeta4));
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandUnary(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandUnary(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryPowMatrix2(threadData_t *threadData, modelica_metatype _matrix, modelica_integer _n)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  { /* match expression */
    modelica_integer tmp4_1;
    tmp4_1 = _n;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 4; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (1 != tmp4_1) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta1 = _matrix;
          goto tmp3_done;
        }
        case 1: {
          if (2 != tmp4_1) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NFExpandExp_makeBinaryMatrixProduct(threadData, _matrix, _matrix);
          goto tmp3_done;
        }
        case 2: {
          modelica_integer tmp6;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(modelica_integer_mod(_n, ((modelica_integer) 2)) == ((modelica_integer) 0))) goto tmp3_end;
          tmp6 = ((modelica_integer) 2);
          if (tmp6 == 0) {goto goto_2;}
          _exp = omc_NFExpandExp_expandBinaryPowMatrix2(threadData, _matrix, modelica_div_integer(_n,tmp6).quot);
          tmpMeta1 = omc_NFExpandExp_makeBinaryMatrixProduct(threadData, _exp, _exp);
          goto tmp3_done;
        }
        case 3: {
          
          /* Pattern matching succeeded */
          _exp = omc_NFExpandExp_expandBinaryPowMatrix2(threadData, _matrix, ((modelica_integer) -1) + _n);
          tmpMeta1 = omc_NFExpandExp_makeBinaryMatrixProduct(threadData, _matrix, _exp);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryPowMatrix2(threadData_t *threadData, modelica_metatype _matrix, modelica_metatype _n)
{
  modelica_integer tmp1;
  modelica_metatype _exp = NULL;
  tmp1 = mmc_unbox_integer(_n);
  _exp = omc_NFExpandExp_expandBinaryPowMatrix2(threadData, _matrix, tmp1);
  /* skip box _exp; NFExpression */
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryPowMatrix(threadData_t *threadData, modelica_metatype _exp, modelica_boolean _resize, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype _op = NULL;
  modelica_integer _n;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_boolean tmp5_c1 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  // _op has no default value.
  // _n has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _op = tmpMeta3;
  _exp2 = tmpMeta4;

  
  
  { /* match expression */
    modelica_metatype tmp8_1;
    tmp8_1 = _exp2;
    {
      volatile mmc_switch_type tmp8;
      int tmp9;
      tmp8 = 0;
      for (; tmp8 < 3; tmp8++) {
        switch (MMC_SWITCH_CAST(tmp8)) {
        case 0: {
          modelica_metatype tmpMeta10;
          modelica_integer tmp11;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_1,0,1) == 0) goto tmp7_end;
          tmpMeta10 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp8_1), 2));
          tmp11 = mmc_unbox_integer(tmpMeta10);
          if (0 != tmp11) goto tmp7_end;
          /* Pattern matching succeeded */
          _n = omc_NFDimension_size(threadData, listHead(omc_NFType_arrayDims(threadData, omc_NFOperator_typeOf(threadData, _op))), 0 /* false */);
          tmpMeta[0+0] = omc_NFExpression_makeIdentityMatrix(threadData, _n, _OMC_LIT4);
          tmp5_c1 = 1 /* true */;
          goto tmp7_done;
        }
        case 1: {
          modelica_metatype tmpMeta12;
          modelica_integer tmp13;
          if (mmc__uniontype__metarecord__typedef__equal(tmp8_1,0,1) == 0) goto tmp7_end;
          tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp8_1), 2));
          tmp13 = mmc_unbox_integer(tmpMeta12);
          _n = tmp13  /* pattern as ty=Integer */;
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(_n > ((modelica_integer) 0))) goto tmp7_end;
          _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

          if(_expanded)
          {
            _outExp = omc_NFExpandExp_expandBinaryPowMatrix2(threadData, _exp1, _n);
          }
          tmpMeta[0+0] = _outExp;
          tmp5_c1 = _expanded;
          goto tmp7_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandGeneric(threadData, _exp, _resize, &tmp5_c1);
          goto tmp7_done;
        }
        }
        goto tmp7_end;
        tmp7_end: ;
      }
      goto goto_6;
      goto_6:;
      MMC_THROW_INTERNAL();
      goto tmp7_done;
      tmp7_done:;
    }
  }
  _outExp = tmpMeta[0+0];
  _expanded = tmp5_c1;
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryPowMatrix(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _resize, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  tmp1 = mmc_unbox_integer(_resize);
  _outExp = omc_NFExpandExp_expandBinaryPowMatrix(threadData, _exp, tmp1, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

static modelica_metatype closure2_NFExpandExp_makeScalarProduct(threadData_t *thData, modelica_metatype closure, modelica_metatype exp2)
{
  modelica_metatype exp1 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpandExp_makeScalarProduct(thData, exp1, exp2);
}
DLLDirection
modelica_metatype omc_NFExpandExp_makeBinaryMatrixProduct2(threadData_t *threadData, modelica_metatype _row, modelica_metatype _matrix)
{
  modelica_metatype _outRow = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outRow has no default value.
  tmpMeta1 = mmc_mk_box1(0, _row);
  _outRow = omc_Array_map(threadData, _matrix, (modelica_fnptr) mmc_mk_box2(0,closure2_NFExpandExp_makeScalarProduct,tmpMeta1));
  _return: OMC_LABEL_UNUSED
  return _outRow;
}

DLLDirection
modelica_metatype omc_NFExpandExp_makeBinaryMatrixProduct(threadData_t *threadData, modelica_metatype _exp1, modelica_metatype _exp2)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _arr1 = NULL;
  modelica_metatype _arr2 = NULL;
  modelica_metatype _arr = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _row_ty = NULL;
  modelica_metatype _mat_ty = NULL;
  modelica_metatype _n = NULL;
  modelica_metatype _p = NULL;
  modelica_integer _len;
  modelica_metatype _e = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  modelica_metatype tmpMeta16;
  modelica_metatype tmpMeta17;
  modelica_metatype tmpMeta18;
  modelica_metatype tmpMeta19;
  modelica_metatype tmpMeta20;
  modelica_metatype tmpMeta21;
  modelica_integer tmp22;
  modelica_integer tmp23;
  modelica_integer tmp24;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  // _arr1 has no default value.
  // _arr2 has no default value.
  // _arr has no default value.
  // _ty has no default value.
  // _row_ty has no default value.
  // _mat_ty has no default value.
  // _n has no default value.
  // _p has no default value.
  // _len has no default value.
  // _e has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp1;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,8,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta2,7,2) == 0) MMC_THROW_INTERNAL();
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 2));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta2), 3));
  if (listEmpty(tmpMeta4)) MMC_THROW_INTERNAL();
  tmpMeta5 = MMC_CAR(tmpMeta4);
  tmpMeta6 = MMC_CDR(tmpMeta4);
  if (listEmpty(tmpMeta6)) MMC_THROW_INTERNAL();
  tmpMeta7 = MMC_CAR(tmpMeta6);
  tmpMeta8 = MMC_CDR(tmpMeta6);
  if (!listEmpty(tmpMeta8)) MMC_THROW_INTERNAL();
  tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  _ty = tmpMeta3;
  _n = tmpMeta5;
  _arr1 = tmpMeta9;

  /* Pattern-matching assignment */
  tmpMeta10 = omc_NFExpression_transposeArray(threadData, _exp2);
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta10,8,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta10), 2));
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta11,7,2) == 0) MMC_THROW_INTERNAL();
  tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta11), 3));
  if (listEmpty(tmpMeta12)) MMC_THROW_INTERNAL();
  tmpMeta13 = MMC_CAR(tmpMeta12);
  tmpMeta14 = MMC_CDR(tmpMeta12);
  if (listEmpty(tmpMeta14)) MMC_THROW_INTERNAL();
  tmpMeta15 = MMC_CAR(tmpMeta14);
  tmpMeta16 = MMC_CDR(tmpMeta14);
  if (!listEmpty(tmpMeta16)) MMC_THROW_INTERNAL();
  tmpMeta17 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta10), 3));
  _p = tmpMeta13;
  _arr2 = tmpMeta17;

  tmpMeta18 = mmc_mk_cons(_n, mmc_mk_cons(_p, MMC_REFSTRUCTLIT(mmc_nil)));
  tmpMeta19 = mmc_mk_box3(10, &NFType_ARRAY__desc, _ty, tmpMeta18);
  _mat_ty = tmpMeta19;

  if((arrayLength(_arr2) == ((modelica_integer) 0)))
  {
    _exp = omc_NFExpression_makeZero(threadData, _mat_ty);
  }
  else
  {
    tmpMeta20 = mmc_mk_cons(_p, MMC_REFSTRUCTLIT(mmc_nil));
    tmpMeta21 = mmc_mk_box3(10, &NFType_ARRAY__desc, _ty, tmpMeta20);
    _row_ty = tmpMeta21;

    _len = arrayLength(_arr1);

    _arr = arrayCreateNoInit(_len, _exp1);

    tmp22 = ((modelica_integer) 1); tmp23 = 1; tmp24 = _len;
    if(!(((tmp23 > 0) && (tmp22 > tmp24)) || ((tmp23 < 0) && (tmp22 < tmp24))))
    {
      modelica_integer _i;
      for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp22, tmp24); _i += tmp23)
      {
        _e = arrayGetNoBoundsChecking(_arr1, _i);

        arrayUpdateNoBoundsChecking(_arr, _i, omc_NFExpression_makeArray(threadData, _row_ty, omc_NFExpandExp_makeBinaryMatrixProduct2(threadData, _e, _arr2), 0 /* false */));
      }
    }

    _exp = omc_NFExpression_makeArray(threadData, _mat_ty, _arr, 0 /* false */);
  }
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryMatrixProduct(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _exp2 = tmpMeta3;

  _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    _exp2 = omc_NFExpandExp_expand(threadData, _exp2, 0 /* false */ ,&_expanded);
  }

  if(_expanded)
  {
    _outExp = omc_NFExpandExp_makeBinaryMatrixProduct(threadData, _exp1, _exp2);
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryMatrixProduct(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBinaryMatrixProduct(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

static modelica_metatype closure3_NFSimplifyExp_simplifyBinaryOp(threadData_t *thData, modelica_metatype closure, modelica_metatype exp1, modelica_metatype exp2)
{
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFSimplifyExp_simplifyBinaryOp(thData, exp1, op, exp2);
}static modelica_metatype closure4_NFSimplifyExp_simplifyBinaryOp(threadData_t *thData, modelica_metatype closure, modelica_metatype exp1, modelica_metatype exp2)
{
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFSimplifyExp_simplifyBinaryOp(thData, exp1, op, exp2);
}
DLLDirection
modelica_metatype omc_NFExpandExp_makeScalarProduct(threadData_t *threadData, modelica_metatype _exp1, modelica_metatype _exp2)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _arr1 = NULL;
  modelica_metatype _arr2 = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _elem_ty = NULL;
  modelica_metatype _mul_op = NULL;
  modelica_metatype _add_op = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  // _arr1 has no default value.
  // _arr2 has no default value.
  // _ty has no default value.
  // _elem_ty has no default value.
  // _mul_op has no default value.
  // _add_op has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp1;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,8,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  _ty = tmpMeta2;
  _arr1 = tmpMeta3;

  /* Pattern-matching assignment */
  tmpMeta4 = _exp2;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta4,8,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 3));
  _arr2 = tmpMeta5;

  _elem_ty = omc_NFType_unliftArray(threadData, _ty);

  if((arrayLength(_arr1) == ((modelica_integer) 0)))
  {
    _exp = omc_NFExpression_makeZero(threadData, _elem_ty);
  }
  else
  {
    _mul_op = omc_NFOperator_makeMul(threadData, _elem_ty);

    _add_op = omc_NFOperator_makeAdd(threadData, _elem_ty);

    tmpMeta6 = mmc_mk_box1(0, _mul_op);
    _arr1 = omc_Array_threadMap(threadData, _arr1, _arr2, (modelica_fnptr) mmc_mk_box2(0,closure3_NFSimplifyExp_simplifyBinaryOp,tmpMeta6));

    tmpMeta7 = mmc_mk_box1(0, _add_op);
    _exp = omc_Array_reduce(threadData, _arr1, (modelica_fnptr) mmc_mk_box2(0,closure4_NFSimplifyExp_simplifyBinaryOp,tmpMeta7));
  }
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryDotProduct(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _exp2 = tmpMeta3;

  _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    _exp2 = omc_NFExpandExp_expand(threadData, _exp2, 0 /* false */ ,&_expanded);
  }

  if(_expanded)
  {
    _outExp = omc_NFExpandExp_makeScalarProduct(threadData, _exp1, _exp2);
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryDotProduct(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBinaryDotProduct(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

static modelica_metatype closure5_NFExpandExp_makeScalarProduct(threadData_t *thData, modelica_metatype closure, modelica_metatype exp1)
{
  modelica_metatype exp2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpandExp_makeScalarProduct(thData, exp1, exp2);
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryMatrixVector(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype _arr = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _n = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  // _arr has no default value.
  // _ty has no default value.
  // _n has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _exp2 = tmpMeta3;

  _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    /* Pattern-matching assignment */
    tmpMeta4 = _exp1;
    if (mmc__uniontype__metarecord__typedef__equal(tmpMeta4,8,3) == 0) MMC_THROW_INTERNAL();
    tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 2));
    if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,7,2) == 0) MMC_THROW_INTERNAL();
    tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 2));
    tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 3));
    if (listEmpty(tmpMeta7)) MMC_THROW_INTERNAL();
    tmpMeta8 = MMC_CAR(tmpMeta7);
    tmpMeta9 = MMC_CDR(tmpMeta7);
    if (listEmpty(tmpMeta9)) MMC_THROW_INTERNAL();
    tmpMeta10 = MMC_CAR(tmpMeta9);
    tmpMeta11 = MMC_CDR(tmpMeta9);
    if (!listEmpty(tmpMeta11)) MMC_THROW_INTERNAL();
    tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 3));
    _ty = tmpMeta6;
    _n = tmpMeta8;
    _arr = tmpMeta12;

    tmpMeta13 = mmc_mk_cons(_n, MMC_REFSTRUCTLIT(mmc_nil));
    tmpMeta14 = mmc_mk_box3(10, &NFType_ARRAY__desc, _ty, tmpMeta13);
    _ty = tmpMeta14;

    if((arrayLength(_arr) == ((modelica_integer) 0)))
    {
      _outExp = omc_NFExpression_makeZero(threadData, _ty);
    }
    else
    {
      _exp2 = omc_NFExpandExp_expand(threadData, _exp2, 0 /* false */ ,&_expanded);

      if(_expanded)
      {
        tmpMeta15 = mmc_mk_box1(0, _exp2);
        _arr = omc_Array_map(threadData, _arr, (modelica_fnptr) mmc_mk_box2(0,closure5_NFExpandExp_makeScalarProduct,tmpMeta15));

        _outExp = omc_NFExpression_makeArray(threadData, _ty, _arr, 0 /* false */);
      }
      else
      {
        _outExp = _exp;
      }
    }
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryMatrixVector(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBinaryMatrixVector(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

static modelica_metatype closure6_NFExpandExp_makeScalarProduct(threadData_t *thData, modelica_metatype closure, modelica_metatype exp2)
{
  modelica_metatype exp1 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  return boxptr_NFExpandExp_makeScalarProduct(thData, exp1, exp2);
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryVectorMatrix(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype _arr = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _m = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  modelica_metatype tmpMeta14;
  modelica_metatype tmpMeta15;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  // _arr has no default value.
  // _ty has no default value.
  // _m has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _exp2 = tmpMeta3;

  _exp2 = omc_NFExpandExp_expand(threadData, _exp2, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    /* Pattern-matching assignment */
    tmpMeta4 = omc_NFExpression_transposeArray(threadData, _exp2);
    if (mmc__uniontype__metarecord__typedef__equal(tmpMeta4,8,3) == 0) MMC_THROW_INTERNAL();
    tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 2));
    if (mmc__uniontype__metarecord__typedef__equal(tmpMeta5,7,2) == 0) MMC_THROW_INTERNAL();
    tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 2));
    tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta5), 3));
    if (listEmpty(tmpMeta7)) MMC_THROW_INTERNAL();
    tmpMeta8 = MMC_CAR(tmpMeta7);
    tmpMeta9 = MMC_CDR(tmpMeta7);
    if (listEmpty(tmpMeta9)) MMC_THROW_INTERNAL();
    tmpMeta10 = MMC_CAR(tmpMeta9);
    tmpMeta11 = MMC_CDR(tmpMeta9);
    if (!listEmpty(tmpMeta11)) MMC_THROW_INTERNAL();
    tmpMeta12 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 3));
    _ty = tmpMeta6;
    _m = tmpMeta8;
    _arr = tmpMeta12;

    tmpMeta13 = mmc_mk_cons(_m, MMC_REFSTRUCTLIT(mmc_nil));
    tmpMeta14 = mmc_mk_box3(10, &NFType_ARRAY__desc, _ty, tmpMeta13);
    _ty = tmpMeta14;

    if((arrayLength(_arr) == ((modelica_integer) 0)))
    {
      _outExp = omc_NFExpression_makeZero(threadData, _ty);
    }
    else
    {
      _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

      if(_expanded)
      {
        tmpMeta15 = mmc_mk_box1(0, _exp1);
        _arr = omc_Array_map(threadData, _arr, (modelica_fnptr) mmc_mk_box2(0,closure6_NFExpandExp_makeScalarProduct,tmpMeta15));

        _outExp = omc_NFExpression_makeArray(threadData, _ty, _arr, 0 /* false */);
      }
      else
      {
        _outExp = _exp;
      }
    }
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryVectorMatrix(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBinaryVectorMatrix(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

static modelica_metatype closure7_NFSimplifyExp_simplifyBinaryOp(threadData_t *thData, modelica_metatype closure, modelica_metatype exp1)
{
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype exp2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFSimplifyExp_simplifyBinaryOp(thData, exp1, op, exp2);
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryArrayScalar(threadData_t *threadData, modelica_metatype _exp, modelica_integer _scalarOp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype _op = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  // _op has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _op = tmpMeta3;
  _exp2 = tmpMeta4;

  _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    tmpMeta5 = mmc_mk_box3(3, &NFOperator_OPERATOR__desc, omc_NFType_arrayElementType(threadData, omc_NFOperator_typeOf(threadData, _op)), mmc_mk_integer((modelica_integer)_scalarOp));
    _op = tmpMeta5;

    tmpMeta6 = mmc_mk_box2(0, _op, _exp2);
    _outExp = omc_NFExpression_mapArrayElements(threadData, _exp1, (modelica_fnptr) mmc_mk_box2(0,closure7_NFSimplifyExp_simplifyBinaryOp,tmpMeta6));
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryArrayScalar(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _scalarOp, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  tmp1 = mmc_unbox_integer(_scalarOp);
  _outExp = omc_NFExpandExp_expandBinaryArrayScalar(threadData, _exp, tmp1, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_makeScalarArrayBinary__traverser(threadData_t *threadData, modelica_metatype _exp1, modelica_metatype _op, modelica_metatype _exp2)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp2;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp2;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NFSimplifyExp_simplifyBinaryOp(threadData, _exp1, _op, _exp2);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}

static modelica_metatype closure8_NFSimplifyExp_simplifyBinaryOp(threadData_t *thData, modelica_metatype closure, modelica_metatype exp2)
{
  modelica_metatype exp1 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFSimplifyExp_simplifyBinaryOp(thData, exp1, op, exp2);
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryScalarArray(threadData_t *threadData, modelica_metatype _exp, modelica_integer _scalarOp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype _op = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  // _op has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _op = tmpMeta3;
  _exp2 = tmpMeta4;

  _exp2 = omc_NFExpandExp_expand(threadData, _exp2, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    tmpMeta5 = mmc_mk_box3(3, &NFOperator_OPERATOR__desc, omc_NFType_arrayElementType(threadData, omc_NFOperator_typeOf(threadData, _op)), mmc_mk_integer((modelica_integer)_scalarOp));
    _op = tmpMeta5;

    tmpMeta6 = mmc_mk_box2(0, _exp1, _op);
    _outExp = omc_NFExpression_mapArrayElements(threadData, _exp2, (modelica_fnptr) mmc_mk_box2(0,closure8_NFSimplifyExp_simplifyBinaryOp,tmpMeta6));
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryScalarArray(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _scalarOp, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  tmp1 = mmc_unbox_integer(_scalarOp);
  _outExp = omc_NFExpandExp_expandBinaryScalarArray(threadData, _exp, tmp1, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

static modelica_metatype closure9_NFExpandExp_expandBinaryElementWise2(threadData_t *thData, modelica_metatype closure, modelica_metatype exp1, modelica_metatype exp2)
{
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_fnptr func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  return boxptr_NFExpandExp_expandBinaryElementWise2(thData, exp1, op, exp2, func);
}static modelica_metatype closure10_func(threadData_t *thData, modelica_metatype closure, modelica_metatype exp1, modelica_metatype exp2)
{
  modelica_metatype op = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_fnptr _func = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  if (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func),2))) {
    return  ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (thData, MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func),2)), exp1, op, exp2);
  } else { /* No closure in the called variable */
    return  ((modelica_metatype(*)(threadData_t*, modelica_metatype, modelica_metatype, modelica_metatype)) (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_func), 1)))) (thData, exp1, op, exp2);
  }
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryElementWise2(threadData_t *threadData, modelica_metatype _exp1, modelica_metatype _op, modelica_metatype _exp2, modelica_fnptr _func)
{
  modelica_metatype _exp = NULL;
  modelica_metatype _expl1 = NULL;
  modelica_metatype _expl2 = NULL;
  modelica_metatype _expl = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype _eop = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  // _expl1 has no default value.
  // _expl2 has no default value.
  // _expl has no default value.
  // _ty has no default value.
  // _eop has no default value.
  _expl1 = omc_NFExpression_arrayElements(threadData, _exp1);

  _expl2 = omc_NFExpression_arrayElements(threadData, _exp2);

  _ty = omc_NFOperator_typeOf(threadData, _op);

  _eop = omc_NFOperator_setType(threadData, omc_NFType_unliftArray(threadData, _ty), _op);

  if((omc_NFType_dimensionCount(threadData, _ty) > ((modelica_integer) 1)))
  {
    tmpMeta1 = mmc_mk_box2(0, _eop, ((modelica_fnptr) _func));
    _expl = omc_Array_threadMap(threadData, _expl1, _expl2, (modelica_fnptr) mmc_mk_box2(0,closure9_NFExpandExp_expandBinaryElementWise2,tmpMeta1));
  }
  else
  {
    tmpMeta2 = mmc_mk_box2(0, _eop, _func);
    _expl = omc_Array_threadMap(threadData, _expl1, _expl2, (modelica_fnptr) mmc_mk_box2(0,closure10_func,tmpMeta2));
  }

  _exp = omc_NFExpression_makeArray(threadData, _ty, _expl, 0 /* false */);
  _return: OMC_LABEL_UNUSED
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBinaryElementWise(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _exp1 = NULL;
  modelica_metatype _exp2 = NULL;
  modelica_metatype _op = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _exp1 has no default value.
  // _exp2 has no default value.
  // _op has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,16,3) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  _exp1 = tmpMeta2;
  _op = tmpMeta3;
  _exp2 = tmpMeta4;

  if(omc_NFType_isArray(threadData, omc_NFOperator_typeOf(threadData, _op)))
  {
    _exp1 = omc_NFExpandExp_expand(threadData, _exp1, 0 /* false */ ,&_expanded);

    if(_expanded)
    {
      _exp2 = omc_NFExpandExp_expand(threadData, _exp2, 0 /* false */ ,&_expanded);
    }

    if(_expanded)
    {
      _outExp = omc_NFExpandExp_expandBinaryElementWise2(threadData, _exp1, _op, _exp2, boxvar_NFSimplifyExp_simplifyBinaryOp);
    }
    else
    {
      _outExp = _exp;
    }
  }
  else
  {
    _outExp = _exp;

    _expanded = 1 /* true */;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinaryElementWise(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBinaryElementWise(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBinary(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _op, modelica_boolean _resize, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  
  
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_op), 3)));
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 16; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_integer tmp6;
          tmp6 = mmc_unbox_integer(tmp4_1);
          if (11 != tmp6) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryScalarArray(threadData, _exp, 1, &tmp1_c1);
          goto tmp3_done;
        }
        case 1: {
          modelica_integer tmp7;
          tmp7 = mmc_unbox_integer(tmp4_1);
          if (12 != tmp7) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryArrayScalar(threadData, _exp, 1, &tmp1_c1);
          goto tmp3_done;
        }
        case 2: {
          modelica_integer tmp8;
          tmp8 = mmc_unbox_integer(tmp4_1);
          if (13 != tmp8) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryScalarArray(threadData, _exp, 2, &tmp1_c1);
          goto tmp3_done;
        }
        case 3: {
          modelica_integer tmp9;
          tmp9 = mmc_unbox_integer(tmp4_1);
          if (14 != tmp9) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryArrayScalar(threadData, _exp, 2, &tmp1_c1);
          goto tmp3_done;
        }
        case 4: {
          modelica_integer tmp10;
          tmp10 = mmc_unbox_integer(tmp4_1);
          if (15 != tmp10) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryScalarArray(threadData, _exp, 3, &tmp1_c1);
          goto tmp3_done;
        }
        case 5: {
          modelica_integer tmp11;
          tmp11 = mmc_unbox_integer(tmp4_1);
          if (16 != tmp11) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryArrayScalar(threadData, _exp, 3, &tmp1_c1);
          goto tmp3_done;
        }
        case 6: {
          modelica_integer tmp12;
          tmp12 = mmc_unbox_integer(tmp4_1);
          if (17 != tmp12) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryVectorMatrix(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 7: {
          modelica_integer tmp13;
          tmp13 = mmc_unbox_integer(tmp4_1);
          if (18 != tmp13) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryMatrixVector(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 8: {
          modelica_integer tmp14;
          tmp14 = mmc_unbox_integer(tmp4_1);
          if (19 != tmp14) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryDotProduct(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 9: {
          modelica_integer tmp15;
          tmp15 = mmc_unbox_integer(tmp4_1);
          if (20 != tmp15) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryMatrixProduct(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 10: {
          modelica_integer tmp16;
          tmp16 = mmc_unbox_integer(tmp4_1);
          if (21 != tmp16) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryScalarArray(threadData, _exp, 4, &tmp1_c1);
          goto tmp3_done;
        }
        case 11: {
          modelica_integer tmp17;
          tmp17 = mmc_unbox_integer(tmp4_1);
          if (22 != tmp17) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryArrayScalar(threadData, _exp, 4, &tmp1_c1);
          goto tmp3_done;
        }
        case 12: {
          modelica_integer tmp18;
          tmp18 = mmc_unbox_integer(tmp4_1);
          if (23 != tmp18) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryScalarArray(threadData, _exp, 5, &tmp1_c1);
          goto tmp3_done;
        }
        case 13: {
          modelica_integer tmp19;
          tmp19 = mmc_unbox_integer(tmp4_1);
          if (24 != tmp19) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryArrayScalar(threadData, _exp, 5, &tmp1_c1);
          goto tmp3_done;
        }
        case 14: {
          modelica_integer tmp20;
          tmp20 = mmc_unbox_integer(tmp4_1);
          if (25 != tmp20) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryPowMatrix(threadData, _exp, _resize, &tmp1_c1);
          goto tmp3_done;
        }
        case 15: {
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinaryElementWise(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outExp = tmpMeta[0+0];
  _expanded = tmp1_c1;

  if((!_expanded))
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBinary(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _op, modelica_metatype _resize, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  tmp1 = mmc_unbox_integer(_resize);
  _outExp = omc_NFExpandExp_expandBinary(threadData, _exp, _op, tmp1, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandSize(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  _expanded = 1 /* true */;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      modelica_integer _dims;
      modelica_metatype _e = NULL;
      modelica_metatype _ty = NULL;
      modelica_metatype _expl = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _dims has no default value.
      // _e has no default value.
      // _ty has no default value.
      // _expl has no default value.
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta16;
          modelica_metatype tmpMeta17;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,14,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (!optionNone(tmpMeta7)) goto tmp3_end;
          _e = tmpMeta6;
          /* Pattern matching succeeded */
          _ty = omc_NFExpression_typeOf(threadData, _e);

          _dims = omc_NFType_dimensionCount(threadData, _ty);

          {
            modelica_metatype __omcQ_24tmpVar7;
            modelica_metatype* tmp9;
            modelica_metatype tmpMeta10;
            modelica_metatype tmpMeta11;
            modelica_metatype tmpMeta12;
            modelica_metatype __omcQ_24tmpVar6;
            modelica_integer tmp13;
            modelica_integer tmp14;
            modelica_integer tmp15;
            modelica_integer _i;
            tmp14 = 1 /* Range step-value */;
            tmp15 = _dims /* Range stop-value */;
            _i = ((modelica_integer) 1) /* Range start-value */;
            _i = (((modelica_integer) 1) /* Range start-value */)-tmp14;
            tmpMeta10 = MMC_REFSTRUCTLIT(mmc_nil);
            __omcQ_24tmpVar7 = tmpMeta10; /* defaultValue */
            tmp9 = &__omcQ_24tmpVar7;
            while(1) {
              tmp13 = 1;
              if (tmp14 > 0 ? _i+tmp14 <= tmp15 : _i+tmp14 >= tmp15) {
                _i += tmp14;
                tmp13--;
              }
              if (tmp13 == 0) {
                tmpMeta11 = mmc_mk_box2(3, &NFExpression_INTEGER__desc, mmc_mk_integer(_i));
                tmpMeta12 = mmc_mk_box3(17, &NFExpression_SIZE__desc, _e, mmc_mk_some(tmpMeta11));
                __omcQ_24tmpVar6 = tmpMeta12;
                *tmp9 = mmc_mk_cons(__omcQ_24tmpVar6,0);
                tmp9 = &MMC_CDR(*tmp9);
              } else if (tmp13 == 1) {
                break;
              } else {
                goto goto_2;
              }
            }
            *tmp9 = mmc_mk_nil();
            tmpMeta8 = __omcQ_24tmpVar7;
          }
          _expl = tmpMeta8;
          tmpMeta16 = mmc_mk_cons(omc_NFDimension_fromInteger(threadData, _dims, 1), MMC_REFSTRUCTLIT(mmc_nil));
          tmpMeta17 = mmc_mk_box3(10, &NFType_ARRAY__desc, _ty, tmpMeta16);
          tmpMeta1 = omc_NFExpression_makeArray(threadData, tmpMeta17, listArray(_expl), 0 /* false */);
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outExp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandSize(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandSize(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandArrayConstructor2(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _ty, modelica_metatype _ranges, modelica_metatype _iterators)
{
  modelica_metatype _result = NULL;
  modelica_metatype _range = NULL;
  modelica_metatype _ranges_rest = NULL;
  modelica_metatype _expl = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _iter = NULL;
  modelica_metatype _iters_rest = NULL;
  modelica_metatype _range_iter = NULL;
  modelica_metatype _value = NULL;
  modelica_metatype _el_ty = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _result has no default value.
  // _range has no default value.
  // _ranges_rest has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _expl = tmpMeta1;
  // _iter has no default value.
  // _iters_rest has no default value.
  // _range_iter has no default value.
  // _value has no default value.
  // _el_ty has no default value.
  if(listEmpty(_ranges))
  {
    _result = omc_NFExpandExp_expand(threadData, omc_NFSimplifyExp_simplify(threadData, _exp, 0 /* false */), 0 /* false */, NULL);
  }
  else
  {
    /* Pattern-matching assignment */
    tmpMeta2 = _ranges;
    if (listEmpty(tmpMeta2)) MMC_THROW_INTERNAL();
    tmpMeta3 = MMC_CAR(tmpMeta2);
    tmpMeta4 = MMC_CDR(tmpMeta2);
    _range = tmpMeta3;
    _ranges_rest = tmpMeta4;

    /* Pattern-matching assignment */
    tmpMeta5 = _iterators;
    if (listEmpty(tmpMeta5)) MMC_THROW_INTERNAL();
    tmpMeta6 = MMC_CAR(tmpMeta5);
    tmpMeta7 = MMC_CDR(tmpMeta5);
    _iter = tmpMeta6;
    _iters_rest = tmpMeta7;

    _range_iter = omc_NFExpressionIterator_fromExp(threadData, _range, 0 /* false */);

    _el_ty = omc_NFType_unliftArray(threadData, _ty);

    while(1)
    {
      if(!omc_NFExpressionIterator_hasNext(threadData, _range_iter)) break;
      _range_iter = omc_NFExpressionIterator_next(threadData, _range_iter ,&_value);

      omc_Mutable_update(threadData, _iter, _value);

      tmpMeta8 = mmc_mk_cons(omc_NFExpandExp_expandArrayConstructor2(threadData, _exp, _el_ty, _ranges_rest, _iters_rest), _expl);
      _expl = tmpMeta8;
    }

    _result = omc_NFExpression_makeArray(threadData, _ty, listArray(listReverseInPlace(_expl)), 0 /* false */);
  }
  _return: OMC_LABEL_UNUSED
  return _result;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandArrayConstructor(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _ty, modelica_metatype _iterators, modelica_boolean *out_expanded)
{
  modelica_metatype _result = NULL;
  modelica_boolean _expanded;
  modelica_metatype _e = NULL;
  modelica_metatype _range = NULL;
  modelica_metatype _node = NULL;
  modelica_metatype _ranges = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _iter = NULL;
  modelica_metatype _iters = NULL;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_boolean tmp10;
  modelica_metatype tmpMeta11;
  modelica_metatype tmpMeta12;
  modelica_metatype tmpMeta13;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _result has no default value.
  _expanded = 1 /* true */;
  _e = _exp;
  // _range has no default value.
  // _node has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _ranges = tmpMeta1;
  // _iter has no default value.
  tmpMeta2 = MMC_REFSTRUCTLIT(mmc_nil);
  _iters = tmpMeta2;
  {
    modelica_metatype _i;
    for (tmpMeta3 = _iterators; !listEmpty(tmpMeta3); tmpMeta3=MMC_CDR(tmpMeta3))
    {
      _i = MMC_CAR(tmpMeta3);
      /* Pattern-matching assignment */
      tmpMeta4 = _i;
      tmpMeta5 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 1));
      tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta4), 2));
      _node = tmpMeta5;
      _range = tmpMeta6;

      tmpMeta7 = mmc_mk_box2(33, &NFExpression_EMPTY__desc, omc_NFInstNode_InstNode_getType(threadData, _node));
      _iter = omc_Mutable_create(threadData, tmpMeta7);

      tmpMeta8 = mmc_mk_box2(32, &NFExpression_MUTABLE__desc, _iter);
      _e = omc_NFExpression_replaceIterator(threadData, _e, _node, tmpMeta8);

      tmpMeta9 = mmc_mk_cons(_iter, _iters);
      _iters = tmpMeta9;

      /* Pattern-matching tuple assignment */
      tmpMeta11 = omc_NFExpandExp_expand(threadData, _range, 0 /* false */, &tmp10);
      _range = tmpMeta11;
      if (1 /* true */ != tmp10) MMC_THROW_INTERNAL();

      tmpMeta12 = mmc_mk_cons(_range, _ranges);
      _ranges = tmpMeta12;
    }
  }

  _result = omc_NFExpandExp_expandArrayConstructor2(threadData, _e, _ty, _ranges, _iters);
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _result;
}
modelica_metatype boxptr_NFExpandExp_expandArrayConstructor(threadData_t *threadData, modelica_metatype _exp, modelica_metatype _ty, modelica_metatype _iterators, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _result = NULL;
  _result = omc_NFExpandExp_expandArrayConstructor(threadData, _exp, _ty, _iterators, &_expanded);
  /* skip box _result; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _result;
}

static modelica_metatype closure11_NFExpandExp_expandBuiltinGeneric2(threadData_t *thData, modelica_metatype closure, modelica_metatype $in_exp)
{
  modelica_metatype fn = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
  modelica_metatype ty = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),2));
  modelica_metatype var = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),3));
  modelica_metatype pur = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),4));
  modelica_metatype attr = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),5));
  return boxptr_NFExpandExp_expandBuiltinGeneric2(thData, $in_exp, fn, ty, var, pur, attr);
}
DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinGeneric2(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _fn, modelica_metatype _ty, modelica_integer _var, modelica_integer _pur, modelica_metatype _attr)
{
  modelica_metatype _exp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      modelica_metatype _arr = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _arr has no default value.
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_integer tmp7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,3) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 4));
          tmp7 = mmc_unbox_integer(tmpMeta6);
          if (1 /* true */ != tmp7) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta1 = _exp;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta8 = mmc_mk_box5(0, _fn, _ty, mmc_mk_integer((modelica_integer)_var), mmc_mk_integer((modelica_integer)_pur), _attr);
          _arr = omc_Array_map(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), (modelica_fnptr) mmc_mk_box2(0,closure11_NFExpandExp_expandBuiltinGeneric2,tmpMeta8));
          tmpMeta1 = omc_NFExpression_makeArray(threadData, omc_NFType_setArrayElementType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), _ty), _arr, 0 /* false */);
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          
          /* Pattern matching succeeded */
          tmpMeta9 = mmc_mk_cons(_exp, MMC_REFSTRUCTLIT(mmc_nil));
          tmpMeta10 = mmc_mk_box7(5, &NFCall_TYPED__CALL__desc, _fn, _ty, mmc_mk_integer((modelica_integer)_var), mmc_mk_integer((modelica_integer)_pur), tmpMeta9, _attr);
          tmpMeta11 = mmc_mk_box2(16, &NFExpression_CALL__desc, tmpMeta10);
          tmpMeta1 = tmpMeta11;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _exp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinGeneric2(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _fn, modelica_metatype _ty, modelica_metatype _var, modelica_metatype _pur, modelica_metatype _attr)
{
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_metatype _exp = NULL;
  tmp1 = mmc_unbox_integer(_var);
  tmp2 = mmc_unbox_integer(_pur);
  _exp = omc_NFExpandExp_expandBuiltinGeneric2(threadData, __omcQ_24in_5Fexp, _fn, _ty, tmp1, tmp2, _attr);
  /* skip box _exp; NFExpression */
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinGeneric(threadData_t *threadData, modelica_metatype _call, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _fn = NULL;
  modelica_metatype _ty = NULL;
  modelica_integer _var;
  modelica_integer _pur;
  modelica_metatype _attr = NULL;
  modelica_metatype _arg = NULL;
  modelica_metatype _args = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_integer tmp5;
  modelica_metatype tmpMeta6;
  modelica_integer tmp7;
  modelica_metatype tmpMeta8;
  modelica_metatype tmpMeta9;
  modelica_metatype tmpMeta10;
  modelica_metatype tmpMeta11;
  modelica_boolean tmp12;
  modelica_metatype tmpMeta13;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  _expanded = 1 /* true */;
  // _fn has no default value.
  // _ty has no default value.
  // _var has no default value.
  // _pur has no default value.
  // _attr has no default value.
  // _arg has no default value.
  // _args has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _call;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,2,6) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  tmpMeta3 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 3));
  tmpMeta4 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 4));
  tmp5 = mmc_unbox_integer(tmpMeta4);
  tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 5));
  tmp7 = mmc_unbox_integer(tmpMeta6);
  tmpMeta8 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 6));
  if (listEmpty(tmpMeta8)) MMC_THROW_INTERNAL();
  tmpMeta9 = MMC_CAR(tmpMeta8);
  tmpMeta10 = MMC_CDR(tmpMeta8);
  if (!listEmpty(tmpMeta10)) MMC_THROW_INTERNAL();
  tmpMeta11 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 7));
  _fn = tmpMeta2;
  _ty = tmpMeta3;
  _var = tmp5  /* pattern as ty=enumeration(CONSTANT, STRUCTURAL_PARAMETER, PARAMETER, NON_STRUCTURAL_PARAMETER, DISCRETE, IMPLICITLY_DISCRETE, CONTINUOUS) */;
  _pur = tmp7  /* pattern as ty=enumeration(PURE, IMPURE) */;
  _arg = tmpMeta9;
  _attr = tmpMeta11;

  _ty = omc_NFType_arrayElementType(threadData, _ty);

  /* Pattern-matching tuple assignment */
  tmpMeta13 = omc_NFExpandExp_expand(threadData, _arg, 0 /* false */, &tmp12);
  _arg = tmpMeta13;
  if (1 /* true */ != tmp12) MMC_THROW_INTERNAL();

  _outExp = omc_NFExpandExp_expandBuiltinGeneric2(threadData, _arg, _fn, _ty, (modelica_integer)_var, (modelica_integer)_pur, _attr);
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinGeneric(threadData_t *threadData, modelica_metatype _call, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBuiltinGeneric(threadData, _call, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinTranspose(threadData_t *threadData, modelica_metatype _arg, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  _outExp = omc_NFExpandExp_expand(threadData, _arg, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    _outExp = omc_NFExpression_transposeArray(threadData, _outExp);
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinTranspose(threadData_t *threadData, modelica_metatype _arg, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBuiltinTranspose(threadData, _arg, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinFill(threadData_t *threadData, modelica_metatype _args, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  _expanded = 1 /* true */;
  _outExp = omc_NFExpression_fillArgs(threadData, listHead(_args), listRest(_args));
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinFill(threadData_t *threadData, modelica_metatype _args, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBuiltinFill(threadData, _args, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinDiagonal(threadData_t *threadData, modelica_metatype _arg, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  _outExp = omc_NFExpandExp_expand(threadData, _arg, 0 /* false */ ,&_expanded);

  if(_expanded)
  {
    _outExp = omc_NFCeval_evalBuiltinDiagonal(threadData, _outExp);
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinDiagonal(threadData_t *threadData, modelica_metatype _arg, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandBuiltinDiagonal(threadData, _arg, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinPromote(threadData_t *threadData, modelica_metatype _args, modelica_boolean *out_expanded)
{
  modelica_metatype _exp = NULL;
  modelica_boolean _expanded;
  modelica_integer _n;
  modelica_metatype _eexp = NULL;
  modelica_metatype _nexp = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  modelica_metatype tmpMeta5;
  modelica_metatype tmpMeta6;
  modelica_metatype tmpMeta7;
  modelica_integer tmp8;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  // _expanded has no default value.
  // _n has no default value.
  // _eexp has no default value.
  // _nexp has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _args;
  if (listEmpty(tmpMeta1)) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_CAR(tmpMeta1);
  tmpMeta3 = MMC_CDR(tmpMeta1);
  if (listEmpty(tmpMeta3)) MMC_THROW_INTERNAL();
  tmpMeta4 = MMC_CAR(tmpMeta3);
  tmpMeta5 = MMC_CDR(tmpMeta3);
  if (!listEmpty(tmpMeta5)) MMC_THROW_INTERNAL();
  _eexp = tmpMeta2;
  _nexp = tmpMeta4;

  /* Pattern-matching assignment */
  tmpMeta6 = _nexp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,0,1) == 0) MMC_THROW_INTERNAL();
  tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta6), 2));
  tmp8 = mmc_unbox_integer(tmpMeta7);
  _n = tmp8  /* pattern as ty=Integer */;

  _eexp = omc_NFExpandExp_expand(threadData, _eexp, 0 /* false */ ,&_expanded);

  _exp = omc_NFExpression_promote(threadData, _eexp, omc_NFExpression_typeOf(threadData, _eexp), _n, NULL);
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _exp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinPromote(threadData_t *threadData, modelica_metatype _args, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _exp = NULL;
  _exp = omc_NFExpandExp_expandBuiltinPromote(threadData, _args, &_expanded);
  /* skip box _exp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinCat(threadData_t *threadData, modelica_metatype _args, modelica_metatype _call, modelica_boolean _resize, modelica_boolean *out_expanded)
{
  modelica_metatype _exp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _expl = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _exp has no default value.
  // _expanded has no default value.
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _expl = tmpMeta1;
  _expl = omc_NFExpandExp_expandList(threadData, listRest(_args), 1 /* true */ ,&_expanded);

  if(_expanded)
  {
    _exp = omc_NFCeval_evalBuiltinCat(threadData, listHead(_args), _expl, _OMC_LIT3);
  }
  else
  {
    tmpMeta2 = mmc_mk_box2(16, &NFExpression_CALL__desc, _call);
    _exp = omc_NFExpandExp_expandGeneric(threadData, tmpMeta2, _resize, NULL);
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _exp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinCat(threadData_t *threadData, modelica_metatype _args, modelica_metatype _call, modelica_metatype _resize, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _exp = NULL;
  tmp1 = mmc_unbox_integer(_resize);
  _exp = omc_NFExpandExp_expandBuiltinCat(threadData, _args, _call, tmp1, &_expanded);
  /* skip box _exp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _exp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandBuiltinCall(threadData_t *threadData, modelica_metatype _fn, modelica_metatype _args, modelica_metatype _call, modelica_boolean _resize, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _fn_path = NULL;
  modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  _fn_path = omc_NFFunction_Function_nameConsiderBuiltin(threadData, _fn);
  
  
  { /* match expression */
    modelica_string tmp4_1;
    tmp4_1 = omc_AbsynUtil_pathFirstIdent(threadData, _fn_path);
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 8; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (3 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT5), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinCat(threadData, _args, _call, _resize, &tmp1_c1);
          goto tmp3_done;
        }
        case 1: {
          if (3 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT6), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinGeneric(threadData, _call, &tmp1_c1);
          goto tmp3_done;
        }
        case 2: {
          if (8 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT7), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinDiagonal(threadData, listHead(_args), &tmp1_c1);
          goto tmp3_done;
        }
        case 3: {
          if (4 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT8), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinFill(threadData, _args, &tmp1_c1);
          goto tmp3_done;
        }
        case 4: {
          if (3 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT9), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinGeneric(threadData, _call, &tmp1_c1);
          goto tmp3_done;
        }
        case 5: {
          if (8 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT10), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinGeneric(threadData, _call, &tmp1_c1);
          goto tmp3_done;
        }
        case 6: {
          if (7 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT11), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinPromote(threadData, _args, &tmp1_c1);
          goto tmp3_done;
        }
        case 7: {
          if (9 != MMC_STRLEN(tmp4_1) || strcmp(MMC_STRINGDATA(_OMC_LIT12), MMC_STRINGDATA(tmp4_1)) != 0) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinTranspose(threadData, listHead(_args), &tmp1_c1);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outExp = tmpMeta[0+0];
  _expanded = tmp1_c1;
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandBuiltinCall(threadData_t *threadData, modelica_metatype _fn, modelica_metatype _args, modelica_metatype _call, modelica_metatype _resize, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  tmp1 = mmc_unbox_integer(_resize);
  _outExp = omc_NFExpandExp_expandBuiltinCall(threadData, _fn, _args, _call, tmp1, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandCall(threadData_t *threadData, modelica_metatype _call, modelica_metatype _exp, modelica_boolean _resize, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  
  
  { /* matchcontinue expression */
    volatile modelica_metatype tmp4_1;
    tmp4_1 = _call;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      MMC_TRY_INTERNAL(mmc_jumper)
      tmp3_top:
      threadData->mmc_jumper = &new_mmc_jumper;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,6) == 0) goto tmp3_end;
          
          tmp4 += 1; /* Pattern matching succeeded; we may skip some cases if we fail */
          /* Check guard condition after assignments */
          if (!(omc_NFFunction_Function_isBuiltin(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 2)))) && (!omc_NFFunction_Function_isImpure(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 2))))))) goto tmp3_end;
          tmpMeta[0+0] = omc_NFExpandExp_expandBuiltinCall(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 6))), _call, _resize, &tmp1_c1);
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,4,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandArrayConstructor(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 5))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 2))), (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_call), 6))), &tmp1_c1);
          goto tmp3_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandGeneric(threadData, _exp, _resize, &tmp1_c1);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      tmp3_done:
      (void)tmp4;
      MMC_RESTORE_INTERNAL(mmc_jumper);
      goto tmp3_done2;
      goto_2:;
      MMC_CATCH_INTERNAL(mmc_jumper);
      if (++tmp4 < 3) {
        goto tmp3_top;
      }
      MMC_THROW_INTERNAL();
      tmp3_done2:;
    }
  }
  _outExp = tmpMeta[0+0];
  _expanded = tmp1_c1;
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandCall(threadData_t *threadData, modelica_metatype _call, modelica_metatype _exp, modelica_metatype _resize, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  tmp1 = mmc_unbox_integer(_resize);
  _outExp = omc_NFExpandExp_expandCall(threadData, _call, _exp, tmp1, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandRange(threadData_t *threadData, modelica_metatype _exp, modelica_boolean *out_expanded)
{
  modelica_metatype _outExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _range_iter = NULL;
  modelica_metatype _ty = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  // _expanded has no default value.
  // _range_iter has no default value.
  // _ty has no default value.
  /* Pattern-matching assignment */
  tmpMeta1 = _exp;
  if (mmc__uniontype__metarecord__typedef__equal(tmpMeta1,10,4) == 0) MMC_THROW_INTERNAL();
  tmpMeta2 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta1), 2));
  _ty = tmpMeta2;

  _expanded = omc_NFExpression_isLiteral(threadData, _exp);

  if(_expanded)
  {
    _outExp = omc_NFCeval_evalExp(threadData, _exp, _OMC_LIT3);
  }
  else
  {
    _outExp = _exp;
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExp;
}
modelica_metatype boxptr_NFExpandExp_expandRange(threadData_t *threadData, modelica_metatype _exp, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outExp = NULL;
  _outExp = omc_NFExpandExp_expandRange(threadData, _exp, &_expanded);
  /* skip box _outExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandTypename(threadData_t *threadData, modelica_metatype _ty)
{
  modelica_metatype _outExp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outExp has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _ty;
    {
      modelica_metatype _lits = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _lits has no default value.
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,3,0) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta1 = omc_NFExpression_makeArray(threadData, _ty, listArray(_OMC_LIT16), 1 /* true */);
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,2) == 0) goto tmp3_end;
          tmpMeta7 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,5,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          _lits = omc_NFExpression_makeEnumLiterals(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_ty), 2))));
          tmpMeta1 = omc_NFExpression_makeArray(threadData, _ty, listArray(_lits), 1 /* true */);
          goto tmp3_done;
        }
        case 2: {
          
          /* Pattern matching succeeded */
          omc_Error_addInternalError(threadData, _OMC_LIT17, _OMC_LIT19);
          goto goto_2;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _outExp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _outExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandCref4(threadData_t *threadData, modelica_metatype _subs, modelica_metatype _comb, modelica_metatype _accum, modelica_metatype _restSubs, modelica_metatype _cref, modelica_metatype _crefType)
{
  modelica_metatype _arrayExp = NULL;
  modelica_metatype _expl = NULL;
  modelica_metatype _arr_ty = NULL;
  modelica_metatype _slice = NULL;
  modelica_metatype _rest = NULL;
  modelica_integer _i;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _arrayExp has no default value.
  // _expl has no default value.
  // _arr_ty has no default value.
  // _slice has no default value.
  // _rest has no default value.
  // _i has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _subs;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 3; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (!listEmpty(tmp4_1)) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta6 = mmc_mk_cons(listReverse(_comb), _accum);
          tmpMeta1 = omc_NFExpandExp_expandCref3(threadData, _restSubs, _cref, _crefType, tmpMeta6);
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_metatype tmpMeta9;
          modelica_metatype tmpMeta10;
          modelica_metatype tmpMeta11;
          modelica_metatype tmpMeta12;
          if (listEmpty(tmp4_1)) goto tmp3_end;
          tmpMeta7 = MMC_CAR(tmp4_1);
          tmpMeta8 = MMC_CDR(tmp4_1);
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta7,4,1) == 0) goto tmp3_end;
          tmpMeta9 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta7), 2));
          _slice = tmpMeta9;
          _rest = tmpMeta8;
          /* Pattern matching succeeded */
          _expl = arrayCreateNoInit(listLength(_slice), _OMC_LIT20);

          _i = ((modelica_integer) 1);

          {
            modelica_metatype _idx;
            for (tmpMeta10 = _slice; !listEmpty(tmpMeta10); tmpMeta10=MMC_CDR(tmpMeta10))
            {
              _idx = MMC_CAR(tmpMeta10);
              tmpMeta11 = mmc_mk_cons(_idx, _comb);
              arrayUpdateNoBoundsChecking(_expl, _i, omc_NFExpandExp_expandCref4(threadData, _rest, tmpMeta11, _accum, _restSubs, _cref, _crefType));

              _i = ((modelica_integer) 1) + _i;
            }
          }

          _arr_ty = omc_NFType_liftArrayLeft(threadData, omc_NFExpression_typeOf(threadData, arrayGet(_expl, ((modelica_integer) 1))), omc_NFDimension_fromExpArray(threadData, _expl));
          tmpMeta1 = omc_NFExpression_makeArray(threadData, _arr_ty, _expl, 0 /* false */);
          goto tmp3_done;
        }
        case 2: {
          modelica_metatype tmpMeta13;
          modelica_metatype tmpMeta14;
          
          /* Pattern matching succeeded */
          tmpMeta14 = mmc_mk_cons(listHead(_subs), _comb);
          /* Tail recursive call */
          tmpMeta13 = listRest(_subs);
          _comb = tmpMeta14;
          _subs = tmpMeta13;
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _arrayExp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _arrayExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandCref3(threadData_t *threadData, modelica_metatype _subs, modelica_metatype _cref, modelica_metatype _crefType, modelica_metatype _accum)
{
  modelica_metatype _arrayExp = NULL;
  modelica_metatype tmpMeta1;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _arrayExp has no default value.
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _subs;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          if (!listEmpty(tmp4_1)) goto tmp3_end;
          /* Pattern matching succeeded */
          tmpMeta6 = mmc_mk_box3(9, &NFExpression_CREF__desc, _crefType, omc_NFComponentRef_setSubscriptsList(threadData, _accum, _cref));
          tmpMeta1 = tmpMeta6;
          goto tmp3_done;
        }
        case 1: {
          modelica_metatype tmpMeta7;
          
          /* Pattern matching succeeded */
          tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
          tmpMeta1 = omc_NFExpandExp_expandCref4(threadData, listHead(_subs), tmpMeta7, _accum, listRest(_subs), _cref, _crefType);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _arrayExp = tmpMeta1;
  _return: OMC_LABEL_UNUSED
  return _arrayExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandCref2(threadData_t *threadData, modelica_metatype _cref, modelica_boolean _backend, modelica_metatype __omcQ_24in_5Fsubs)
{
  modelica_metatype _subs = NULL;
  modelica_metatype _cr_subs = NULL;
  modelica_metatype tmpMeta1;
  modelica_metatype _dims = NULL;
  modelica_metatype tmpMeta2;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _subs = __omcQ_24in_5Fsubs;
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _cr_subs = tmpMeta1;
  // _dims has no default value.
  { /* match expression */
    modelica_metatype tmp5_1;
    tmp5_1 = _cref;
    {
      volatile mmc_switch_type tmp5;
      int tmp6;
      tmp5 = 0;
      for (; tmp5 < 2; tmp5++) {
        switch (MMC_SWITCH_CAST(tmp5)) {
        case 0: {
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          modelica_boolean tmp9;
          modelica_metatype tmpMeta10;
          if (mmc__uniontype__metarecord__typedef__equal(tmp5_1,0,5) == 0) goto tmp4_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!(_backend || (mmc_unbox_integer((MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cref), 5)))) == 1))) goto tmp4_end;
          _dims = omc_NFType_arrayDims(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cref), 4))));

          _cr_subs = omc_NFSubscript_expandList(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cref), 3))), _dims, _backend);
          tmp9 = (modelica_boolean)(listEmpty(_cr_subs) && (!listEmpty(_dims)));
          if(tmp9)
          {
            tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
            tmpMeta10 = tmpMeta7;
          }
          else
          {
            tmpMeta8 = mmc_mk_cons(_cr_subs, _subs);
            /* Tail recursive call */
            _cref = (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_cref), 6)));
            __omcQ_24in_5Fsubs = tmpMeta8;
            goto _tailrecursive;
            /* TODO: Make sure any eventual dead code below is never generated */
          }
          tmpMeta2 = tmpMeta10;
          goto tmp4_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta2 = _subs;
          goto tmp4_done;
        }
        }
        goto tmp4_end;
        tmp4_end: ;
      }
      goto goto_3;
      goto_3:;
      MMC_THROW_INTERNAL();
      goto tmp4_done;
      tmp4_done:;
    }
  }
  _subs = tmpMeta2;
  _return: OMC_LABEL_UNUSED
  return _subs;
}
modelica_metatype boxptr_NFExpandExp_expandCref2(threadData_t *threadData, modelica_metatype _cref, modelica_metatype _backend, modelica_metatype __omcQ_24in_5Fsubs)
{
  modelica_integer tmp1;
  modelica_metatype _subs = NULL;
  tmp1 = mmc_unbox_integer(_backend);
  _subs = omc_NFExpandExp_expandCref2(threadData, _cref, tmp1, __omcQ_24in_5Fsubs);
  /* skip box _subs; list<list<NFSubscript>> */
  return _subs;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandCref(threadData_t *threadData, modelica_metatype _crefExp, modelica_boolean _backend, modelica_boolean *out_expanded)
{
  modelica_metatype _arrayExp = NULL;
  modelica_boolean _expanded;
  modelica_metatype _subs = NULL;
  modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _arrayExp has no default value.
  // _expanded has no default value.
  // _subs has no default value.
  
  
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _crefExp;
    {
      volatile mmc_switch_type tmp4;
      int tmp5;
      tmp4 = 0;
      for (; tmp4 < 2; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          modelica_metatype tmpMeta6;
          modelica_metatype tmpMeta7;
          modelica_metatype tmpMeta8;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,0,5) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          if(omc_NFType_hasZeroDimension(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_crefExp), 2)))))
          {
            _arrayExp = omc_NFExpression_makeEmptyArray(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_crefExp), 2))));

            _expanded = 1 /* true */;
          }
          else
          {
            if(omc_NFType_hasKnownSize(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_crefExp), 2)))))
            {
              tmpMeta7 = MMC_REFSTRUCTLIT(mmc_nil);
              _subs = omc_NFExpandExp_expandCref2(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_crefExp), 3))), _backend, tmpMeta7);

              tmpMeta8 = MMC_REFSTRUCTLIT(mmc_nil);
              _arrayExp = omc_NFExpandExp_expandCref3(threadData, _subs, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_crefExp), 3))), omc_NFType_arrayElementType(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_crefExp), 2)))), tmpMeta8);

              _expanded = 1 /* true */;
            }
            else
            {
              _arrayExp = _crefExp;

              _expanded = 0 /* false */;
            }
          }
          tmpMeta[0+0] = _arrayExp;
          tmp1_c1 = _expanded;
          goto tmp3_done;
        }
        case 1: {
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _crefExp;
          tmp1_c1 = 0 /* false */;
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _arrayExp = tmpMeta[0+0];
  _expanded = tmp1_c1;
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _arrayExp;
}
modelica_metatype boxptr_NFExpandExp_expandCref(threadData_t *threadData, modelica_metatype _crefExp, modelica_metatype _backend, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _arrayExp = NULL;
  tmp1 = mmc_unbox_integer(_backend);
  _arrayExp = omc_NFExpandExp_expandCref(threadData, _crefExp, tmp1, &_expanded);
  /* skip box _arrayExp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _arrayExp;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandList(threadData_t *threadData, modelica_metatype _expl, modelica_boolean _abortOnFailure, modelica_boolean *out_expanded)
{
  modelica_metatype _outExpl = NULL;
  modelica_metatype tmpMeta1;
  modelica_boolean _expanded;
  modelica_boolean _res;
  modelica_metatype tmpMeta2;
  modelica_metatype tmpMeta3;
  modelica_metatype tmpMeta4;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  tmpMeta1 = MMC_REFSTRUCTLIT(mmc_nil);
  _outExpl = tmpMeta1;
  _expanded = 1 /* true */;
  // _res has no default value.
  {
    modelica_metatype _exp;
    for (tmpMeta2 = _expl; !listEmpty(tmpMeta2); tmpMeta2=MMC_CDR(tmpMeta2))
    {
      _exp = MMC_CAR(tmpMeta2);
      _exp = omc_NFExpandExp_expand(threadData, _exp, 0 /* false */ ,&_res);

      _expanded = (_res && _expanded);

      if(((!_res) && _abortOnFailure))
      {
        _outExpl = _expl;

        goto _return;
      }

      tmpMeta3 = mmc_mk_cons(_exp, _outExpl);
      _outExpl = tmpMeta3;
    }
  }

  _outExpl = listReverseInPlace(_outExpl);
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outExpl;
}
modelica_metatype boxptr_NFExpandExp_expandList(threadData_t *threadData, modelica_metatype _expl, modelica_metatype _abortOnFailure, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _outExpl = NULL;
  modelica_metatype tmpMeta2;
  tmp1 = mmc_unbox_integer(_abortOnFailure);
  _outExpl = omc_NFExpandExp_expandList(threadData, _expl, tmp1, &_expanded);
  /* skip box _outExpl; list<NFExpression> */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outExpl;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expandArray(threadData_t *threadData, modelica_metatype _arr, modelica_boolean *out_expanded)
{
  modelica_metatype _outArray = NULL;
  modelica_boolean _expanded;
  modelica_boolean _res;
  modelica_metatype _e = NULL;
  modelica_integer tmp1;
  modelica_integer tmp2;
  modelica_integer tmp3;
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  // _outArray has no default value.
  _expanded = 1 /* true */;
  // _res has no default value.
  // _e has no default value.
  _outArray = arrayCopy(_arr);

  tmp1 = ((modelica_integer) 1); tmp2 = 1; tmp3 = arrayLength(_outArray);
  if(!(((tmp2 > 0) && (tmp1 > tmp3)) || ((tmp2 < 0) && (tmp1 < tmp3))))
  {
    modelica_integer _i;
    for(_i = ((modelica_integer) 1); in_range_integer(_i, tmp1, tmp3); _i += tmp2)
    {
      _e = omc_NFExpandExp_expand(threadData, arrayGetNoBoundsChecking(_outArray, _i), 0 /* false */ ,&_res);

      if((!_res))
      {
        _expanded = 0 /* false */;

        goto _return;
      }

      arrayUpdateNoBoundsChecking(_outArray, _i, _e);
    }
  }
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _outArray;
}
modelica_metatype boxptr_NFExpandExp_expandArray(threadData_t *threadData, modelica_metatype _arr, modelica_metatype *out_expanded)
{
  modelica_boolean _expanded;
  modelica_metatype _outArray = NULL;
  _outArray = omc_NFExpandExp_expandArray(threadData, _arr, &_expanded);
  /* skip box _outArray; array<NFExpression> */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _outArray;
}

DLLDirection
modelica_metatype omc_NFExpandExp_expand(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_boolean _backend, modelica_boolean *out_expanded)
{
  modelica_metatype _exp = NULL;
  modelica_boolean _expanded;
  modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
  modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
  MMC_SO();
  _tailrecursive: OMC_LABEL_UNUSED
  _exp = __omcQ_24in_5Fexp;
  // _expanded has no default value.
  
  
  { /* match expression */
    modelica_metatype tmp4_1;
    tmp4_1 = _exp;
    {
      modelica_metatype _arr = NULL;
      volatile mmc_switch_type tmp4;
      int tmp5;
      // _arr has no default value.
      tmp4 = 0;
      for (; tmp4 < 21; tmp4++) {
        switch (MMC_SWITCH_CAST(tmp4)) {
        case 0: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 1: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 2: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 3: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,3,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 4: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,4,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 5: {
          modelica_metatype tmpMeta6;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,6,2) == 0) goto tmp3_end;
          tmpMeta6 = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
          if (mmc__uniontype__metarecord__typedef__equal(tmpMeta6,7,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandCref(threadData, _exp, _backend, &tmp1_c1);
          goto tmp3_done;
        }
        case 6: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Check guard condition after assignments */
          if (!omc_NFType_isVector(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))))) goto tmp3_end;
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 7: {
          modelica_metatype tmpMeta7;
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,8,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          _arr = omc_NFExpandExp_expandArray(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))) ,&_expanded);

          tmpMeta7 = MMC_TAGPTR(mmc_alloc_words(5));
          memcpy(MMC_UNTAGPTR(tmpMeta7), MMC_UNTAGPTR(_exp), 5*sizeof(modelica_metatype));
          ((modelica_metatype*)MMC_UNTAGPTR(tmpMeta7))[3] = _arr;
          _exp = tmpMeta7;
          tmpMeta[0+0] = _exp;
          tmp1_c1 = _expanded;
          goto tmp3_done;
        }
        case 8: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,7,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandTypename(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))));
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 9: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,10,4) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandRange(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 10: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,13,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandCall(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 2))), _exp, _backend, &tmp1_c1);
          goto tmp3_done;
        }
        case 11: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,14,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandSize(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 12: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,16,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandBinary(threadData, _exp, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_exp), 3))), _backend, &tmp1_c1);
          goto tmp3_done;
        }
        case 13: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,21,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          /* Tail recursive call */
          __omcQ_24in_5Fexp = omc_NFSimplifyExp_splitMultary(threadData, _exp);
          goto _tailrecursive;
          /* TODO: Make sure any eventual dead code below is never generated */
          goto tmp3_done;
        }
        case 14: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,17,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandUnary(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 15: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,18,3) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandLogicalBinary(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 16: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,19,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandLogicalUnary(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 17: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,20,4) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 18: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,23,2) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandCast(threadData, _exp, &tmp1_c1);
          goto tmp3_done;
        }
        case 19: {
          if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,32,1) == 0) goto tmp3_end;
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = _exp;
          tmp1_c1 = 1 /* true */;
          goto tmp3_done;
        }
        case 20: {
          
          /* Pattern matching succeeded */
          tmpMeta[0+0] = omc_NFExpandExp_expandGeneric(threadData, _exp, _backend, &tmp1_c1);
          goto tmp3_done;
        }
        }
        goto tmp3_end;
        tmp3_end: ;
      }
      goto goto_2;
      goto_2:;
      MMC_THROW_INTERNAL();
      goto tmp3_done;
      tmp3_done:;
    }
  }
  _exp = tmpMeta[0+0];
  _expanded = tmp1_c1;
  _return: OMC_LABEL_UNUSED
  if (out_expanded) { *out_expanded = _expanded; }
  return _exp;
}
modelica_metatype boxptr_NFExpandExp_expand(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fexp, modelica_metatype _backend, modelica_metatype *out_expanded)
{
  modelica_integer tmp1;
  modelica_boolean _expanded;
  modelica_metatype _exp = NULL;
  tmp1 = mmc_unbox_integer(_backend);
  _exp = omc_NFExpandExp_expand(threadData, __omcQ_24in_5Fexp, tmp1, &_expanded);
  /* skip box _exp; NFExpression */
  if (out_expanded) { *out_expanded = mmc_mk_icon(_expanded); }
  return _exp;
}

